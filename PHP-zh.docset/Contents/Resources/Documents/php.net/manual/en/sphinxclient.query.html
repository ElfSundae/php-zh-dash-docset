<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>执行搜索查询</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="sphinxclient.open.html">? SphinxClient::open</a></li>
      <li style="float: right;"><a href="sphinxclient.resetfilters.html">SphinxClient::resetFilters ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.sphinxclient.html">SphinxClient</a></li>
    <li>执行搜索查询</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="sphinxclient.query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">SphinxClient::query</h1>
  <p class="verinfo">(PECL sphinx &gt;= 0.1.0)</p><p class="refpurpose"><span class="refname">SphinxClient::query</span> &mdash; <span class="dc-title">执行搜索查询</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-sphinxclient.query-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>SphinxClient::query</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$query</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$index</code><span class="initializer"> = &quot;*&quot;</span></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$comment</code><span class="initializer"> = &quot;&quot;</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   连接到searchd服务器，根据服务器的当前设置执行给定的查询，取得并返回结果集.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-sphinxclient.query-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">query</code></dt>

     <dd>

      <p class="para">
      查询字符串.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">index</code></dt>

     <dd>

      <p class="para">
       索引名称 (可以为多个，使用逗号分割，或者为"*"表示全部索引).
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">comment</code></dt>

     <dd>

      <p class="para">
      发送到searchd的查询日志的注释内容
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-sphinxclient.query-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果搜索成功, <span class="function"><strong>SphinxClient::query()</strong></span> 返回的结果集列表包含找到的全部匹配项中的一部分，以及与查询相关的统计数据. 结果集是哈希结构，包含如下键和值:
   <table class="doctable table">
    <caption><strong>返回数据结构</strong></caption>
    
     <thead>
      <tr>
       <th>键</th>
       <th>值说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>&quot;matches&quot;</td>
       <td>存储文档ID以及其对应的另一个包含文档权重和属性值的hash表</td>
      </tr>

      <tr>
       <td>&quot;total&quot;</td>
       <td>此查询在服务器检索所得的匹配文档总数（即服务器端结果集的大小，且与相关设置有关） </td>
      </tr>

      <tr>
       <td>&quot;total_found&quot;</td>
       <td>（服务器上找到和处理了的）索引中匹配文档的总数</td>
      </tr>

      <tr>
       <td>&quot;words&quot;</td>
       <td>将查询关键字（关键字已经过大小写转换，取词干和其他处理）映射到一个包含关于关键字的统计数据（"docs"&mdash;&mdash;在多少文档中出现，"hits"&mdash;&mdash;共出现了多少次）的小hash表上。</td>
      </tr>

      <tr>
       <td>&quot;error&quot;</td>
       <td>searchd报告的错误信息</td>
      </tr>

      <tr>
       <td>&quot;warning&quot;</td>
       <td>searchd报告的警告信息</td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-sphinxclient.query-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="sphinxclient.runqueries.html" class="xref">SphinxClient::runQueries</a></li>
    <li class="member"><a href="sphinxclient.addquery.html" class="xref">SphinxClient::addQuery</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117978""></a>
  <div class="note">
   <strong class="user">design dot ber at gmail dot com</strong>
   <a href="#117978" class="date">12-Sep-2015 02:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can limit the search to certain indexes separated by anything other than letters, numbers, underscores, and dashes.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// All valid<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">Query</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'main delta'</span><span class="keyword">);<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">Query</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'main;delta'</span><span class="keyword">);<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">Query</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'main, delta'</span><span class="keyword">);<br />
</span><span class="default">$client</span><span class="keyword">-&gt;</span><span class="default">Query</span><span class="keyword">(</span><span class="string">'test'</span><span class="keyword">, </span><span class="string">'main:delta'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102434""></a>
  <div class="note">
   <strong class="user">moosh at php dot net</strong>
   <a href="#102434" class="date">14-Feb-2011 12:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
public array SphinxClient::query ( string $query [, string $index = "*" [, string $comment = "" ]] )<br />
<br />
If you add a value for comment, you can retrieve them in sphinx query log.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="99927""></a>
  <div class="note">
   <strong class="user">php at senz dot su</strong>
   <a href="#99927" class="date">15-Sep-2010 04:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is also a "status" key showing in what status query has ended. 
<br />
Here are codes, taken from searchd.cpp:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">/// known status return codes
<br />
</span><span class="default">enum SearchdStatus_e
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">SEARCHD_OK&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">///&lt; general success, command-specific reply follows
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">SEARCHD_ERROR&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">///&lt; general failure, error message follows
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">SEARCHD_RETRY&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">2</span><span class="keyword">,&nbsp; &nbsp; </span><span class="comment">///&lt; temporary failure, error message follows, client should retry later
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">SEARCHD_WARNING </span><span class="keyword">= </span><span class="default">3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">///&lt; general success, warning message and command-specific reply follow
<br />
</span><span class="keyword">};
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87585""></a>
  <div class="note">
   <strong class="user">fkoehl at gmail dot com</strong>
   <a href="#87585" class="date">11-Dec-2008 05:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears that Query() (or the Sphinx program in general) does have some kind of limit imposed on the maximum length of a query submission. Stumbled across this limitation when trying to perform some searches based on content from user-submitted e-mails.<br />
<br />
In looking at the returned array, the 'words' portion only accounts for the first 8 or 9 words of the long query. I'm assuming that the rest of the string is being truncated. The number of accepted words appears to change based on the total length of the words. Just a heads-up.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
