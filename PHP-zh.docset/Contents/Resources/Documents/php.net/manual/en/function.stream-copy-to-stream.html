<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Copies data from one stream to another</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.stream-context-set-params.html">? stream_context_set_params</a></li>
      <li style="float: right;"><a href="function.stream-encoding.html">stream_encoding ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.stream.html">Stream 函数</a></li>
    <li>Copies data from one stream to another</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.stream-copy-to-stream" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">stream_copy_to_stream</h1>
  <p class="verinfo">(PHP 5)</p><p class="refpurpose"><span class="refname">stream_copy_to_stream</span> &mdash; <span class="dc-title">Copies data from one stream to another</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.stream-copy-to-stream-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>stream_copy_to_stream</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$source</code></span>
   , <span class="methodparam"><span class="type">resource</span> <code class="parameter">$dest</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$maxlength</code><span class="initializer"> = -1</span></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$offset</code><span class="initializer"> = 0</span></span>
  ]] )</div>

  <p class="para rdfs-comment">
   Makes a copy of up to <code class="parameter">maxlength</code> bytes
   of data from the current position (or from the
   <code class="parameter">offset</code> position, if specified) in
   <code class="parameter">source</code> to <code class="parameter">dest</code>. If
   <code class="parameter">maxlength</code> is not specified, all remaining content in
   <code class="parameter">source</code> will be copied.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.stream-copy-to-stream-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">source</code></dt>

     <dd>

      <p class="para">
       The source stream
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">dest</code></dt>

     <dd>

      <p class="para">
       The destination stream
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">maxlength</code></dt>

     <dd>

      <p class="para">
       Maximum bytes to copy
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">offset</code></dt>

     <dd>

      <p class="para">
       The offset where to start to copy data
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.stream-copy-to-stream-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns the total count of bytes copied.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.stream-copy-to-stream-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.1.0</td>
       <td>
        Added the <code class="parameter">offset</code> parameter
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.stream-copy-to-stream-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-4037">
    <p><strong>Example #1 A <span class="function"><strong>stream_copy_to_stream()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$src&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'http://www.example.com'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'r'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$dest1&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'first1k.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$dest2&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #DD0000">'remainder.txt'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'w'</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">stream_copy_to_stream</span><span style="color: #007700">(</span><span style="color: #0000BB">$src</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dest1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1024</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;bytes&nbsp;copied&nbsp;to&nbsp;first1k.txt\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">stream_copy_to_stream</span><span style="color: #007700">(</span><span style="color: #0000BB">$src</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$dest2</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">"&nbsp;bytes&nbsp;copied&nbsp;to&nbsp;remainder.txt\n"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.stream-copy-to-stream-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.copy.html" class="function" rel="rdfs-seeAlso">copy()</a> - 拷贝文件</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="98119""></a>
  <div class="note">
   <strong class="user">felix dot nensa at gmail dot com</strong>
   <a href="#98119" class="date">27-May-2010 01:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As stream_copy_to_stream() seems to be quite a memory hog (at least in PHP 5.1.6 64-bit) it may be way more efficient just to copy streams with this simple PHP alternative:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">pipe_streams</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">, </span><span class="default">$out</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$size </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">)) </span><span class="default">$size </span><span class="keyword">+= </span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$out</span><span class="keyword">,</span><span class="default">fread</span><span class="keyword">(</span><span class="default">$in</span><span class="keyword">,</span><span class="default">8192</span><span class="keyword">));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$size</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76669""></a>
  <div class="note">
   <strong class="user">sundance2001 guess what gmail.com</strong>
   <a href="#76669" class="date">25-Jul-2007 03:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you need to copy a file from any website into yours you can use following function:<br />
<br />
function getUrlContents($url)<br />
{<br />
&nbsp;&nbsp; $url_parsed = parse_url($url);<br />
<br />
&nbsp;&nbsp; $host = $url_parsed["host"];<br />
&nbsp;&nbsp; if ($url == '' || $host == '') {<br />
&nbsp;&nbsp; &nbsp; &nbsp; return false;<br />
&nbsp;&nbsp; }<br />
&nbsp;&nbsp; $port = 80;<br />
&nbsp;&nbsp; $path = (empty($url_parsed["path"]) ? '/' : $url_parsed["path"]);<br />
&nbsp;&nbsp; $path.= (!empty($url_parsed["query"]) ? '?'.$url_parsed["query"] : '');<br />
&nbsp;&nbsp; $out = "GET $path HTTP/1.0\r\nHost: $host\r\nConnection: Close\r\n\r\n";<br />
&nbsp;&nbsp; $fp = fsockopen($host, $port, $errno, $errstr, 30);<br />
&nbsp;&nbsp; fwrite($fp, $out);<br />
&nbsp;&nbsp; $headers = '';<br />
&nbsp;&nbsp; $content = '';<br />
&nbsp;&nbsp; $buf = '';<br />
&nbsp;&nbsp; $isBody = false;<br />
&nbsp; while (!feof($fp) and !$isBody) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $buf = fgets($fp, 1024);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ($buf == "\r\n" ) {$isBody = true;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else{$headers .= $buf;}<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $file1 = fopen(basename($url_parsed["path"]), 'w');<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; $bytes=stream_copy_to_stream($fp,$file1);<br />
&nbsp;&nbsp; fclose($fp);<br />
&nbsp;&nbsp; return $bytes;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75790""></a>
  <div class="note">
   <strong class="user">none at noone dot com</strong>
   <a href="#75790" class="date">16-Jun-2007 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
stream_copy_to_stream almost copies a stream...<br />
<br />
$objInputStream = fopen("php://input", "rb");<br />
$objTempStream = fopen("php://temp", "w+b");<br />
stream_copy_to_stream($objInputStream, $objTempStream);<br />
<br />
That code will copy a stream but it will also move the stream pointers to EOF.&nbsp; This is fine if you plan on rewinding the temp stream but good luck rewinding the input stream.<br />
<br />
rewind($objTempStream);<br />
rewind($objInputStream);<br />
<br />
So as you can see this is stream copy or stream move depending on what kind of stream you are working with, and because there are no peaking functions your effed if you need to read from an input stream in multiple classes that are unrelated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
