<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Creates a new service entry in the SCM database</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.win32-continue-service.html">? win32_continue_service</a></li>
      <li style="float: right;"><a href="function.win32-delete-service.html">win32_delete_service ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.win32service.html">win32service 函数</a></li>
    <li>Creates a new service entry in the SCM database</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.win32-create-service" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">win32_create_service</h1>
  <p class="verinfo">(PECL win32service SVN)</p><p class="refpurpose"><span class="refname">win32_create_service</span> &mdash; <span class="dc-title">Creates a new service entry in the SCM database</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.win32-create-service-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>win32_create_service</strong></span>
    ( <span class="methodparam"><span class="type">array</span> <code class="parameter">$details</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$machine</code></span>
  ] )</div>

 </div>

 <div class="refsect1 parameters" id="refsect1-function.win32-create-service-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">details</code></dt>

     <dd>

      <p class="para">
       An array of service details:
       <dl>

        
         <dt>
<code class="parameter">service</code></dt>

         <dd>

          <p class="para">
           The short name of the service.  This is the name that you
           will use to control the service using the <em>net</em>
           command.  The service must be unique (no two services can share the
           same name), and, ideally, should avoid having spaces in the name.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">display</code></dt>

         <dd>

          <p class="para">The display name of the service.  This is the name that you
          will see in the Services Applet.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">description</code></dt>

         <dd>

          <p class="para">The long description of the service.  This is the description
          that you will see in the Services Applet.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">user</code></dt>

         <dd>

          <p class="para">
           The name of the user account under which you want the service to
           run.  If omitted, the service will run as the LocalSystem account.
           If the username is specified, you must also provide a password.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">password</code></dt>

         <dd>

          <p class="para">
           The password that corresponds to the <code class="parameter">user</code>.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">path</code></dt>

         <dd>

          <p class="para">
           The full path to the executable module that will be launched when
           the service is started.  If omitted, the path to the current PHP
           process will be used.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">params</code></dt>

         <dd>

          <p class="para">
           Command line parameters to pass to the service when it starts.
           If you want to run a PHP script as the service, then the first
           parameter should be the full path to the PHP script that you intend
           to run. If the script name or path contains spaces, then wrap the
           full path to the PHP script with <em>&quot;</em>.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">load_order</code></dt>

         <dd>

          <p class="para">
           Controls the load_order.  This is not yet fully supported.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">svc_type</code></dt>

         <dd>

          <p class="para">
           Sets the service type.  If omitted, the default value is
           <strong><code>WIN32_SERVICE_WIN32_OWN_PROCESS</code></strong>.
           Don&#039;t change this unless you know what you&#039;re doing.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">start_type</code></dt>

         <dd>

          <p class="para">
           Specifies how the service should be started.  The default is
           <strong><code>WIN32_SERVICE_AUTO_START</code></strong> which means the
           service will be launched when the machine starts up.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">error_control</code></dt>

         <dd>

          <p class="para">
           Informs the SCM what it should do when it detects a problem with
           the service.  The default is
           <strong><code>WIN32_SERVER_ERROR_IGNORE</code></strong>.  Changing this
           value is not yet fully supported.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">delayed_start</code></dt>

         <dd>

          <p class="para">
           If <code class="parameter">delayed_start</code> is set to <strong><code>TRUE</code></strong>, then this
           will inform the SCM that this service should be started after other
           auto-start services are started plus a short delay.
          </p>
          <p class="para">
           Any service can be marked as a delayed auto-start service; however,
           this setting has no effect unless the service&#039;s
           <code class="parameter">start_type</code> is
           <strong><code>WIN32_SERVICE_AUTO_START</code></strong>.
          </p>
          <p class="para">
           This setting is only applicable on Windows Vista and Windows Server
           2008 or greater.
          </p>
         </dd>

        
        
         <dt>
<code class="parameter">base_priority</code></dt>

         <dd>

          <p class="para">
           To reduce the impact on processor utilisation, it may be necessary
           to set a base priority lower than normal.
          </p>
          <p class="para">
           The <code class="parameter">base_priority</code> can be set to one of the
           constants define in
           <a href="win32service.constants.basepriorities.html" class="link">Win32 Base Priority Classes</a>.
          </p>
         </dd>

        
       </dl>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">machine</code></dt>

     <dd>

      <p class="para">
       The optional machine name on which you want to create a service.
       If omitted, it will use the local machine.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.win32-create-service-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
    成功时返回 <strong><code>WIN32_NO_ERROR</code></strong>，参数错误时返回 <strong><code>FALSE</code></strong>，或失败时返回一个 <a href="win32service.constants.errors.html" class="link">Win32 错误码</a>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.win32-create-service-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5376">
    <p><strong>Example #1 A <span class="function"><strong>win32_create_service()</strong></span> example</strong></p>
    <div class="example-contents"><p>
     Create a service with the short name &#039;dummyphp&#039;.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$x&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">win32_create_service</span><span style="color: #007700">(array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'service'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'dummyphp'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;the&nbsp;name&nbsp;of&nbsp;your&nbsp;service<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'display'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'sample&nbsp;dummy&nbsp;PHP&nbsp;service'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;short&nbsp;description<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'description'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'This&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Windows&nbsp;service&nbsp;created&nbsp;using&nbsp;PHP.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #FF8000">#&nbsp;long&nbsp;description<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'params'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">'"'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">__FILE__&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'"&nbsp;&nbsp;run'</span><span style="color: #007700">,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">#&nbsp;path&nbsp;to&nbsp;the&nbsp;script&nbsp;and&nbsp;parameters<br /></span><span style="color: #007700">));<br /></span><span style="color: #0000BB">debug_zval_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.win32-create-service-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.win32-delete-service.html" class="function" rel="rdfs-seeAlso">win32_delete_service()</a> - Deletes a service entry from the SCM database</span></li>
    <li class="member"><a href="win32service.constants.basepriorities.html" class="link">Win32 Base Priority Classes</a></li>
    <li class="member"><a href="win32service.constants.errors.html" class="link">Win32 Error Codes</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="100333""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#100333" class="date">08-Oct-2010 07:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[An example of how to create a Windows service.&nbsp; Evaluate code first and use at your own risk!]
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">//No timeouts, Flush Content immediatly
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">ob_implicit_flush</span><span class="keyword">();
<br />
&nbsp;&nbsp;&nbsp; 
<br />
</span><span class="comment">//Service Settings
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$phpPath </span><span class="keyword">= </span><span class="string">"D:\\php\\php5.2.9"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ServiceName </span><span class="keyword">= </span><span class="string">'phpServiceName'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ServiceDisplay </span><span class="keyword">= </span><span class="string">'phpDisplayName'</span><span class="keyword">;
<br />

<br />
</span><span class="comment">//Windows Service Control
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ServiceAction </span><span class="keyword">= </span><span class="string">"status"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//$ServiceAction = "debug";
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( isset(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'ServiceAction'</span><span class="keyword">]) and </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'ServiceAction'</span><span class="keyword">]) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ServiceAction </span><span class="keyword">= </span><span class="default">addslashes</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'ServiceAction'</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; } else if ( isset(</span><span class="default">$argv</span><span class="keyword">) and isset(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) and </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ServiceAction </span><span class="keyword">= </span><span class="default">$argv</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; if( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"status" </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ServiceStatus </span><span class="keyword">= </span><span class="default">win32_query_service_status</span><span class="keyword">(</span><span class="default">$ServiceName</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_STOPPED </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Stopped\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_START_PENDING </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Start Pending\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_STOP_PENDING </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Stop Pending\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_RUNNING </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Running\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_CONTINUE_PENDING </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Continue Pending\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_PAUSE_PENDING </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Pause Pending\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else if ( </span><span class="default">$ServiceStatus</span><span class="keyword">[</span><span class="string">'CurrentState'</span><span class="keyword">] == </span><span class="default">WIN32_SERVICE_PAUSED </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Paused\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else{
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Unknown\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp;&nbsp; } else if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"install" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Install Windows Service
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_create_service</span><span class="keyword">( Array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'service' </span><span class="keyword">=&gt; </span><span class="default">$ServiceName</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'display' </span><span class="keyword">=&gt; </span><span class="default">$ServiceDisplay</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'params' </span><span class="keyword">=&gt; </span><span class="default">__FILE__ </span><span class="keyword">. </span><span class="string">" run"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'path' </span><span class="keyword">=&gt; </span><span class="default">$phpPath</span><span class="keyword">.</span><span class="string">"\\php.exe"</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Installed\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp;&nbsp; } else if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"uninstall" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Remove Windows Service
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_delete_service</span><span class="keyword">(</span><span class="default">$ServiceName</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Removed\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp;&nbsp; } else if( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"start"</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Start Windows Service
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">win32_start_service</span><span class="keyword">(</span><span class="default">$ServiceName</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Started\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp;&nbsp; } else if( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"stop" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Stop Windows Service
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">win32_stop_service</span><span class="keyword">(</span><span class="default">$ServiceName</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="string">"Service Stopped\n\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp;&nbsp; } else if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"run" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Run Windows Service
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_start_service_ctrl_dispatcher</span><span class="keyword">(</span><span class="default">$ServiceName</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_set_service_status</span><span class="keyword">(</span><span class="default">WIN32_SERVICE_RUNNING</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"debug" </span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Debug Windows Service
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exit();
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//Server Loop
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">1</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//Handle Windows Service Request
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">*</span><span class="default">1000</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"run" </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; switch ( </span><span class="default">win32_get_last_control_message</span><span class="keyword">() ) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">WIN32_SERVICE_CONTROL_CONTINUE</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">WIN32_SERVICE_CONTROL_INTERROGATE</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_set_service_status</span><span class="keyword">(</span><span class="default">WIN32_NO_ERROR</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; break;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; case </span><span class="default">WIN32_SERVICE_CONTROL_STOP</span><span class="keyword">:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_set_service_status</span><span class="keyword">(</span><span class="default">WIN32_SERVICE_STOPPED</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; exit;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; default:
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_set_service_status</span><span class="keyword">(</span><span class="default">WIN32_ERROR_CALL_NOT_IMPLEMENTED</span><span class="keyword">); 
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//User Loop
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="string">"\n&lt;BR&gt;YOUR CODE HERE"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
</span><span class="comment">//Exit
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">$ServiceAction </span><span class="keyword">== </span><span class="string">"run" </span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">win32_set_service_status</span><span class="keyword">(</span><span class="default">WIN32_SERVICE_STOPPED</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; exit();
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72513""></a>
  <div class="note">
   <strong class="user">pauljamesthomson at gmail dot com</strong>
   <a href="#72513" class="date">22-Jan-2007 01:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Other start_type values:<br />
<br />
0x00000002: A service started automatically by the service control manager during system startup. For more information, see Automatically Starting Services.<br />
<br />
0x00000000: A device driver started by the system loader. This value is valid only for driver services.<br />
<br />
0x00000003: A service started by the service control manager when a process calls the win32_start_service() function.<br />
<br />
0x00000004: A service that cannot be started. Attempts to start the service result in the error code <br />
<br />
0x00000001: A device driver started by the IoInitSystem function. This value is valid only for driver services.<br />
<br />
I can confirm that 0x00000003 works as expected (service is created, but must be started manually).<br />
<br />
More here:<br />
<br />
<a href="http://msdn2.microsoft.com/en-us/library/ms682450.aspx" rel="nofollow" target="_blank">http://msdn2.microsoft.com/en-us/library/ms682450.aspx</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
