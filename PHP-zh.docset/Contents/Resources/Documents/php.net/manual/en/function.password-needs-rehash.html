<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Checks if the given hash matches the given options</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.password-hash.html">? password_hash</a></li>
      <li style="float: right;"><a href="function.password-verify.html">password_verify ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.password.html">Password Hashing 函数</a></li>
    <li>Checks if the given hash matches the given options</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.password-needs-rehash" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">password_needs_rehash</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.5.0)</p><p class="refpurpose"><span class="refname">password_needs_rehash</span> &mdash; <span class="dc-title">Checks if the given hash matches the given options</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.password-needs-rehash-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">boolean</span> <span class="methodname"><strong>password_needs_rehash</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$hash</code></span>
   , <span class="methodparam"><span class="type">integer</span> <code class="parameter">$algo</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   This function checks to see if the supplied hash implements the algorithm
   and options provided. If not, it is assumed that the hash needs to be
   rehashed.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.password-needs-rehash-parameters">
  <h3 class="title">参数</h3>
  <dl>

   
    <dt>
<code class="parameter">hash</code></dt>

    <dd>

     <p class="para">
      一个由 <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> 创建的散列值。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">algo</code></dt>

    <dd>

     <p class="para">
      一个用来在散列密码时指示算法的<a href="password.constants.html" class="link">密码算法常量</a>。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">options</code></dt>

    <dd>

     <p class="para">
      一个包含有选项的关联数组。目前支持两个选项：<em>salt</em>，在散列密码时加的盐（干扰字符串），以及<em>cost</em>，用来指明算法递归的层数。这两个值的例子可在 <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> 页面找到。
     </p>
    </dd>

   
  </dl>

 </div>

 
 <div class="refsect1 examples" id="refsect1-function.password-needs-rehash-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-898">
    <p><strong>Example #1 Usage of <span class="function"><strong>password_needs_rehash()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$password&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'rasmuslerdorf'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$hash&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'$2y$10$YCFsG6elYca568hBi2pZ0.3LDL5wjgxct1N8w/oLR/jfHsiQwCqTS'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;The&nbsp;cost&nbsp;parameter&nbsp;can&nbsp;change&nbsp;over&nbsp;time&nbsp;as&nbsp;hardware&nbsp;improves<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;array(</span><span style="color: #DD0000">'cost'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">11</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Verify&nbsp;stored&nbsp;hash&nbsp;against&nbsp;plain-text&nbsp;password<br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">password_verify</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$hash</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Check&nbsp;if&nbsp;a&nbsp;newer&nbsp;hashing&nbsp;algorithm&nbsp;is&nbsp;available<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;or&nbsp;the&nbsp;cost&nbsp;has&nbsp;changed<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">password_needs_rehash</span><span style="color: #007700">(</span><span style="color: #0000BB">$hash</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_DEFAULT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;so,&nbsp;create&nbsp;a&nbsp;new&nbsp;hash,&nbsp;and&nbsp;replace&nbsp;the&nbsp;old&nbsp;one<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$newHash&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">password_hash</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_DEFAULT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Log&nbsp;user&nbsp;in<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p> 
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.password-needs-rehash-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns <strong><code>TRUE</code></strong> if the hash should be rehashed to match the given
   <code class="parameter">algo</code> and <code class="parameter">options</code>, or <strong><code>FALSE</code></strong>
   otherwise.
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="115727""></a>
  <div class="note">
   <strong class="user">admin at torntech dot com</strong>
   <a href="#115727" class="date">13-Sep-2014 11:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some other use-cases for the password_needs_rehash function is when you have specified using the PASSWORD_DEFAULT algorithm for password_hash.<br />
As mentioned on the Password Hashing Predefined Constants and password_hash pages, the algorithm used by PASSWORD_DEFAULT is subject to change as different versions of PHP are released.<br />
Additionally password_needs_rehash would be used if you have changed the optional cost or static salt (DO NOT USE A STATIC SALT) requirements of your password_hash options.<br />
<br />
Full example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$new </span><span class="keyword">= [<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'options' </span><span class="keyword">=&gt; [</span><span class="string">'cost' </span><span class="keyword">=&gt; </span><span class="default">11</span><span class="keyword">],<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'algo' </span><span class="keyword">=&gt; </span><span class="default">PASSWORD_DEFAULT</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'hash' </span><span class="keyword">=&gt; </span><span class="default">null<br />
</span><span class="keyword">];<br />
<br />
</span><span class="default">$password </span><span class="keyword">= </span><span class="string">'rasmuslerdorf'</span><span class="keyword">;<br />
<br />
</span><span class="comment">//stored hash of password<br />
</span><span class="default">$oldHash </span><span class="keyword">= </span><span class="string">'$2y$07$BCryptRequires22Chrcte/VlQH0piJtjXl.0t1XkA8pw9dMXTpOq'</span><span class="keyword">;<br />
<br />
</span><span class="comment">//verify stored hash against plain-text password<br />
</span><span class="keyword">if (</span><span class="default">true </span><span class="keyword">=== </span><span class="default">password_verify</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$oldHash</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//verify legacy password to new password_hash options<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">true </span><span class="keyword">=== </span><span class="default">password_needs_rehash</span><span class="keyword">(</span><span class="default">$oldHash</span><span class="keyword">, </span><span class="default">$new</span><span class="keyword">[</span><span class="string">'algo'</span><span class="keyword">], </span><span class="default">$new</span><span class="keyword">[</span><span class="string">'options'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//rehash/store plain-text password using new hash<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$newHash </span><span class="keyword">= </span><span class="default">password_hash</span><span class="keyword">(</span><span class="default">$password</span><span class="keyword">, </span><span class="default">$new</span><span class="keyword">[</span><span class="string">'algo'</span><span class="keyword">], </span><span class="default">$new</span><span class="keyword">[</span><span class="string">'options'</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; echo </span><span class="default">$newHash</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
The above example will output something similar to:<br />
$2y$11$Wu5rN3u38.g/XWdUeA6Wj.PD.F0fLXXmZrMNFyzzg2UxkVmxlk41W</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115023""></a>
  <div class="note">
   <strong class="user">php dot net at muer dot nl</strong>
   <a href="#115023" class="date">14-May-2014 06:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
nick, this function cannot check if a string is a MD5 or SHA1 hash. It can only tell you if a password, hashed using the password_hash function, needs to be put through the hashing function again to keep up to date with the new defaults.<br />
<br />
The only time you can use this function is when your user logs in and you have already checked by means of password_verify that the password entered is actually correct. At that point, if password_needs_rehash returns true, you can put the plain text password through the password_hash function.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112733""></a>
  <div class="note">
   <strong class="user">nick at nickstallman dot net</strong>
   <a href="#112733" class="date">18-Jul-2013 09:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
ydroneaud this would be used on a login page, not at any other time.<br />
<br />
So if you have a site with MD5 passwords for example, and wish to upgrade to SHA256 for additional security you would put this check in the login script.<br />
<br />
This function will take a user's hash and say if it is SHA256, if it isn't then you can take the user's password which you still have as plaintext and rehash it as SHA256.<br />
<br />
This lets you gradually update the hashes in your database without disrupting any features or resetting passwords.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112496""></a>
  <div class="note">
   <strong class="user">ydroneaud at opteya dot com</strong>
   <a href="#112496" class="date">22-Jun-2013 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
According to the documentation, it's checking if the given hashed password string is compatible with the provided algorithm (and options, but not salt), eg. it's checking if the hashed password string was generated with the provided algorithm (and options, but not salt).<br />
<br />
There's nothing to 'rehash' in its parameters ... especially not the already hashed password string, and the password "stored" in the hashed password string is not supposed to be known, it's not in clear, it's a secret.<br />
<br />
The name of the function seems misleading, this function should have been called "password_hash_compatible()" instead.<br />
<br />
This function could be use to check if a password database/a hashed password string (hashed by function "password_hash()") need to be upgraded to a stronger password hashing/storage scheme: if the function returns false,&nbsp; a new password will have to be set for the user, hashed with the new, stronger, algorithm/options.<br />
<br />
One should carefully think before using this function to support multiple algorithms/options in one database, eg. support "legacy scheme" passwords + "new scheme" ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
