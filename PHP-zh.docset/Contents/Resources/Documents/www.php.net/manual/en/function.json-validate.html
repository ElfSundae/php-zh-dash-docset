<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>检查一个字符串是否包含有效的JSON</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.json-last-error-msg.html">? json_last_error_msg</a></li>
      <li style="float: right;"><a href="book.simdjson.html">Simdjson ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.json.html">JSON 函数</a></li>
    <li>检查一个字符串是否包含有效的JSON</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.json-validate" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">json_validate</h1>
  <p class="verinfo">(PHP 8 &gt;= 8.3.0)</p><p class="refpurpose"><span class="refname">json_validate</span> &mdash; <span class="dc-title">检查一个字符串是否包含有效的JSON</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.json-validate-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>json_validate</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$json</code></span>, <span class="methodparam"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span> <code class="parameter">$depth</code><span class="initializer"> = 512</span></span>, <span class="methodparam"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>

  <p class="para rdfs-comment">
   返回给定的 <span class="type"><a href="language.types.string.html" class="type string">string</a></span> 是否是语法上有效的 JSON。
   如果 <span class="function"><strong>json_validate()</strong></span> 返回 <strong><code><a href="reserved.constants.html#constant.true">true</a></code></strong>，<span class="function"><a href="function.json-decode.html" class="function">json_decode()</a></span> 在使用相同的 <code class="parameter">depth</code>
   和 <code class="parameter">flags</code> 时，将成功解码给定的字符串。
  </p>
  <p class="para">
   如果 <span class="function"><strong>json_validate()</strong></span> 返回 <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>，原因可以使用 <span class="function"><a href="function.json-last-error.html" class="function">json_last_error()</a></span>
   和 <span class="function"><a href="function.json-last-error-msg.html" class="function">json_last_error_msg()</a></span> 获取。
  </p>
  <p class="para">
   如果解码后的 JSON 内容未被使用，<span class="function"><strong>json_validate()</strong></span> 相比于
   <span class="function"><a href="function.json-decode.html" class="function">json_decode()</a></span> 使用了较少的内存，因为它不需要构建包含有效载荷的数组或对象结构。
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="para">
    在 <span class="function"><a href="function.json-decode.html" class="function">json_decode()</a></span> 之前调用 <span class="function"><strong>json_validate()</strong></span> 将不必要地解析字符串两次，
    因为 <span class="function"><a href="function.json-decode.html" class="function">json_decode()</a></span> 在解码过程中隐式地执行验证。
   </p>
   <p class="para">
    <span class="function"><strong>json_validate()</strong></span> 只有在解码后的 JSON 内容不会立即使用，但需要知道字符串是否包含有效的 JSON 时才有用。
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.json-validate-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt><code class="parameter">json</code></dt>
     <dd>
      <p class="para">
       需要验证的字符串。
      </p>
      <p class="para">
       该函数仅适用于 UTF-8 编码字符串。
      </p>
      
 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <p class="para">
   PHP 实现了 JSON 的一个超集，参考
   <a href="http://www.faqs.org/rfcs/rfc7159" class="link external" title="Link : http://www.faqs.org/rfcs/rfc7159">&raquo;&nbsp;RFC 7159</a>.
  </p>
 </p></blockquote>

     </dd>
    
    
     <dt><code class="parameter">depth</code></dt>
     <dd>
      <p class="para">
       解码结构的最大嵌套深度。
       该值必须大于 <code class="literal">0</code>、
       且小于或等于 <code class="literal">2147483647</code>。
      </p>
     </dd>
    
    
     <dt><code class="parameter">flags</code></dt>
     <dd>
      <p class="para">
       当前只接受 <strong><code><a href="json.constants.html#constant.json-invalid-utf8-ignore">JSON_INVALID_UTF8_IGNORE</a></code></strong>。
      </p>
     </dd>
    
   </dl>
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.json-validate-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果给定字符串是语法有效的 JSON，则返回 <strong><code><a href="reserved.constants.html#constant.true">true</a></code></strong>，否则返回 <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.json-validate-errors">
  <h3 class="title">错误／异常</h3>
  <p class="para">
   如果 <code class="parameter">depth</code> 超出允许的范围，将抛出 <span class="classname"><a href="class.valueerror.html" class="classname">ValueError</a></span>。
  </p>
  <p class="para">
   如果 <code class="parameter">flags</code> 不是一个有效的 flag，将抛出 <span class="classname"><a href="class.valueerror.html" class="classname">ValueError</a></span>。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.json-validate-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3526">
    <p><strong>Example #1 <span class="function"><strong>json_validate()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_validate</span><span style="color: #007700">(</span><span style="color: #DD0000">'{ "test": { "foo": "bar" } }'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">json_validate</span><span style="color: #007700">(</span><span style="color: #DD0000">'{ "": "": "" } }'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="examplescode"><pre class="examplescode">bool(true)
bool(false)</pre>
</div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.json-validate-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="function"><a href="function.json-decode.html" class="function" rel="rdfs-seeAlso">json_decode()</a> - 对 JSON 格式的字符串进行解码</span></li>
    <li><span class="function"><a href="function.json-last-error.html" class="function" rel="rdfs-seeAlso">json_last_error()</a> - 返回最后发生的错误</span></li>
    <li><span class="function"><a href="function.json-last-error-msg.html" class="function" rel="rdfs-seeAlso">json_last_error_msg()</a> - 返回最后一次调用 json_encode() 或 json_decode() 时产生的错误信息</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="129248""></a>
  <div class="note">
   <strong class="user">Julien T.</strong>
   <a href="#129248" class="date">15-Feb-2024 05:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Building upon Allan R.'s initial idea, I've developed an improved version of the json_validate function for those using PHP 8.2 and earlier versions. This function emulates the functionality introduced in PHP 8.3, providing an effective way to validate JSON strings in earlier PHP versions.<br />
<br />
```php<br />
if (!function_exists('json_validate')) {<br />
&nbsp;&nbsp;&nbsp; /**<br />
&nbsp;&nbsp; &nbsp; * Validates a JSON string.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * @param string $json The JSON string to validate.<br />
&nbsp;&nbsp; &nbsp; * @param int $depth Maximum depth. Must be greater than zero.<br />
&nbsp;&nbsp; &nbsp; * @param int $flags Bitmask of JSON decode options.<br />
&nbsp;&nbsp; &nbsp; * @return bool Returns true if the string is a valid JSON, otherwise false.<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; function json_validate($json, $depth = 512, $flags = 0) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!is_string($json)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; json_decode($json, false, $depth, $flags | JSON_THROW_ON_ERROR);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } catch (\JsonException $e) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
```<br />
<br />
Key Improvements:<br />
<br />
- String Check: Added a validation to ensure the input is a string.<br />
- Error Handling: Utilizes try-catch to effectively catch and handle JsonException.<br />
- Backward Compatibility: Safely integrable in older PHP versions, automatically deferring to native functionality in PHP 8.3+.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="129148""></a>
  <div class="note">
   <strong class="user">Behrad</strong>
   <a href="#129148" class="date">08-Jan-2024 12:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
---------------- PHP &lt; 8.3 ---------------- <br />
<br />
function json_validate(string $string): bool {<br />
&nbsp;&nbsp;&nbsp; json_decode($string);<br />
<br />
&nbsp;&nbsp;&nbsp; return json_last_error() === JSON_ERROR_NONE;<br />
}<br />
<br />
var_dump(json_validate('{ "test": { "foo": "bar" } }')); // true<br />
<br />
---------------- PHP &gt;= 8.3 ---------------- <br />
<br />
var_dump(json_validate('{ "test": { "foo": "bar" } }')); // true<br />
<br />
Note: code from https://www.php.net/releases/8.3/en.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
