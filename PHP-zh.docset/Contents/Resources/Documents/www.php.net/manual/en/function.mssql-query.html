<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Send MS SQL query</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.mssql-pconnect.html">? mssql_pconnect</a></li>
      <li style="float: right;"><a href="function.mssql-result.html">mssql_result ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mssql.html">Mssql 函数</a></li>
    <li>Send MS SQL query</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mssql-query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mssql_query</h1>
  <p class="verinfo">(PHP 4, PHP 5, PECL odbtp &gt;= 1.1.1)</p><p class="refpurpose"><span class="refname">mssql_query</span> &mdash; <span class="dc-title">Send MS SQL query</span></p>

 </div>
 
 <div id="function.mssql-query-refsynopsisdiv">
  <div class="warning"><strong class="warning">Warning</strong>
   
<p class="para">
 This function was <em class="emphasis">REMOVED</em> in PHP 7.0.0.
</p>
<p class="para">
 Alternatives to this function include:
</p>

   <ul class="simplelist">
    <li class="member"><span class="function"><a href="pdo.query.html" class="function">PDO::query()</a></span></li>
    <li class="member"><span class="function"><a href="function.sqlsrv-query.html" class="function">sqlsrv_query()</a></span></li>
    <li class="member"><span class="function"><a href="function.odbc-exec.html" class="function">odbc_exec()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mssql-query-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mssql_query</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$query</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code></span>
   [, <span class="methodparam"><span class="type">int</span> <code class="parameter">$batch_size</code><span class="initializer"> = 0</span></span>
  ]] ) : <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>mssql_query()</strong></span> sends a query to the currently active
   database on the server that&#039;s associated with the specified link
   identifier. 
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mssql-query-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">query</code></dt>

     <dd>

      <p class="para">
       An SQL query.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">link_identifier</code></dt>

     <dd>

      <p class="para">
       A MS SQL link identifier, returned by 
       <span class="function"><a href="function.mssql-connect.html" class="function">mssql_connect()</a></span> or 
       <span class="function"><a href="function.mssql-pconnect.html" class="function">mssql_pconnect()</a></span>.
      </p>
      <p class="para">
       If the link identifier isn&#039;t specified, the last opened link is
       assumed.  If no link is open, the function tries to establish a link
       as if <span class="function"><a href="function.mssql-connect.html" class="function">mssql_connect()</a></span> was called, and use it.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">batch_size</code></dt>

     <dd>

      <p class="para">
       The number of records to batch in the buffer.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mssql-query-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns a MS SQL result resource on success, <strong><code>TRUE</code></strong> if no rows were
   returned, or <strong><code>FALSE</code></strong> on error.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mssql-query-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-1807">
    <p><strong>Example #1 <span class="function"><strong>mssql_query()</strong></span> example</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Connect&nbsp;to&nbsp;MSSQL<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'KALLESPC\SQLEXPRESS'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'sa'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'phpfi'</span><span style="color: #007700">);<br /><br />if&nbsp;(!</span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">||&nbsp;!</span><span style="color: #0000BB">mssql_select_db</span><span style="color: #007700">(</span><span style="color: #DD0000">'php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$link</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">'Unable&nbsp;to&nbsp;connect&nbsp;or&nbsp;select&nbsp;database!'</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;Do&nbsp;a&nbsp;simple&nbsp;query,&nbsp;select&nbsp;the&nbsp;version&nbsp;of&nbsp;<br />//&nbsp;MSSQL&nbsp;and&nbsp;print&nbsp;it.<br /></span><span style="color: #0000BB">$version&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_query</span><span style="color: #007700">(</span><span style="color: #DD0000">'SELECT&nbsp;@@VERSION'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$row&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mssql_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$version</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">//&nbsp;Clean&nbsp;up<br /></span><span style="color: #0000BB">mssql_free_result</span><span style="color: #007700">(</span><span style="color: #0000BB">$version</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mssql-query-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    If the query returns multiple results then it is necessary to fetch all
    results by <span class="function"><a href="function.mssql-next-result.html" class="function">mssql_next_result()</a></span> or free the results by
    <span class="function"><a href="function.mssql-free-result.html" class="function">mssql_free_result()</a></span> before executing next query.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mssql-query-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mssql-select-db.html" class="function" rel="rdfs-seeAlso">mssql_select_db()</a> - Select MS SQL database</span></li>
    <li class="member"><span class="function"><a href="function.mssql-connect.html" class="function" rel="rdfs-seeAlso">mssql_connect()</a> - 打开MS SQL server链接</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="106954""></a>
  <div class="note">
   <strong class="user">Haprog</strong>
   <a href="#106954" class="date">20-Dec-2011 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In some cases when mssql_query() returns rows containing fields of type SMALLDATETIME or TIMESTAMP when the data is not NULL, PHP seems to enter some kind of error state where PHP no longer outputs anything to the browser. Not even data echoed before the query! DATETIME fields seem to work without this problem though.<br />
<br />
When this happens, PHP doesn't give any errors even with error_reporting(-1), and no errors appear in Apache logfiles either.<br />
<br />
There seems to be a workaround by explicitly calling flush() at the end of the skript.<br />
<br />
In my case the problem occurred only when using some basic comparison operators for integer or string fields in a WHERE clause (eg. "WHERE id = 1000").<br />
<br />
I discovered this behaviour on Ubuntu 11.10 (Linux 3.0.0-13-generic-pae), Apache 2.2.20, PHP 5.3.6-13ubuntu3.3 with Suhosin-Patch as Apache module, php5-mssql package using freetds</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105843""></a>
  <div class="note">
   <strong class="user">MSSQLNewbie</strong>
   <a href="#105843" class="date">19-Sep-2011 01:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are some things you might need to know:<br />
1. Install mssql support for Debian (Lenny/Squeeze):<br />
apt-get install php5-sybase <br />
<br />
2. When you got this error message:<br />
"Unicode data in a Unicode-only collation or ntext data cannot be sent to clients using DB-Library (such as ISQL) or ODBC version 3.7 or earlier."<br />
<br />
In /etc/freetds/freetds.conf add these two lines (last two):<br />
[global]<br />
;tds version = 4.2<br />
tds version = 8.0<br />
client charset = UTF-8<br />
<br />
You can edit "charset" in php.ini too (but you don't need if you did it previously in freetds.conf):<br />
; Specify client character set..<br />
; If empty or not set the client charset from freetds.comf is used<br />
; This is only used when compiled with FreeTDS<br />
mssql.charset = "UTF-8"<br />
<br />
3. Use nchar/nvarchar/ntext column types if you need unicode support.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104263""></a>
  <div class="note">
   <strong class="user">Wilfur</strong>
   <a href="#104263" class="date">04-Jun-2011 08:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had this problem upgrading to sqlsrv from mssql. In short, SCOPE_IDENTITY doesn't seem to work with sqlsrv correctly when using parameters. This isn't in fact the case, it just works differently.
<br />

<br />
To recap the problem:
<br />

<br />
Table 'test' definitely has an identity column id. However you can not do (apologies for pseudo-code):
<br />

<br />
<span class="default">&lt;?php
<br />
doquery</span><span class="keyword">(</span><span class="string">"INSERT INTO test (col1, col2) VALUES (?,?)"</span><span class="keyword">, </span><span class="default">$parameters</span><span class="keyword">);
<br />
</span><span class="default">$lastId</span><span class="keyword">=</span><span class="default">doquery</span><span class="keyword">(</span><span class="string">"SELECT SCOPE_IDENTITY()"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
because, under sqlsrv, these two queries are in different scopes, so there is nothing to return... However, this also doesn't work as expected:
<br />

<br />
<span class="default">&lt;?php
<br />
$query </span><span class="keyword">= </span><span class="string">"INSERT INTO test (col1, col2) VALUES (?,?); SELECT SCOPE_IDENTITY()"</span><span class="keyword">;
<br />
</span><span class="default">$arrParams</span><span class="keyword">[]=</span><span class="string">"1"</span><span class="keyword">;
<br />
</span><span class="default">$arrParams</span><span class="keyword">[]=</span><span class="string">"2"</span><span class="keyword">;
<br />
</span><span class="default">$resource</span><span class="keyword">=</span><span class="default">sqlsrv_query</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$arrParams</span><span class="keyword">);
<br />
</span><span class="default">$arrRow </span><span class="keyword">= </span><span class="default">sqlsrv_fetch_array</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">SQLSRV_FETCH_ASSOC</span><span class="keyword">);
<br />
echo </span><span class="default">$arrRow</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Here you might expect to see the last insert id, but you see nothing. This is because the resource is currently pointing to the 'true' from the first query (the insert query) and so the insert id is 'hidden' in another row of the resource.
<br />

<br />
Solution.... set up as before, but then:
<br />

<br />
<span class="default">&lt;?php
<br />
$resource</span><span class="keyword">=</span><span class="default">sqlsrv_query</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">, </span><span class="default">$query</span><span class="keyword">, </span><span class="default">$arrParams</span><span class="keyword">);
<br />
</span><span class="default">sqlsrv_next_result</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">);
<br />
</span><span class="default">sqlsrv_fetch</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">);
<br />
echo </span><span class="default">sqlsrv_get_field</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will give you what you want! This will work similarly with something like "INSERT INTO test (col1, col2) VALUES (?,?); SELECT * from test WHERE ID = SCOPE_IDENTITY()" and again you have to move through the resource to get at the data you want.
<br />

<br />
I hope this helps someone, since it's just wasted a good two hours of my time! Also, sorry for any errors in the code - I'm afraid I've written it off the top of my head, but hopefully you get the idea...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97848""></a>
  <div class="note">
   <strong class="user">sreekumar kv</strong>
   <a href="#97848" class="date">12-May-2010 12:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If text fields from mssql SELECT queries are truncated (at 4096 characters), even after using , <br />
<span class="default">&lt;?php<br />
ini_set </span><span class="keyword">( </span><span class="string">'mssql.textlimit' </span><span class="keyword">, </span><span class="string">'65536' </span><span class="keyword">);<br />
</span><span class="default">ini_set </span><span class="keyword">( </span><span class="string">'mssql.textsize' </span><span class="keyword">, </span><span class="string">'65536' </span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
make sure that the ini_set function is used before the connection to the database is established.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96230""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#96230" class="date">16-Feb-2010 01:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the problems mentioned on here with the format that datetime columns are returned in. Running on debian lenny and used apt-get install php5-sybase to get access to these functions. After which datetime fields were returned as a string something like 'Feb 16 2010 09:14:10:010AM' which was not recognised when passed to e.g. new DateTime(). Also smalldatetime fields caused php to crash.<br />
<br />
To fix I did this:<br />
<br />
vi /etc/php5/apache2/php.ini<br />
After this line:<br />
;mssql.datetimeconvert = On<br />
Add this line:<br />
mssql.datetimeconvert = Off<br />
<br />
Now both datetime and smalldatetime come back as something like '2010-02-16 09:14:00'.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90876""></a>
  <div class="note">
   <strong class="user">thewiglaf at gmail dot com</strong>
   <a href="#90876" class="date">13-May-2009 06:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that although the documentations states that mssql_query will return "TRUE if no rows were returned", it will still return an empty resource identifier for SELECT statements that do not return any rows. This empty resource identifier will get dynamically typed as TRUE in a boolean context. Only for queries that do not actually return rows (eg. insert, update, or delete) will mssql_query return an actual boolean TRUE value.<br />
<br />
We should use mssql_num_rows($resource) rather than $resource===TRUE for checking whether rows were returned.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82949""></a>
  <div class="note">
   <strong class="user">mikelasouris at yahoo dot com</strong>
   <a href="#82949" class="date">02-May-2008 08:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unicode data in a Unicode-only collation or ntext data cannot be sent to clients using DB-Library <br />
<br />
solution: <br />
try: select field from table, avoid "select * from table" php will scream at you. strangely after executing select field from table you'll be able to execute select * from table.<br />
<br />
i'm using apache2, win XP, sqlexpress05</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77346""></a>
  <div class="note">
   <strong class="user">Lance</strong>
   <a href="#77346" class="date">25-Aug-2007 02:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to update a "text" field &gt; 1,000 odd characters you must use WRITETEXT or UPDATETEXT.. how you ask:<br />
<br />
function mssql_updatetext($db_name, $table_name, $field_name, $where, $text) {<br />
&nbsp;&nbsp;&nbsp; // assume mssql db link already created etc<br />
&nbsp;&nbsp;&nbsp; $str_pos=0;<br />
&nbsp;&nbsp;&nbsp; $buffer_len = 1024;<br />
&nbsp;&nbsp;&nbsp; mssql_query("EXEC sp_dboption '{$db_name}', 'select into/bulkcopy', 'true'");<br />
&nbsp;&nbsp;&nbsp; while ($str_pos &lt; strlen($text)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $buffer = str_replace("'", "''", substr($text, $str_pos, $buffer_len)); // escape buffer<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mssql_query("DECLARE @ptrval binary(16)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SELECT&nbsp; @ptrval = TEXTPTR($field)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FROM&nbsp; &nbsp; [$table]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; WHERE&nbsp;&nbsp; $where<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; UPDATETEXT [{$table}].$field @ptrval $str_pos NULL $buffer");<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $str_pos += $buffer_len;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; mssql_query("EXEC sp_dboption '$db_name', 'select into/bulkcopy', 'false'");<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return true;<br />
}<br />
<br />
// test it using "pubs" &gt; pub_info.pr_info<br />
mssql_updatetext(<br />
&nbsp;&nbsp;&nbsp; $db_name='pubs', <br />
&nbsp;&nbsp;&nbsp; $table_name='pub_info', <br />
&nbsp;&nbsp;&nbsp; $field_name='pr_info', <br />
&nbsp;&nbsp;&nbsp; $where='pub_id = 9999', <br />
&nbsp;&nbsp;&nbsp; $text=str_repeat("This is a long bit of text \r\n", 1000)<br />
);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72570""></a>
  <div class="note">
   <strong class="user">muratyaman at gmail dot com</strong>
   <a href="#72570" class="date">24-Jan-2007 10:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is annoying that MSSQL does not return proper error numbers.<br />
<br />
For example: run a simple "INSERT INTO ..." query that will cause an error and see it.<br />
<br />
All I get is:<br />
<br />
Code:&nbsp; &nbsp; &nbsp;&nbsp; HY000<br />
Message: (below) <br />
<br />
SQLSTATE[HY000]: General error: 10007 INSERT statement conflicted with COLUMN FOREIGN KEY constraint 'FK...'. The conflict occurred in database 'DB...', table 'TBL...', column 'COL...'. [10007] (severity 5) [INSERT INTO ... ]<br />
<br />
'HY000' does not help me at all and same thing is returned for other errors as well. (I am not sure, but if 10007 is the number I am looking for, I do NOT want to parse the error messages. Then why do we have the notion of "err_code and err_message"?)<br />
<br />
I think, running the following just after the 'failed' query may help:<br />
<br />
$err = your_query_and_fetch_row_func ('select @@error');<br />
<br />
Cheers!<br />
Murat<br />
<br />
P.S. Firebird rocks! ;)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70078""></a>
  <div class="note">
   <strong class="user">vollmer at ampache dot org</strong>
   <a href="#70078" class="date">02-Oct-2006 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You need to escape ' with '' in mssql, however while doing a large dataset migration I ran into an issue with \0 (NULL) in the strings breaking the query. I ended up writting the below small little function, I'm sure it could be done faster/better but it has served me well. 
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">sqlEscape</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">) {
<br />
&nbsp;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* De MagicQuotes */
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fix_str&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">stripslashes</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fix_str&nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"'"</span><span class="keyword">,</span><span class="string">"''"</span><span class="keyword">,</span><span class="default">$sql</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fix_str&nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"\0"</span><span class="keyword">,</span><span class="string">"[NULL]"</span><span class="keyword">,</span><span class="default">$fix_str</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$fix_str</span><span class="keyword">;
<br />

<br />
} </span><span class="comment">// sqlEscape
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64561""></a>
  <div class="note">
   <strong class="user">km at mcminndigital dot com</strong>
   <a href="#64561" class="date">18-Apr-2006 11:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another note for the archives:<br />
<br />
If for some reason you aren't on a windows platform (using FreeTDS etc), or on a older windows platform and are having a hard time with unicode errors with ntext and images there are two things to do:<br />
<br />
1) make sure you odbc drivers are up to date<br />
&nbsp;:: or ::<br />
2) make sure to convert any ntext or image fields in your select. If you need an image from a select then you are stuck with upgrading your odbc drivers if you are getting unicode errors.<br />
<br />
Use mssql_field_type to get your field types however you want.<br />
<br />
SELECT [Name], [UserID], [SomeValue], convert(TEXT, [Description]) FROM [MyDB.[dbo].[MyTable];</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="64090""></a>
  <div class="note">
   <strong class="user">andrei_mole at yahoo dot com</strong>
   <a href="#64090" class="date">07-Apr-2006 01:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if anyone has faced a problem with displaying images from mssql image field it could be that they have an ole header put by sql.<br />
here is an example. hope it helps:<br />
<br />
<span class="default">&lt;?php <br />
$db</span><span class="keyword">=</span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">"server"</span><span class="keyword">,</span><span class="string">"user"</span><span class="keyword">,</span><span class="string">"pass"</span><span class="keyword">); <br />
</span><span class="default">$d</span><span class="keyword">=</span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="string">"NorthWind"</span><span class="keyword">, </span><span class="default">$db</span><span class="keyword">); <br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT Picture FROM Categories WHERE CategoryId=2"</span><span class="keyword">; <br />
</span><span class="default">$res </span><span class="keyword">= </span><span class="default">mssql_query</span><span class="keyword">(</span><span class="default">$sql</span><span class="keyword">); <br />
</span><span class="default">$row </span><span class="keyword">= </span><span class="default">mssql_fetch_array</span><span class="keyword">(</span><span class="default">$res</span><span class="keyword">); <br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">$row</span><span class="keyword">[</span><span class="string">'Picture'</span><span class="keyword">]; <br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: image/bmp"</span><span class="keyword">); <br />
</span><span class="comment">//remove the ole header<br />
</span><span class="default">$data </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">,</span><span class="default">78</span><span class="keyword">); <br />
</span><span class="comment">//print the pic in the browser<br />
</span><span class="keyword">echo </span><span class="default">$data</span><span class="keyword">; <br />
</span><span class="default">mssql_close</span><span class="keyword">(); <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62487""></a>
  <div class="note">
   <strong class="user">augustinus at netsession dot net</strong>
   <a href="#62487" class="date">01-Mar-2006 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding the note of jesse at lostangel dot net, written on 17-Sep-2002 03:33 implementing the mysql_insert_id function for MSSQL I have a remark:<br />
<br />
The example hasn't worked on my database server (SQL Server 2000 Standard Edition with SP3a, english) so i just left of the exec statement.<br />
Instead I used:<br />
<br />
$result = mssql_query("INSERT INTO STUFF(gaga,otherGaga) VALUES ('hello','apple'); SELECT @@IDENTITY as insertId;");<br />
<br />
list ($gagaId) = mssql_fetch_row($result);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62230""></a>
  <div class="note">
   <strong class="user">Rizwan Khan</strong>
   <a href="#62230" class="date">22-Feb-2006 02:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MSSQL will not let you use TEXT data in the where clause, TEXT data is BLOG data, its max size is 2,147,483,647 bytes (each character occupies one byte).<br />
The varchar and char can have max of 8000 characters, so you can use text data in a where clause if you convert as follows convert(varchar(8000),SOMETEXTDATA)<br />
<br />
select * from tHistory where myNotes=convert(varchar(8000),SOMETEXTDATA)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="62229""></a>
  <div class="note">
   <strong class="user">Rizwan Khan</strong>
   <a href="#62229" class="date">22-Feb-2006 02:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just explaining how to get date in YYYY-MM-DD format much easily, when you use convert function in SQL you usually give the format as one of the arguments. for example &lt;br&gt;<br />
select convert(varchar(20),getdate(),20)&lt;br&gt;<br />
select convert(varchar(20),getdate(),120)&lt;br&gt;<br />
will both return dates in yyyy-mm-dd hh:mi:ss(24h) format. you can also use &lt;br&gt;<br />
select convert(varchar(20),getdate(),21)&lt;br&gt;<br />
select convert(varchar(20),getdate(),121)&lt;br&gt;<br />
in yyyy-mm-dd hh:mi:ss.mmm(24h) formats.&lt;br&gt;<br />
So now when you have the date as string from either of the four convert functions you can either take the left part of the string or use a substring function to get the date in YYYY-MM-DD format.&lt;br&gt;<br />
following are few examples.&lt;br&gt;<br />
select left(convert(varchar(20),getdate(),20),10)&lt;br&gt;<br />
select left(convert(varchar(20),getdate(),120),10)&lt;br&gt;<br />
select left(convert(varchar(20),getdate(),21),10)&lt;br&gt;<br />
select left(convert(varchar(20),getdate(),121),10)&lt;br&gt;<br />
select substring(convert(varchar(20),getdate(),20),1,10)&lt;br&gt;<br />
select substring(convert(varchar(20),getdate(),20),1,10)&lt;br&gt;<br />
select substring(convert(varchar(20),getdate(),120),1,10)&lt;br&gt;<br />
select substring(convert(varchar(20),getdate(),21),1,10)&lt;br&gt;<br />
select substring(convert(varchar(20),getdate(),121),1,10)&lt;br&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="60228""></a>
  <div class="note">
   <strong class="user">tristanx3 at rogers dot com</strong>
   <a href="#60228" class="date">30-Dec-2005 07:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It would appear that MSSQL will not let you use fields of the TEXT data type in WHERE clauses.<br />
<br />
I tried running a simple query to get account data for a particular user based on email address, but the command was not returning any data.&nbsp; I finally realized that this was because the emailaddress column was of the data type TEXT.&nbsp; When I changed the WHERE clause in the query to test against a name, which was of type VARCHAR, the query worked perfectly.<br />
<br />
I overcame this problem by converting the TEXT field to VARCHAR in the WHERE clause, as noted below:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">### Field 'emailaddress' is of data type TEXT in the SQL database<br />
<br />
# This would not work!<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT * FROM accounts WHERE emailaddress = 'test@test.com'"</span><span class="keyword">;<br />
<br />
</span><span class="comment"># Converting the data type inline solved the problem<br />
</span><span class="default">$sql </span><span class="keyword">= </span><span class="string">"SELECT * FROM accounts WHERE CONVERT( VARCHAR, emailaddress ) = 'test@test.com'"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This seems to have solved my problem, although I am still unsure of the limits (if any) to this solution.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56664""></a>
  <div class="note">
   
   <a href="#56664" class="date">11-Sep-2005 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another way how to use dates in queries:<br />
<br />
$createdate="2005-01-30";<br />
<br />
$query = "<br />
DECLARE @newdate datetime;<br />
SELECT @newdate=convert(varchar(100), '$createdate', 102);<br />
INSERT INTO TABLE(NUMBER, DATE) VALUES ('$num', @newdate);"<br />
<br />
and fire the query....</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54590""></a>
  <div class="note">
   <strong class="user">php at syntax101 dot com</strong>
   <a href="#54590" class="date">08-Jul-2005 08:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On certain server setups simply replacing a single quote with two single quotes will result in:<br />
you\''d <br />
<br />
I use the following function for single quote escaping quote for MSsql:<br />
<br />
function escapeSingleQuotes($string){<br />
&nbsp;&nbsp;&nbsp; //escapse single quotes<br />
&nbsp;&nbsp;&nbsp; $singQuotePattern = "'";<br />
&nbsp;&nbsp;&nbsp; $singQuoteReplace = "''";<br />
&nbsp;&nbsp;&nbsp; return(stripslashes(eregi_replace($singQuotePattern, $singQuoteReplace, $string)));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54589""></a>
  <div class="note">
   <strong class="user">php at syntax101 dot com</strong>
   <a href="#54589" class="date">08-Jul-2005 08:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On certain server setups simple replacing a single quote with two single quotes will result in:<br />
you\''d <br />
<br />
I use the following function for single quote escaping quote for MSsql:<br />
<br />
function escapeSingleQuotes($string){<br />
&nbsp;&nbsp;&nbsp; //escapse single quotes<br />
&nbsp;&nbsp;&nbsp; $singQuotePattern = "'";<br />
&nbsp;&nbsp;&nbsp; $singQuoteReplace = "''";<br />
&nbsp;&nbsp;&nbsp; return(stripslashes(eregi_replace($singQuotePattern, $singQuoteReplace, $string)));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="52986""></a>
  <div class="note">
   <strong class="user">rzachris at yahoo dot com</strong>
   <a href="#52986" class="date">19-May-2005 01:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're having problems trying to get data stored in a varchar column with more than 255 chars use CONVERT to change the data type to TEXT like this:<br />
<br />
$query=mssql_query("SELECT table.id, CONVERT(TEXT, table.comment) AS comment FROM table");<br />
<br />
Don't forget to set name for the column (AS comment) or you won't be able to retrieve the data ...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46925""></a>
  <div class="note">
   <strong class="user">roger4a45 at yahoo dot es</strong>
   <a href="#46925" class="date">27-Oct-2004 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using Aplication Role with PHP<br />
<br />
Introduction<br />
<br />
Aplication Role is a Microsoft SQL Server 2000 feature that allow to make control what "source" use your data. It means that you can allow select, inset or update operation from your PHP code and deny it from and ODBC source, Microsoft Access or any kind of application that want to use your data.<br />
<br />
Scenario:<br />
<br />
Imagina you have a DAtabase named MYDB. This DB has three table. TABLEA, TABLEB and TABLEC. Imagine that your user named 'nemesis' can access to TABLEA from anywhere but you want that from table B and C access from your PHP code.<br />
<br />
Follow this steps<br />
<br />
[From your MSSQL Administrator]<br />
<br />
1 -. From your Database MYDB create a new role (Standard Role). Insert this user inside this role.<br />
2 -. Edit permisions and deny any operation at TABLEB and TABLEC.<br />
3 -. Create a new Role (Aplication Role). For intance&nbsp; it named 'myaccess' with a password 'anypassword'.<br />
4 -. Edit permisions and allow any operation you wish at TABLEB and TABLEC<br />
<br />
[From your source] (I don't include any control errors to simplify source)<br />
<br />
$s = mssql_connect('MYSERVER','nemesis','nemesispassword');<br />
$b = mssql_select_db('MYDB',$s);<br />
<br />
//This one activate application role. Any user permision are <br />
//ignored. User permision are override with application role<br />
// permisions.<br />
<br />
$query = "EXEC sp_setapprole 'myaccess', 'anypassword'";<br />
$b = mssql_query($query);<br />
$result = mssql_query('SELECT * FROM TABLEB,$s);<br />
[...]<br />
<br />
Note: If you kill "$query = ..." you will find out that SELECT fails. If you insert that line $quey will be succeed. Now, nemesis only can take data from TABLEB and TABLEC through your PHP code. If he/She try to use that data through ODBC driver then he can not do it.<br />
<br />
NOte: Application role drops when you make a mssql_close.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="46026""></a>
  <div class="note">
   <strong class="user">dennis at -nospam- darknoise d0t de</strong>
   <a href="#46026" class="date">27-Sep-2004 05:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In response to post from jesse at lostangel dot net from 18-Sep-2002:<br />
<br />
INSERT ...<br />
SELECT @@IDENTITY <br />
may NOT work as desired! <br />
While running multiple queries at the same time, you will get the last identity value generated, somewhere in your database.<br />
<br />
If you need to know the identity value generated by your INSERT statement, use SCOPE_IDENTITY().</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="39611""></a>
  <div class="note">
   <strong class="user">labrat457_minusthispart!_*-*_!yahoo.com</strong>
   <a href="#39611" class="date">04-Feb-2004 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can run a stored proceedure AND get back a result set from mssql_query().&nbsp; I figured this little trick out when I realized I couldn't use the mssql_init() function group for my stored procedure stuff as I needed datetime variables to be passed, and they are not supported.&nbsp; However, you can "encapsulate" a snippet of stored procedure within a normal query that can be executed via mssql_query() and have a result value returned.&nbsp; For example, here's a query which passes a store's local date and time to a stored procedure that converts it to the GMT values that is used internally by the rest of the database structure:<br />
$temptime=time();<br />
$storeid = 68;<br />
$deptid = 70;<br />
$StartDate = strftime("%b %d %Y %H:%M:%S",$temptime);<br />
$spquery="<br />
BEGIN<br />
DECLARE @date datetime,<br />
&nbsp;&nbsp;&nbsp; @GMreturn datetime<br />
SELECT @date='$StartDate'<br />
execute TZ_toGMT '$storeid','$deptid',@date,@GMreturn OUTPUT<br />
SELECT @GMreturn<br />
END";<br />
<br />
Now, when $spquery is passed to mssql_query(), it will return with a value for @GMreturn, which can be parsed out with mssql_fetch_array() as with any other query.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37613""></a>
  <div class="note">
   <strong class="user">papaggel at csd dot uoc dot gr</strong>
   <a href="#37613" class="date">20-Nov-2003 03:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you try to INSERT a large string to a MSSQLServer 2000 table attribute of type nvarchar/varchar/text/nchar/char, but it is limited to the first 256 characters do the following:<br />
<br />
1. Open Tools-&gt;SQL Query Analyzer<br />
2. In SQL Query Analyzer <br />
&nbsp;&nbsp;&nbsp; i.&nbsp;&nbsp; Go to Tools-&gt;Options<br />
&nbsp;&nbsp;&nbsp; ii.&nbsp; Select the "Results" tab<br />
&nbsp;&nbsp;&nbsp; iii. Change "Maximum characters per column" to something else</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="35396""></a>
  <div class="note">
   <strong class="user">Me</strong>
   <a href="#35396" class="date">29-Aug-2003 12:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Kelsey made a note that the only character that MSSQL needs "escaping" is the single quote ', and it done by using two single quotes ''.&nbsp; You will want to make sure that, when using strings, you contain the strings in single quotes, since you can't escape double quotes.<br />
<br />
In addition, you won't find a mssql_escape_string() function (though there are for other DB's, i.e. mysql_escape_string()), but using:<br />
<br />
$escapedString = str_replace("'","''",$stringToEscape);<br />
<br />
Will accomplish the same thing.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34336""></a>
  <div class="note">
   <strong class="user">jagos at ebrno dot net</strong>
   <a href="#34336" class="date">24-Jul-2003 04:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This's note about mssql and truncating binary output from database (mostly image ...), i spent about 2 days tuning this stuff and fortunately i made the hit ... <br />
&nbsp;&nbsp;&nbsp; so if you're experiencing truncates of your binary data read from mssql database (it looks like incomplete, broken or even no images) check mssql section of your php.ini file and set values of mssql.textlimit and mssql.textsize variables to their maximum (2147483647) or at least bigger size than the default is ... so i hope it helps a bit, have a good time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="31688""></a>
  <div class="note">
   <strong class="user">arnarb at oddi dot is</strong>
   <a href="#31688" class="date">30-Apr-2003 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you'd like to store binary data, such as an image, in MSSQL, it's common to have problems with addslashes and co.<br />
<br />
This is because the MSSQL parser makes a clear distinction between binary an character constants. You can therefore not easilly insert binary data with "column = '$data'" syntax like in MySQL and others.<br />
<br />
The MSSQL documentation states that binary constants should be represented by their unquoted hexadecimal byte-string. That is.. to set the binary column "col" to contain the bytes 0x12, 0x65 and 0x35 you shold do "col = 0x126535" in you query.<br />
<br />
I've successfully stored and retrieved jpeg images in a column with the "image" datatype. Here's how:<br />
<br />
// storing a file<br />
$datastring = file_get_contents("img.jpg");<br />
$data = unpack("H*hex", $datastring);<br />
mssql_query("insert into images (name, data)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; values ('img.jpg', 0x".$data['hex'].")");<br />
<br />
// retrieving<br />
$result = mssql_query("select data from images where name = 'img.jpg'");<br />
$row = mssql_fetch_assoc($result);<br />
header("Content-type: image/jpeg;");<br />
echo $row['data'];<br />
<br />
As you can see there is nothing to do with the image on they way out, just blurb out the buffer your recieve as with any other field type.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="29923""></a>
  <div class="note">
   <strong class="user">AzRaH</strong>
   <a href="#29923" class="date">28-Feb-2003 02:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are experiencing TRUNCATING issues trying to return more than 4096 bytes on a VARCHAR field try converting it to text:<br />
<br />
CONVERT(TEXT, Yourfield) <br />
<br />
EX:<br />
$sql-&gt;db_select("SELECT cc_main.cc_entry_id, CONVERT(TEXT, cc_main.comment) FROM cc_main");</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="26845""></a>
  <div class="note">
   <strong class="user">wind at wag dot nl</strong>
   <a href="#26845" class="date">14-Nov-2002 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Had a similar problem to Jesse<br />
<br />
What I experienced with Microsoft SQLserver 2000 and PHP 4.1.2 was that if you execute a query consisting of multiple queries separated by a semicolon with mssql_query is that the queries themselves are executed but the connection is dropped immediately after that. It seems that the phpdriver doesn't count on this.<br />
The EXEC solution (or maybe sp_executesql) works fine in these cases because to the db-library it is one statement.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25926""></a>
  <div class="note">
   <strong class="user">php at netznacht dot de</strong>
   <a href="#25926" class="date">11-Oct-2002 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just tried to give a string:<br />
<br />
Welcome at Mike's&nbsp;&nbsp; to the SQL Server:<br />
<br />
He misinterpreted the \' as the end of the String.<br />
MySQL will resolve&nbsp; \' and not think that the String has ended.<br />
<br />
You should replace the \' before constructing the MSSQL Query string.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="25274""></a>
  <div class="note">
   <strong class="user">jesse at lostangel dot net</strong>
   <a href="#25274" class="date">17-Sep-2002 03:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While trying to return a @@IDENTITY after an INSERT statement, the only way I could get a valid return result was to encapsulate the query within an EXEC like so:<br />
<br />
&nbsp;&nbsp;&nbsp; $result = mssql_query("<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; exec(\"<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; INSERT INTO Files <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (ownerId, name, sizeKB, path) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; VALUES ('$contactId', '$userfile_name', '$filesize', '$path')<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; SELECT @@IDENTITY as fileId\")<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ");<br />
&nbsp;&nbsp;&nbsp; list($fileId) = mssql_fetch_row($result);<br />
<br />
This returned the appropriate @@IDENTITY in a valid result set.&nbsp; Not sure if mssql supports multiple inline commands or not.&nbsp; But that assumption would back the useage of the EXEC command in order to execute these properly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="22514""></a>
  <div class="note">
   <strong class="user">cusaacb at squared dot com</strong>
   <a href="#22514" class="date">20-Jun-2002 12:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using the latest version of freetds with support for tds ver 7.0.&nbsp; I could not get more than 256 characters on varchar until I set the environment variable TDSVER=70.&nbsp; <br />
<br />
Then it correctly returns all of the field.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="20580""></a>
  <div class="note">
   <strong class="user">arthur dot mcgibbon at btinternet dot com</strong>
   <a href="#20580" class="date">08-Apr-2002 08:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The mssql_execute etc. commands for stored procs do not seem to support a DATETIME type.<br />
This means using mssql_query.<br />
Now problems occur when you want to use parameters that have Input values and Output values.&nbsp; SQL Server refuses to acknowledge the following...<br />
<br />
declare @ret int, @i int<br />
select @i = 25<br />
exec @ret = testsp @Param1 = @i output<br />
select @ret, @i<br />
<br />
It doesn't like 2 select statements, even when the first is changed to "set".<br />
<br />
To get round this, put the whole query into an exec command.<br />
e.g.<br />
mssql_query("exec('declare @ret int, @i int<br />
select @i = 25<br />
exec @ret = testsp @Param1 = @i output<br />
select @ret, @i')"<br />
<br />
This seems to work fine.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
