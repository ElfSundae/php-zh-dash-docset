<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Microsoft SQL Server and Sybase Functions (PDO_DBLIB)</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="pdo.cubrid-schema.html">? PDO::cubrid_schema</a></li>
      <li style="float: right;"><a href="ref.pdo-dblib.connection.html">PDO_DBLIB DSN ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="pdo.drivers.html">PDO Çý¶¯</a></li>
    <li>Microsoft SQL Server and Sybase Functions (PDO_DBLIB)</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.pdo-dblib" class="reference">
  
  <h1 class="title">Microsoft SQL Server and Sybase Functions (PDO_DBLIB)</h1>
  
  <div class="partintro">

   <div class="section" id="pdo-dblib.intro">
   <h2 class="title">¼ò½é</h2>
    <p class="para">
     PDO_DBLIB is a driver that implements the <a href="intro.pdo.html" class="link">PHP
     Data Objects (PDO) interface</a> to enable access from PHP to
     Microsoft SQL Server and Sybase databases through the FreeTDS library.
    </p>
    <p class="para">
     This extension is not available anymore on Windows.
    </p>
    <p class="para">
     On Windows, you should use SqlSrv, an alternative driver for MS SQL is 
     available from Microsoft: <a href="http://msdn.microsoft.com/en-us/sqlserver/ff657782.aspx" class="link external" title="Link : http://msdn.microsoft.com/en-us/sqlserver/ff657782.aspx">&raquo;&nbsp;http://msdn.microsoft.com/en-us/sqlserver/ff657782.aspx
     </a>.
    </p>
    <p class="para">
     If it is not possible to use SqlSrv, you can use the 
     <a href="ref.pdo-odbc.html" class="link">PDO_ODBC</a> driver to connect to 
     Microsoft SQL Server and Sybase databases, as the native Windows DB-LIB 
     is ancient, thread un-safe and no longer supported by Microsoft.
    </p>
   </div>
  </div>

  

 <h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="ref.pdo-dblib.connection.html">PDO_DBLIB DSN</a> &mdash; Connecting to Microsoft SQL Server and Sybase databases</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123063""></a>
  <div class="note">
   <strong class="user">Fabian G</strong>
   <a href="#123063" class="date">22-Aug-2018 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Instead of using Mssql or DBLib extension you should use the official extensions from Microsoft from here: https://github.com/Microsoft/msphpsql</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121650""></a>
  <div class="note">
   <strong class="user">fleduc dot perso at gmail dot com</strong>
   <a href="#121650" class="date">18-Sep-2017 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Watch out!<br />
<br />
If you use PDO SQLSRV on windows 7, using 32 bit php on XAMMP, you might encounter driver problems : "This extension requires the Microsoft ODBC Driver 11 for SQL Server to communicate with SQL Server"<br />
<br />
The reason, Microsoft 32-bit ODBC driver doesn't install properly on 64-bit Windows 7.<br />
<br />
Check the solution to PDO SQLSRV driver problem here in StackOverflow<br />
<br />
https://stackoverflow.com/a/46245990/1330248</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120698""></a>
  <div class="note">
   <strong class="user">Vic L</strong>
   <a href="#120698" class="date">23-Feb-2017 05:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI: PDO dblib module (pdo_dblib.so) was installed when I installed php-mssql in CentOS 7.&nbsp; I thought php-mssql would just include the soon to be deprecated mssql PHP functions but it also contains the PDO connector.&nbsp; After installing this I'm able to connect to our MSSQL 2014 DB via PDO!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118093""></a>
  <div class="note">
   <strong class="user">Johankasselman at live dot com</strong>
   <a href="#118093" class="date">02-Oct-2015 01:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi All, I'wrote a class to connect to MSSQL/Azure databases with Transaction support.<br />
<br />
Hope this can help anyone!<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
*&nbsp; &nbsp; @author&nbsp; &nbsp;&nbsp; Johan Kasselman &lt;johankasselman@live.com&gt;<br />
*&nbsp; &nbsp; @since&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 2015-09-28&nbsp; &nbsp; V1<br />
*<br />
*/<br />
<br />
</span><span class="keyword">class </span><span class="default">pdo_dblib_mssql</span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$db</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; private </span><span class="default">$cTransID</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; private </span><span class="default">$childTrans </span><span class="keyword">= array();<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$port</span><span class="keyword">, </span><span class="default">$dbname</span><span class="keyword">, </span><span class="default">$username</span><span class="keyword">, </span><span class="default">$pwd</span><span class="keyword">){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hostname </span><span class="keyword">= </span><span class="default">$hostname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">port </span><span class="keyword">= </span><span class="default">$port</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dbname </span><span class="keyword">= </span><span class="default">$dbname</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">username </span><span class="keyword">= </span><span class="default">$username</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pwd </span><span class="keyword">= </span><span class="default">$pwd</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">connect</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">beginTransaction</span><span class="keyword">(){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cAlphanum </span><span class="keyword">= </span><span class="string">"AaBbCc0Dd1EeF2fG3gH4hI5iJ6jK7kLlM8mN9nOoPpQqRrSsTtUuVvWwXxYyZz"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cTransID </span><span class="keyword">= </span><span class="string">"T"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">str_shuffle</span><span class="keyword">(</span><span class="default">$cAlphanum</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">7</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_unshift</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">childTrans</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cTransID</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"BEGIN TRAN [</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">cTransID</span><span class="string">];"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">rollBack</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">childTrans</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cTmp </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">childTrans</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"ROLLBACK TRAN [</span><span class="default">$cTmp</span><span class="string">];"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$stmt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">commit</span><span class="keyword">(){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; while(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">childTrans</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$cTmp </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">childTrans</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"COMMIT TRAN [</span><span class="default">$cTmp</span><span class="string">];"</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return&nbsp; </span><span class="default">$stmt</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">close</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">connect</span><span class="keyword">(){<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; try {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">db </span><span class="keyword">= new </span><span class="default">PDO </span><span class="keyword">(</span><span class="string">"dblib:host=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">hostname</span><span class="string">:</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">port</span><span class="string">;dbname=</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">dbname</span><span class="string">"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">username</span><span class="string">"</span><span class="keyword">, </span><span class="string">"</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">pwd</span><span class="string">"</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } catch (</span><span class="default">PDOException $e</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">logsys </span><span class="keyword">.= </span><span class="string">"Failed to get DB handle: " </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109439""></a>
  <div class="note">
   <strong class="user">ian at helastel dot com</strong>
   <a href="#109439" class="date">17-Jul-2012 03:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For people with issues inserting UTF-8 / Unicode data using DBLIB, you can't do this natively - but you can workaround the problem by converting the data first.<br />
<br />
e.g. inserting into a nvarchar column with collation Latin1_General_CI_AS<br />
<br />
...<br />
$res = $db-&gt;prepare($sql);<br />
$res-&gt;bindValue(':value', iconv('UTF-8', 'ISO8859-1', $value);<br />
...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="61090""></a>
  <div class="note">
   <strong class="user">support at converters dot ru</strong>
   <a href="#61090" class="date">25-Jan-2006 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If You work with MSSQL Server 7.0/2000/... under Windows and use non latin Encoding then better To use PDO_MSSQL until PDO_ODBC bugs will be fixed (MSSQL ext far more stable and usabe for PHP versions &lt;=5.1.2).<br />
If your MSSQL connection use strings in OEM encoding (cp866 for russian charset) <br />
<br />
1. Run Microsoft Server/Client Network Utility on work PC and UNCHECK "DBLibrary options"/"Automatic ANSI to OEM conversion"<br />
<br />
2. Restart Web server if needed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56585""></a>
  <div class="note">
   <strong class="user">graham1 dot simpson at hsbcib dot com</strong>
   <a href="#56585" class="date">08-Sep-2005 12:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is currently little sybase related PDO docs out there. The ones that I found often mention a spec for a dsn that is invalid. Here's how I am currently connecting to sybase ASE:<br />
<br />
1. Compile up freetds <a href="http://www.freetds.org on top of open client;" rel="nofollow" target="_blank">http://www.freetds.org on top of open client;</a><br />
2. Add the PDO and PD_DBLIB modules to php 5 as per the documentation; Note: I'm currently using the PDO-beta and PDO_DBLIB-beta;<br />
3. Check mods installed ok using "pear list" and "php -m";<br />
<br />
The documentation often says to use "sybase:" as your DSN, this doesn't work. Use "dblib:" instead. Here's an example:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">try {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hostname </span><span class="keyword">= </span><span class="string">"myhost"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$port </span><span class="keyword">= </span><span class="default">10060</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dbname </span><span class="keyword">= </span><span class="string">"tempdb"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$username </span><span class="keyword">= </span><span class="string">"dbuser"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pw </span><span class="keyword">= </span><span class="string">"password"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dbh </span><span class="keyword">= new </span><span class="default">PDO </span><span class="keyword">(</span><span class="string">"dblib:host=</span><span class="default">$hostname</span><span class="string">:</span><span class="default">$port</span><span class="string">;dbname=</span><span class="default">$dbname</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$username</span><span class="string">"</span><span class="keyword">,</span><span class="string">"</span><span class="default">$pw</span><span class="string">"</span><span class="keyword">);<br />
&nbsp; } catch (</span><span class="default">PDOException $e</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Failed to get DB handle: " </span><span class="keyword">. </span><span class="default">$e</span><span class="keyword">-&gt;</span><span class="default">getMessage</span><span class="keyword">() . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; exit;<br />
&nbsp; }<br />
&nbsp; </span><span class="default">$stmt </span><span class="keyword">= </span><span class="default">$dbh</span><span class="keyword">-&gt;</span><span class="default">prepare</span><span class="keyword">(</span><span class="string">"select name from master..sysdatabases where name = db_name()"</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">execute</span><span class="keyword">();<br />
&nbsp; while (</span><span class="default">$row </span><span class="keyword">= </span><span class="default">$stmt</span><span class="keyword">-&gt;</span><span class="default">fetch</span><span class="keyword">()) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$row</span><span class="keyword">);<br />
&nbsp; }<br />
&nbsp; unset(</span><span class="default">$dbh</span><span class="keyword">); unset(</span><span class="default">$stmt</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Hope this helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
