<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>设置选项</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mysqli.next-result.html">? mysqli::next_result</a></li>
      <li style="float: right;"><a href="mysqli.ping.html">mysqli::ping ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.mysqli.html">MySQLi</a></li>
    <li>设置选项</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="mysqli.options" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysqli::options</h1>
  <h1 class="refname">mysqli_options</h1>
  <p class="verinfo">(PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">mysqli::options</span> -- <span class="refname">mysqli_options</span> &mdash; <span class="dc-title">设置选项</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mysqli.options-description">
  <h3 class="title">说明</h3>
  <p class="para">面向对象风格</p>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysqli::options</strong></span>
    ( <span class="methodparam"><span class="type">int</span> <code class="parameter">$option</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">过程化风格</p>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mysqli_options</strong></span>
    ( <span class="methodparam"><span class="type"><a href="class.mysqli.html" class="type mysqli">mysqli</a></span> <code class="parameter">$link</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$option</code></span>
   , <span class="methodparam"><span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">$value</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   设置一个连接的扩展选项，这些选项可以改变这个连接的行为。
  </p>
  <p class="para">
   如果要对多个选项进行设置，可以多次调用此函数来。
  </p>
  <p class="para">
   <span class="function"><strong>mysqli_options()</strong></span> 需要在
   <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span> 函数之后、
   <span class="function"><a href="mysqli.real-connect.html" class="function">mysqli_real_connect()</a></span> 函数之前被调用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mysqli.options-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
link</code></dt>
<dd>
<p class="para">仅以过程化样式：由<span class="function"><a href="function.mysqli-connect.html" class="function">mysqli_connect()</a></span> 或 <span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span>
返回的链接标识。</p></dd>

    
     <dt>
<code class="parameter">option</code></dt>

     <dd>

      <p class="para">
       要进行设置的选项，可以是下列中的某一项：
       <table class="doctable table">
        <caption><strong>有效的选项</strong></caption>
        
         <thead>
          <tr>
           <th>名称</th>
           <th>描述</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td><strong><code>MYSQLI_OPT_CONNECT_TIMEOUT</code></strong></td>
           <td>连接超时设置，以秒为单位（在 Windows 平台上，PHP 5.3.1 之后才支持此选项）。</td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_OPT_LOCAL_INFILE</code></strong></td>
           <td>启用或禁用 <code class="literal">LOAD LOCAL INFILE</code> 语句</td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_INIT_COMMAND</code></strong></td>
           <td>成功建立 MySQL 连接之后要执行的 SQL 语句</td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_READ_DEFAULT_FILE</code></strong></td>
           <td>
            从指定的文件中读取选项，而不是使用 <var class="filename">my.cnf</var> 中的选项
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_READ_DEFAULT_GROUP</code></strong></td>
           <td>
            从 <var class="filename">my.cnf</var> 或者 <strong><code>MYSQL_READ_DEFAULT_FILE</code></strong> 指定的文件中
            读取指定的组中的选项。
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_SERVER_PUBLIC_KEY</code></strong></td>
           <td>
             SHA-256 认证模式下，要使用的 RSA 公钥文件。
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_OPT_NET_CMD_BUFFER_SIZE</code></strong></td>
           <td>
            内部命令/网络缓冲大小，
            仅在 mysqlnd 驱动下有效。
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_OPT_NET_READ_BUFFER_SIZE</code></strong></td>
           <td>
            以字节为单位，读取 MySQL 命令报文时候的块大小，
            仅在 mysqlnd 驱动下有效。
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_OPT_INT_AND_FLOAT_NATIVE</code></strong></td>
           <td>
            将整数和浮点数类型的列转换成 PHP 的数值类型，
            仅在 mysqlnd 驱动下有效。
           </td>
          </tr>

          <tr>
           <td><strong><code>MYSQLI_OPT_SSL_VERIFY_SERVER_CERT</code></strong></td>
           <td>
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>

    
    
     <dt>
<code class="parameter">value</code></dt>

     <dd>

      <p class="para">
       选项值。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mysqli.options-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   成功时返回 <strong><code>true</code></strong>， 或者在失败时返回 <strong><code>false</code></strong>。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-mysqli.options-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        新增 <strong><code>MYSQLI_SERVER_PUBLIC_KEY</code></strong> 和
        <strong><code>MYSQLI_SERVER_PUBLIC_KEY</code></strong> 选项。
       </td>
      </tr>

      <tr>
       <td>5.3.0</td>
       <td>
        新增 <strong><code>MYSQLI_OPT_INT_AND_FLOAT_NATIVE</code></strong>，
        <strong><code>MYSQLI_OPT_NET_CMD_BUFFER_SIZE</code></strong>，
        <strong><code>MYSQLI_OPT_NET_READ_BUFFER_SIZE</code></strong> 和
        <strong><code>MYSQLI_OPT_SSL_VERIFY_SERVER_CERT</code></strong> 
        选项。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mysqli.options-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   参见 <span class="function"><a href="mysqli.real-connect.html" class="function">mysqli_real_connect()</a></span>。
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-mysqli.options-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
<p class="para">MySQLnd 总是使用服务器的默认字符集。此字符集在连接握手／认证时发送，并被 mysqlnd
使用。</p><p class="para">Libmysqlclient 使用 <var class="filename">my.cnf</var> 中的默认字符集或者由在调用
<span class="function"><a href="mysqli.init.html" class="function">mysqli_init()</a></span> 之后，<span class="function"><a href="mysqli.real-connect.html" class="function">mysqli_real_connect()</a></span>
之前先调用 <span class="function"><strong>mysqli_options()</strong></span> 来指定。</p></p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-mysqli.options-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.init.html" class="function" rel="rdfs-seeAlso">mysqli_init()</a> - 初始化 MySQLi 并返回一个资源类型的值，这个值可以作为 mysqli_real_connect() 函数的传入参数</span></li>
    <li class="member"><span class="function"><a href="mysqli.real-connect.html" class="function" rel="rdfs-seeAlso">mysqli_real_connect()</a> - 建立一个 MySQL 服务器连接</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122965""></a>
  <div class="note">
   <strong class="user">php at darkain dot com</strong>
   <a href="#122965" class="date">20-Jul-2018 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is an undocumented option: MYSQLI_OPT_READ_TIMEOUT. This is similar to MYSQLI_OPT_CONNECT_TIMEOUT in theory, but has a slightly different application. Connection timeout only specifies the wait time for the initial TCP connection. Once that is created, the timeout no longer applies. Read timeout, however, is from the time the TCP connection is created until the first packet of actual data is received. There are instances where a TCP connection can be established, but the MySQL server stalls indefinitely, preventing execution from ever returning to PHP. Specifying a read timeout alleviates this condition, whereas connect timeout wouldn't. <br />
<br />
If the MYSQLI_OPT_READ_TIMEOUT constant isn't defined, it is still supported on versions where that isn't the case. You can define it yourself in older PHP versions with the following code.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">if (!</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'MYSQLI_OPT_READ_TIMEOUT'</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">define </span><span class="keyword">(</span><span class="string">'MYSQLI_OPT_READ_TIMEOUT'</span><span class="keyword">, </span><span class="default">11</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
You can then use read timeout the same way you could a connect timeout as follows. Please note that since these are two different timeout values for two different parts of the entire connection process, the timeouts do stack (eg: 10 seconds connect timeout + 10 seconds read timeout = maximum possible timeout of 20 seconds)<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">//create the object<br />
</span><span class="default">$connection </span><span class="keyword">= </span><span class="default">mysqli_init</span><span class="keyword">();<br />
<br />
</span><span class="comment">//specify the connection timeout<br />
</span><span class="default">$connection</span><span class="keyword">-&gt;</span><span class="default">options</span><span class="keyword">(</span><span class="default">MYSQLI_OPT_CONNECT_TIMEOUT</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
<br />
</span><span class="comment">//specify the read timeout<br />
</span><span class="default">$connection</span><span class="keyword">-&gt;</span><span class="default">options</span><span class="keyword">(</span><span class="default">MYSQLI_OPT_READ_TIMEOUT</span><span class="keyword">, </span><span class="default">10</span><span class="keyword">);<br />
<br />
</span><span class="comment">//initiate the connection to the server, using both previously specified timeouts<br />
</span><span class="default">$connection</span><span class="keyword">-&gt;</span><span class="default">real_connect</span><span class="keyword">(</span><span class="string">'server'</span><span class="keyword">, </span><span class="string">'user'</span><span class="keyword">, </span><span class="string">'pass'</span><span class="keyword">, </span><span class="string">'database'</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81126""></a>
  <div class="note">
   <strong class="user">king at bobfish dot org</strong>
   <a href="#81126" class="date">14-Feb-2008 12:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Example on using mysqli_options to increase size of max_allowed_packet for working with big blobs.<br />
<br />
function dbConnect()<br />
{<br />
&nbsp;&nbsp; $user = 'jomama';<br />
&nbsp;&nbsp; $pass = 'cartoon';<br />
&nbsp;&nbsp; $dbName = 'LifeCycle';<br />
&nbsp;&nbsp; $host = 'localhost';<br />
<br />
&nbsp;&nbsp; $mysqli = mysqli_init();<br />
&nbsp;&nbsp; mysqli_options($mysqli,MYSQLI_READ_DEFAULT_GROUP,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; "max_allowed_packet=50M");<br />
&nbsp;&nbsp; mysqli_real_connect($mysqli,$host, $user, $pass,$dbName) <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; or die ('&lt;P&gt;Unable to connect&lt;/P&gt;');<br />
<br />
&nbsp;&nbsp; return $mysqli;<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73723""></a>
  <div class="note">
   <strong class="user">fluppy</strong>
   <a href="#73723" class="date">07-Mar-2007 02:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here es little example to create a SSL Connection
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$db </span><span class="keyword">= </span><span class="default">mysqli_init</span><span class="keyword">();
<br />

<br />
</span><span class="comment">/*
<br />
When you want so use a separate cnf
<br />
$test = $db-&gt;options(MYSQLI_EAD_DEFAULT_FILE,'myother.cnf');
<br />
*/
<br />

<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">ssl_set</span><span class="keyword">(</span><span class="string">'server-key.pem'</span><span class="keyword">,</span><span class="string">'server-cert.pem'</span><span class="keyword">,
<br />
</span><span class="string">'cacert.pem'</span><span class="keyword">,</span><span class="default">NULL</span><span class="keyword">,</span><span class="default">NULL</span><span class="keyword">);
<br />

<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">real_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">,</span><span class="string">'root'</span><span class="keyword">,</span><span class="string">''</span><span class="keyword">,</span><span class="string">'mydb'</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//Here some query
<br />

<br />
</span><span class="default">$db</span><span class="keyword">-&gt;</span><span class="default">close</span><span class="keyword">();
<br />

<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
