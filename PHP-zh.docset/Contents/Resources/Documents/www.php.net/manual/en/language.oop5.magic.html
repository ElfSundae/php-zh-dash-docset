<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>魔术方法</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="language.oop5.iterations.html">? 遍历对象</a></li>
      <li style="float: right;"><a href="language.oop5.final.html">Final 关键字 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.oop5.html">类与对象</a></li>
    <li>魔术方法</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="language.oop5.magic" class="sect1">
  <h2 class="title">魔术方法</h2>
  <p class="para">
   魔术方法是一种特殊的方法，当对对象执行某些操作时会覆盖 PHP 的默认操作。
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    PHP 保留所有以 <code class="literal">__</code> 开头的方法名称。
    因此，除非覆盖 PHP 的行为，否则不建议使用此类方法名称。
   </p>
  </div>
  <p class="para">
   下列方法名被认为是魔术方法：
   
   <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a>、
   <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a>、
   <a href="language.oop5.overloading.html#object.call" class="link">__call()</a>、
   <a href="language.oop5.overloading.html#object.callstatic" class="link">__callStatic()</a>、
   <a href="language.oop5.overloading.html#object.get" class="link">__get()</a>、
   <a href="language.oop5.overloading.html#object.set" class="link">__set()</a>、
   <a href="language.oop5.overloading.html#object.isset" class="link">__isset()</a>、
   <a href="language.oop5.overloading.html#object.unset" class="link">__unset()</a>、
   <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>、
   <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>、
   <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a>、
   <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>、
   <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>、
   <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a>、
   <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a>、
   <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a>、
   <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a>。
  </p>

  <div class="warning"><strong class="warning">Warning</strong>
   
   <p class="simpara">
    除了 <a href="language.oop5.decon.html#object.construct" class="link">__construct()</a>、
    <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a> 和
    <a href="language.oop5.cloning.html#object.clone" class="link">__clone()</a> 之外的所有魔术方法都<em>必须</em>声明为 <code class="literal">public</code>，
    否则会发出 <strong><code><a href="errorfunc.constants.html#constant.e-warning">E_WARNING</a></code></strong>。
    在 PHP 8.0.0 之前没有为魔术方法
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>、<a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>、<a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a>、<a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>、<a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 发出诊断信息。
   </p>
  </div>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    如果定义魔术方法时使用类型声明，它们必须与本文档中描述的签名相同，否则会发出致命错误。
    在 PHP 8.0.0 之前，不会发出诊断信息。
    然而，<a href="language.oop5.decon.html#object.construct" class="link">__construct()</a> 和
    <a href="language.oop5.decon.html#object.destruct" class="link">__destruct()</a> 不能声明返回类型，
    否则会发出致命错误。
   </p>
  </div>
 
  <div class="sect2" id="language.oop5.magic.sleep">
   <h3 class="title">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 和
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
   </h3>
   
   <div class="methodsynopsis dc-description" id="object.sleep">
    <span class="modifier">public</span> <span class="methodname"><strong>__sleep</strong></span>(): <span class="type"><a href="language.types.array.html" class="type array">array</a></span></div>

   <div class="methodsynopsis dc-description" id="object.wakeup"><span class="modifier">public</span> <span class="methodname"><strong>__wakeup</strong></span>(): <span class="type"><a href="language.types.void.html" class="type void">void</a></span></div>

   
   <p class="para">
    <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> 函数会检查类中是否存在一个魔术方法
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。
    如果该方法未返回任何内容，则 <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong> 被序列化，并产生一个 <strong><code><a href="errorfunc.constants.html#constant.e-notice">E_NOTICE</a></code></strong> 级别的错误。
    </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 不能返回父类的私有成员的名字。这样做会产生一个
     <strong><code><a href="errorfunc.constants.html#constant.e-notice">E_NOTICE</a></code></strong> 级别的错误。使用
     <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 接口替代。
    </p>
   </p></blockquote>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     自 PHP 8.0.0 起，<a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 的返回值不是数组会生成 warning。之前生成 notice。
    </p>
   </p></blockquote>
   <p class="para">
    <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 方法常用于提交未提交的数据，或类似的清理操作。同时，如果有一些很大的对象，但不需要全部保存，这个功能就很好用。
   </p>
   <p class="para">
    与之相反，<span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> 会检查是否存在一个 <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
    方法。如果存在，则会先调用 <code class="literal">__wakeup</code> 方法，预先准备对象需要的资源。
   </p>
   <p class="para">
    <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 经常用在反序列化操作中，例如重新建立数据库连接，或执行其它初始化操作。
   </p>
   <div class="example" id="example-266">
    <p><strong>Example #1 Sleep 和 wakeup</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Connection <br /></span><span style="color: #007700">{<br />    protected </span><span style="color: #0000BB">$link</span><span style="color: #007700">;<br />    private </span><span style="color: #0000BB">$server</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />    <br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$server</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">, </span><span style="color: #0000BB">$db</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server </span><span style="color: #007700">= </span><span style="color: #0000BB">$server</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db </span><span style="color: #007700">= </span><span style="color: #0000BB">$db</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />    <br />    private function </span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link </span><span style="color: #007700">= </span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">server</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">mysql_select_db</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">db</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link</span><span style="color: #007700">);<br />    }<br />    <br />    public function </span><span style="color: #0000BB">__sleep</span><span style="color: #007700">()<br />    {<br />        return array(</span><span style="color: #DD0000">'server'</span><span style="color: #007700">, </span><span style="color: #DD0000">'username'</span><span style="color: #007700">, </span><span style="color: #DD0000">'password'</span><span style="color: #007700">, </span><span style="color: #DD0000">'db'</span><span style="color: #007700">);<br />    }<br />    <br />    public function </span><span style="color: #0000BB">__wakeup</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.serialize">
   <h3 class="title">
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 和
    <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>
   </h3>

   <div class="methodsynopsis dc-description" id="object.serialize">
    <span class="modifier">public</span> <span class="methodname"><strong>__serialize</strong></span>(): <span class="type"><a href="language.types.array.html" class="type array">array</a></span></div>

   <div class="methodsynopsis dc-description" id="object.unserialize"><span class="modifier">public</span> <span class="methodname"><strong>__unserialize</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.array.html" class="type array">array</a></span> <code class="parameter">$data</code></span>): <span class="type"><a href="language.types.void.html" class="type void">void</a></span></div>


   <p class="para">
    <span class="function"><a href="function.serialize.html" class="function">serialize()</a></span> 函数会检查类中是否存在一个魔术方法
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 
    。如果存在，该方法将在任何序列化之前优先执行。它必须以一个代表对象序列化形式的 键/值 成对的关联数组形式来返回，如果没有返回数组，将会抛出一个
    <span class="classname"><a href="class.typeerror.html" class="classname">TypeError</a></span> 错误。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     如果类中同时定义了 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 和 <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a>
     两个魔术方法，则只有 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 方法会被调用。
     <a href="language.oop5.magic.html#object.sleep" class="link">__sleep()</a> 方法会被忽略掉。如果对象实现了 <a href="class.serializable.html" class="link">Serializable</a>
     接口，接口的 <code class="literal">serialize()</code> 方法会被忽略，做为代替类中的 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 方法会被调用。
    </p>
   </p></blockquote>
   <p class="para">
    <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a> 的预期用途是定义对象序列化友好的任意表示。
    数组的元素可能对应对象的属性，但是这并不是必须的。
   </p>
   <p class="para">
    相反，<span class="function"><a href="function.unserialize.html" class="function">unserialize()</a></span> 检查是否存在具有名为 
    <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a>
    的魔术方法。此函数将会传递从 <a href="language.oop5.magic.html#object.serialize" class="link">__serialize()</a>
    返回的恢复数组。然后它可以根据需要从该数组中恢复对象的属性。
   </p>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
     如果类中同时定义了 <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 和 <a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a>
     两个魔术方法，则只有 <a href="language.oop5.magic.html#object.unserialize" class="link">__unserialize()</a> 方法会生效，<a href="language.oop5.magic.html#object.wakeup" class="link">__wakeup()</a> 方法会被忽略。
    </p>
   </p></blockquote>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <p class="para">
      此特性自 PHP 7.4.0 起可用。
    </p>
   </p></blockquote>
   <div class="example" id="example-267">
    <p><strong>Example #2 序列化和反序列化</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Connection<br /></span><span style="color: #007700">{<br />    protected </span><span style="color: #0000BB">$link</span><span style="color: #007700">;<br />    private </span><span style="color: #0000BB">$dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$username</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn </span><span style="color: #007700">= </span><span style="color: #0000BB">$dsn</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$username</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br /><br />    private function </span><span style="color: #0000BB">connect</span><span style="color: #007700">()<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">link </span><span style="color: #007700">= new </span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">);<br />    }<br /><br />    public function </span><span style="color: #0000BB">__serialize</span><span style="color: #007700">(): array<br />    {<br />        return [<br />          </span><span style="color: #DD0000">'dsn' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn</span><span style="color: #007700">,<br />          </span><span style="color: #DD0000">'user' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username</span><span style="color: #007700">,<br />          </span><span style="color: #DD0000">'pass' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password</span><span style="color: #007700">,<br />        ];<br />    }<br /><br />    public function </span><span style="color: #0000BB">__unserialize</span><span style="color: #007700">(array </span><span style="color: #0000BB">$data</span><span style="color: #007700">): </span><span style="color: #0000BB">void<br />    </span><span style="color: #007700">{<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">dsn </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'dsn'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">password </span><span style="color: #007700">= </span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'pass'</span><span style="color: #007700">];<br /><br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">();<br />    }<br />}</span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.tostring">
   <h3 class="title"><a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a></h3>
   <div class="methodsynopsis dc-description" id="object.tostring">
    <span class="modifier">public</span> <span class="methodname"><strong>__toString</strong></span>(): <span class="type"><a href="language.types.string.html" class="type string">string</a></span></div>

   
   <p class="para">
    <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a> 方法用于一个类被当成字符串时应怎样回应。例如
    <code class="literal">echo $obj;</code> 应该显示些什么。
   </p>
   <div class="warning"><strong class="warning">Warning</strong>
    <p class="para">
     从 PHP 8.0.0 起，返回值遵循标准的 PHP 类型语义，
     这意味着如果禁用 <a href="language.types.declarations.html#language.types.declarations.strict" class="link">严格类型</a>
     ，它将会强制转换为字符串。
    </p>
    <p class="para">
     如果启用<a href="language.types.declarations.html#language.types.declarations.strict" class="link">严格类型</a>，则声明的 <span class="type"><a href="language.types.string.html" class="type string">string</a></span> 类型将<em>不会</em>接受
     <span class="interfacename"><a href="class.stringable.html" class="interfacename">Stringable</a></span> 对象。如果需要这种行为，类型声明必须接受 <span class="interfacename"><a href="class.stringable.html" class="interfacename">Stringable</a></span> 和 <span class="type"><a href="language.types.string.html" class="type string">string</a></span> 的联合类型。
    </p>
    <p class="para">
     从 PHP 8.0.0 起，任何包含 <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
     方法的类都将隐性实现 <span class="interfacename"><a href="class.stringable.html" class="interfacename">Stringable</a></span> 接口，
     因此将通过该接口的类型检查。推荐无论如何应显式实现该接口。
    </p>
    <p class="para">
     在 PHP 7.4 中，返回值 <em>必须</em> 是 <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     ，否则会抛出 <span class="classname"><a href="class.error.html" class="classname">Error</a></span> 。
    </p>
    <p class="para">
     在 PHP 7.4.0 之前，返回值 <em>必须</em> 是 <span class="type"><a href="language.types.string.html" class="type string">string</a></span>
     ，否则会抛出致命错误 <strong><code><a href="errorfunc.constants.html#constant.e-recoverable-error">E_RECOVERABLE_ERROR</a></code></strong> 。
    </p>
   </div>
   <div class="warning"><strong class="warning">Warning</strong>
    <p class="simpara">
     在 PHP 7.4.0 之前不能在 <a href="language.oop5.magic.html#object.tostring" class="link">__toString()</a>
     方法中抛出异常。这么做会导致致命错误。
    </p>
   </div>
   <div class="example" id="example-268">
    <p><strong>Example #3 简单示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 声明一个简单的类<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">TestClass<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$foo</span><span style="color: #007700">) <br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo </span><span style="color: #007700">= </span><span style="color: #0000BB">$foo</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">__toString</span><span style="color: #007700">() {<br />        return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">foo</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$class </span><span style="color: #007700">= new </span><span style="color: #0000BB">TestClass</span><span style="color: #007700">(</span><span style="color: #DD0000">'Hello'</span><span style="color: #007700">);<br />echo </span><span style="color: #0000BB">$class</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Hello
</pre></div>
    </div>
   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.invoke">
   <h3 class="title"><a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></h3>
   <div class="methodsynopsis dc-description" id="object.invoke">
    <span class="methodname"><strong>__invoke</strong></span>(<span class="methodparam"> <code class="parameter">...$values</code></span>): <span class="type"><a href="language.types.mixed.html" class="type mixed">mixed</a></span></div>

   <p class="para">
    当尝试以调用函数的方式调用一个对象时，<a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a> 方法会被自动调用。
   </p>
   <div class="example" id="example-269">
    <p><strong>Example #4 使用 <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">CallableClass <br /></span><span style="color: #007700">{<br />    function </span><span style="color: #0000BB">__invoke</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">);<br />    }<br />}<br /></span><span style="color: #0000BB">$obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">CallableClass</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$obj</span><span style="color: #007700">(</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">is_callable</span><span style="color: #007700">(</span><span style="color: #0000BB">$obj</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
int(5)
bool(true)
</pre></div>
    </div>
   </div>
   <div class="example" id="example-270">
    <p><strong>Example #5 使用 <a href="language.oop5.magic.html#object.invoke" class="link">__invoke()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Sort<br /></span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">string $key</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key </span><span style="color: #007700">= </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    }<br />    public function </span><span style="color: #0000BB">__invoke</span><span style="color: #007700">(array </span><span style="color: #0000BB">$a</span><span style="color: #007700">, array </span><span style="color: #0000BB">$b</span><span style="color: #007700">): </span><span style="color: #0000BB">int<br />    </span><span style="color: #007700">{<br />        return </span><span style="color: #0000BB">$a</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">] &lt;=&gt; </span><span style="color: #0000BB">$b</span><span style="color: #007700">[</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">];<br />    }<br />}<br /></span><span style="color: #0000BB">$customers </span><span style="color: #007700">= [<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'John'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Do'</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">3</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Alice'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Gustav'</span><span style="color: #007700">],<br />    [</span><span style="color: #DD0000">'id' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">2</span><span style="color: #007700">, </span><span style="color: #DD0000">'first_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Bob'</span><span style="color: #007700">, </span><span style="color: #DD0000">'last_name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Filipe'</span><span style="color: #007700">]<br />];<br /></span><span style="color: #FF8000">// sort customers by first name<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">, new </span><span style="color: #0000BB">Sort</span><span style="color: #007700">(</span><span style="color: #DD0000">'first_name'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// sort customers by last name<br /></span><span style="color: #0000BB">usort</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">, new </span><span style="color: #0000BB">Sort</span><span style="color: #007700">(</span><span style="color: #DD0000">'last_name'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$customers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 3
            [first_name] =&gt; Alice
            [last_name] =&gt; Gustav
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [first_name] =&gt; Bob
            [last_name] =&gt; Filipe
        )
    [2] =&gt; Array
        (
            [id] =&gt; 1
            [first_name] =&gt; John
            [last_name] =&gt; Do
        )
)
Array
(
    [0] =&gt; Array
        (
            [id] =&gt; 1
            [first_name] =&gt; John
            [last_name] =&gt; Do
        )
    [1] =&gt; Array
        (
            [id] =&gt; 2
            [first_name] =&gt; Bob
            [last_name] =&gt; Filipe
        )
    [2] =&gt; Array
        (
            [id] =&gt; 3
            [first_name] =&gt; Alice
            [last_name] =&gt; Gustav
        )
)
</pre></div>
    </div>
   </div>
  </div>

  <div class="sect2" id="language.oop5.magic.set-state">
   <h3 class="title"><a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a></h3>
   <div class="methodsynopsis dc-description" id="object.set-state">
    <span class="modifier">static</span> <span class="methodname"><strong>__set_state</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.array.html" class="type array">array</a></span> <code class="parameter">$properties</code></span>): <span class="type"><a href="language.types.object.html" class="type object">object</a></span></div>

   <p class="para">
    当调用 <span class="function"><a href="function.var-export.html" class="function">var_export()</a></span> 导出类时，此<a href="language.oop5.static.html" class="link">静态</a> 方法会被调用。
   </p>
   <p class="para">
    本方法的唯一参数是一个数组，其中包含按 <code class="literal">[&#039;property&#039; =&gt; value, ...]</code> 格式排列的类属性。
   </p>
   <div class="example" id="example-271">
    <p><strong>Example #6 使用 <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a>&gt;</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">A<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$var1</span><span style="color: #007700">;<br />    public </span><span style="color: #0000BB">$var2</span><span style="color: #007700">;<br /><br />    public static function </span><span style="color: #0000BB">__set_state</span><span style="color: #007700">(</span><span style="color: #0000BB">$an_array</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$obj </span><span style="color: #007700">= new </span><span style="color: #0000BB">A</span><span style="color: #007700">;<br />        </span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1 </span><span style="color: #007700">= </span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var1'</span><span style="color: #007700">];<br />        </span><span style="color: #0000BB">$obj</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2 </span><span style="color: #007700">= </span><span style="color: #0000BB">$an_array</span><span style="color: #007700">[</span><span style="color: #DD0000">'var2'</span><span style="color: #007700">];<br />        return </span><span style="color: #0000BB">$obj</span><span style="color: #007700">;<br />    }<br />}<br /><br /></span><span style="color: #0000BB">$a </span><span style="color: #007700">= new </span><span style="color: #0000BB">A</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var1 </span><span style="color: #007700">= </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">var2 </span><span style="color: #007700">= </span><span style="color: #DD0000">'foo'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$b </span><span style="color: #007700">= </span><span style="color: #0000BB">var_export</span><span style="color: #007700">(</span><span style="color: #0000BB">$a</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br />eval(</span><span style="color: #DD0000">'$c = ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$b </span><span style="color: #007700">. </span><span style="color: #DD0000">';'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$c</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$b</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
string(60) &quot;A::__set_state(array(
   &#039;var1&#039; =&gt; 5,
   &#039;var2&#039; =&gt; &#039;foo&#039;,
))&quot;
object(A)#2 (2) {
  [&quot;var1&quot;]=&gt;
  int(5)
  [&quot;var2&quot;]=&gt;
  string(3) &quot;foo&quot;
}
</pre></div>
    </div>
   </div>
   <blockquote class="note"><p><strong class="note">Note</strong>: 
    <span class="simpara">
     导出对象时，<span class="function"><a href="function.var-export.html" class="function">var_export()</a></span> 不会检查对象类是否实现了
     <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> ，
     所以如果 <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 没有实现，
     重新导入对象会触发 <span class="classname"><a href="class.error.html" class="classname">Error</a></span> 异常。特别是这会影响内部(内置)类。
    </span>
    <span class="simpara">
     程序员有责任验证要重新导入的类是否实现了 
     <a href="language.oop5.magic.html#object.set-state" class="link">__set_state()</a> 。
    </span>
   </p></blockquote>
  </div>
  <div class="sect2" id="language.oop5.magic.debuginfo">
   <h3 class="title"><a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></h3>
   <div class="methodsynopsis dc-description" id="object.debuginfo">
    <span class="methodname"><strong>__debugInfo</strong></span>(): <span class="type"><a href="language.types.array.html" class="type array">array</a></span></div>

   <p class="para">
    当通过 <span class="function"><a href="function.var-dump.html" class="function">var_dump()</a></span> 转储对象，获取应该要显示的属性的时候，
    该函数就会被调用。如果对象中没有定义该方法，那么将会展示所有的公有、受保护和私有的属性。
   </p>
   <div class="example" id="example-272">
    <p><strong>Example #7 使用 <a href="language.oop5.magic.html#object.debuginfo" class="link">__debugInfo()</a></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">C </span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$prop</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$val</span><span style="color: #007700">) {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop </span><span style="color: #007700">= </span><span style="color: #0000BB">$val</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">__debugInfo</span><span style="color: #007700">() {<br />        return [<br />            </span><span style="color: #DD0000">'propSquared' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prop </span><span style="color: #007700">** </span><span style="color: #0000BB">2</span><span style="color: #007700">,<br />        ];<br />    }<br />}<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(new </span><span style="color: #0000BB">C</span><span style="color: #007700">(</span><span style="color: #0000BB">42</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
object(C)#1 (1) {
  [&quot;propSquared&quot;]=&gt;
  int(1764)
}
</pre></div>
    </div>
   </div>
  </div>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="128621""></a>
  <div class="note">
   <strong class="user">tyler at nighthound dot us</strong>
   <a href="#128621" class="date">18-Jun-2023 01:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that as of PHP 8.2 implementing __serialize() has no control over the output of json_encode(). you still have to implement JsonSerializable.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125282""></a>
  <div class="note">
   <strong class="user">ctamayo at sitecrafting dot com</strong>
   <a href="#125282" class="date">18-Aug-2020 06:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Due to a bug in PHP &lt;= 7.3, overriding the __debugInfo() method from SPL classes is silently ignored.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Debuggable </span><span class="keyword">extends </span><span class="default">ArrayObject </span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">__debugInfo</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; return [</span><span class="string">'special' </span><span class="keyword">=&gt; </span><span class="string">'This should show up'</span><span class="keyword">];<br />
&nbsp; }<br />
}<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(new </span><span class="default">Debuggable</span><span class="keyword">());<br />
<br />
</span><span class="comment">// Expected output:<br />
// object(Debuggable)#1 (1) {<br />
//&nbsp;&nbsp; ["special"]=&gt;<br />
//&nbsp;&nbsp; string(19) "This should show up"<br />
// }<br />
<br />
// Actual output:<br />
// object(Debuggable)#1 (1) {<br />
//&nbsp;&nbsp; ["storage":"ArrayObject":private]=&gt;<br />
//&nbsp;&nbsp; array(0) {<br />
//&nbsp;&nbsp; }<br />
// }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Bug report: https://bugs.php.net/bug.php?id=69264</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122684""></a>
  <div class="note">
   <strong class="user">daniel dot peder at gmail dot com</strong>
   <a href="#122684" class="date">30-Apr-2018 09:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<a href="http://sandbox.onlinephpfunctions.com/code/4d2cc3648aed58c0dad90c7868173a4775e5ba0c" rel="nofollow" target="_blank">http://sandbox.onlinephpfunctions.com/code/4d2cc3648aed58c0dad90c7868173a4775e5ba0c</a><br />
<br />
IMHO a bug or need feature change<br />
<br />
providing a object as a array index doesn't try to us __toString() method so some volatile object identifier is used to index the array, which is breaking any persistency. Type hinting solves that, but while other than "string" type hinting doesn't work on ob jects, the automatic conversion to string should be very intuitive.<br />
<br />
PS: tried to submit bug, but withot patch the bugs are ignored, unfortunately, I don't C coding<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">shop_product_id </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$shop_name</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; protected </span><span class="default">$product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$shop_name</span><span class="keyword">,</span><span class="default">$product_id</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shop_name </span><span class="keyword">= </span><span class="default">$shop_name</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">product_id </span><span class="keyword">= </span><span class="default">$product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__toString</span><span class="keyword">(){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">shop_name </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">product_id</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$shop_name </span><span class="keyword">= </span><span class="string">'Shop_A'</span><span class="keyword">;<br />
</span><span class="default">$product_id </span><span class="keyword">= </span><span class="default">123</span><span class="keyword">;<br />
</span><span class="default">$demo_id </span><span class="keyword">= </span><span class="default">$shop_name </span><span class="keyword">. </span><span class="string">':' </span><span class="keyword">. </span><span class="default">$product_id</span><span class="keyword">;<br />
</span><span class="default">$demo_name </span><span class="keyword">= </span><span class="string">'Some product in shop A'</span><span class="keyword">;<br />
<br />
</span><span class="default">$all_products </span><span class="keyword">= [ </span><span class="default">$demo_id </span><span class="keyword">=&gt; </span><span class="default">$demo_name </span><span class="keyword">];<br />
</span><span class="default">$pid </span><span class="keyword">= new </span><span class="default">shop_product_id</span><span class="keyword">( </span><span class="default">$shop_name</span><span class="keyword">, </span><span class="default">$product_id </span><span class="keyword">);<br />
<br />
echo </span><span class="string">"with type hinting: "</span><span class="keyword">;<br />
echo (</span><span class="default">$demo_name </span><span class="keyword">=== </span><span class="default">$all_products</span><span class="keyword">[(string)</span><span class="default">$pid</span><span class="keyword">]) ? </span><span class="string">"ok" </span><span class="keyword">: </span><span class="string">"fail"</span><span class="keyword">;<br />
echo </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
echo </span><span class="string">"without type hinting: "</span><span class="keyword">;<br />
echo (</span><span class="default">$demo_name </span><span class="keyword">=== </span><span class="default">$all_products</span><span class="keyword">[</span><span class="default">$pid</span><span class="keyword">]) ?&nbsp; </span><span class="string">"ok" </span><span class="keyword">: </span><span class="string">"fail"</span><span class="keyword">;<br />
echo </span><span class="string">"\n"</span><span class="keyword">;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121158""></a>
  <div class="note">
   <strong class="user">kguest at php dot net</strong>
   <a href="#121158" class="date">30-May-2017 01:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
__debugInfo&nbsp; is also utilised when calling print_r on an object:<br />
<br />
$ cat test.php<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">FooQ </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp; &nbsp; private </span><span class="default">$bar </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bar </span><span class="keyword">= </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; public function </span><span class="default">__debugInfo</span><span class="keyword">()<br />
&nbsp;&nbsp; &nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; return [</span><span class="string">'_bar' </span><span class="keyword">=&gt; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">bar</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; }<br />
}<br />
</span><span class="default">$fooq </span><span class="keyword">= new </span><span class="default">FooQ</span><span class="keyword">(</span><span class="string">"q"</span><span class="keyword">);<br />
</span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$fooq</span><span class="keyword">);<br />
<br />
$ </span><span class="default">php test</span><span class="keyword">.</span><span class="default">php<br />
FooQ Object<br />
</span><span class="keyword">(<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">_bar</span><span class="keyword">] =&gt; </span><span class="default">q<br />
</span><span class="keyword">)<br />
$</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87404""></a>
  <div class="note">
   <strong class="user">jsnell at e-normous dot com</strong>
   <a href="#87404" class="date">03-Dec-2008 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be very careful to define __set_state() in classes which inherit from a parent using it, as the static __set_state() call will be called for any children.&nbsp; If you are not careful, you will end up with an object of the wrong type.&nbsp; Here is an example:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">A
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$var1</span><span class="keyword">; 
<br />

<br />
&nbsp;&nbsp;&nbsp; public static function </span><span class="default">__set_state</span><span class="keyword">(</span><span class="default">$an_array</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">A</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">$an_array</span><span class="keyword">[</span><span class="string">'var1'</span><span class="keyword">];&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$obj</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />

<br />
class </span><span class="default">B </span><span class="keyword">extends </span><span class="default">A </span><span class="keyword">{
<br />
}
<br />

<br />
</span><span class="default">$b </span><span class="keyword">= new </span><span class="default">B</span><span class="keyword">;
<br />
</span><span class="default">$b</span><span class="keyword">-&gt;</span><span class="default">var1 </span><span class="keyword">= </span><span class="default">5</span><span class="keyword">;
<br />

<br />
eval(</span><span class="string">'$new_b = ' </span><span class="keyword">. </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">) . </span><span class="string">';'</span><span class="keyword">); 
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$new_b</span><span class="keyword">);
<br />
</span><span class="comment">/*
<br />
object(A)#2 (1) {
<br />
&nbsp; ["var1"]=&gt;
<br />
&nbsp; int(5)
<br />
}
<br />
*/
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86111""></a>
  <div class="note">
   <strong class="user">jon at webignition dot net</strong>
   <a href="#86111" class="date">03-Oct-2008 07:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The __toString() method is extremely useful for converting class attribute names and values into common string representations of data (of which there are many choices). I mention this as previous references to __toString() refer only to debugging uses.<br />
<br />
I have previously used the __toString() method in the following ways:<br />
<br />
&nbsp;- representing a data-holding object as:<br />
&nbsp;&nbsp; - XML<br />
&nbsp;&nbsp; - raw POST data<br />
&nbsp;&nbsp; - a GET query string<br />
&nbsp;&nbsp; - header name:value pairs<br />
<br />
&nbsp;- representing a custom mail object as an actual email (headers then body, all correctly represented)<br />
<br />
When creating a class, consider what possible standard string representations are available and, of those, which would be the most relevant with respect to the purpose of the class.<br />
<br />
Being able to represent data-holding objects in standardised string forms makes it much easier for your internal representations of data to be shared in an interoperable way with other applications.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="63863""></a>
  <div class="note">
   <strong class="user">rayRO</strong>
   <a href="#63863" class="date">02-Apr-2006 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you use the Magical Method '__set()', be shure that the call of<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">[</span><span class="string">'myarray'</span><span class="keyword">] = </span><span class="string">'data'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>will not appear!<br />
<br />
For that u have to do it the fine way if you want to use __set Method ;)<br />
<span class="default">&lt;?php<br />
$myobject</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= array(</span><span class="string">'myarray' </span><span class="keyword">=&gt; </span><span class="string">'data'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If a Variable is already set, the __set Magic Method already wont appear!<br />
<br />
My first solution was to use a Caller Class.<br />
With that, i ever knew which Module i currently use!<br />
But who needs it... :]<br />
There are quiet better solutions for this...<br />
Here's the Code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">Caller </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$caller</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__call</span><span class="keyword">(</span><span class="default">$funcname</span><span class="keyword">, </span><span class="default">$args </span><span class="keyword">= array()) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">) &amp;&amp; </span><span class="default">function_exists</span><span class="keyword">(</span><span class="string">'call_user_func_array'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">call_user_func_array</span><span class="keyword">(array(&amp;</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="default">$funcname</span><span class="keyword">), </span><span class="default">$args</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">"Call to Function with call_user_func_array failed"</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$callerClassName </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$callerModuleName </span><span class="keyword">= </span><span class="string">'Webboard'</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$callerClassName </span><span class="keyword">== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'No Classname'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$callerModuleName</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">class_exists</span><span class="keyword">(</span><span class="default">$callerClassName</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller </span><span class="keyword">= new </span><span class="default">$callerClassName</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Class not exists: \''</span><span class="keyword">.</span><span class="default">$callerClassName</span><span class="keyword">.</span><span class="string">'\''</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__init'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__init</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__destruct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">method_exists</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">, </span><span class="string">'__deinit'</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">__deinit</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__isset</span><span class="keyword">(</span><span class="default">$isset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$isset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__unset</span><span class="keyword">(</span><span class="default">$unset</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$unset</span><span class="keyword">});<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__set</span><span class="keyword">(</span><span class="default">$set</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$set</span><span class="keyword">} = </span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__get</span><span class="keyword">(</span><span class="default">$get</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">setModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_object</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (isset(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">}))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;{</span><span class="default">$get</span><span class="keyword">};<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$return </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Caller is no object!'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">unsetModuleInformation</span><span class="keyword">();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$return</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">setModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">unsetModuleInformation</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">caller</span><span class="keyword">-&gt;</span><span class="default">module </span><span class="keyword">= </span><span class="default">NULL</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// Well this can be a Config Class?<br />
</span><span class="keyword">class </span><span class="default">Config </span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$module</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public </span><span class="default">$test</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Constructor will have no Module Information... Use __init() instead!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'123'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__init</span><span class="keyword">()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'Using of __init()!&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'--&gt; '</span><span class="keyword">.</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">' &lt;--'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">testFunction</span><span class="keyword">(</span><span class="default">$test </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$test </span><span class="keyword">!= </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="default">$test</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
echo(</span><span class="string">'&lt;pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow </span><span class="keyword">= new </span><span class="default">Caller</span><span class="keyword">(</span><span class="string">'Config'</span><span class="keyword">, </span><span class="string">'Guestbook'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test </span><span class="keyword">= </span><span class="string">'456'</span><span class="keyword">;<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">testFunction</span><span class="keyword">(</span><span class="string">'789'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">test</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
print(</span><span class="string">'&lt;br /&gt;'</span><span class="keyword">);<br />
</span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$wow</span><span class="keyword">-&gt;</span><span class="default">module</span><span class="keyword">);<br />
echo(</span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Outputs something Like:<br />
<br />
Constructor will have no Module Information... Use __init() instead!<br />
--&gt;&nbsp; &lt;--<br />
<br />
Using of __init()!<br />
--&gt; Guestbook &lt;--<br />
<br />
123<br />
<br />
456<br />
<br />
789<br />
<br />
Guestbook</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55844""></a>
  <div class="note">
   <strong class="user">martin dot goldinger at netserver dot ch</strong>
   <a href="#55844" class="date">15-Aug-2005 04:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When you use sessions, its very important to keep the sessiondata small, due to low performance with unserialize. Every class shoud extend from this class. The result will be, that no null Values are written to the sessiondata. It will increase performance.<br />
<br />
&lt;?<br />
class BaseObject<br />
{<br />
&nbsp;&nbsp;&nbsp; function __sleep()<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $vars = (array)$this;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach ($vars as $key =&gt; $val)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (is_null($val))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; unset($vars[$key]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return array_keys($vars);<br />
&nbsp;&nbsp;&nbsp; }<br />
};<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="55806""></a>
  <div class="note">
   <strong class="user">jeffxlevy at gmail dot com</strong>
   <a href="#55806" class="date">13-Aug-2005 06:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Intriguing what happens when __sleep() and __wakeup() and sessions() are mixed. I had a hunch that, as session data is serialized, __sleep would be called when an object, or whatever, is stored in _SESSION. true. The same hunch applied when session_start() was called. Would __wakeup() be called? True. Very helpful, specifically as I'm building massive objects (well, lots of simple objects stored in sessions), and need lots of automated tasks (potentially) reloaded at "wakeup" time. (for instance, restarting a database session/connection).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49413""></a>
  <div class="note">
   <strong class="user">ddavenport at newagedigital dot com</strong>
   <a href="#49413" class="date">26-Jan-2005 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
One of the principles of OOP is encapsulation--the idea that an object should handle its own data and no others'.&nbsp; Asking base classes to take care of subclasses' data, esp considering that a class can't possibly know how many dozens of ways it will be extended, is irresponsible and dangerous.<br />
<br />
Consider the following...<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">class </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">CryptedStorageClass </span><span class="keyword">extends </span><span class="default">SomeStupidStorageClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">(</span><span class="default">$pos</span><span class="keyword">, </span><span class="default">$len</span><span class="keyword">) { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If SomeStupidStorageClass decided to serialize its subclasses' data as well as its own, a portion of what was once an encrypted thingie could be stored, in the clear, wherever the thingie was stored.&nbsp; Obviously, CryptedStorageClass would never have chosen this...but it had to either know how to serialize its parent class's data without calling parent::_sleep(), or let the base class do what it wanted to.<br />
<br />
Considering encapsulation again, no class should have to know how the parent handles its own private data.&nbsp; And it certainly shouldn't have to worry that users will find a way to break access controls in the name of convenience.<br />
<br />
If a class wants both to have private/protected data and to survive serialization, it should have its own __sleep() method which asks the parent to report its own fields and then adds to the list if applicable.&nbsp; Like so....<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$content</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return array(</span><span class="string">'basedata1'</span><span class="keyword">, </span><span class="string">'basedata2'</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">stuff</span><span class="keyword">... }<br />
}<br />
<br />
class </span><span class="default">BetterDerivedClass </span><span class="keyword">extends </span><span class="default">BetterClass<br />
</span><span class="keyword">{<br />
&nbsp; private </span><span class="default">$decrypted_block</span><span class="keyword">;<br />
<br />
&nbsp; public function </span><span class="default">__sleep</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">parent</span><span class="keyword">::</span><span class="default">__sleep</span><span class="keyword">();<br />
&nbsp; }<br />
<br />
&nbsp; public function </span><span class="default">getContents</span><span class="keyword">() { ...</span><span class="default">decrypt</span><span class="keyword">... }<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The derived class has better control over its data, and we don't have to worry about something being stored that shouldn't be.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
