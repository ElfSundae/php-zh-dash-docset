<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回当前 Unix 时间戳和微秒数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.localtime.html">? localtime</a></li>
      <li style="float: right;"><a href="function.mktime.html">mktime ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.datetime.html">Date/Time 函数</a></li>
    <li>返回当前 Unix 时间戳和微秒数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.microtime" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">microtime</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">microtime</span> &mdash; <span class="dc-title">返回当前 Unix 时间戳和微秒数</span></p>

 </div>
 <div class="refsect1 unknown-seealsp" id="refsect1-function.microtime-unknown-seealsp">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>microtime</strong></span>
    ( <span class="methodparam"><span class="type">bool</span> <code class="parameter">$get_as_float</code> = ?</span>
   ) : <span class="type"><a href="language.types.declarations.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   <span class="function"><strong>microtime()</strong></span> 当前 Unix
   时间戳以及微秒数。本函数仅在支持 gettimeofday()
   系统调用的操作系统下可用。
  </p>
  <p class="para">
   如果调用时不带可选参数，本函数以 &quot;msec sec&quot;
   的格式返回一个字符串，其中 sec 是自 Unix 纪元（0:00:00 January 1,
   1970 GMT）起到现在的秒数，msec 是微秒部分。字符串的两部分都是以秒为单位返回的。
  </p>
  <p class="para">
   如果给出了 <code class="parameter">get_as_float</code> 参数并且其值等价于
   <strong><code>true</code></strong>，<span class="function"><strong>microtime()</strong></span> 将返回一个浮点数。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    <code class="parameter">get_as_float</code> 参数是 PHP 5.0.0 新加的。
   </span>
  </p></blockquote>
  <p class="para">
   <div class="example" id="example-2021">
    <p><strong>Example #1 用 <span class="function"><strong>microtime()</strong></span> 对脚本的运行计时</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;Simple&nbsp;function&nbsp;to&nbsp;replicate&nbsp;PHP&nbsp;5&nbsp;behaviour<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$usec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sec</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;((float)</span><span style="color: #0000BB">$usec&nbsp;</span><span style="color: #007700">+&nbsp;(float)</span><span style="color: #0000BB">$sec</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;Sleep&nbsp;for&nbsp;a&nbsp;while<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   参见 <span class="function"><a href="function.time.html" class="function">time()</a></span>。
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125754""></a>
  <div class="note">
   <strong class="user">aldemarcalazans at gmail dot com</strong>
   <a href="#125754" class="date">01-Feb-2021 08:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The description of "msec", in this documentation, is very bad.<br />
<br />
It is NOT the microseconds that have elapsed since "sec" (if so, it should be given as an integer, without the "0." in the beginning of the string).<br />
It IS the fractional part of the time elapsed since "sec", with microseconds (10E-6) precision, if the last "00" are not considered significant".<br />
If the last two digits are significant, then we would have a precision of 10E-8 seconds.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124984""></a>
  <div class="note">
   <strong class="user">shdwlynxjunk at yahoo dot com</strong>
   <a href="#124984" class="date">07-May-2020 07:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is important to note that microtime(TRUE) does NOT always return a float (at least in PHP 5.x; I have not tested 7.x).&nbsp; If it happens to land on an exact second, it returns an integer instead.<br />
<br />
Here is some simple code to illustrate this:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">5000</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; echo </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">100</span><span class="keyword">); </span><span class="comment">// Adjust this if your PC is too fast/slow<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">}<br />
</span><span class="default">?&gt;<br />
</span><br />
When you run this at a command line, you'll see output like this (and you'll know EXACTLY when I ran this):<br />
1588881290.9992<br />
1588881290.9994<br />
1588881290.9996<br />
1588881290.9998<br />
1588881291&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;-- Look, Ma, an integer!<br />
1588881291.0002<br />
1588881291.0004<br />
1588881291.0006<br />
1588881291.0008<br />
<br />
Why does this matter?&nbsp; Because if you want to format microtime into a very friendly but exact date/time, this popular code will fail on exact seconds (but works great otherwise):<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $raw_time </span><span class="keyword">= </span><span class="default">DateTime</span><span class="keyword">::</span><span class="default">createFromFormat</span><span class="keyword">(</span><span class="string">'U.u'</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">)); </span><span class="comment">// This line will not create an object when microtime returns an integer because it depends on the number being a float, including a decimal point!<br />
&nbsp;&nbsp; </span><span class="default">$today </span><span class="keyword">= </span><span class="default">$raw_time</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s.u'</span><span class="keyword">); </span><span class="comment">// This will die when format is attempted on a non-object<br />
</span><span class="default">?&gt;<br />
</span><br />
The fix is to format the microtime output to force it to always be a float:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; $utime </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%.4f'</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">));<br />
&nbsp;&nbsp; </span><span class="default">$raw_time </span><span class="keyword">= </span><span class="default">DateTime</span><span class="keyword">::</span><span class="default">createFromFormat</span><span class="keyword">(</span><span class="string">'U.u'</span><span class="keyword">, </span><span class="default">$utime</span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$today </span><span class="keyword">= </span><span class="default">$raw_time</span><span class="keyword">-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s.u'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Paraphrasing the characters on Silicon Valley, "Always Float! Always Float!&nbsp; Always Float!"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124127""></a>
  <div class="note">
   <strong class="user">Carlos Reche</strong>
   <a href="#124127" class="date">20-Aug-2019 02:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As previously pointed out, setting the parameter $get_as_float as true will not allow microseconds precision (what would mean 6 decimal digits). It happens because the float returned has a big integer section, what crops the decimal one leaving it with less than 6 digits.<br />
<br />
Here is a solution to easily calculate the execution time of a script without having to alter any configuration parameter. It uses the former way of getting microseconds.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Timer </span><span class="keyword">{<br />
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$timeStart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$microsecondsStart</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$timeStop</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$microsecondsStop</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">start</span><span class="keyword">();<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">start</span><span class="keyword">(): </span><span class="default">void </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">microsecondsStart</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timeStart</span><span class="keyword">] = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timeStop&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microsecondsStop </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">stop</span><span class="keyword">(): </span><span class="default">void </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">microsecondsStop</span><span class="keyword">, </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timeStop</span><span class="keyword">] = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">getTime</span><span class="keyword">(): </span><span class="default">float </span><span class="keyword">{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$timeEnd&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timeStop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microsecondsEnd </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">microsecondsStop</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">$timeEnd</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">$microsecondsEnd</span><span class="keyword">, </span><span class="default">$timeEnd</span><span class="keyword">] = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$seconds&nbsp; &nbsp; &nbsp; </span><span class="keyword">= </span><span class="default">$timeEnd </span><span class="keyword">- </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">timeStart</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microseconds </span><span class="keyword">= </span><span class="default">$microsecondsEnd </span><span class="keyword">- </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">microsecondsStart</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// now the integer section ($seconds) should be small enough<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; // to allow a float with 6 decimal digits<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">return </span><span class="default">round</span><span class="keyword">((</span><span class="default">$seconds </span><span class="keyword">+ </span><span class="default">$microseconds</span><span class="keyword">), </span><span class="default">6</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="default">$t </span><span class="keyword">= new </span><span class="default">Timer</span><span class="keyword">();<br />
</span><span class="default">usleep</span><span class="keyword">(</span><span class="default">250</span><span class="keyword">);<br />
echo </span><span class="default">$t</span><span class="keyword">-&gt;</span><span class="default">getTime</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122789""></a>
  <div class="note">
   <strong class="user">joe from wonderland org</strong>
   <a href="#122789" class="date">01-Jun-2018 01:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A convenient way to write the current time / microtime as formatted string in your timezone as expression?<br />
<br />
<span class="default">&lt;?php<br />
$nowDate </span><span class="keyword">= </span><span class="string">'DateTime&nbsp; now is: ' </span><span class="keyword">. (new \</span><span class="default">DateTime</span><span class="keyword">(</span><span class="default">null</span><span class="keyword">,(new \</span><span class="default">DateTimeZone</span><span class="keyword">(</span><span class="string">'Europe/Berlin'</span><span class="keyword">))))-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'Y-m-d H:i:s'</span><span class="keyword">);<br />
<br />
</span><span class="default">$microDate </span><span class="keyword">= </span><span class="string">'Microtime now is: ' </span><span class="keyword">. </span><span class="default">date_create_from_format</span><span class="keyword">( </span><span class="string">'U.u'</span><span class="keyword">, </span><span class="default">number_format</span><span class="keyword">(</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">), </span><span class="default">6</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">))-&gt;</span><span class="default">setTimezone</span><span class="keyword">((new \</span><span class="default">DateTimeZone</span><span class="keyword">(</span><span class="string">'Europe/Berlin'</span><span class="keyword">)))-&gt;</span><span class="default">format</span><span class="keyword">(</span><span class="string">'ymd H:i:s.u e'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
For the microtime expression only the procedural style can be used. If you do not use namespaces the backslashes may be removed.<br />
PHP &gt;= 5.4 needed due to accessing a member of a newly created object in a single expression "(new DateTime())-&gt;format('Y-m-d H:i:s.u')"<br />
<br />
DateTime&nbsp; now is: 2018-06-01 14:54:58 Europe/Berlin<br />
Microtime now is: 180601 14:54:58.781716 Europe/Berlin</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121830""></a>
  <div class="note">
   <strong class="user">johovich at yandex dot ru</strong>
   <a href="#121830" class="date">05-Nov-2017 04:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
//Function to convert microtime return to human readable units<br />
//функция для конвертации времени, принимает значения в секундах<br />
<br />
function convert_time($time)<br />
{<br />
&nbsp;&nbsp;&nbsp; if($time == 0 ){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return 0;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; //допустимые единицы измерения<br />
&nbsp;&nbsp;&nbsp; $unit=array(-4=&gt;'ps', -3=&gt;'ns',-2=&gt;'mcs',-1=&gt;'ms',0=&gt;'s');<br />
&nbsp;&nbsp;&nbsp; //логарифм времени в сек по основанию 1000<br />
&nbsp;&nbsp;&nbsp; //берем значение не больше 0, т.к. секунды у нас последняя изменяемая по тысяче величина, дальше по 60<br />
&nbsp;&nbsp;&nbsp; $i=min(0,floor(log($time,1000)));<br />
<br />
&nbsp;&nbsp;&nbsp; //тут делим наше время на число соответствующее единицам измерения т.е. на миллион для секунд,<br />
&nbsp;&nbsp;&nbsp; //на тысячу для миллисекунд<br />
&nbsp;&nbsp;&nbsp; $t = @round($time/pow(1000,$i) , 1);<br />
&nbsp;&nbsp;&nbsp; return $t.$unit[$i];<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121536""></a>
  <div class="note">
   <strong class="user">how to set nonce value with microtime</strong>
   <a href="#121536" class="date">18-Aug-2017 10:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using microtime() to set 'nonce' value:<br />
<br />
ini_set("precision", 16);<br />
$nonce="nonce=".microtime(true)/0.000001;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113078""></a>
  <div class="note">
   <strong class="user">Daniel Rhodes</strong>
   <a href="#113078" class="date">27-Aug-2013 12:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
But note that the default 'precision' setting of PHP* - which is used when a float is converted to a stringy format by echo()ing, casting or json_encode()ing etc - is not enough to hold the six digit accuracy of microtime(true).<br />
<br />
Out of the box, microtime(true) will echo something like:<br />
<br />
1377611450.1234<br />
<br />
Which is obviously less than microsecond accuracy. You'll probably want to bump the 'precision' setting up to 16 which will echo something like:<br />
<br />
1377611450.123456<br />
<br />
*Internally* it will be accurate to the six digits even with the default 'precision', but a lot of things (ie. NoSQL databases) are moving to all-text representations these days so it becomes a bit more important.<br />
<br />
* 14 at the time of writing</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112725""></a>
  <div class="note">
   <strong class="user">Nads</strong>
   <a href="#112725" class="date">17-Jul-2013 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Get date time with milliseconds<br />
<br />
$micro_date = microtime();<br />
$date_array = explode(" ",$micro_date);<br />
$date = date("Y-m-d H:i:s",$date_array[1]);<br />
echo "Date: $date:" . $date_array[0];<br />
<br />
Test accuracy by running it in a loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112104""></a>
  <div class="note">
   <strong class="user">Russell G.</strong>
   <a href="#112104" class="date">03-May-2013 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the timestamp returned is "with microseconds", not "in microseconds". This is especially good to know if you pass 'true' as the parameter and then calculate the difference between two float values -- the result is already in seconds; it doesn't need to be divided by a million.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111107""></a>
  <div class="note">
   <strong class="user">player27</strong>
   <a href="#111107" class="date">15-Jan-2013 04:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use one variable to check execution $time as follow:
<br />

<br />
<span class="default">&lt;?php
<br />
$time </span><span class="keyword">= -</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4000</span><span class="keyword">); ++</span><span class="default">$i</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash </span><span class="keyword">^= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">str_shuffle</span><span class="keyword">(</span><span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">)));
<br />
}
<br />
</span><span class="default">$time </span><span class="keyword">+= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
echo </span><span class="string">"Hash: </span><span class="default">$hash</span><span class="string"> iterations:</span><span class="default">$i</span><span class="string"> time: "</span><span class="keyword">,</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%f'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">),</span><span class="default">PHP_EOL</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108255""></a>
  <div class="note">
   <strong class="user">thomas</strong>
   <a href="#108255" class="date">12-Apr-2012 02:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been getting negative values substracting a later microtime(true) call from an earlier microtime(true) call on Windows with PHP 5.3.8<br />
<br />
Produces negative values<br />
------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- mostly negatives<br />
}<br />
<br />
Calling usleep(1) seems to work<br />
---------------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; usleep(1);<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- fixed now<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104053""></a>
  <div class="note">
   <strong class="user">langpavel at phpskelet dot org</strong>
   <a href="#104053" class="date">19-May-2011 01:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this for measure duration of script execution. This function should be defined (and of couse first call made) as soon as possible.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* get execution time in seconds at current point of call in seconds<br />
&nbsp;* @return float Execution time at this point of call<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_execution_time</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$microtime_start </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0.0</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$microtime_start</span><span class="keyword">; <br />
}<br />
</span><span class="default">get_execution_time</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
However it is true that result depends of gettimeofday() call. ([jamie at bishopston dot net] wrote this &amp; I can confirm)<br />
If system time change, result of this function can be unpredictable (much greater or less than zero).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101628""></a>
  <div class="note">
   <strong class="user">jamie at bishopston dot net</strong>
   <a href="#101628" class="date">30-Dec-2010 12:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All these timing scripts rely on microtime which relies on gettimebyday(2)<br />
<br />
This can be inaccurate on servers that run ntp to syncronise the servers<br />
time.<br />
<br />
For timing, you should really use clock_gettime(2) with the<br />
CLOCK_MONOTONIC flag set.<br />
<br />
This returns REAL WORLD time, not affected by intentional clock drift.<br />
<br />
This may seem a bit picky, but I recently saw a server that's clock was an<br />
hour out, and they'd set it to 'drift' to the correct time (clock is speeded<br />
up until it reaches the correct time)<br />
<br />
Those sorts of things can make a real impact.<br />
<br />
Any solutions, seeing as php doesn't have a hook into clock_gettime?<br />
<br />
More info here: <a href="http://tinyurl.com/28vxja9" rel="nofollow" target="_blank">http://tinyurl.com/28vxja9</a><br />
<br />
<a href="http://blog.habets.pp.se/2010/09/" rel="nofollow" target="_blank">http://blog.habets.pp.se/2010/09/</a><br />
gettimeofday-should-never-be-used-to-measure-time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101561""></a>
  <div class="note">
   <strong class="user">Robin Leffmann</strong>
   <a href="#101561" class="date">24-Dec-2010 12:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While doing some experiments on using microtime()'s output for an entropy generator I found that its microsecond value was always quantified to the nearest hundreds (i.e. the number ends with 00), which affected the randomness of the entropy generator. This output pattern was consistent on three separate machines, running OpenBSD, Mac OS X and Windows.<br />
&nbsp;<br />
The solution was to instead use gettimeofday()'s output, as its usec value followed no quantifiable pattern on any of the three test platforms.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91566""></a>
  <div class="note">
   <strong class="user">gomodo at free dot fr</strong>
   <a href="#91566" class="date">17-Jun-2009 03:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Need a mini benchmark ?<br />
Use microtime with this (very smart) benchmark function :<br />
<br />
mixed mini_bench_to(array timelist[, return_array=false])<br />
return a mini bench result<br />
<br />
-the timelist first key must be 'start'<br />
-default return a resume string, or array if return_array= true :<br />
'total_time' (ms) in first row<br />
details (purcent) in next row<br />
<br />
example :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">unset(</span><span class="default">$t</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// if previous used<br />
<br />
//-- zone to bench<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">$tab_test</span><span class="keyword">=array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);<br />
</span><span class="default">$fact</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'init_values'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
foreach (</span><span class="default">$tab_test </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fact</span><span class="keyword">=</span><span class="default">$fact</span><span class="keyword">*</span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'loop_fact'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="string">"fact = "</span><span class="keyword">.</span><span class="default">$fact</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="comment">//-- END zone to bench<br />
<br />
</span><span class="keyword">echo </span><span class="string">"---- string result----\n"</span><span class="keyword">;<br />
</span><span class="default">$str_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">);<br />
echo </span><span class="default">$str_result_bench</span><span class="keyword">; </span><span class="comment">// string return<br />
</span><span class="keyword">echo </span><span class="string">"---- tab result----\n"</span><span class="keyword">;<br />
</span><span class="default">$tab_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$tab_result_bench</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>this example return:<br />
<br />
---- string result----<br />
total time : 0.0141 ms<br />
start -&gt; init_values : 51.1 %<br />
init_values -&gt; loop_fact : 48.9 %<br />
---- tab result----<br />
array (<br />
&nbsp; 'total_time' =&gt; 0.0141,<br />
&nbsp; 'start -&gt; init_values' =&gt; 51.1,<br />
&nbsp; 'init_values -&gt; loop_fact' =&gt; 48.9,<br />
)<br />
<br />
The function to include :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">, </span><span class="default">$arg_ra</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tttime</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">((</span><span class="default">end</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">)-</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">])*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="string">'total_time'</span><span class="keyword">]=</span><span class="default">$tttime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$aff</span><span class="keyword">=</span><span class="string">"total time : "</span><span class="keyword">.</span><span class="default">$tttime</span><span class="keyword">.</span><span class="string">"ms\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="string">'start'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$arg_t </span><span class="keyword">as </span><span class="default">$cle</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$cle</span><span class="keyword">!=</span><span class="string">'start'</span><span class="keyword">)&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prcnt_t</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(((</span><span class="default">round</span><span class="keyword">((</span><span class="default">$val</span><span class="keyword">-</span><span class="default">$prv_val</span><span class="keyword">)*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)/</span><span class="default">$tttime</span><span class="keyword">)*</span><span class="default">100</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">]=</span><span class="default">$prcnt_t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aff</span><span class="keyword">.=</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">.</span><span class="default">$prcnt_t</span><span class="keyword">.</span><span class="string">" %\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="default">$cle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) return </span><span class="default">$ar_aff</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aff</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83504""></a>
  <div class="note">
   <strong class="user">luke at lucanos dot com</strong>
   <a href="#83504" class="date">28-May-2008 04:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the list() function, etc. I have found the following code to be a bit cleaner and simpler:<br />
<span class="default">&lt;?php<br />
$theTime </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">' ' </span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">() ) );<br />
echo </span><span class="default">$theTime</span><span class="keyword">;<br />
</span><span class="comment"># Displays "1212018372.3366"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66187""></a>
  <div class="note">
   <strong class="user">EdorFaus</strong>
   <a href="#66187" class="date">16-May-2006 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Of the methods I've seen here, and thought up myself, to convert microtime() output into a numerical value, the microtime_float() one shown in the documentation proper(using explode,list,float,+) is the slowest in terms of runtime.<br />
<br />
I implemented the various methods, ran each in a tight loop 1,000,000 times, and compared runtimes (and output). I did this 10 times to make sure there wasn't a problem of other things putting a load spike on the server. I'll admit I didn't take into account martijn at vanderlee dot com's comments on testing accuracy, but as I figured the looping code etc would be the same, and this was only meant as a relative comparison, it should not be necessary.<br />
<br />
The above method took on average 5.7151877 seconds, while a method using substr and simply adding strings with . took on average 3.0144226 seconds. rsalazar at innox dot com dot mx's method using preg_replace used on average 4.1819633 seconds. This shows that there are indeed differences, but for normal use noone is going to notice it.<br />
<br />
Note that the substr method mentioned isn't quite the one given anonymously below, but one I made based on it:<br />
<span class="default">&lt;?php<br />
$time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">();<br />
</span><span class="default">$timeval</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Also worth noting is that the microtime_float() method gets faster, and no less accurate, if the (float) conversions are taken out and the variables are simply added together.<br />
<br />
Any of the methods that used + or array_sum ended up rounding the result to 2 digits after the decimal point, while (most of) the ones using preg_replace or substr and . kept all the digits.<br />
<br />
For accurate timing, since floating-point arithmetic would lose precision, I stored microtime results as-is and calculated time difference with this function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">microtime_used</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">$after</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; +(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
For further information, the script itself, etc, see <a href="http://edorfaus.xepher.net/div/convert-method-test.php" rel="nofollow" target="_blank">http://edorfaus.xepher.net/div/convert-method-test.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59052""></a>
  <div class="note">
   <strong class="user">radek at pinkbike com</strong>
   <a href="#59052" class="date">24-Nov-2005 08:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A lot of the comments here suggest adding in the following way:&nbsp; (float)$usec + (float)$sec<br />
Make sure you have the float precision high enough as with the default precision of 12, you are only precise to the 0.01 seconds.&nbsp; <br />
Set this in you php.ini file.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; precision&nbsp; &nbsp; =&nbsp; 16</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53969""></a>
  <div class="note">
   <strong class="user">vladson at pc-labs dot info</strong>
   <a href="#53969" class="date">19-Jun-2005 03:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I like to use bcmath for it<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">micro_time</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">bcadd</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">6</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
<br />
</span><span class="default">$time_overall </span><span class="keyword">= </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$time_stop</span><span class="keyword">, </span><span class="default">$time_start</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
echo </span><span class="string">"Execution time - </span><span class="default">$time_overall</span><span class="string"> Seconds"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
