<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>用户级别输出缓冲区</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="outcontrol.flushing-system-buffers.html">? 冲刷系统缓冲区</a></li>
      <li style="float: right;"><a href="outcontrol.what-output-is-buffered.html">缓冲什么输出？ ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.outcontrol.html">输出控制</a></li>
    <li>用户级别输出缓冲区</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="outcontrol.user-level-output-buffers" class="chapter">
 <h1 class="title">用户级别输出缓冲区</h1>
<h2>Table of Contents</h2><ul class="chunklist chunklist_chapter"><li><a href="outcontrol.what-output-is-buffered.html">缓冲什么输出？</a></li><li><a href="outcontrol.nesting-output-buffers.html">嵌套输出缓冲区</a></li><li><a href="outcontrol.buffer-size.html">缓冲区大小</a></li><li><a href="outcontrol.operations-on-buffers.html">缓冲区中允许的操作</a></li><li><a href="outcontrol.output-handlers.html">输出处理程序</a></li><li><a href="outcontrol.working-with-output-handlers.html">使用输出处理程序</a></li><li><a href="outcontrol.flags-passed-to-output-handlers.html">传递给输出处理程序的 flag</a></li><li><a href="outcontrol.output-handler-return-values.html">输出处理程序的返回值</a></li></ul>

 <p class="para">
  用户级输出缓冲区可以从 PHP 代码中实现启动、操作和终止。每个都包含输出缓冲区和关联的输出处理函数。
 </p>

 

 <div class="section">
  <h2 class="title">打开输出缓冲</h2>
  <p class="para">
   可以通过使用 <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span> 函数或设置 <a href="outcontrol.configuration.html#ini.output-buffering" class="link">output_buffering</a> 和
   <a href="outcontrol.configuration.html#ini.output-handler" class="link">output_handler</a> <var class="filename">php.ini</var> 配置来启用输出缓冲。虽然两者都可以创建输出缓冲区，但 <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span>
   更加灵活，因为接受用户定义的函数作为输出处理程序，并且还可以设置对缓冲区允许的操作（冲刷、清空、移除）。通过 <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span>
   开始的缓冲区将从调用该函数的行开始生效，而通过 <a href="outcontrol.configuration.html#ini.output-buffering" class="link">output_buffering</a> 开始的缓冲区将从脚本的第一行开始缓冲输出。
  </p>
  <p class="para">
   PHP 还自带了内置的 <code class="literal">&quot;URL-Rewriter&quot;</code> 输出处理程序，它会启动自己的输出缓冲区，并且任何时候最多只允许有两个实例运行（一个用于用户级别的
   URL 重写，另一个用于透明 Session ID 支持）。这些缓冲区可以通过调用 <span class="function"><a href="function.output-add-rewrite-var.html" class="function">output_add_rewrite_var()</a></span> 函数或启用
   <a href="session.configuration.html#ini.session.use-trans-sid" class="link">session.use_trans_sid</a> php.ini 设置来启动。
  </p>
  <p class="para">
   捆绑的 <code class="literal">zlib</code> 扩展有自己的输出缓冲区，可以使用
   <a href="zlib.configuration.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>
   <var class="filename">php.ini</var> 设置启用。
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    While <code class="literal">&quot;URL-Rewriter&quot;</code> is special
    in that it only allows up to two instances of it running at any one time,
    all user-level output buffers use the same underlying buffers
    used by <span class="function"><a href="function.ob-start.html" class="function">ob_start()</a></span>
    with their functionality implemented by a custom output handler function.
    As such, all of their functionality can be emulated by userland code.
   </span>
  </p></blockquote>
 </div>

 

 

 

 <div class="section">
  <h2 class="title">冲刷、访问和清理缓冲区内容</h2>
  <p class="para">
   Flushing sends and discards the contents of the active buffer.
   Output buffers get flushed when the size of the output
   exceeds the size of the buffer; the script ends or
   <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>, <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>
   or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span> is called.
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    Calling <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>
    or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span> will turn off the active buffer.
   </p>
  </div>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    Flushing buffers will flush the return value of the output handler
    which can differ from the contents of the buffer.
    For example, using <span class="function"><a href="function.ob-gzhandler.html" class="function">ob_gzhandler()</a></span> will compress
    the output and flush the compressed output.
   </p>
  </div>
  <p class="para">
   The contents of the active buffer can be retrieved by calling
   <span class="function"><a href="function.ob-get-contents.html" class="function">ob_get_contents()</a></span>, <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span>
   or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>.
  </p>
  <p class="para">
   If only the length of the buffer&#039;s contents are needed,
   <span class="function"><a href="function.ob-get-length.html" class="function">ob_get_length()</a></span> or <span class="function"><a href="function.ob-get-status.html" class="function">ob_get_status()</a></span>
   will return the length of the contents in bytes.
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    Calling <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span>
    or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span> will turn off the active buffer
    after returning the its contents.
   </p>
  </div>
  <p class="para">
   The contents of the active buffer can be cleaned by calling
   <span class="function"><a href="function.ob-clean.html" class="function">ob_clean()</a></span>, <span class="function"><a href="function.ob-end-clean.html" class="function">ob_end_clean()</a></span>
   or <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span>.
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    Calling <span class="function"><a href="function.ob-end-clean.html" class="function">ob_end_clean()</a></span>
    or <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span> will turn off the active buffer.
   </p>
  </div>
 </div>

 <div class="section">
  <h2 class="title">关闭缓冲区</h2>
  <p class="para">
   Output buffers can be turned off by calling
   <span class="function"><a href="function.ob-end-clean.html" class="function">ob_end_clean()</a></span>, <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>,
   <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span> or <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span>.
  </p>
  <div class="warning"><strong class="warning">Warning</strong>
   <p class="simpara">
    Output buffers started without the
    <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-removable">PHP_OUTPUT_HANDLER_REMOVABLE</a></code></strong> flag
    cannot be turned off and may generate an <strong><code><a href="errorfunc.constants.html#constant.e-notice">E_NOTICE</a></code></strong>.
   </p>
  </div>
  <p class="para">
   Every output buffer that has not been closed by the end of the script
   or when <span class="function"><a href="function.exit.html" class="function">exit()</a></span> is called will be flushed
   and turned off by PHP&#039;s shutdown process.
   The buffers will be flushed and turned off in reverse order
   of their starting up.
   The last buffered started will be first,
   the first buffer started will be last to be flushed and turned off.
  </p>
  <div class="caution"><strong class="caution">Caution</strong>
   <p class="simpara">
    If flushing of the buffer&#039;s contents is not desired,
    a custom output handler should be used to prevent flushing during shutdown.
   </p>
  </div>
 </div>

 

 

 

 

 <div class="section">
  <h2 class="title">输出处理程序中抛出异常</h2>
  <p class="para">
   If an uncaught exception is thrown in an output handler
   the program terminates and the handler is invoked
   by the shutdown process after which
   the <code class="literal">&quot;Uncaught Exception&quot;</code> error message is flushed.
  </p>
  <p class="para">
   If the uncaught exception is thrown in a handler
   invoked by <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>,
   <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span> or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>,
   the contents of the buffer are flushed before the error message.
  </p>
  <p class="para">
   If an uncaught exception is thrown in an output handler during shutdown,
   the handler is terminated and neither the contents of the buffer
   nor the error message is flushed.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    If a handler throws an exception
    its <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-disabled">PHP_OUTPUT_HANDLER_DISABLED</a></code></strong> status flag is set.
   </span>
  </p></blockquote>
 </div>

 <div class="section">
  <h2 class="title">输出处理程序中引发错误</h2>
  <p class="para">
   If a non-fatal error is raised in an output handler
   the program continues execution.
  </p>
  <p class="para">
   If the non-fatal error is raised in a handler invoked by
   <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>, <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>
   or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>,
   the buffer flushes certain data depending on the return value of the handler.
   If the handler returns <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong> the buffer and the error message are flushed.
   If the returns anything else the handler return value is flushed
   but not the error message.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    If a handler returns <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>
    its <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-disabled">PHP_OUTPUT_HANDLER_DISABLED</a></code></strong> status flag is set.
   </span>
  </p></blockquote>
  <p class="para">
   If a fatal error is raised in an output handler
   the program terminates and the handler is invoked
   by the shutdown process after which the error message is flushed.
  </p>
  <p class="para">
   If the fatal error is raised in a handler
   invoked by <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>,
   <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span> or <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>,
   the contents of the buffers are flushed before the error message.
  </p>
  <p class="para">
   If a fatal error is raised in an output handler during shutdown
   the program terminates without flushing the buffer or the error message.
  </p>
 </div>

 <div class="section">
  <h2 class="title">输出处理程序中输出</h2>
  <p class="para">
   In specific circumstances, output produced in the handler is flushed
   along with the contents of the buffer.
   This output is not appended to the buffer and is not part of the string
   returned by <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>.
  </p>
  <p class="para">
   During flush operations (calling <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>,
   <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>, <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>
   and during shutdown)
   if the return value of a handler is <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>
   the contents of the buffer are flushed followed by the output.
   If the handler is not invoked during shutdown
   the handler throwing an exception or <span class="function"><a href="function.exit.html" class="function">exit()</a></span> being called
   results in the same behavior.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    If a handler returns <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>
    its <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-disabled">PHP_OUTPUT_HANDLER_DISABLED</a></code></strong> status flag is set.
   </span>
  </p></blockquote>
 </div>

 <div class="section">
  <h2 class="title">输出处理程序状态 flag</h2>
  <p class="para">
   The
   <a href="outcontrol.constants.html#outcontrol.constants.flags-returned-by-handler" class="link">
    handler status flags
   </a> of the buffer&#039;s <code class="literal">flags</code> bitmask
   are set every time to the output handler is invoked
   and are part of the <code class="literal">flags</code> returned by
   <span class="function"><a href="function.ob-get-status.html" class="function">ob_get_status()</a></span>.
   If the handler successfully executes and does not return <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>,
   <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-started">PHP_OUTPUT_HANDLER_STARTED</a></code></strong> and
   <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-processed">PHP_OUTPUT_HANDLER_PROCESSED</a></code></strong> is set.
   If the handler returns <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong> or throws an exception while executing,
   <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-started">PHP_OUTPUT_HANDLER_STARTED</a></code></strong> and
   <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-disabled">PHP_OUTPUT_HANDLER_DISABLED</a></code></strong> is set.
  </p>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <span class="simpara">
    If the <strong><code><a href="outcontrol.constants.html#constant.php-output-handler-disabled">PHP_OUTPUT_HANDLER_DISABLED</a></code></strong> of a handler is set,
    the handler will not be invoked by calling
    <span class="function"><a href="function.ob-end-clean.html" class="function">ob_end_clean()</a></span>, <span class="function"><a href="function.ob-end-flush.html" class="function">ob_end_flush()</a></span>,
    <span class="function"><a href="function.ob-get-clean.html" class="function">ob_get_clean()</a></span>, <span class="function"><a href="function.ob-get-flush.html" class="function">ob_get_flush()</a></span>
    or during PHP&#039;s shutdown process.
    This flag has no effect on when calling <span class="function"><a href="function.ob-clean.html" class="function">ob_clean()</a></span>
    or <span class="function"><a href="function.ob-flush.html" class="function">ob_flush()</a></span>.
   </span>
  </p></blockquote>
 </div>

</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
 <div class="note">There are no user contributed notes for this page.</div>
</div>
</div></div></body></html>
