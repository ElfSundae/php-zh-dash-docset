<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Mssql 函数</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="mssql.constants.html">? 预定义常量</a></li>
      <li style="float: right;"><a href="function.mssql-bind.html">mssql_bind ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="book.mssql.html">Mssql</a></li>
    <li>Mssql 函数</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="ref.mssql" class="reference">
  <h1 class="title">Mssql 函数</h1>



























































































































































































<h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.mssql-bind.html">mssql_bind</a> &mdash; Adds a parameter to a stored procedure or a remote stored procedure</li><li><a href="function.mssql-close.html">mssql_close</a> &mdash; 关闭MS SQL Server链接</li><li><a href="function.mssql-connect.html">mssql_connect</a> &mdash; 打开MS SQL server链接</li><li><a href="function.mssql-data-seek.html">mssql_data_seek</a> &mdash; Moves internal row pointer</li><li><a href="function.mssql-execute.html">mssql_execute</a> &mdash; Executes a stored procedure on a MS SQL server database</li><li><a href="function.mssql-fetch-array.html">mssql_fetch_array</a> &mdash; Fetch a result row as an associative array, a numeric array, or both</li><li><a href="function.mssql-fetch-assoc.html">mssql_fetch_assoc</a> &mdash; Returns an associative array of the current row in the result</li><li><a href="function.mssql-fetch-batch.html">mssql_fetch_batch</a> &mdash; Returns the next batch of records</li><li><a href="function.mssql-fetch-field.html">mssql_fetch_field</a> &mdash; Get field information</li><li><a href="function.mssql-fetch-object.html">mssql_fetch_object</a> &mdash; Fetch row as object</li><li><a href="function.mssql-fetch-row.html">mssql_fetch_row</a> &mdash; Get row as enumerated array</li><li><a href="function.mssql-field-length.html">mssql_field_length</a> &mdash; Get the length of a field</li><li><a href="function.mssql-field-name.html">mssql_field_name</a> &mdash; Get the name of a field</li><li><a href="function.mssql-field-seek.html">mssql_field_seek</a> &mdash; Seeks to the specified field offset</li><li><a href="function.mssql-field-type.html">mssql_field_type</a> &mdash; Gets the type of a field</li><li><a href="function.mssql-free-result.html">mssql_free_result</a> &mdash; Free result memory</li><li><a href="function.mssql-free-statement.html">mssql_free_statement</a> &mdash; Free statement memory</li><li><a href="function.mssql-get-last-message.html">mssql_get_last_message</a> &mdash; Returns the last message from the server</li><li><a href="function.mssql-guid-string.html">mssql_guid_string</a> &mdash; Converts a 16 byte binary GUID to a string</li><li><a href="function.mssql-init.html">mssql_init</a> &mdash; Initializes a stored procedure or a remote stored procedure</li><li><a href="function.mssql-min-error-severity.html">mssql_min_error_severity</a> &mdash; Sets the minimum error severity</li><li><a href="function.mssql-min-message-severity.html">mssql_min_message_severity</a> &mdash; Sets the minimum message severity</li><li><a href="function.mssql-next-result.html">mssql_next_result</a> &mdash; Move the internal result pointer to the next result</li><li><a href="function.mssql-num-fields.html">mssql_num_fields</a> &mdash; Gets the number of fields in result</li><li><a href="function.mssql-num-rows.html">mssql_num_rows</a> &mdash; Gets the number of rows in result</li><li><a href="function.mssql-pconnect.html">mssql_pconnect</a> &mdash; Open persistent MS SQL connection</li><li><a href="function.mssql-query.html">mssql_query</a> &mdash; Send MS SQL query</li><li><a href="function.mssql-result.html">mssql_result</a> &mdash; Get result data</li><li><a href="function.mssql-rows-affected.html">mssql_rows_affected</a> &mdash; Returns the number of records affected by the query</li><li><a href="function.mssql-select-db.html">mssql_select_db</a> &mdash; Select MS SQL database</li></ul>
</div>
<div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="113666""></a>
  <div class="note">
   <strong class="user">amolkulkarni82 at gmail dot com</strong>
   <a href="#113666" class="date">13-Nov-2013 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is the changes required to connect MSSQL database using&nbsp; mssql_connect with long password (more than 30 chars)<br />
<br />
Steps to follow: <br />
<br />
1) cd /usr/local/src/freetds-0.91/<br />
<br />
2) Change the values as required in freetds src:<br />
<br />
# Default values:<br />
# Filename:&nbsp; include/sybdb.h (line 67)<br />
#define DBMAXNAME&nbsp; 30<br />
<br />
# Filename:&nbsp; include/tds.h (line 760)<br />
#define TDS_MAX_DYNID_LEN&nbsp; &nbsp; 30<br />
<br />
# Filename:&nbsp; include/tds.h (line 831)<br />
#define TDS_MAX_LOGIN_STR_SZ 30<br />
<br />
3) Modify the TDS_MAX_LOGIN_STR_SZ macro to overcome the password limitation of 30 chars<br />
<br />
4) Recompile the freetds<br />
<br />
make clean &amp;&amp; ./configure --prefix=/usr/local/freetds --with-tdsver=8.0 --enable-msdblib --enable-dbmfix --with-gnu-ld &amp;&amp; make &amp;&amp; make install<br />
<br />
5) Restart the apache<br />
/usr/local/apache2/bin/apachectl stop &amp;&amp; /usr/local/apache2/bin/apachectl start<br />
<br />
6) Export the FREETDS<br />
export FREETDSCONF=/etc/freetds.conf<br />
<br />
Test the MSSQLdatabase connection using CLI<br />
<br />
&gt; php -a<br />
Interactive mode enabled<br />
<br />
<span class="default">&lt;?php<br />
<br />
$conn </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="string">'hostname'</span><span class="keyword">,</span><span class="string">'username'</span><span class="keyword">,</span><span class="string">'password'</span><span class="keyword">);<br />
<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$conn</span><span class="keyword">);<br />
<br />
if (!</span><span class="default">$conn</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">$strerr </span><span class="keyword">= </span><span class="string">"ERROR: Failed to connect to MSSQL Server ('hostname') : "</span><span class="keyword">.</span><span class="default">mssql_get_last_message</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
CTR+D<br />
<br />
expected output:<br />
<br />
resource(1) of type (mssql link)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96947""></a>
  <div class="note">
   <strong class="user">stephan at towli dot ch</strong>
   <a href="#96947" class="date">24-Mar-2010 07:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I worked on a project with a MS SQL server 2008 containing data of NVARCHAR type in multiple languages, 
<br />
including asian characters. It is a known issue, that the PHP MSSQL functions are not able to retrieve
<br />
unicode data form NVARCHAR or NTEXT data fields.
<br />

<br />
I spent some time searching for possible solutions and finaly found a work arround, that provides correct 
<br />
display of latin and asian fonts from a NVARCHAR field.
<br />

<br />
Do a SQL query, while you convert the NVARCHAR data first to VARBINARY and then to VARCHAR
<br />

<br />
SELECT 
<br />
CONVERT(VARCHAR(MAX),CONVERT(VARBINARY(MAX),nvarchar_col)) AS x 
<br />
FROM dbo.table
<br />

<br />
While you fetch the result set in PHP, use the iconv() function to convert the data to unicode
<br />

<br />
<span class="default">&lt;?php $x </span><span class="keyword">= </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">"UCS-2LE"</span><span class="keyword">,</span><span class="string">"UTF-8"</span><span class="keyword">,</span><span class="default">$row</span><span class="keyword">[</span><span class="string">'x'</span><span class="keyword">]); </span><span class="default">?&gt;
<br />
</span>
<br />
Now you can ouput the text to UTF-8 encoded page with the correct characters.
<br />

<br />
This workarround did run on IIS 6.0 with PHP 5.2.6 running as FastCGI.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="87674""></a>
  <div class="note">
   <strong class="user">David Alan</strong>
   <a href="#87674" class="date">16-Dec-2008 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get an error like:<br />
<br />
PHP Warning:&nbsp; mssql_query(): message: Unicode data in a Unicode-only collation or ntext data cannot be sent to clients using DB-Library (such as ISQL) or ODBC version 3.7 or earlier. (severity 16) in /var/www/html/query.php on line 29<br />
<br />
There are two solutions: one solution involves casting the data types in the query, the other solution involves changing the version number free tds is using.<br />
<br />
The first solution is mentioned all over the web and limits what you can return, the second solution will probably only be found right here.&nbsp; <br />
<br />
Open up your free tds configuration file (/etc/freetds.conf), and change:<br />
<br />
[global]<br />
tds version = 4.2<br />
<br />
to this:<br />
<br />
[global]<br />
tds version = 8.0<br />
<br />
You don't have to upgrade any packages, but by default, freetds tries to use an older version (if you installed freetds using yum or apt-get).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85912""></a>
  <div class="note">
   <strong class="user">robert dot johnson at icap dot com</strong>
   <a href="#85912" class="date">24-Sep-2008 04:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a PHP driver for SQL Server 2005+ from Microsoft.&nbsp; You can even download the source code.<br />
<br />
Search for "SQL Server 2005 Driver for PHP" on MSDN, or try one of these links:<br />
<br />
<a href="http://msdn.microsoft.com/en-us/library/cc793139(SQL.90" rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/cc793139(SQL.90</a>).aspx<br />
<br />
<a href="http://msdn.microsoft.com/en-us/library/cc296221.aspx" rel="nofollow" target="_blank">http://msdn.microsoft.com/en-us/library/cc296221.aspx</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82005""></a>
  <div class="note">
   <strong class="user">Keith Radue, South Africa</strong>
   <a href="#82005" class="date">23-Mar-2008 10:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My Workstation/server:<br />
<br />
Windows 2000 Advanced Server<br />
iis<br />
PHP 5.2.5<br />
SQL server Express<br />
<br />
Could not connect using the following connect string:<br />
<br />
$sqlconn = mssql_connect "localhost,1433", "user", "password")<br />
<br />
After 2 days of frustration and reinstalling PHP + SQLEXPRESS and trying EVERYTHING I could find via Google, I found a setting in PHP.INI that I never noticed.<br />
<br />
ENABLE _dl = ON&nbsp; ---------- I changed this to OFF <br />
<br />
Problem went away and all is working as it used to on PHP4<br />
<br />
Hope this helps others with the same problem</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81594""></a>
  <div class="note">
   <strong class="user">Sander Wartenberg</strong>
   <a href="#81594" class="date">05-Mar-2008 04:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Running on the following settings I couldn't connect to my local SQL server.<br />
<br />
- Apache 2.2.6<br />
- PHP 5.2.5<br />
- SQL Server 2005<br />
- Windows XP SP2<br />
<br />
The problem lies within the wrong dynamic library that is included in Apache and PHP. To fix this problem follow this steps:<br />
<br />
1. Download the good version of ntwdblib.dll (2000.80.194.0)&nbsp; <a href="http://webzila.com/dll/1/ntwdblib.zip" rel="nofollow" target="_blank">http://webzila.com/dll/1/ntwdblib.zip</a><br />
2. Overwrite C:\wamp\bin\apache\apache2.2.6\bin\ntwdblib.dll<br />
3. Overwrite C:\wamp\bin\php\php5.2.5\ntwdblib.dll<br />
<br />
4. Start the SQL Server Configuration Manager -&gt; Protocols<br />
5. Enable "named pipes" and "tcp/ip"<br />
6. Right-click "tcp/ip" -&gt; Properties tab "IP addresses"<br />
7. Fill in "TCP Dynamic Ports" with 1433<br />
<br />
8. Restart SQL Server AND Apache, PHP and all the other services<br />
<br />
Try the following mssql_connect:<br />
<br />
mssql_connect('localhost,1433', USERNAME, PASSWORD);<br />
<br />
Good luck!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81150""></a>
  <div class="note">
   <strong class="user">jigarbe at yahoo dot com</strong>
   <a href="#81150" class="date">15-Feb-2008 08:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was able to install and configure Freetds on CENTOS 4 following the guide lines mentioned in beliw mentioned URL<br />
<br />
I advice everybody to follow the same<br />
<br />
<a href="http://members.cox.net/midian/howto/phpMSSQL.htm" rel="nofollow" target="_blank">http://members.cox.net/midian/howto/phpMSSQL.htm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81149""></a>
  <div class="note">
   <strong class="user">jigarbe at yahoo dot com</strong>
   <a href="#81149" class="date">15-Feb-2008 08:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
PHP and SQL Server <br />
<br />
Install And Configure FreeTDS<br />
The first thing you need to do is to download and install the FreeTDS driver. You can get the source and compile it yourself from <a href="http://www.freetds.org/, but I prefer RPMs. Depending on your distrobution of Linux, the version you want will vary. I" rel="nofollow" target="_blank">http://www.freetds.org/, but I prefer RPMs. Depending on your distrobution of Linux, the version you want will vary. I</a>'m running Red Hat Enterprise Linux 4 ES and CentOS 4, which are both almost identical. I installed freetds-0.62.3-1 from <a href="http://rpmforge.net/user/packages/freetds/" rel="nofollow" target="_blank">http://rpmforge.net/user/packages/freetds/</a><br />
After installing FreeTDS, you can check your driver by attempting to connect to the MSSQL Server. Of course, use the appropriate server name, username and password in your command line.<br />
# /usr/bin/tsql -S [mssql.servername.or.ip] -U [ValidUser]<br />
locale is "en-US.UTF-8"<br />
locale charset is "UTF-8"<br />
Password: [password]<br />
1&gt;<br />
Enter "quit" to exit your successful connection. If the tsql command doesn't return the 1&gt; prompt, verify that you can get to your MSSQL server with telnet [mssql.servername.or.ip] 1433 and that your username and password are valid.<br />
Next, edit your /etc/freetds.conf configuration file and add the following at the end of the file:<br />
[TDS]<br />
&nbsp;&nbsp;&nbsp; host = [mssql.servername.or.ip]<br />
&nbsp;&nbsp;&nbsp; port = 1433<br />
&nbsp;&nbsp;&nbsp; tds version = 7.0<br />
&nbsp; Setup ODBC Data Source<br />
Next, unixODBC needs to know about all ODBC drivers you intend to use. While you can use the GUI program that comes with unixODBC, you can also use the odbcinst command. First create a template file containing your FreeTDS setup information.<br />
tdsdriver.template<br />
[FreeTDS]<br />
Description = v.062 with protocol v7.0<br />
Driver = /usr/lib/libtdsodbc.so.0<br />
Run odbcinst, telling it to install a driver entry using the template we just created.<br />
# odbcinst -i -d -f tdsdriver.template<br />
odbcinst: Driver installed. Usage count increased to 1.<br />
&nbsp;&nbsp;&nbsp; Target directory is /etc<br />
This will add an entry to the end of the file /etc/odbcinst.ini<br />
[FreeTDS]<br />
Description&nbsp; &nbsp; &nbsp; &nbsp; = v0.62 with protocol v7.0<br />
Driver&nbsp; &nbsp; &nbsp;&nbsp; = /usr/lib/libtdsodbc.so.0<br />
UsageCount&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = 1</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80559""></a>
  <div class="note">
   <strong class="user">Erwin Moller</strong>
   <a href="#80559" class="date">22-Jan-2008 06:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Microsoft SQL Server 2005 and Vista.<br />
<br />
The following steps enabled MSSQL 2005 support on Vista Home Permium. (native drivers, not odbc which works out-of-the-box)<br />
<br />
1) Place ntwdblib.dll in C:\Windows\System32<br />
2) Place php_mssql.dll in C:\Windows\System32<br />
(I gave IUSR full access to these files, maybe read is enough)<br />
<br />
3) uncomment php_mssql.dll in php.ini<br />
<br />
4) Changed my default SQLSERVER 2005 install so it accepts named piped. (Do this via start-&gt; SQLServer2005-&gt;configuration tools-&gt;SQL SERVER surface area configuration.<br />
<br />
5) reboot.<br />
<br />
After that I could use the mssql_* functions.<br />
<br />
Hope that helps.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="80534""></a>
  <div class="note">
   <strong class="user">darkelder at php dot net</strong>
   <a href="#80534" class="date">21-Jan-2008 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Microsoft do offer a SQL Server 2005 driver for PHP at <a href="http://www.microsoft.com/sql/technologies/php/default.mspx" rel="nofollow" target="_blank">http://www.microsoft.com/sql/technologies/php/default.mspx</a><br />
<br />
It can be download free of charge. Binaries are provided for Windows platform only.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="79293""></a>
  <div class="note">
   <strong class="user">ahribernik _at_ blitztelecom com au</strong>
   <a href="#79293" class="date">19-Nov-2007 04:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FYI if you are on Linux and using FreeTDS for your drivers (you most likely are), you can get past the 255 character limit by:<br />
<br />
1. open the file freetds.conf (normally in the directory /etc)<br />
2. under [global] section change the "tds version" to "7.0" or "8.0" (depending on your version of SQL Server)<br />
3. changes should be instant!<br />
<br />
use 7.0 for Microsoft SQL Server 7.0<br />
use 8.0 for Microsoft SQL Server 2000 and above<br />
<br />
see <a href="http://www.freetds.org/userguide/choosingtdsprotocol.htm" rel="nofollow" target="_blank">http://www.freetds.org/userguide/choosingtdsprotocol.htm</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78769""></a>
  <div class="note">
   <strong class="user">nospam at gmail dot com</strong>
   <a href="#78769" class="date">26-Oct-2007 11:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are using mssql_bind with stored procedures on Windows and need to get around the 255 character varchar limit, one hack is to pass SQLTEXT as the data type to mssql_bind rather than SQLVARCHAR.&nbsp; <br />
<br />
You will still need to use some means to get around returning&nbsp; varchar data that's longer than 255, the simplest of which is to CAST the varchar field as text in your stored procedure itself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77737""></a>
  <div class="note">
   <strong class="user">hadrien(dot)debris {at} gmail(dot)com</strong>
   <a href="#77737" class="date">11-Sep-2007 06:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have lost one day to understand why the MSSQL&lt;-&gt;PHP connection was no longer functioning after a PHP update (5.2.2-&gt;5.2.4).<br />
<br />
I eventually found how to solve things:<br />
BEFORE<br />
[code]$link = mssql_connect("SERVER\INST", "LOGIN", "password");[/code]<br />
<br />
Which does not work any longer.<br />
<br />
AFTER<br />
[code]$link = mssql_connect("SERVER\\INST", "LOGIN", "password");[/code]<br />
<br />
Works flawlessly.<br />
<br />
Hope that'll prevent someone to lose precious hours of exasperation.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77735""></a>
  <div class="note">
   <strong class="user">michael at nospam dot onlinecity dot dk</strong>
   <a href="#77735" class="date">11-Sep-2007 02:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are experiencing that ANSI characters are being corrupted, e.g. nordic letters are showing up as invalid characters and you have SQL Server 2000 installed on the same machine as the webserver, try checking SQL Server Client Network Utility under the DB-Library Options tab.<br />
Make sure that "Automatic ANSI to OEM conversion" is NOT checked, this caused me several hours of headache.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77619""></a>
  <div class="note">
   <strong class="user">mprentice at eeicom dot com</strong>
   <a href="#77619" class="date">05-Sep-2007 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It appears ntwdblib.dll is no longer a part of SQL 2005.&nbsp; According to Microsoft the component is deprecated and they recommend using OLE DB or ODBC.&nbsp; The dll from SQL Server version 6.5, SQL Server 7.0, or SQL Server 2000 still works against 2005 if you have it.<br />
<br />
From Microsoft's site:<br />
<br />
&nbsp;Although the SQL Server 2005 Database Engine still supports connections from existing applications using the DB-Library and Embedded SQL APIs, it does not include the files or documentation needed to do programming work on applications that use these APIs. A future version of the SQL Server Database Engine will drop support for connections from DB-Library or Embedded SQL applications. Do not use DB-Library or Embedded SQL to develop new applications. Remove any dependencies on either DB-Library or Embedded SQL when modifying existing applications. Instead of these APIs, use the SQLClient namespace or an API such as OLE DB or ODBC. SQL Server 2005 does not include the DB-Library DLL required to run these applications. To run DB-Library or Embedded SQL applications you must have available the DB-Library DLL from SQL Server version 6.5, SQL Server 7.0, or SQL Server 2000.<br />
&nbsp;<br />
<a href="http://msdn2.microsoft.com/en-us/library/ms143729.aspx" rel="nofollow" target="_blank">http://msdn2.microsoft.com/en-us/library/ms143729.aspx</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="77436""></a>
  <div class="note">
   <strong class="user">chop_01 at yahoo dot com</strong>
   <a href="#77436" class="date">29-Aug-2007 01:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I tried all manner of things in order to cnnect to SQLExpress aka SQL Server 2005 and was just about to walk away and move across to MySQL when it just dawned on me that after following all of the instructions from numerous people I never restarted the Apache service.<br />
<br />
This meant that the new ntwdblib.dll was never called. I restarted the service and hey presto ... I can now connect to the SQL server.<br />
<br />
The items that I did were as follows:<br />
<br />
1. Installed the SQLServer in mixed auth mode<br />
2. Checked that the mssql.secure_connection = Off was present in the php.ini<br />
3. Copied the ntwdblib.dll file into<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; o WINDOWS\SYSTEM32<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; o program files\apache2\bin<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; o php<br />
4. Started the SQL Server Browser Service<br />
5. Enabled all of the IPs in Protocols &gt; TCP/IP<br />
6. Restarted the following services:<br />
&nbsp;&nbsp; &nbsp; &nbsp; o Apache<br />
&nbsp;&nbsp; &nbsp; &nbsp; o SQL Service<br />
&nbsp;&nbsp; &nbsp; &nbsp; o SQL Browser Service<br />
<br />
This allowed me to connect with no problems using the following parameters within my mssql_connect call<br />
<br />
HOST=.\SQLEXPRESS<br />
USERNAME=sa<br />
PASSWORD=&lt;MYPASS&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76503""></a>
  <div class="note">
   <strong class="user">swaldester at gmail dot com</strong>
   <a href="#76503" class="date">18-Jul-2007 08:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For all of you connecting to MS SQL Server using freeTDS, having trouble to log on with a domain login:<br />
<br />
Add the line:<br />
putenv('TDSVER=70');<br />
<br />
just before calling mssql_connect()<br />
<br />
This worked for me with a MS SQL Server 2K Ent.<br />
<br />
Thank you elmer !</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76004""></a>
  <div class="note">
   <strong class="user">nmax at libero dot it</strong>
   <a href="#76004" class="date">26-Jun-2007 05:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About the ntwdblib.dll, I can say that on Windows 2003 Server with Apache 2.2 and PHP 5.2.3 I have repalced the one present in PHP folder with the version 8.00.194 of the same.<br />
<br />
Putting the dll only in PHP folder and configuring in php.ini the variable mssql.secure_connection = Off mssql_connect() works!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="75929""></a>
  <div class="note">
   <strong class="user">James at thetallfamily dot com</strong>
   <a href="#75929" class="date">21-Jun-2007 12:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MSSQL doesn't have a real_escape_string function like MYSQL does, which can lead to error when inserting or updating data that contains a ' (single quote). <br />
<br />
To prevent this, replace all ' (single quotes) by TWO ' (single quotes) '' which SQL server will interpret as an escaped '.<br />
Also you may want to remove any \' \" escape sequences that are translated from any FORM output into the PHP $_POST variables.<br />
<br />
Hope this helps someone.<br />
James</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74990""></a>
  <div class="note">
   <strong class="user">Roy Maarssen</strong>
   <a href="#74990" class="date">07-May-2007 01:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
My problem was that I've loaded the ntwdblib.dll (8.00.194) into the php directory, but it also have to be placed in the bin directory of Apache.<br />
<br />
I hope this will save you some time searching for the solution, if you encounter the same problem.<br />
<br />
I'm using SQL 2005 Express Edition on Windows Vista Enterprise with Apache.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74834""></a>
  <div class="note">
   <strong class="user">lostaircryptic at hotmail dot co dot uk</strong>
   <a href="#74834" class="date">30-Apr-2007 03:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
MAXIMUM COLUMN LENGTH OF 30 CHARACTERS....<br />
<br />
This restriction was solved by using the following techniques.<br />
<br />
First create a test which detects this to be the problem and then self correct it.<br />
<br />
For the times that this is a problem rename the columns to an unique column name which is 30 characters exactly in length.&nbsp; This column must be unique compares to the others, so use the MD5 Hashed value.&nbsp; Since MD5 hashed values are 32 character HEX values, convert this to a toggle Hex value giving an exact maximum length of 31 characters.&nbsp; Prepend a character to the start to ensure that it falls within Column naming regulations.<br />
<br />
When the data is obtained, check for the hashed values against a check array and replace where neccessary.<br />
<br />
Although complex it may sound, the method has been tried and successfully works, thus allowing columns of greater length than that of 30 characters.<br />
<br />
I had this situation within Linux as well as Windows (XAMPP), so this solution was ultimate in solving the problem.<br />
<br />
You can run the detection as a constant or automatically.&nbsp; However it is best to use a constant for efficiency reasons.<br />
<br />
Any questions, just email me.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74417""></a>
  <div class="note">
   <strong class="user">Jason {at} RoundtopRiders {dot} com</strong>
   <a href="#74417" class="date">10-Apr-2007 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I struggled with this for a few days and finally got it figured out. I'm running Windows 2003 Server, PHP 5.2, Apache 2.2 and MSSQL Server 2005.<br />
<br />
(1) Set 'msssql.secure_connection = On' in the PHP.ini file<br />
(2) Download the correct ntwdblib.dll file (version 8.00.194)<br />
<br />
Copy this to:<br />
<br />
C:/Windows/System32<br />
&lt;server root&gt;/php<br />
&lt;server root&gt;/apache/bin<br />
<br />
(I would just do a search for this file and replace it anywhere you find it...)<br />
<br />
(3) Make sure TCP/IP and Named Pipes are enabled in the SQL Configuration tool.<br />
<br />
Hope this saves somebody a few hours.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74405""></a>
  <div class="note">
   <strong class="user">deyura at gmail dot com</strong>
   <a href="#74405" class="date">10-Apr-2007 03:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FreeTDS is work!!!<br />
<br />
But after install you shoul add in config file<br />
1. Add in freetds.conf client cahrset:<br />
[TDS_NAME_TO_CONNECT]<br />
host = 192.168.0.1<br />
port = 1433<br />
tds version = 8.0<br />
client charset = CP1251<br />
<br />
2. For datetime add in locales.conf in [default]:<br />
date format = %Y-%m-%d %I:%M:%S.%z<br />
<br />
3. restart apache<br />
<br />
4. In your php-script you should connect to [TDS_NAME_TO_CONNECT]<br />
mssql_connect('TDS_NAME_TO_CONNECT', 'php', '123');</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74346""></a>
  <div class="note">
   <strong class="user">vbchris at gmail dot com</strong>
   <a href="#74346" class="date">06-Apr-2007 08:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If your having problems with&nbsp; your script at random times refusing to connect to the database. Try editing php.ini and uncommenting this line.
<br />

<br />
mssql.max_procs = -1
<br />

<br />
This solved the problem for me after 3 days of pulling my hair out wondering why it kept refusing to connect!
<br />

<br />
==
<br />

<br />
[Because this may not always work,] I created a loop to create a few connections and noticed it was always the first connection that failed. So I wrote this to keep trying to connect until it eventually does.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">while(!</span><span class="default">$connection</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">$connection </span><span class="keyword">= </span><span class="default">mssql_connect</span><span class="keyword">(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'server'</span><span class="keyword">],</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">],</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">]);
<br />
}
<br />
</span><span class="default">$db </span><span class="keyword">= </span><span class="default">mssql_select_db</span><span class="keyword">(</span><span class="default">$cfg</span><span class="keyword">[</span><span class="string">'database'</span><span class="keyword">],</span><span class="default">$connection</span><span class="keyword">) or die(</span><span class="string">"Error selecting the database"</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72711""></a>
  <div class="note">
   <strong class="user">ziggurism at gmail dot com</strong>
   <a href="#72711" class="date">30-Jan-2007 10:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On *nix, of course you need to add extension=mssql.so to your php.ini.&nbsp; Obvious, but it took me a while to figure that out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="72446""></a>
  <div class="note">
   <strong class="user">tom at mazzotta dot com</strong>
   <a href="#72446" class="date">18-Jan-2007 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
FINNALLY got PHP to connect to MS SQL Server. Even though I read through the multitue of comments about ntwdblib.dll, etc., I still couldn't get it to work. The key was to load the Microsoft MDAC (2.8) on my IIS/PHP server. If your environement does not use the web server to host SQL as well, you will probably need to install the MDAC. My guess is that an installation of SQL Server (and/or just the client tools) on the webserver will automatically include the MDAC and you would not experience this problem.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71876""></a>
  <div class="note">
   <strong class="user">be_misc_01 at flowbuzz dot com</strong>
   <a href="#71876" class="date">20-Dec-2006 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Couple of notes:
<br />
When setting this up, you might notice that the unixODBC isql command likes the password wrapped in single quotes:
<br />
isql -v MyDSN MyUserID 'MyPa$$W0rd'
<br />

<br />
Additionally, if you happen to have a dollar-sign in your password (or username, or DSN) -- you must avoid using double quotes.&nbsp; This is a normal PHP gotcha, but worth mentioning.
<br />
Won't work: 
<br />
<span class="default">&lt;?php $con </span><span class="keyword">= </span><span class="default">mssql_connect </span><span class="keyword">(</span><span class="string">"MyDSN"</span><span class="keyword">, </span><span class="string">"MyUserID"</span><span class="keyword">, </span><span class="string">"MyPa$</span><span class="default">$W0rd</span><span class="string">"</span><span class="keyword">); </span><span class="default">?&gt;
<br />
</span>
<br />
Will work (single quotes):
<br />
<span class="default">&lt;?php $con </span><span class="keyword">= </span><span class="default">mssql_connect </span><span class="keyword">(</span><span class="string">"MyDSN"</span><span class="keyword">, </span><span class="string">"MyUserID"</span><span class="keyword">, </span><span class="string">'MyPa$$W0rd'</span><span class="keyword">); </span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71602""></a>
  <div class="note">
   <strong class="user">davinel_lu_linvega at hotmail dot com</strong>
   <a href="#71602" class="date">07-Dec-2006 03:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
About using the MSSQL XML field-type, for Win32 users,&nbsp; :<br />
<br />
1. The most simple way would be to<br />
<br />
"SELECT [xmlfield] FROM [table]"<br />
<br />
But this triggers the following error :<br />
<br />
"Unicode data in a Unicode-only collation or ntext data cannot be sent to clients using DB-Library (such as ISQL) or ODBC version 3.7 or earlier. (severity 16)"<br />
<br />
2. Well, let's just read [xmlfield] as a VARCHAR.<br />
<br />
"SELECT CAST([xmlfield] AS VARCHAR(8000)) FROM [table]"<br />
<br />
will truncate to the 255 first characters, due to the API limitation. (see the marc at NOSPAM dot durdin dot net note)<br />
<br />
3. So woud not that be appropriate to use the TEXT field-type ?<br />
<br />
"SELECT CAST([xmlfield] AS TEXT) FROM [table]"<br />
<br />
triggers :<br />
<br />
"Explicit conversion from data type xml to text is not allowed. (severity 16)"<br />
<br />
4. So you cannot read the VARCHAR nor the XML, and you cannot transform the XML into TEXT. In order to finally read that XML field-type, you may use this trick :<br />
<br />
"SELECT CAST(CAST([xmlfield] AS VARCHAR(8000)) AS TEXT) FROM [table]"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71312""></a>
  <div class="note">
   <strong class="user">KamiKazie at comcast dot net</strong>
   <a href="#71312" class="date">21-Nov-2006 07:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found that a Windows Webserver cannot connect to a Microsoft SQL Database if the webserver is running Microsoft SQL Server Agent.&nbsp; It gives connection and undefined function errors.&nbsp; Hope this helps some people.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71186""></a>
  <div class="note">
   <strong class="user">JinXy at skylinetop dot com</strong>
   <a href="#71186" class="date">15-Nov-2006 08:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had major problems trying to get the msssql extension loaded.&nbsp; The following fixed it for me:&nbsp; <br />
<br />
1. Make sure the ntwdblib.dll file located in system32/ on the Database server is copied to system32 on the PHP serving server.<br />
2. Uncomment the extension in the php.ini file.<br />
3. Add the following to the registry: [HKEY_LOCAL_MACHINE\SOFTWARE\PHP]<br />
"IniFilePath"="C:\\PHP"<br />
This tells PHP where to find the php.ini<br />
(This is what my resolution to my problem was - only after some time did I find some reference to it).<br />
4. Restart IIS</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70907""></a>
  <div class="note">
   <strong class="user">anders jenbo(located)pc denmark</strong>
   <a href="#70907" class="date">03-Nov-2006 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 3 major headaicks I had while setting up MS SQL 2005, php 5.1.6 (apache 2.2 server) on Vista RC1 and getting them to comunicate.<br />
<br />
TCP/IP and "Named Pipes Protocol" had to be enabled in the MS SQL Server. You do this in the Surface Area Configuration tool.<br />
<br />
MS SQL 2005 should be set to mix mode login. Unless you use NT authentication in php.ini.<br />
You can do this in duing install if you select advanced options.<br />
If it's already installed you will have to use the SQL management Studio (properties-&gt;securety).<br />
<br />
At first the php_mssql.dll didn't load properly (wan't showing up under phpinfo()) and gave no error message at startup, the cause of this was the ntwdblib.dll that came with php (273KB) replacing it with the one that came with MS SQL 2005 (269KB) fixed the issuse, incase you haven't installed MS SQL on your machine you can also find it on the net.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66438""></a>
  <div class="note">
   <strong class="user">Bart</strong>
   <a href="#66438" class="date">22-May-2006 09:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another helpful hint in regards to SQL Server 2005 Express:<br />
<br />
Make sure your SQL Server is set to&nbsp; "SQL Server and Windows Authentication mode". By default it is NOT.<br />
<br />
1) Open "SQL Server Management Studio Express"<br />
2) Right-click server ("machinename\sqlexpress") and select "Properties".<br />
3) Select "Security"<br />
4) Select "SQL Server and Windows Authentication mode"<br />
5) Restart SQL Server.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42694""></a>
  <div class="note">
   <strong class="user">Arthur W Rudd</strong>
   <a href="#42694" class="date">26-May-2004 11:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm running apache 1.3.26 and php 4.3.6 on a linux server (debian), and connecting to SQL Server 2000 via php4-mssql and Freetds.<br />
<br />
I managed to get a connection to the SQL server, but found that when I used the function mssql_query() to pass in a Select statement containing datetime columns, I would get the following message in Internet Explorer - "The page cannot be displayed".&nbsp; When I removed the datetime column from the query, it worked fine, and returned a resultset.<br />
Looked in the apache error.log file, and found the error "child pid xxxxxx exit signal segmentation fault".<br />
<br />
After a lot of searching on the internet I stumbled upon an entry which was missing from my php.ini.&nbsp; I added the line "mssql.datetimeconvert = Off" to the MSSQL section of pphp.ini, restarted Apache, and the problem went away.&nbsp; Now I can select dates in SQL queries</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
