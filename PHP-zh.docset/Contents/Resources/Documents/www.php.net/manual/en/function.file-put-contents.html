<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将数据写入文件</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.file-get-contents.html">? file_get_contents</a></li>
      <li style="float: right;"><a href="function.fileatime.html">fileatime ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.filesystem.html">文件系统函数</a></li>
    <li>将数据写入文件</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.file-put-contents" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">file_put_contents</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">file_put_contents</span> &mdash; <span class="dc-title">将数据写入文件</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.file-put-contents-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>file_put_contents</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$filename</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.mixed.html" class="type mixed">mixed</a></span> <code class="parameter">$data</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type"><a href="language.types.null.html" class="type null">?</a></span><span class="type"><a href="language.types.resource.html" class="type resource">resource</a></span></span> <code class="parameter">$context</code><span class="initializer"> = <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong></span></span><br>): <span class="type"><span class="type"><a href="language.types.integer.html" class="type int">int</a></span>|<span class="type"><a href="language.types.value.html" class="type false">false</a></span></span></div>

  <p class="para rdfs-comment"> 
   和依次调用 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>，<span class="function"><a href="function.fwrite.html" class="function">fwrite()</a></span>
   以及 <span class="function"><a href="function.fclose.html" class="function">fclose()</a></span> 功能一样。
  </p>
  <p class="para">
   如果 <code class="parameter">filename</code>
   不存在，将会创建文件。反之，存在的文件将会重写，除非设置
   <strong><code><a href="filesystem.constants.html#constant.file-append">FILE_APPEND</a></code></strong> flag。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.file-put-contents-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt><code class="parameter">filename</code></dt>
     <dd>
      <p class="para">
       要被写入数据的文件名。
      </p>
     </dd>
    
    
     <dt><code class="parameter">data</code></dt>
     <dd>
      <p class="para">
       要写入的数据。类型可以是 <span class="type"><a href="language.types.string.html" class="type string">string</a></span>，<span class="type"><a href="language.types.array.html" class="type array">array</a></span>
       或者是 <span class="type">stream</span> 资源（如上面所说的那样）。
      </p>
      <p class="para">
       如果 <code class="parameter">data</code>
       指定为 stream 资源，这里 stream
       中所保存的缓存数据将被写入到指定文件中，这种用法就相似于使用
       <span class="function"><a href="function.stream-copy-to-stream.html" class="function">stream_copy_to_stream()</a></span> 函数。
      </p>
      <p class="para">
       参数 <code class="parameter">data</code> 可以是数组（但不能为多维数组），这就相当于
       <code class="literal">file_put_contents($filename, join(&#039;&#039;, $array))</code>。
      </p>
     </dd>
    
    
     <dt><code class="parameter">flags</code></dt>
     <dd>
      <p class="para">
       <code class="parameter">flags</code> 的值可以是
       以下 flag 使用 OR (<code class="literal">|</code>) 运算符进行的组合。
      </p>
       <p class="para">
       <table class="doctable table">
        <caption><strong>Available flags</strong></caption>
        
         <thead>
          <tr>
           <th>Flag</th>
           <th>描述</th>
          </tr>

         </thead>

         <tbody class="tbody">
          <tr>
           <td>
            <strong><code><a href="filesystem.constants.html#constant.file-use-include-path">FILE_USE_INCLUDE_PATH</a></code></strong>
           </td>
           <td>
            在 include 目录里搜索  <code class="parameter">filename</code>。
            更多信息可参见 <a href="ini.core.html#ini.include-path" class="link">include_path</a>。
           </td>
          </tr>

          <tr>
           <td>
            <strong><code><a href="filesystem.constants.html#constant.file-append">FILE_APPEND</a></code></strong>
           </td>
           <td>
            如果文件 <code class="parameter">filename</code>  已经存在，追加数据而不是覆盖。
           </td>
          </tr>

          <tr>
           <td>
            <strong><code><a href="filesystem.constants.html#constant.lock-ex">LOCK_EX</a></code></strong>
           </td>
           <td>
            在写入时获取文件独占锁。换句话说，在调用 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>
            和 <span class="function"><a href="function.fwrite.html" class="function">fwrite()</a></span> 中间发生了 <span class="function"><a href="function.flock.html" class="function">flock()</a></span>
            调用。这与调用带模式"x"的 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span> 不同。
           </td>
          </tr>

         </tbody>
        
       </table>

      </p>
     </dd>
    
    
     <dt><code class="parameter">context</code></dt>
     <dd>
      <p class="para">
       一个 context 资源。
      </p>
     </dd>
    
   </dl>
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.file-put-contents-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   该函数将返回写入到文件内数据的字节数，失败时返回<strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>
  </p>
  <div class="warning"><strong class="warning">Warning</strong><p class="simpara">此函数可能返回布尔值
<strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>，但也可能返回等同于 <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong> 的非布尔值。请阅读 <a href="language.types.boolean.html" class="link">布尔类型</a>章节以获取更多信息。应使用
<a href="language.operators.comparison.html" class="link">===
运算符</a>来测试此函数的返回值。</p></div>
 </div>


 <div class="refsect1 examples" id="refsect1-function.file-put-contents-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-2214">
    <p><strong>Example #1 简单用法示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$file </span><span style="color: #007700">= </span><span style="color: #DD0000">'people.txt'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// 打开文件获取已经存在的内容<br /></span><span style="color: #0000BB">$current </span><span style="color: #007700">= </span><span style="color: #0000BB">file_get_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// 追加新成员到文件<br /></span><span style="color: #0000BB">$current </span><span style="color: #007700">.= </span><span style="color: #DD0000">"John Smith\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// 将内容写回文件<br /></span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">, </span><span style="color: #0000BB">$current</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   <div class="example" id="example-2215">
    <p><strong>Example #2 Using flags</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$file </span><span style="color: #007700">= </span><span style="color: #DD0000">'people.txt'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// The new person to add to the file<br /></span><span style="color: #0000BB">$person </span><span style="color: #007700">= </span><span style="color: #DD0000">"John Smith\n"</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// Write the contents to the file, <br />// using the FILE_APPEND flag to append the content to the end of the file<br />// and the LOCK_EX flag to prevent anyone else writing to the file at the same time<br /></span><span style="color: #0000BB">file_put_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">, </span><span style="color: #0000BB">$person</span><span style="color: #007700">, </span><span style="color: #0000BB">FILE_APPEND </span><span style="color: #007700">| </span><span style="color: #0000BB">LOCK_EX</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.file-put-contents-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">此函数可安全用于二进制对象。</span></p></blockquote>
  <div class="tip"><strong class="tip">Tip</strong><p class="simpara">如已启用<a href="filesystem.configuration.html#ini.allow-url-fopen" class="link">fopen 包装器</a>，在此函数中， URL 可作为文件名。关于如何指定文件名详见 <span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>。各种
wapper 的不同功能请参见 <a href="wrappers.html" class="xref">支持的协议和封装协议</a>，注意其用法及其可提供的预定义变量。</p></div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.file-put-contents-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="function"><a href="function.fopen.html" class="function" rel="rdfs-seeAlso">fopen()</a> - 打开文件或者 URL</span></li>
    <li><span class="function"><a href="function.fwrite.html" class="function" rel="rdfs-seeAlso">fwrite()</a> - 写入文件（可安全用于二进制文件）</span></li>
    <li><span class="function"><a href="function.file-get-contents.html" class="function" rel="rdfs-seeAlso">file_get_contents()</a> - 将整个文件读入一个字符串</span></li>
    <li><span class="function"><a href="function.stream-context-create.html" class="function" rel="rdfs-seeAlso">stream_context_create()</a> - 创建资源流上下文</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="129183""></a>
  <div class="note">
   <strong class="user">curda222 at gmail dot com</strong>
   <a href="#129183" class="date">22-Jan-2024 01:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
An improved and enraptured code from TrentTompkins at gmail dot com&nbsp; <br />
<br />
Note: Added error response <br />
Note: Added directory detection<br />
Note: Added root detection<br />
Note: Added permissions when creating folder<br />
<br />
function file_force_contents($dir, $contents, $flags = 0){<br />
&nbsp;&nbsp;&nbsp; if (strpos($dir, "../") === 0){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dir = str_replace("..", substr(__DIR__, 0, strrpos(__DIR__, "/")), $dir);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; $parts = explode('/', $dir);<br />
&nbsp;&nbsp;&nbsp; if(is_array($parts)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $file = array_pop($parts);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dir = '';<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($parts as $part)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!is_dir($dir .= "/$part")){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; mkdir($dir, 0777, true);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(file_put_contents("$dir/$file", $contents, $flags) === false ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(file_put_contents("$dir", $contents, $flags) === false ){<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
-Oliver Leuyim Angel</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="127040""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#127040" class="date">08-May-2022 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A more simplified version of the method that creates subdirectories:<br />
<br />
function path_put_contents($filePath, $contents, $flags = 0) {<br />
<br />
&nbsp;&nbsp;&nbsp; if (! is_dir($dir = implode('/', explode('/', $filePath, -1))))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; mkdir($dir, 0777, true);<br />
&nbsp;&nbsp;&nbsp; file_put_contents($filePath, $contents, $flags);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123657""></a>
  <div class="note">
   <strong class="user">maksam07 at gmail dot com</strong>
   <a href="#123657" class="date">05-Mar-2019 10:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A slightly simplified version of the method: <a href="http://php.net/manual/ru/function.file-put-contents.php#84180" rel="nofollow" target="_blank">http://php.net/manual/ru/function.file-put-contents.php#84180</a><br />
<br />
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">file_force_contents</span><span class="keyword">( </span><span class="default">$fullPath</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">, </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">( </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$fullPath </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">array_pop</span><span class="keyword">( </span><span class="default">$parts </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">( </span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$parts </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if( !</span><span class="default">is_dir</span><span class="keyword">( </span><span class="default">$dir </span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">( </span><span class="default">$dir</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">true </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">( </span><span class="default">$fullPath</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">, </span><span class="default">$flags </span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">file_force_contents</span><span class="keyword">( </span><span class="default">ROOT</span><span class="keyword">.</span><span class="string">'/newpath/file.txt'</span><span class="keyword">, </span><span class="string">'message'</span><span class="keyword">, </span><span class="default">LOCK_EX </span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120817""></a>
  <div class="note">
   <strong class="user">vaneatona at gmail dot com</strong>
   <a href="#120817" class="date">15-Mar-2017 09:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I'm updating a function that was posted, as it would fail if there was no directory. It also returns the final value so you can determine if the actual file was written.<br />
<br />
&nbsp;&nbsp;&nbsp; public static function file_force_contents($dir, $contents){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $parts = explode('/', $dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $file = array_pop($parts);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $dir = '';<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach($parts as $part) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (! is_dir($dir .= "{$part}/")) mkdir($dir);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return file_put_contents("{$dir}{$file}", $contents);<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120709""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120709" class="date">26-Feb-2017 10:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure not to corrupt anything in case of failure.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">file_put_contents_atomically</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$context </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">.</span><span class="string">"~"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">) === </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$contents</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">rename</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">.</span><span class="string">"~"</span><span class="keyword">,</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$context</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp;&nbsp; @</span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">.</span><span class="string">"~"</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">FALSE</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119363""></a>
  <div class="note">
   <strong class="user">aabaev arroba gmail coma com</strong>
   <a href="#119363" class="date">20-May-2016 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I suggest to expand file_force_contents() function of TrentTompkins at gmail dot com by adding verification if patch is like: "../foo/bar/file"<br />
<br />
if (strpos($dir, "../") === 0)<br />
&nbsp;&nbsp;&nbsp; $dir = str_replace("..", substr(__DIR__, 0, strrpos(__DIR__, "/")), $dir);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115952""></a>
  <div class="note">
   <strong class="user">gurjindersingh at SPAM dot hotmail dot com</strong>
   <a href="#115952" class="date">18-Oct-2014 06:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
File put contents fails if you try to put a file in a directory that doesn't exist. This function creates the directory.<br />
&nbsp;<br />
i have updated code of "TrentTompkins at gmail dot com". thanks<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @param string $filename &lt;p&gt;file name including folder. <br />
&nbsp;* example :: /path/to/file/filename.ext or filename.ext&lt;/p&gt;<br />
&nbsp;* @param string $data &lt;p&gt; The data to write.<br />
&nbsp;* &lt;/p&gt;<br />
&nbsp;* @param int $flags same flags used for file_put_contents.<br />
&nbsp;* more info: <a href="http://php.net/manual/en/function.file-put-contents.php" rel="nofollow" target="_blank">http://php.net/manual/en/function.file-put-contents.php</a><br />
&nbsp;* @return bool &lt;b&gt;TRUE&lt;/b&gt; file created succesfully &lt;br&gt; &lt;b&gt;FALSE&lt;/b&gt; failed to create file.<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">file_force_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="default">$flags </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">).</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">0777</span><span class="keyword">, </span><span class="default">TRUE</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">,</span><span class="default">$flags</span><span class="keyword">);<br />
}<br />
</span><span class="comment">// usage<br />
<br />
</span><span class="default">file_force_contents</span><span class="keyword">(</span><span class="string">'test1.txt'</span><span class="keyword">,</span><span class="string">'test1 content'</span><span class="keyword">);&nbsp; </span><span class="comment">// test1.txt created<br />
<br />
</span><span class="default">file_force_contents</span><span class="keyword">(</span><span class="string">'test2/test2.txt'</span><span class="keyword">,</span><span class="string">'test2 content'</span><span class="keyword">); <br />
</span><span class="comment">// test2/test2.txt created "test2" folder.&nbsp; <br />
<br />
</span><span class="default">file_force_contents</span><span class="keyword">(</span><span class="string">'~/test3/test3.txt'</span><span class="keyword">,</span><span class="string">'test3 content'</span><span class="keyword">); <br />
</span><span class="comment">// /path/to/user/directory/test3/test3.txt created "test3" folder in user directory (check on linux "ll ~/ | grep test3").&nbsp; <br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112831""></a>
  <div class="note">
   <strong class="user">chris at ocportal dot com</strong>
   <a href="#112831" class="date">28-Jul-2013 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's important to understand that LOCK_EX will not prevent reading the file unless you also explicitly acquire a read lock (shared locked) with the PHP 'flock' function.<br />
<br />
i.e. in concurrent scenarios file_get_contents may return empty if you don't wrap it like this:<br />
<br />
<span class="default">&lt;?php<br />
$myfile</span><span class="keyword">=</span><span class="default">fopen</span><span class="keyword">(</span><span class="string">'test.txt'</span><span class="keyword">,</span><span class="string">'rt'</span><span class="keyword">);<br />
</span><span class="default">flock</span><span class="keyword">(</span><span class="default">$myfile</span><span class="keyword">,</span><span class="default">LOCK_SH</span><span class="keyword">);<br />
</span><span class="default">$read</span><span class="keyword">=</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'test.txt'</span><span class="keyword">);<br />
</span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$myfile</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
If you have code that does a file_get_contents on a file, changes the string, then re-saves using file_put_contents, you better be sure to do this correctly or your file will randomly wipe itself out.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107221""></a>
  <div class="note">
   <strong class="user">vahkos at mail dot ru</strong>
   <a href="#107221" class="date">22-Jan-2012 08:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
file_put_contents does not issue an error message if file name is incorrect(for example has improper symbols on the end of it /n,/t)
<br />
that is why use trim() for file name.
<br />
$name=trim($name);
<br />
file_put_contents($name,$content);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105421""></a>
  <div class="note">
   <strong class="user">justin dot carlson at gmail dot com</strong>
   <a href="#105421" class="date">16-Aug-2011 08:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be obvious that this should only be used if you're making one write, if you are writing multiple times to the same file you should handle it yourself with fopen and fwrite, the fclose when you are done writing.<br />
<br />
Benchmark below:<br />
<br />
file_put_contents() for 1,000,000 writes - average of 3 benchmarks:<br />
<br />
&nbsp;real 0m3.932s<br />
&nbsp;user 0m2.487s<br />
&nbsp;sys 0m1.437s<br />
<br />
fopen() fwrite() for 1,000,000 writes, fclose() -&nbsp; average of 3 benchmarks:<br />
<br />
&nbsp;real 0m2.265s<br />
&nbsp;user 0m1.819s<br />
&nbsp;sys 0m0.445s</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104814""></a>
  <div class="note">
   <strong class="user">Brandon Lockaby</strong>
   <a href="#104814" class="date">08-Jul-2011 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calling file_put_contents within a destructor will cause the file to be written in SERVER_ROOT...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101408""></a>
  <div class="note">
   <strong class="user">ravianshmsr08 at gmail dot com</strong>
   <a href="#101408" class="date">15-Dec-2010 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To upload file from your localhost to any FTP server.
<br />
pease note 'ftp_chdir' has been used instead of putting direct remote file path....in ftp_put ...remoth file should be only file name
<br />

<br />
<span class="default">&lt;?php
<br />
$host </span><span class="keyword">= </span><span class="string">'*****'</span><span class="keyword">;
<br />
</span><span class="default">$usr </span><span class="keyword">= </span><span class="string">'*****'</span><span class="keyword">;
<br />
</span><span class="default">$pwd </span><span class="keyword">= </span><span class="string">'**********'</span><span class="keyword">;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
</span><span class="default">$local_file </span><span class="keyword">= </span><span class="string">'./orderXML/order200.xml'</span><span class="keyword">;
<br />
</span><span class="default">$ftp_path </span><span class="keyword">= </span><span class="string">'order200.xml'</span><span class="keyword">;
<br />
</span><span class="default">$conn_id </span><span class="keyword">= </span><span class="default">ftp_connect</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">, </span><span class="default">21</span><span class="keyword">) or die (</span><span class="string">"Cannot connect to host"</span><span class="keyword">);&nbsp; &nbsp; &nbsp; 
<br />
</span><span class="default">ftp_pasv</span><span class="keyword">(</span><span class="default">$resource</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">ftp_login</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$usr</span><span class="keyword">, </span><span class="default">$pwd</span><span class="keyword">) or die(</span><span class="string">"Cannot login"</span><span class="keyword">);
<br />
</span><span class="comment">// perform file upload
<br />
</span><span class="default">ftp_chdir</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="string">'/public_html/abc/'</span><span class="keyword">); 
<br />
</span><span class="default">$upload </span><span class="keyword">= </span><span class="default">ftp_put</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">, </span><span class="default">$ftp_path</span><span class="keyword">, </span><span class="default">$local_file</span><span class="keyword">, </span><span class="default">FTP_ASCII</span><span class="keyword">);
<br />
if(</span><span class="default">$upload</span><span class="keyword">) { </span><span class="default">$ftpsucc</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">; } else { </span><span class="default">$ftpsucc</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; }
<br />
</span><span class="comment">// check upload status:
<br />
</span><span class="keyword">print (!</span><span class="default">$upload</span><span class="keyword">) ? </span><span class="string">'Cannot upload' </span><span class="keyword">: </span><span class="string">'Upload complete'</span><span class="keyword">;
<br />
print </span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="comment">// close the FTP stream
<br />
</span><span class="default">ftp_close</span><span class="keyword">(</span><span class="default">$conn_id</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101349""></a>
  <div class="note">
   <strong class="user">error at example dot com</strong>
   <a href="#101349" class="date">11-Dec-2010 12:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's worth noting that you must make sure to use the correct path when working with this function. I was using it to help with logging in an error handler and sometimes it would work - while other times it wouldn't. In the end it was because sometimes it was called from different paths resulting in a failure to write to the log file.<br />
<br />
__DIR__ is your friend.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="96217""></a>
  <div class="note">
   <strong class="user">deqode at felosity dot nl</strong>
   <a href="#96217" class="date">15-Feb-2010 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that when saving using an FTP host, an additional stream context must be passed through telling PHP to overwrite the file.
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;</span><span class="comment">/* set the FTP hostname */
<br />
&nbsp;</span><span class="default">$user </span><span class="keyword">= </span><span class="string">"test"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$pass </span><span class="keyword">= </span><span class="string">"myFTP"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$host </span><span class="keyword">= </span><span class="string">"example.com"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$file </span><span class="keyword">= </span><span class="string">"test.txt"</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$hostname </span><span class="keyword">= </span><span class="default">$user </span><span class="keyword">. </span><span class="string">":" </span><span class="keyword">. </span><span class="default">$pass </span><span class="keyword">. </span><span class="string">"@" </span><span class="keyword">. </span><span class="default">$host </span><span class="keyword">. </span><span class="string">"/" </span><span class="keyword">. </span><span class="default">$file</span><span class="keyword">;
<br />

<br />
&nbsp;</span><span class="comment">/* the file content */
<br />
&nbsp;</span><span class="default">$content </span><span class="keyword">= </span><span class="string">"this is just a test."</span><span class="keyword">;
<br />
&nbsp;
<br />
&nbsp;</span><span class="comment">/* create a stream context telling PHP to overwrite the file */
<br />
&nbsp;</span><span class="default">$options </span><span class="keyword">= array(</span><span class="string">'ftp' </span><span class="keyword">=&gt; array(</span><span class="string">'overwrite' </span><span class="keyword">=&gt; </span><span class="default">true</span><span class="keyword">));
<br />
&nbsp;</span><span class="default">$stream </span><span class="keyword">= </span><span class="default">stream_context_create</span><span class="keyword">(</span><span class="default">$options</span><span class="keyword">);
<br />
&nbsp;
<br />
&nbsp;</span><span class="comment">/* and finally, put the contents */
<br />
&nbsp;</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">, </span><span class="default">$content</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$stream</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92569""></a>
  <div class="note">
   <strong class="user">John Galt</strong>
   <a href="#92569" class="date">29-Jul-2009 12:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use file_put_contents() as a method of very simple hit counters. These are two different examples of extremely simple hit counters, put on one line of code, each.<br />
<br />
Keep in mind that they're not all that efficient. You must have a file called counter.txt with the initial value of 0.<br />
<br />
For a text hit counter:<br />
<span class="default">&lt;?php<br />
&nbsp;$counter </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"counter.txt"</span><span class="keyword">); </span><span class="default">$counter</span><span class="keyword">++; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"counter.txt"</span><span class="keyword">, </span><span class="default">$counter</span><span class="keyword">); echo </span><span class="default">$counter</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Or a graphic hit counter:<br />
<span class="default">&lt;?php<br />
&nbsp;$counter </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"counter.txt"</span><span class="keyword">); </span><span class="default">$counter</span><span class="keyword">++; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"counter.txt"</span><span class="keyword">, </span><span class="default">$counter</span><span class="keyword">); for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$counter</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) echo </span><span class="string">"&lt;img src=\"counter/"</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$counter</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">".gif\" alt=\""</span><span class="keyword">.</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$counter</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">).</span><span class="string">"\" /&gt;"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91793""></a>
  <div class="note">
   <strong class="user">wjsams at gmail dot com</strong>
   <a href="#91793" class="date">25-Jun-2009 08:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
file_put_contents() strips the last line ending<br />
<br />
If you really want an extra line ending at the end of a file when writing with file_put_contents(), you must append an extra PHP_EOL to the end of the line as follows.<br />
<br />
<span class="default">&lt;?php<br />
$a_str </span><span class="keyword">= array(</span><span class="string">"these"</span><span class="keyword">,</span><span class="string">"are"</span><span class="keyword">,</span><span class="string">"new"</span><span class="keyword">,</span><span class="string">"lines"</span><span class="keyword">);<br />
</span><span class="default">$contents </span><span class="keyword">= </span><span class="default">implode</span><span class="keyword">(</span><span class="default">PHP_EOL</span><span class="keyword">, </span><span class="default">$a_str</span><span class="keyword">);<br />
</span><span class="default">$contents </span><span class="keyword">.= </span><span class="default">PHP_EOL </span><span class="keyword">. </span><span class="default">PHP_EOL</span><span class="keyword">;<br />
</span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"newfile.txt"</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
print(</span><span class="string">"|</span><span class="default">$contents</span><span class="string">|"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
You can see that when you print $contents you get two extra line endings, but if you view the file newfile.txt, you only get one.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="84180""></a>
  <div class="note">
   <strong class="user">TrentTompkins at gmail dot com</strong>
   <a href="#84180" class="date">02-Jul-2008 05:25</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
File put contents fails if you try to put a file in a directory that doesn't exist. This creates the directory.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">file_force_contents</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$file </span><span class="keyword">= </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dir </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$parts </span><span class="keyword">as </span><span class="default">$part</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">is_dir</span><span class="keyword">(</span><span class="default">$dir </span><span class="keyword">.= </span><span class="string">"/</span><span class="default">$part</span><span class="string">"</span><span class="keyword">)) </span><span class="default">mkdir</span><span class="keyword">(</span><span class="default">$dir</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"</span><span class="default">$dir</span><span class="string">/</span><span class="default">$file</span><span class="string">"</span><span class="keyword">, </span><span class="default">$contents</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="68329""></a>
  <div class="note">
   <strong class="user">egingell at sisna dot com</strong>
   <a href="#68329" class="date">23-Jul-2006 04:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In reply to the previous note:<br />
<br />
If you want to emulate this function in PHP4, you need to return the bytes written as well as support for arrays, flags.<br />
<br />
I can only figure out the FILE_APPEND flag and array support. If I could figure out "resource context" and the other flags, I would include those too.<br />
<br />
&lt;?<br />
<br />
define('FILE_APPEND', 1);<br />
function file_put_contents($n, $d, $flag = false) {<br />
&nbsp;&nbsp;&nbsp; $mode = ($flag == FILE_APPEND || strtoupper($flag) == 'FILE_APPEND') ? 'a' : 'w';<br />
&nbsp;&nbsp;&nbsp; $f = @fopen($n, $mode);<br />
&nbsp;&nbsp;&nbsp; if ($f === false) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return 0;<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (is_array($d)) $d = implode($d);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $bytes_written = fwrite($f, $d);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; fclose($f);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return $bytes_written;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
?&gt;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42551""></a>
  <div class="note">
   <strong class="user">aidan at php dot net</strong>
   <a href="#42551" class="date">20-May-2004 07:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This functionality is now implemented in the PEAR package PHP_Compat.<br />
<br />
More information about using this function without upgrading your version of PHP can be found on the below link:<br />
<br />
<a href="http://pear.php.net/package/PHP_Compat" rel="nofollow" target="_blank">http://pear.php.net/package/PHP_Compat</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
