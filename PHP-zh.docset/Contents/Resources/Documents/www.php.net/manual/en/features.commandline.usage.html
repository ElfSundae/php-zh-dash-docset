<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Executing PHP files</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="features.commandline.options.html">? Options</a></li>
      <li style="float: right;"><a href="features.commandline.io-streams.html">I/O streams ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="features.commandline.html">PHP 的命令行模式</a></li>
    <li>Executing PHP files</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="features.commandline.usage" class="section">
<h2 class="title">Executing PHP files</h2>


 <p class="para">
  <acronym title="Command Line Interpreter/Interface">CLI</acronym> <acronym title="Server Application Programming Interface">SAPI</acronym> 模块有以下三种不同的方法来获取要运行的 PHP 代码：
  <ol type="1">
   <li class="listitem">
    <p class="para">
     让 PHP 运行指定文件。
    </p>
    <p class="para">
     <div class="example-contents screen">
<div class="cdata"><pre>
php my_script.php

php -f my_script.php
</pre></div>
     </div>
    </p>
    <p class="para">
     以上两种方法（使用或不使用 <strong class="option unknown">-f</strong> 参数）都能够运行给定的
     <var class="filename">my_script.php</var> 文件。可以选择任何文件来运行，指定的
     PHP 脚本并非必须要以 <code class="literal">.php</code>
     为扩展名，它们可以有任意的文件名和扩展名。
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <p class="para">
      If arguments need to be passed to the script when using
      <strong class="option unknown">-f</strong>, the first argument must be <code class="literal">--</code>.
     </p>
    </p></blockquote>
   </li>
   <li class="listitem">
    <p class="para">
     在命令行直接运行 PHP 代码。
    </p>
    <p class="para">
     <div class="example-contents screen">
<div class="cdata"><pre>
php -r &#039;print_r(get_defined_constants());&#039;
</pre></div>
     </div>
    </p>
    <p class="para">
     在使用这种方法时，请注意外壳变量的替代及引号的使用。
    </p>
    <blockquote class="note"><p><strong class="note">Note</strong>: 
     <p class="para">
      请仔细阅读以上范例，在运行代码时没有开始和结束的标记符！加上
      <strong class="option unknown">-r</strong> 参数后，这些标记符是不需要的，加上它们会导致语法错误。
     </p>
    </p></blockquote>
   </li>
   <li class="listitem">
    <p class="para">
     通过标准输入（<code class="literal">stdin</code>）提供需要运行的 PHP 代码。
    </p>
    <p class="para">
     以上用法提供了非常强大的功能，使得可以如下范例所示，动态地生成
     PHP 代码并通过命令行运行这些代码：
     <div class="example-contents screen">
<div class="cdata"><pre>
$ some_application | some_filter | php | sort -u &gt;final_output.txt
</pre></div>
     </div>
    </p>
   </li>
  </ol>
  以上三种运行代码的方法不能同时使用。
 </p>

 <p class="para">
  和所有的外壳应用程序一样，PHP 的二进制文件及其运行的 PHP 脚本能够接受一系列的参数。PHP
  没有限制传送给脚本程序的参数的个数（外壳程序对命令行的字符数有限制，但通常都不会超过该限制）。传递给脚本的参数可在全局变量
  <var class="varname"><a href="reserved.variables.argv.html" class="classname">$argv</a></var> 中获取。该数组中下标为零的成员 <var class="varname"><a href="reserved.variables.argv.html" class="classname">$argv[0]</a></var> 为脚本的名称（当
  PHP 代码来自标准输入获直接用 <strong class="option unknown">-r</strong>
  参数以命令行方式运行时，该名称为"<code class="literal">-</code>"）。The same is true if the code is
  executed via a pipe from <code class="literal">STDIN</code>.
 </p>

 <p class="para">
 另外，全局变量
 <var class="varname"><a href="reserved.variables.argc.html" class="classname">$argc</a></var> 存有 <var class="varname"><a href="reserved.variables.argv.html" class="classname">$argv</a></var>
 数组中成员变量的个数（而<em class="emphasis">非</em>传送给脚本程序的参数的个数）。
 </p>

 <p class="para">
  只要传送给脚本的参数不是以 <code class="literal">-</code>
  符号开头，就无需过多的注意什么。向脚本传送以
  <code class="literal">-</code> 开头的参数会导致错误，因为 PHP
  会认为应该由它自身来处理这些参数。可以用参数列表分隔符
  <code class="literal">--</code> 来解决这个问题。在 PHP
  解析完参数后，该符号后所有的参数将会被原样传送给脚本程序。
 </p>

<div class="informalexample">
  <div class="example-contents screen">
<div class="cdata"><pre>
# 以下命令将不会运行 PHP 代码，而只显示 PHP 命令行模式的使用说明：
$ php -r &#039;var_dump($argv);&#039; -h
Usage: php [options] [-f] &lt;file&gt; [args...]
[...]

# 以下命令将会把"-h"参数传送给脚本程序，PHP 不会显示命令行模式的使用说明：
$ php -r &#039;var_dump($argv);&#039; -- -h
array(2) {
  [0]=&gt;
  string(1) &quot;-&quot;
  [1]=&gt;
  string(2) &quot;-h&quot;
}
</pre></div>
 </div>
</div>

 <p class="para">
  除此之外，还有另一个方法将 PHP 用于外壳脚本。可以在写一个脚本，并在第一行以
  <code class="literal">#!/usr/bin/php</code> 开头，在其后加上以 PHP
  开始和结尾标记符包含的正常的 PHP
  代码，然后为该文件设置正确的运行属性（例如：<strong class="command">chmod +x test</strong>）。
  该方法可以使得该文件能够像外壳脚本或 PERL 脚本一样被直接执行。
 </p>

<div class="example" id="example-453">
 <p><strong>Example #1 Execute PHP script as shell script</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
#!/usr/bin/php<br /><span style="color: #0000BB">&lt;?php<br />&nbsp;&nbsp;&nbsp;&nbsp;var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$argv</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 <div class="example-contents"><p>
  假设改文件名为 <var class="filename">test</var> 并被放置在当前目录下，可以做如下操作：
 </p></div>
  <div class="example-contents screen">
<div class="cdata"><pre>
$ chmod +x test
$ ./test -h -- foo
array(4) {
  [0]=&gt;
  string(6) &quot;./test&quot;
  [1]=&gt;
  string(2) &quot;-h&quot;
  [2]=&gt;
  string(2) &quot;--&quot;
  [3]=&gt;
  string(3) &quot;foo&quot;
}
</pre></div>
  </div>
</div>

 <p class="para">
  正如所看到的，在向该脚本传送以 <code class="literal">-</code> 开头的参数时，脚本仍然能够正常运行。
 </p>

 <p class="para">
  PHP 的命令行模式能使得 PHP 脚本能完全独立于 web 服务器单独运行。如果使用
  Unix 系统，需要在 PHP
  脚本的最前面加上一行特殊的代码，使得它能够被执行，这样系统就能知道用哪个程序去运行该脚本。在
  Windows 平台下可以将 <var class="filename">php.exe</var> 和 <code class="literal">.php</code>
  文件的双击属性相关联，也可以编写一个批处理文件来用 PHP
  执行脚本。为 Unix 系统增加的第一行代码不会影响该脚本在
  Windows 下的运行，因此也可以用该方法编写跨平台的脚本程序。以下是一个简单的
  PHP 命令行程序的范例。
 </p>

 <p class="para">
  <div class="example" id="example-454">
   <p><strong>Example #2 试图以命令行方式运行的 PHP 脚本（script.php）</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
#!/usr/bin/php<br /><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">$argc&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">2&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$argv</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;array(</span><span style="color: #DD0000">'--help'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'-help'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'-h'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'-?'</span><span style="color: #007700">)))&nbsp;{<br /></span><span style="color: #0000BB">?&gt;<br /></span><br />This&nbsp;is&nbsp;a&nbsp;command&nbsp;line&nbsp;PHP&nbsp;script&nbsp;with&nbsp;one&nbsp;option.<br /><br />&nbsp;&nbsp;Usage:<br />&nbsp;&nbsp;<span style="color: #0000BB">&lt;?php&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$argv</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];&nbsp;</span><span style="color: #0000BB">?&gt;</span>&nbsp;&lt;option&gt;<br /><br />&nbsp;&nbsp;&lt;option&gt;&nbsp;can&nbsp;be&nbsp;some&nbsp;word&nbsp;you&nbsp;would&nbsp;like<br />&nbsp;&nbsp;to&nbsp;print&nbsp;out.&nbsp;With&nbsp;the&nbsp;--help,&nbsp;-help,&nbsp;-h,<br />&nbsp;&nbsp;or&nbsp;-?&nbsp;options,&nbsp;you&nbsp;can&nbsp;get&nbsp;this&nbsp;help.<br /><br /><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$argv</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>

 <p class="para">
  在以上脚本中，用第一行特殊的代码来指明该文件应该由 PHP
  来执行。在这里使用 <acronym title="Command Line Interpreter/Interface">CLI</acronym> 的版本，因此不会有 HTTP 头信息输出。
 </p>

 <p class="para">
  以上程序中检查了参数的个数是大于 1 个还是小于 1
  个。此外如果参数是 <strong class="option unknown">--help</strong>，<strong class="option unknown">-help</strong>，<strong class="option unknown">-h</strong>
  或 <strong class="option unknown">-?</strong>
  时，打印出帮助信息，并同时用 <var class="varname"><a href="reserved.variables.argv.html" class="classname">$argv[0]</a></var> 动态输出脚本的名称。如果还收到了其它参数，将其显示出来。
 </p>

 <p class="para">
  如果希望在 Unix 下运行以上脚本，需要使其属性为可执行文件，然后简单的运行
  <strong class="command">script.php echothis</strong> 或 <strong class="command">script.php -h</strong>。在
  Windows 下，可以为此编写一个批处理文件：
 </p>

 <p class="para">
  <div class="example" id="example-455">
   <p><strong>Example #3 运行 PHP 命令行脚本的批处理文件（script.bat）</strong></p>
   <div class="example-contents">
<div class="shellcode"><pre class="shellcode">@echo OFF
&quot;C:\php\php.exe&quot; script.php %*</pre>
</div>
   </div>

  </div>
 </p>

 <p class="para">
  假设将上述程序命名为 <var class="filename">script.php</var>，且
  <acronym title="Command Line Interpreter/Interface">CLI</acronym> 版的 <var class="filename">php.exe</var> 文件放置在
  <var class="filename">c:\php\cli\php.exe</var>，该批处理文件会帮助将附加的参数传给脚本程序：<strong class="command">script.bat
  echothis</strong> 或 <strong class="command">script.bat -h</strong>。
 </p>

 <p class="para">
  请参阅 <a href="ref.readline.html" class="link">Readline</a>
  扩展模块的有关文档，以获取更多的函数的信息。这些函数可以帮助完善 PHP 命令行应用程序。
 </p>

 <p class="para">
  On Windows, PHP can be configured to run without the need to
  supply the <var class="filename">C:\php\php.exe</var> or the <code class="literal">.php</code>
  extension, as described in <a href="install.windows.commandline.html" class="link">Command
  Line PHP on Microsoft Windows</a>.
 </p>

 <blockquote class="note"><p><strong class="note">Note</strong>: 
  <p class="para">
   On Windows it is recommended to run PHP under an actual user account.
   When running under a network service certain operations will fail, because
   &quot;No mapping between account names and security IDs was done&quot;.
  </p>
 </p></blockquote>
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="125998""></a>
  <div class="note">
   <strong class="user">email at alexander-bombis dot de</strong>
   <a href="#125998" class="date">09-Apr-2021 06:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For Windows:<br />
<br />
After the years I also have the fact that I have to use double quotation marks after php -r on Windows shell.<br />
<br />
But in the Powershell you can use single or double quotation!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="123019""></a>
  <div class="note">
   <strong class="user">synnus at gmail dot com</strong>
   <a href="#123019" class="date">08-Aug-2018 12:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
in php.ini use auto_prepend_file="init.php" <br />
first start script</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120251""></a>
  <div class="note">
   <strong class="user">gabriel at figdice dot org</strong>
   <a href="#120251" class="date">01-Dec-2016 11:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding shebang:<br />
<br />
In both Linux and Windows, when you execute a script in CLI with:<br />
<br />
&nbsp;&nbsp;&nbsp; php script.php<br />
<br />
then PHP will ignore the very first line of your script if it starts with:<br />
<br />
&nbsp;&nbsp;&nbsp; #!<br />
<br />
So, this line is not only absorbed by the kernel when the script file is executable, but it is also ignored by the PHP engine itself.<br />
<br />
However, the engine will NOT ignore the first #! line of any included files withing your "outer" script.php.<br />
Any "shebang" line in an included script, will result in simply outputting the line to STDOUT, just as any other text residing outside a <span class="default">&lt;?php </span><span class="keyword">...&nbsp; </span><span class="default">?&gt;</span> block.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119609""></a>
  <div class="note">
   <strong class="user">david at frankieandshadow dot com</strong>
   <a href="#119609" class="date">15-Jul-2016 10:27</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A gotcha when using #!/usr/bin/php at the start of the file as noted above:<br />
<br />
if you originally edited the file on Windows and then attempt to use it on Unix, it won't work because the #! line requires a Unix line ending. Bash gives you the following error message if it has DOS line endings:<br />
"bash: /usr/local/bin/wpreplace.php: /usr/bin/php^M: bad interpreter: No such file or directory"<br />
<br />
(In Emacs I used "CTRL-X ENTER f" then type "unix" and ENTER to convert)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111816""></a>
  <div class="note">
   <strong class="user">php at richardneill dot org</strong>
   <a href="#111816" class="date">01-Apr-2013 04:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
On Linux, the shebang (#!) line is parsed by the kernel into at most two parts. <br />
For example:<br />
<br />
1:&nbsp; #!/usr/bin/php<br />
2:&nbsp; #!/usr/bin/env&nbsp; php<br />
3:&nbsp; #!/usr/bin/php -n<br />
4:&nbsp; #!/usr/bin/php -ddisplay_errors=E_ALL<br />
5:&nbsp; #!/usr/bin/php -n -ddisplay_errors=E_ALL<br />
<br />
1. is the standard way to start a script. (compare "#!/bin/bash".)<br />
<br />
2. uses "env" to find where PHP is installed: it might be elsewhere in the $PATH, such as /usr/local/bin.<br />
<br />
3. if you don't need to use env, you can pass ONE parameter here. For example, to ignore the system's PHP.ini, and go with the defaults, use "-n". (See "man php".)<br />
<br />
4.&nbsp; or, you can set exactly one configuration variable. I recommend this one, because display_errors actually takes effect if it is set here. Otherwise, the only place you can enable it is system-wide in php.ini. If you try to use ini_set() in your script itself, it's too late: if your script has a parse error, it will silently die. <br />
<br />
5. This will not (as of 2013) work on Linux. It acts as if the whole string, "-n -ddisplay_errors=E_ALL" were a single argument. But in BSD, the shebang line can take more than 2 arguments, and so it may work as intended.<br />
<br />
Summary: use (2) for maximum portability, and (4) for maximum debugging.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105433""></a>
  <div class="note">
   <strong class="user">petruzanautico at yah00 dot com dot ar</strong>
   <a href="#105433" class="date">17-Aug-2011 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As you can't use -r and -f together, you can circumvent this by doing the following:<br />
php -r '$foo = 678; include("your_script.php");'</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="105286""></a>
  <div class="note">
   <strong class="user">spencer at aninternetpresence dot net</strong>
   <a href="#105286" class="date">07-Aug-2011 05:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you are running the CLI on Windows and use the "-r" option, be sure to enclose your PHP code in double (not single) quotes. Otherwise, your code will not run.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
