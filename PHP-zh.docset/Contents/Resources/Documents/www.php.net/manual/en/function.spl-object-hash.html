<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>返回指定对象的 hash id</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.spl-classes.html">? spl_classes</a></li>
      <li style="float: right;"><a href="function.spl-object-id.html">spl_object_id ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.spl.html">SPL 函数</a></li>
    <li>返回指定对象的 hash id</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.spl-object-hash" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">spl_object_hash</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">spl_object_hash</span> &mdash; <span class="dc-title">
   返回指定对象的 hash id
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.spl-object-hash-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>spl_object_hash</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.object.html" class="type object">object</a></span> <code class="parameter">$object</code></span>): <span class="type"><a href="language.types.string.html" class="type string">string</a></span></div>

  <p class="para rdfs-comment">
   本函数为对象返回唯一标识符。只要对象没有销毁，这个 id
   可用作保存对象的散列键，或者用于标识对象。一旦对象销毁，它的散列值可能会被其它对象重用。此行为类似为
   <span class="function"><a href="function.spl-object-id.html" class="function">spl_object_id()</a></span>。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.spl-object-hash-parameters">
   <h3 class="title">参数</h3>
   <p class="para">
    <dl>
     
      <dt><code class="parameter">object</code></dt>
      <dd>
       <p class="para">
        任何对象。 
       </p>
      </dd>
     
    </dl>
   </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.spl-object-hash-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   字符串，对于当前存在的每个对象都是唯一的，且对同一个对象始终相同。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.spl-object-hash-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3765">
    <p><strong>Example #1 A <span class="function"><strong>spl_object_hash()</strong></span> 示例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$id </span><span style="color: #007700">= </span><span style="color: #0000BB">spl_object_hash</span><span style="color: #007700">(</span><span style="color: #0000BB">$object</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$storage</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">] = </span><span style="color: #0000BB">$object</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.spl-object-hash-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    当对象销毁后，它的散列值可能会被其它对象重用。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    对象散列应该使用 <code class="code">===</code> 和 <code class="code">!==</code> 标识符比较，因为返回的散列可能是<a href="language.types.numeric-strings.html" class="link">数字字符串</a>。例如：<code class="literal">0000000000000e600000000000000000</code>。
   </p>
  </p></blockquote>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.spl-object-hash-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="function"><a href="function.spl-object-id.html" class="function" rel="rdfs-seeAlso">spl_object_id()</a> - Return the integer object handle for given object</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="129141""></a>
  <div class="note">
   <strong class="user">Numety</strong>
   <a href="#129141" class="date">04-Jan-2024 10:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As others have noted, this function now returns the ID, padded with zeroes.<br />
It does not produce a cryptographic hash (which is not what the name hints at, either), nor does it hide it which order the objects were created.<br />
<br />
If you wish to give your objects unique identifiers while hiding in which order they were created, you can achieve this by hashing their ID together with other predictable values:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">objectHash</span><span class="keyword">(</span><span class="default">object $object</span><span class="keyword">): </span><span class="default">string<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">hash</span><span class="keyword">(</span><span class="string">'sha512'</span><span class="keyword">, </span><span class="default">$object</span><span class="keyword">::class . </span><span class="default">spl_object_id</span><span class="keyword">(</span><span class="default">$object</span><span class="keyword">));<br />
}<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Here's an example usage:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">class </span><span class="default">Person<br />
</span><span class="keyword">{<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">__construct</span><span class="keyword">(public </span><span class="default">string $name</span><span class="keyword">) {}<br />
}<br />
<br />
</span><span class="default">$anna </span><span class="keyword">= new </span><span class="default">Person</span><span class="keyword">(</span><span class="string">'Anna'</span><span class="keyword">);<br />
</span><span class="default">$bob </span><span class="keyword">= new </span><span class="default">Person</span><span class="keyword">(</span><span class="string">'Bob'</span><span class="keyword">);<br />
<br />
</span><span class="default">var_export</span><span class="keyword">(</span><span class="default">objectHash</span><span class="keyword">(</span><span class="default">$anna</span><span class="keyword">));&nbsp;&nbsp; </span><span class="comment">// '077d33c1 etc.<br />
</span><span class="keyword">echo </span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="default">var_export</span><span class="keyword">(</span><span class="default">objectHash</span><span class="keyword">(</span><span class="default">$bob</span><span class="keyword">));&nbsp; &nbsp; </span><span class="comment">// 'ea3c1319 etc.<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Feel free to choose another hash, or hash other values along with their ID, for it to better suit your environment.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="129125""></a>
  <div class="note">
   <strong class="user">jasonlester at nope dot com</strong>
   <a href="#129125" class="date">24-Dec-2023 05:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
obj-&gt;handle is an unsigned long that starts a 0 and is incremented by 1 every time an object is created, it is not a true pointer such as if created by mallaoc() or similar.<br />
<br />
/* {{{ Returns the integer object handle for the given object */<br />
PHP_FUNCTION(spl_object_id)<br />
{<br />
&nbsp;&nbsp;&nbsp; zend_object *obj;<br />
<br />
&nbsp;&nbsp;&nbsp; ZEND_PARSE_PARAMETERS_START(1, 1)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; Z_PARAM_OBJ(obj)<br />
&nbsp;&nbsp;&nbsp; ZEND_PARSE_PARAMETERS_END();<br />
<br />
&nbsp;&nbsp;&nbsp; RETURN_LONG((zend_long)obj-&gt;handle);<br />
}<br />
/* }}} */<br />
<br />
PHPAPI zend_string *php_spl_object_hash(zend_object *obj) /* {{{*/<br />
{<br />
&nbsp;&nbsp;&nbsp; return strpprintf(32, "%016zx0000000000000000", (intptr_t)obj-&gt;handle);<br />
}<br />
/* }}} */</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128395""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#128395" class="date">14-Apr-2023 12:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function is slightly older than spl_object_id. Its output is more complex but doesn't actually provide any more information than the newer function. It used to be a lot more complex (without being any more informative) but now it's merely the object's ID number written in hex with a lot of padding to maintain the old format. spl_object_id just gives the ID number as a plain integer.<br />
<br />
You're probably better off using spl_object_id, and thinking about migrating if you're already using spl_object_hash; there is a chance this function will be deprecated and subsequently removed in the future.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128374""></a>
  <div class="note">
   <strong class="user">A simple developer</strong>
   <a href="#128374" class="date">06-Apr-2023 08:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Attention when comparing object hashes in PHP &gt;= 8.1<br />
<br />
In PHP 8.1 (I think) the output of spl_object_hash() changed (see pull request https://github.com/php/php-src/pull/7010).<br />
This lead to a strange misbehaviour of our application, as we stored object hashes in an array to check, if we processed object already. A simple in_array() check returned true, even though the current object hash was NOT actually in array.<br />
<br />
Actual problem: New hashes are much more simple and can be something like "0000000000000e600000000000000000" or "0000000000000e490000000000000000", which PHP will interpret as numeric (exponent).<br />
in_array() will compare non type-safe by default and will interpret named hashes as "0".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122852""></a>
  <div class="note">
   <strong class="user">DimeCadmium</strong>
   <a href="#122852" class="date">18-Jun-2018 03:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For those who believe this function is misnamed, I would like to direct you to https://en.wikipedia.org/wiki/Hash_function . Also, for those who think it's misnamed and supply a comparison to Python, I would like to direct you to https://docs.python.org/2/library/functions.html#hash which does the same thing as this function. (From Python's data-model docs: "User-defined classes have __cmp__() and __hash__() methods by default; ... x.__hash__() returns a result derived from id(x)." - id(x) returns the memory address of the object.)<br />
<br />
The cryptographic hash functions you are familiar with, like MD5 or SHA1, are named hash functions because they have a similar design goal: low chance of collisions.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="122217""></a>
  <div class="note">
   <strong class="user">aa dot vasilenko at gmail dot com</strong>
   <a href="#122217" class="date">03-Jan-2018 07:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that since PHP 7.2 there's new function available spl_object_id() which returns int instead of string. It's (supposed to be) more performant. Due to lack of documentation I recommend you reading the PR https://github.com/php/php-src/pull/2611</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121491""></a>
  <div class="note">
   <strong class="user">Hayleu Watson</strong>
   <a href="#121491" class="date">06-Aug-2017 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The "hash" mentioned in the name of this function refers to the storage structure known as a "hash table", not to any sort of "message digest". The string returned by this function is little more than the object's address in the (hash) table PHP maintains of all existing objects.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121490""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#121490" class="date">06-Aug-2017 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The "hash" mentioned in this function is used in the sense of the storage structure known as a "hash table", not in the sense of "message digest".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121489""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#121489" class="date">06-Aug-2017 10:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The "hash" mentioned in this function is used in the sense of the storage structure known as a "hash table", not in the sense of "message digest".</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121277""></a>
  <div class="note">
   <strong class="user">Ulrich Eckhardt</strong>
   <a href="#121277" class="date">27-Jun-2017 07:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Calling this a hash is very misleading:<br />
<br />
1. This function gives an object identifier (ID), which uniquely identifies the object for its whole lifetime. This is similar to the address of an object in C or the id() function in Python. I'm sure other languages have similar constructs.<br />
2. This is not a hash and has nothing to do with it. A hash takes data and algorithmically reduces that data to some kind of scalar value. The only guarantee is that two equal inputs provide the same output, but not that two different inputs provide different outputs (hint: hash collisions). spl_object_hash() guarantees different outputs for non-identical objects though.<br />
3. As someone mentioned already, this does not look at the content of the object. If you consider the difference between equality and identity, it only allows determining identity. If you serialize and unserialize an object, it will not be identical to its former self, but it will be equal, just to give an example. If you want a key to use in a response cache, using this function on the request is not only useless, because equal requests have different IDs, but possibly even harmful, because when a request object is garbage collected, its ID can be reused.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112199""></a>
  <div class="note">
   <strong class="user">mjs at beebo dot org</strong>
   <a href="#112199" class="date">16-May-2013 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that given two different objects spl_object_hash() can return values that look very similar, and in fact both the most significant *and* least significant digits are likely to be identical!&nbsp; e.g. "000000003cc56d770000000007fa48c5" and "000000003cc56d0d0000000007fa48c5".<br />
<br />
Therefore (especially if using this function for debugging), you may wish to pass the hash into a cryptographic hash function like md5() to get to facilitate visual comparisons, and make it more likely that the first few or last few digits are unique.<br />
<br />
md5("000000003cc56d770000000007fa48c5") -&gt; "619a799747d348fa1caf181a72b65d9f"<br />
<br />
md5("000000003cc56d0d0000000007fa48c5") -&gt; "ae964bc912281e7804fe5a88b4546cb2"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76220""></a>
  <div class="note">
   <strong class="user">planetbeing</strong>
   <a href="#76220" class="date">05-Jul-2007 04:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the contents (properties) of the object are NOT hashed by the function, merely its internal handle and handler table pointer. This is sufficient to guarantee that any two objects simultaneously co-residing in memory will have different hashes. Uniqueness is not guaranteed between objects that did not reside in memory simultaneously, for example:<br />
<br />
var_dump(spl_object_hash(new stdClass()), spl_object_hash(new stdClass()));<br />
<br />
Running this alone will usually generate the same hashes, since PHP reuses the internal handle for the first stdClass after it has been dereferenced and destroyed when it creates the second stdClass.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
