<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>发送邮件</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.ezmlm-hash.html">? ezmlm_hash</a></li>
      <li style="float: right;"><a href="book.mailparse.html">Mailparse ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.mail.html">Mail 函数</a></li>
    <li>发送邮件</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.mail" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mail</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">mail</span> &mdash; <span class="dc-title">发送邮件</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.mail-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>mail</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$to</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$subject</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$message</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type"><a href="language.types.array.html" class="type array">array</a></span>|<span class="type"><a href="language.types.string.html" class="type string">string</a></span></span> <code class="parameter">$additional_headers</code><span class="initializer"> = []</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.string.html" class="type string">string</a></span> <code class="parameter">$additional_params</code><span class="initializer"> = &quot;&quot;</span></span><br>): <span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span></div>

  <p class="para rdfs-comment">
   发送一封电子邮件。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mail-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>
    
     <dt><code class="parameter">to</code></dt>
     <dd>
      <p class="para">
       电子邮件收件人，或收件人列表。
      </p>
      <p class="para">
       本字符串的格式必须符合
       <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>。例如：
       <ul class="simplelist">
        <li>user@example.com</li>
        <li>user@example.com, anotheruser@example.com</li>
        <li>User <user@example.com></li>
        <li>User <user@example.com>, Another User <anotheruser@example.com></li>
       </ul>
      </p>
     </dd>
    
    
     <dt><code class="parameter">subject</code></dt>
     <dd>
      <p class="para">
       电子邮件的主题。
      </p>
      <div class="caution"><strong class="caution">Caution</strong>
       <p class="para">
        本项不能包含任何换行符，否则邮件可能无法正确发送。
       </p>
      </div>
     </dd>
    
    
     <dt><code class="parameter">message</code></dt>
     <dd>
      <p class="para">
       所要发送的消息。
      </p>
      <p class="para">
       行之间必须以一个 CRLF（\r\n）分隔。每行不能超过 70 个字符。
      </p>
      <div class="caution"><strong class="caution">Caution</strong>
       <p class="para">
        （Windows 下）当 PHP 直接连接到 SMTP 服务器时，如果在一行开头发现一个句号，则会被删掉。要避免此问题，将单个句号替换成两个句号。
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$text </span><span style="color: #007700">= </span><span style="color: #0000BB">str_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"\n."</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n.."</span><span style="color: #007700">, </span><span style="color: #0000BB">$text</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
        </div>

       </p>
      </div>
     </dd>
    
    
     <dt><code class="parameter">additional_headers</code>（可选项）</dt>
     <dd>
      <p class="para">
       要插入到邮件 header 尾部的 <span class="type"><a href="language.types.string.html" class="type String">String</a></span> 或 <span class="type"><a href="language.types.array.html" class="type array">array</a></span>。
      </p>
      <p class="para">
       这通常用于添加额外的 header（From、Cc 和 Bcc）。多个额外的 header 应使用
       CRLF（\r\n）分隔。如果使用外部数据来组成此 header，则应对数据进行清理，避免注入不需要的 header。
      </p>
      <p class="para">
       如果传递 <span class="type"><a href="language.types.array.html" class="type array">array</a></span>，则 key 是 header 名称，value 对应的 header 值。
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        发送邮件时，邮件<em>必须</em>包含 <code class="literal">From</code> header。这可以使用
        <code class="parameter">additional_headers</code> 参数来设置，或者可以在  <var class="filename">php.ini</var> 中设置默认值。
       </p>
       <p class="para">
        如果不这样做，将导致类似于 <code class="literal">Warning: mail(): &quot;sendmail_from&quot; not
        set in php.ini or custom &quot;From:&quot; header missing</code> 的错误消息。当直接通过 SMTP（仅限
        Windows）发送时，<code class="literal">From</code> header 还会设置 <code class="literal">Return-Path</code>。
       </p>
      </p></blockquote>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        如果未收到消息，请尝试仅使用 LF（\n）。一些 Unix 邮件传输代理（最著名的是 <a href="http://cr.yp.to/qmail.html" class="link external" title="Link : http://cr.yp.to/qmail.html">&raquo;&nbsp;qmail</a>）会自动用 CRLF 替换 LF（如果使用 CRLF，则会导致 CR
        重复）。这应该是最后的手段，因为它不符合 <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>。
       </p>
      </p></blockquote>
     </dd>
    
    
     <dt><code class="parameter">additional_params</code>（可选）</dt>
     <dd>
      <p class="para">
       The <code class="parameter">additional_params</code> parameter
       can be used to pass additional flags as command line options to the
       program configured to be used when sending mail, as defined by the
       <code class="literal">sendmail_path</code> configuration setting. For example,
       this can be used to set the envelope sender address when using
       sendmail with the <code class="literal">-f</code> sendmail option.
      </p>
      <p class="para">
       This parameter is escaped by <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> internally
       to prevent command execution. <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> prevents
       command execution, but allows to add additional parameters. For security reasons,
       it is recommended for the user to sanitize this parameter to avoid adding unwanted
       parameters to the shell command.
      </p>
      <p class="para">
       Since <span class="function"><a href="function.escapeshellcmd.html" class="function">escapeshellcmd()</a></span> is applied automatically, some characters
       that are allowed as email addresses by internet RFCs cannot be used. 
       <span class="function"><strong>mail()</strong></span> can not allow such characters, so in programs where the use of
       such characters is required, alternative means of sending emails (such as using a framework
       or a library) is recommended. 
      </p>
      <p class="para">
       The user that the webserver runs as should be added as a trusted user to the
       sendmail configuration to prevent a &#039;X-Warning&#039; header from being added
       to the message when the envelope sender (-f) is set using this method.
       For sendmail users, this file is <var class="filename">/etc/mail/trusted-users</var>.
      </p>
     </dd>
    
   </dl>
  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mail-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果邮件成功接受投递，返回 <strong><code><a href="reserved.constants.html#constant.true">true</a></code></strong>，否则返回 <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>。
  </p>
  <p class="para">
   同样重要的是要注意到，邮件仅接受了投递并不意味着邮件实际上达到预定目的地。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.mail-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>7.2.0</td>
       <td>
        现在 <code class="parameter">additional_headers</code> 参数开始支持 <span class="type"><a href="language.types.array.html" class="type array">array</a></span>。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.mail-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-3110">
    <p><strong>Example #1 发送邮件</strong></p>
    <div class="example-contents"><p>
     使用 <span class="function"><strong>mail()</strong></span> 发送简单的邮件：
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// 消息<br /></span><span style="color: #0000BB">$message </span><span style="color: #007700">= </span><span style="color: #DD0000">"Line 1\r\nLine 2\r\nLine 3"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// 如果任何一行超过 70 个字符，应该使用 wordwrap()<br /></span><span style="color: #0000BB">$message </span><span style="color: #007700">= </span><span style="color: #0000BB">wordwrap</span><span style="color: #007700">(</span><span style="color: #0000BB">$message</span><span style="color: #007700">, </span><span style="color: #0000BB">70</span><span style="color: #007700">, </span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// 发送<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'caffeinated@example.com'</span><span style="color: #007700">, </span><span style="color: #DD0000">'My Subject'</span><span style="color: #007700">, </span><span style="color: #0000BB">$message</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   <div class="example" id="example-3111">
    <p><strong>Example #2 使用额外标头发送邮件</strong></p>
    <div class="example-contents"><p>
     添加基本 header，告诉 MUA 发件人和回复地址：
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$to      </span><span style="color: #007700">= </span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$subject </span><span style="color: #007700">= </span><span style="color: #DD0000">'the subject'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$message </span><span style="color: #007700">= </span><span style="color: #DD0000">'hello'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers </span><span style="color: #007700">= </span><span style="color: #DD0000">'From: webmaster@example.com' </span><span style="color: #007700">. </span><span style="color: #DD0000">"\r\n" </span><span style="color: #007700">.<br />    </span><span style="color: #DD0000">'Reply-To: webmaster@example.com' </span><span style="color: #007700">. </span><span style="color: #DD0000">"\r\n" </span><span style="color: #007700">.<br />    </span><span style="color: #DD0000">'X-Mailer: PHP/' </span><span style="color: #007700">. </span><span style="color: #0000BB">phpversion</span><span style="color: #007700">();<br /><br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">, </span><span style="color: #0000BB">$subject</span><span style="color: #007700">, </span><span style="color: #0000BB">$message</span><span style="color: #007700">, </span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   <div class="example" id="example-3112">
    <p><strong>Example #3 使用 <span class="type"><a href="language.types.array.html" class="type array">array</a></span> 形式的额外标头发送邮件</strong></p>
    <div class="example-contents"><p>
     此示例与上面示例发送邮件相同，但将附加 header 作为数组传递（自 PHP 7.2.0 起可用）。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$to      </span><span style="color: #007700">= </span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$subject </span><span style="color: #007700">= </span><span style="color: #DD0000">'the subject'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$message </span><span style="color: #007700">= </span><span style="color: #DD0000">'hello'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers </span><span style="color: #007700">= array(<br />    </span><span style="color: #DD0000">'From' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'webmaster@example.com'</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'Reply-To' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'webmaster@example.com'</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">'X-Mailer' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'PHP/' </span><span style="color: #007700">. </span><span style="color: #0000BB">phpversion</span><span style="color: #007700">()<br />);<br /><br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">, </span><span style="color: #0000BB">$subject</span><span style="color: #007700">, </span><span style="color: #0000BB">$message</span><span style="color: #007700">, </span><span style="color: #0000BB">$headers</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   <div class="example" id="example-3113">
    <p><strong>Example #4 使用附加命令行参数发送邮件。</strong></p>
    <div class="example-contents"><p>
     The <code class="parameter">additional_params</code> parameter
     can be used to pass an additional parameter to the program configured
     to use when sending mail using the <code class="literal">sendmail_path</code>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />mail</span><span style="color: #007700">(</span><span style="color: #DD0000">'nobody@example.com'</span><span style="color: #007700">, </span><span style="color: #DD0000">'the subject'</span><span style="color: #007700">, </span><span style="color: #DD0000">'the message'</span><span style="color: #007700">, </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />   </span><span style="color: #DD0000">'-fwebmaster@example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   <div class="example" id="example-3114">
    <p><strong>Example #5 Sending HTML email</strong></p>
    <div class="example-contents"><p>
     It is also possible to send HTML email with <span class="function"><strong>mail()</strong></span>.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// Multiple recipients<br /></span><span style="color: #0000BB">$to </span><span style="color: #007700">= </span><span style="color: #DD0000">'johny@example.com, sally@example.com'</span><span style="color: #007700">; </span><span style="color: #FF8000">// note the comma<br /><br />// Subject<br /></span><span style="color: #0000BB">$subject </span><span style="color: #007700">= </span><span style="color: #DD0000">'Birthday Reminders for August'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Message<br /></span><span style="color: #0000BB">$message </span><span style="color: #007700">= </span><span style="color: #DD0000">'<br />&lt;html&gt;<br />&lt;head&gt;<br />  &lt;title&gt;Birthday Reminders for August&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />  &lt;p&gt;Here are the birthdays upcoming in August!&lt;/p&gt;<br />  &lt;table&gt;<br />    &lt;tr&gt;<br />      &lt;th&gt;Person&lt;/th&gt;&lt;th&gt;Day&lt;/th&gt;&lt;th&gt;Month&lt;/th&gt;&lt;th&gt;Year&lt;/th&gt;<br />    &lt;/tr&gt;<br />    &lt;tr&gt;<br />      &lt;td&gt;Johny&lt;/td&gt;&lt;td&gt;10th&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1970&lt;/td&gt;<br />    &lt;/tr&gt;<br />    &lt;tr&gt;<br />      &lt;td&gt;Sally&lt;/td&gt;&lt;td&gt;17th&lt;/td&gt;&lt;td&gt;August&lt;/td&gt;&lt;td&gt;1973&lt;/td&gt;<br />    &lt;/tr&gt;<br />  &lt;/table&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// To send HTML mail, the Content-type header must be set<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'MIME-Version: 1.0'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'Content-type: text/html; charset=iso-8859-1'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Additional headers<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'To: Mary &lt;mary@example.com&gt;, Kelly &lt;kelly@example.com&gt;'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'From: Birthday Reminder &lt;birthday@example.com&gt;'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'Cc: birthdayarchive@example.com'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$headers</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'Bcc: birthdaycheck@example.com'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Mail it<br /></span><span style="color: #0000BB">mail</span><span style="color: #007700">(</span><span style="color: #0000BB">$to</span><span style="color: #007700">, </span><span style="color: #0000BB">$subject</span><span style="color: #007700">, </span><span style="color: #0000BB">$message</span><span style="color: #007700">, </span><span style="color: #0000BB">implode</span><span style="color: #007700">(</span><span style="color: #DD0000">"\r\n"</span><span style="color: #007700">, </span><span style="color: #0000BB">$headers</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>
     <blockquote class="note"><p><strong class="note">Note</strong>: 
      <p class="para">
       If intending to send HTML or otherwise Complex mails, it is recommended
       to use the PEAR package <a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a>.
      </p>
     </p></blockquote>
    </p></div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mail-notes">    
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    The SMTP implementation (Windows only) of <span class="function"><strong>mail()</strong></span> differs in many
    ways from the sendmail implementation. First, it doesn&#039;t use a local binary
    for composing messages but only operates on direct sockets which means a
    <code class="literal">MTA</code> is needed listening on a network socket (which
    can either on the localhost or a remote machine).
   </p>
   <p class="para">
    Second, the custom headers like
    <code class="literal">From:</code>,
    <code class="literal">Cc:</code>,
    <code class="literal">Bcc:</code> and
    <code class="literal">Date:</code> are
    <strong>not</strong> interpreted by the
    <code class="literal">MTA</code> in the first place, but are parsed by PHP.
   </p>
   <p class="para">
    As such, the <code class="parameter">to</code> parameter should not be an address
    in the form of &quot;Something &lt;someone@example.com&gt;&quot;. The
    mail command may not parse this properly while talking with 
    the MTA.
   </p>
  </p></blockquote>
  
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    值得注意的是，<span class="function"><strong>mail()</strong></span> 不适合在循环中发送大量邮件。发送每封邮件，此函数为打开和关闭一个套接字，效率不高。
   </p>
   <p class="para">
    要发送大量邮件，请参阅
    <a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a> 和
    <a href="https://pear.php.net/package/Mail_Queue" class="link external" title="Link : https://pear.php.net/package/Mail_Queue">&raquo;&nbsp;PEAR::Mail_Queue</a> 包。
   </p>
  </p></blockquote>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    以下 RFC 可能有用：
    <a href="http://www.faqs.org/rfcs/rfc1896" class="link external" title="Link : http://www.faqs.org/rfcs/rfc1896">&raquo;&nbsp;RFC 1896</a>、<a href="http://www.faqs.org/rfcs/rfc2045" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2045">&raquo;&nbsp;RFC 2045</a>、
    <a href="http://www.faqs.org/rfcs/rfc2046" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2046">&raquo;&nbsp;RFC 2046</a>、<a href="http://www.faqs.org/rfcs/rfc2047" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2047">&raquo;&nbsp;RFC 2047</a>、
    <a href="http://www.faqs.org/rfcs/rfc2048" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2048">&raquo;&nbsp;RFC 2048</a>、<a href="http://www.faqs.org/rfcs/rfc2049" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2049">&raquo;&nbsp;RFC 2049</a> 和
    <a href="http://www.faqs.org/rfcs/rfc2822" class="link external" title="Link : http://www.faqs.org/rfcs/rfc2822">&raquo;&nbsp;RFC 2822</a>。
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mail-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="function"><a href="function.mb-send-mail.html" class="function" rel="rdfs-seeAlso">mb_send_mail()</a> - 发送编码过的邮件</span></li>
    <li><span class="function"><a href="function.imap-mail.html" class="function" rel="rdfs-seeAlso">imap_mail()</a> - Send an email message</span></li>
    <li><a href="https://pear.php.net/package/Mail" class="link external" title="Link : https://pear.php.net/package/Mail">&raquo;&nbsp;PEAR::Mail</a></li>
    <li><a href="https://pear.php.net/package/Mail_Mime" class="link external" title="Link : https://pear.php.net/package/Mail_Mime">&raquo;&nbsp;PEAR::Mail_Mime</a></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="129090""></a>
  <div class="note">
   <strong class="user">priyanshkala3 at gmail dot com</strong>
   <a href="#129090" class="date">06-Dec-2023 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sending mail using XAMPP server<br />
<br />
I encountered numerous issues while attempting to send emails using the XAMPP server. However, I eventually found the correct method to accomplish it.<br />
<br />
Configuring PHP's mail functionality to work with Gmail's SMTP server involves editing the `php.ini` and `sendmail.ini` configuration files. Below are the formal steps for setting up PHP to send emails through Gmail's SMTP server using XAMPP:<br />
<br />
Configuring php.ini:<br />
<br />
1. Open `php.ini` in an editor:<br />
&nbsp;&nbsp; Open the `php.ini` configuration file in your preferred text editor.<br />
<br />
2. Locate the mail function:<br />
&nbsp;&nbsp; Use the search function (Ctrl + F) to find the section related to the mail function within the `php.ini` file.<br />
<br />
3. Update mail function settings:<br />
&nbsp;&nbsp; Copy and paste the following configuration parameters into the mail function section. Comment out or disable all other settings related to mail.<br />
<br />
&nbsp;&nbsp; php.ini code to be edited:<br />
<br />
&nbsp;&nbsp; SMTP=smtp.gmail.com<br />
&nbsp;&nbsp; smtp_port=587<br />
&nbsp;&nbsp; sendmail_from = yourmail@gmail.com<br />
&nbsp;&nbsp; sendmail_path = write_sendmail.exe_path<br />
&nbsp;&nbsp; <br />
<br />
4. Save the changes:<br />
&nbsp;&nbsp; Save the `php.ini` file after applying the modifications.<br />
<br />
Configuring sendmail.ini (in XAMPP folder):<br />
<br />
1. Open `sendmail.ini` in XAMPP folder:<br />
&nbsp;&nbsp; Locate and open the `sendmail.ini` configuration file within the XAMPP directory.<br />
<br />
2. Adjust SMTP settings:<br />
&nbsp;&nbsp; Insert the following content into the `sendmail.ini` file, marking other configurations as comments:<br />
<br />
&nbsp;&nbsp; sendmail.ini code :<br />
<br />
&nbsp;&nbsp; smtp_server=smtp.gmail.com<br />
&nbsp;&nbsp; smtp_port=587<br />
&nbsp;&nbsp; error_logfile=error.log<br />
&nbsp;&nbsp; debug_logfile=debug.log<br />
&nbsp;&nbsp; auth_username=yourmail@gmail.com<br />
auth_password=app_password_after_enabling_two_factor_authentication_for_your_mail_id<br />
&nbsp;&nbsp; force_sender=priyansh.kala.4@gmail.com<br />
&nbsp;&nbsp; <br />
<br />
3. Save the changes:<br />
&nbsp;&nbsp; Save the `sendmail.ini` file after inserting the specified configurations.<br />
<br />
These steps configure PHP to utilize Gmail's SMTP server for sending emails. Ensure that the modifications are saved and that the necessary XAMPP services are restarted for the changes to take effect.<br />
<br />
Please note that using hardcoded passwords in configuration files poses a security risk. Storing passwords directly in plain text files should be avoided in production environments. Consider using environment variables or secure credential management systems for better security practices.<br />
<br />
Code for sending mail-:<br />
<br />
<span class="default">&lt;?php<br />
$subject </span><span class="keyword">= </span><span class="string">"Mail for checking"</span><span class="keyword">;<br />
</span><span class="default">$msg </span><span class="keyword">= </span><span class="string">"Hey! Let us play with PHP."</span><span class="keyword">;<br />
</span><span class="default">$receiver </span><span class="keyword">= </span><span class="string">"reciever@gmail.com"</span><span class="keyword">;<br />
</span><span class="default">mail</span><span class="keyword">(</span><span class="default">$receiver</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$msg</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128324""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#128324" class="date">20-Mar-2023 12:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
So far I used the following to make sure special charakters where correctly shown in the mail subject:<br />
<br />
<span class="default">&lt;?php $subject </span><span class="keyword">= </span><span class="string">'=?utf-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">) . </span><span class="string">'?='</span><span class="keyword">; </span><span class="default">?&gt;<br />
</span><br />
But with very long subjects, the header line gets longer than 76 chars and some e-mail servers really don't like that... So this is my new solution:<br />
<br />
<span class="default">&lt;?php $subject </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">mb_encode_mimeheader</span><span class="keyword">(</span><span class="string">"Subject: " </span><span class="keyword">. </span><span class="default">$subject</span><span class="keyword">, </span><span class="string">'utf-8'</span><span class="keyword">, </span><span class="string">'B'</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">), </span><span class="default">9</span><span class="keyword">); </span><span class="default">?&gt;<br />
</span><br />
Please note: I added "Subject: " in front of $subject and stripped it of afterwards. This is to make sure, that the necessarry space is reserved, as PHP will add the "Subject: " itself...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128240""></a>
  <div class="note">
   <strong class="user">imme_emosol</strong>
   <a href="#128240" class="date">22-Feb-2023 08:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also see chunk_split (as "alternative" to wordwrap).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="128151""></a>
  <div class="note">
   <strong class="user">atesin &gt; gmail</strong>
   <a href="#128151" class="date">26-Jan-2023 12:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mail() internals:<br />
<br />
doing some tests i can say... if sendmail_path is defined in php.ini or by ini.set(), by calling function like...<br />
<br />
mail($to, $subject, $message, $headers, $params)<br />
<br />
would be like if php open a shell internally, execute this command, send this text to stdin, and return true if return value == 0<br />
<br />
------------<br />
shell&gt; $sendmail_path $params<br />
To: $to<br />
Subject: $subject<br />
$headers<br />
<br />
$message<br />
(EOF)<br />
------------<br />
<br />
in windows instead using php smtp which is very limited, i prefer to force use sendmail-like behavior, by setting sendmail_path and then use msmtp for windows</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="127880""></a>
  <div class="note">
   <strong class="user">andrew at my-syte dot com</strong>
   <a href="#127880" class="date">31-Oct-2022 02:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding To: <br />
<br />
be careful not to duplicate To in the additional_headers, <br />
<br />
lest gmail already flags it thus:<br />
<br />
host gmail-smtp-in.l.google.com [142.251.xx.xx]<br />
SMTP error from remote mail server after end of data:<br />
550-5.7.1 [xxx.xxx.xx.xx] This message is not RFC 5322 compliant, the issue is:<br />
550-5.7.1 duplicate To headers. To reduce the amount of spam sent to Gmail,<br />
550-5.7.1 this message has been blocked. Please review<br />
550 5.7.1 RFC 5322 specifications for more information.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="125168""></a>
  <div class="note">
   <strong class="user">pangz dot lab at gmail dot com</strong>
   <a href="#125168" class="date">06-Jul-2020 08:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
* Sending email with attachment<br />
<br />
function sendMail(<br />
&nbsp;&nbsp;&nbsp; string $fileAttachment,<br />
&nbsp;&nbsp;&nbsp; string $mailMessage = MAIL_CONF["mailMessage"],<br />
&nbsp;&nbsp;&nbsp; string $subject&nbsp; &nbsp;&nbsp; = MAIL_CONF["subject"],<br />
&nbsp;&nbsp;&nbsp; string $toAddress&nbsp;&nbsp; = MAIL_CONF["toAddress"],<br />
&nbsp;&nbsp;&nbsp; string $fromMail&nbsp; &nbsp; = MAIL_CONF["fromMail"]<br />
): bool {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $fileAttachment = trim($fileAttachment);<br />
&nbsp;&nbsp;&nbsp; $from&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; = $fromMail;<br />
&nbsp;&nbsp;&nbsp; $pathInfo&nbsp; &nbsp; &nbsp;&nbsp; = pathinfo($fileAttachment);<br />
&nbsp;&nbsp;&nbsp; $attchmentName&nbsp; = "attachment_".date("YmdHms").(<br />
&nbsp;&nbsp;&nbsp; (isset($pathInfo['extension']))? ".".$pathInfo['extension'] : ""<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $attachment&nbsp; &nbsp; = chunk_split(base64_encode(file_get_contents($fileAttachment)));<br />
&nbsp;&nbsp;&nbsp; $boundary&nbsp; &nbsp; &nbsp; = "PHP-mixed-".md5(time());<br />
&nbsp;&nbsp;&nbsp; $boundWithPre&nbsp; = "\n--".$boundary;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $headers&nbsp;&nbsp; = "From: $from";<br />
&nbsp;&nbsp;&nbsp; $headers&nbsp; .= "\nReply-To: $from";<br />
&nbsp;&nbsp;&nbsp; $headers&nbsp; .= "\nContent-Type: multipart/mixed; boundary=\"".$boundary."\"";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $message&nbsp;&nbsp; = $boundWithPre;<br />
&nbsp;&nbsp;&nbsp; $message&nbsp; .= "\n Content-Type: text/plain; CHARSET=gb2312\n";<br />
&nbsp;&nbsp;&nbsp; $message&nbsp; .= "\n $mailMessage";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $message .= $boundWithPre;<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Type: application/octet-stream; name=\"".$attchmentName."\"";<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Transfer-Encoding: base64\n";<br />
&nbsp;&nbsp;&nbsp; $message .= "\nContent-Disposition: attachment\n";<br />
&nbsp;&nbsp;&nbsp; $message .= $attachment;<br />
&nbsp;&nbsp;&nbsp; $message .= $boundWithPre."--";<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return mail($toAddress, $subject, $message, $headers);<br />
}<br />
<br />
* Sending email in html<br />
<br />
function sendHtmlMail(<br />
&nbsp;&nbsp;&nbsp; string $mailMessage = MAIL_CONF["mailMessage"],<br />
&nbsp;&nbsp;&nbsp; string $subject&nbsp; &nbsp;&nbsp; = MAIL_CONF["subject"],<br />
&nbsp;&nbsp;&nbsp; array $toAddress&nbsp; &nbsp; = MAIL_CONF["toAddress"],<br />
&nbsp;&nbsp;&nbsp; string $fromMail&nbsp; &nbsp; = MAIL_CONF["fromMail"]<br />
): bool {<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; $to&nbsp; &nbsp; &nbsp; &nbsp; = implode(",", $toAddress);<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'MIME-Version: 1.0';<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'Content-type: text/html; charset=iso-8859-1';&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; $headers[] = 'To: '.$to;<br />
&nbsp;&nbsp;&nbsp; $headers[] = 'From: '.$fromMail;&nbsp; &nbsp; <br />
<br />
&nbsp;&nbsp;&nbsp; return mail($to, $subject, $mailMessage, implode("\r\n", $headers));<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124291""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#124291" class="date">12-Oct-2019 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you notice wrong displayed characters in the email it's because you need to properly set the Content-Type and the Charset in the headers of the email:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">= </span><span class="string">'Content-Type: text/plain; CHARSET=gb2312' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Mostly, UTF-8 is your best choice.<br />
<br />
You can set custom headers with the fourth parameter of the mail() function.<br />
<br />
To make the whole thing waterproof, add the following header too:<br />
<br />
<span class="default">&lt;?php<br />
$headers </span><span class="keyword">.= </span><span class="string">'Content-Transfer-Encoding: base64' </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Now you can use the combination of UTF-8 and Base64 to properly encode the subject line and the recipient name like this:<br />
<br />
<span class="default">&lt;?php<br />
$subject </span><span class="keyword">= </span><span class="string">'=?UTF-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'Test email with German Umlauts ??ü?'</span><span class="keyword">) . </span><span class="string">'?='</span><span class="keyword">;<br />
</span><span class="default">$recipient </span><span class="keyword">= </span><span class="string">'=?UTF-8?B?' </span><span class="keyword">. </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'Margret Müller'</span><span class="keyword">) . </span><span class="string">'?= &lt;recipient@domain.com&gt;'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
And don't forget to Base64 encode the email message too:<br />
<br />
<span class="default">&lt;?php<br />
$message </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="string">'This email contains German Umlauts ??ü?.'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
All references are taken from:<br />
https://dev.to/lutvit/how-to-make-the-php-mail-function-awesome-3cii</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="124015""></a>
  <div class="note">
   <strong class="user">Mark Simon</strong>
   <a href="#124015" class="date">05-Jul-2019 07:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is worth noting that you can set up a fake sendmail program using the sendmail_path directive in php.ini.<br />
<br />
Despite the comment in that file, sendmail_path also works for Window. From https://www.php.net/manual/en/mail.configuration.php#ini.sendmail-path:<br />
<br />
This directive works also under Windows. If set, smtp, smtp_port and sendmail_from are ignored and the specified command is executed.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121858""></a>
  <div class="note">
   <strong class="user">charles dot fisher at arconic dot com</strong>
   <a href="#121858" class="date">10-Nov-2017 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I migrated an application to a platform without a local transport agent (MTA). I did not want to configure an MTA, so I wrote this xxmail function to replace mail() with calls to a remote SMTP server. Hopefully it is of some use.<br />
<br />
function xxmail($to, $subject, $body, $headers)<br />
{<br />
&nbsp;$smtp = stream_socket_client('tcp://smtp.yourmail.com:25', $eno, $estr, 30);<br />
<br />
&nbsp;$B = 8192;<br />
&nbsp;$c = "\r\n";<br />
&nbsp;$s = 'myapp@someserver.com';<br />
<br />
&nbsp;fwrite($smtp, 'helo ' . $_ENV['HOSTNAME'] . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Envelope<br />
&nbsp;fwrite($smtp, 'mail from: ' . $s . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fwrite($smtp, 'rcpt to: ' . $to . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fwrite($smtp, 'data' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Header <br />
&nbsp;fwrite($smtp, 'To: ' . $to . $c); <br />
&nbsp;if(strlen($subject)) fwrite($smtp, 'Subject: ' . $subject . $c); <br />
&nbsp;if(strlen($headers)) fwrite($smtp, $headers); // Must be \r\n (delimited)<br />
&nbsp;fwrite($smtp, $headers . $c); <br />
<br />
&nbsp;// Body<br />
&nbsp;if(strlen($body)) fwrite($smtp, $body . $c); <br />
&nbsp;fwrite($smtp, $c . '.' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
<br />
&nbsp;// Close<br />
&nbsp;fwrite($smtp, 'quit' . $c);<br />
&nbsp; $junk = fgets($smtp, $B);<br />
&nbsp;fclose($smtp);<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121411""></a>
  <div class="note">
   <strong class="user">eeeugeneee</strong>
   <a href="#121411" class="date">21-Jul-2017 01:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Send mail with minimal requirements from email services.<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $encoding </span><span class="keyword">= </span><span class="string">"utf-8"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Preferences for Subject field<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$subject_preferences </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"input-charset" </span><span class="keyword">=&gt; </span><span class="default">$encoding</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"output-charset" </span><span class="keyword">=&gt; </span><span class="default">$encoding</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"line-length" </span><span class="keyword">=&gt; </span><span class="default">76</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"line-break-chars" </span><span class="keyword">=&gt; </span><span class="string">"\r\n"<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Mail header<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">= </span><span class="string">"Content-type: text/html; charset="</span><span class="keyword">.</span><span class="default">$encoding</span><span class="keyword">.</span><span class="string">" \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"From: "</span><span class="keyword">.</span><span class="default">$from_name</span><span class="keyword">.</span><span class="string">" &lt;"</span><span class="keyword">.</span><span class="default">$from_mail</span><span class="keyword">.</span><span class="string">"&gt; \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"MIME-Version: 1.0 \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Content-Transfer-Encoding: 8bit \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="string">"Date: "</span><span class="keyword">.</span><span class="default">date</span><span class="keyword">(</span><span class="string">"r (T)"</span><span class="keyword">).</span><span class="string">" \r\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$header </span><span class="keyword">.= </span><span class="default">iconv_mime_encode</span><span class="keyword">(</span><span class="string">"Subject"</span><span class="keyword">, </span><span class="default">$mail_subject</span><span class="keyword">, </span><span class="default">$subject_preferences</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Send mail<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$mail_to</span><span class="keyword">, </span><span class="default">$mail_subject</span><span class="keyword">, </span><span class="default">$mail_message</span><span class="keyword">, </span><span class="default">$header</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121163""></a>
  <div class="note">
   <strong class="user">php at simoneast dot net</strong>
   <a href="#121163" class="date">31-May-2017 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Often it's helpful to find the exact error message that is triggered by the mail() function. While the function doesn't provide an error directly, you can use error_get_last() when mail() returns false.<br />
<br />
<span class="default">&lt;?php<br />
$success </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="string">'example@example.com'</span><span class="keyword">, </span><span class="string">'My Subject'</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">);<br />
if (!</span><span class="default">$success</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$errorMessage </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()[</span><span class="string">'message'</span><span class="keyword">];<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
(Tested successfully on Windows which uses SMTP by default, but sendmail on Linux/OSX may not provide the same level of detail.)<br />
<br />
Thanks to https://stackoverflow.com/a/20203870/195835</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121027""></a>
  <div class="note">
   <strong class="user">chris at ocproducts dot com</strong>
   <a href="#121027" class="date">26-Apr-2017 10:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The 'sendmail' executable which PHP uses on Linux/Mac (not Windows) expects "\n" as a line separator.<br />
<br />
This executable is a standard, and emulated by other MTAs.<br />
<br />
"\n" is confirmed required for qmail and postfix, probably also for sendmail and exim but I have not tested.<br />
<br />
If you pass through using "\r\n" as a separator it may appear to work, but your email will be subtly corrupted and some middleware may break. It only works because some systems will clean up your mistake.<br />
<br />
If you are implementing DKIM be very careful, as DKIM checks will fail (at least on popular validation tools) if you screw this up. DKIM must be calculated using "\r\n" but then you must switch it all to "\n" when using the PHP mail function.<br />
<br />
On Windows, however, you should use "\r\n" because PHP is using SMTP in this situation, and hence the normal rules of the SMTP protocol (not the normal rules of Unix piping) apply.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120328""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120328" class="date">14-Dec-2016 10:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Security advice: Although it is not documented, for the parameters $to and $subject the mail() function changes at least \r and \n to space. So these parameters are safe against injection of additional headers. But you might want to check $to for commas as these separate multiple addresses and you might not want to send to more than one recipient.<br />
<br />
The crucial part is the $additional_headers parameter. This parameter can't be cleaned by the mail() function. So it is up to you to prevent unwanted \r or \n to be inserted into the values you put in there. Otherwise you just created a potential spam distributor.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108669""></a>
  <div class="note">
   <strong class="user">pavel.lint at vk.com</strong>
   <a href="#108669" class="date">16-May-2012 11:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a small handy function I use to send email in UTF-8.<br />
<br />
&nbsp;<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mail_utf8</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$from_user</span><span class="keyword">, </span><span class="default">$from_email</span><span class="keyword">, <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">'(No subject)'</span><span class="keyword">, </span><span class="default">$message </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">)<br />
&nbsp;&nbsp; { <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$from_user </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$from_user</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$subject </span><span class="keyword">= </span><span class="string">"=?UTF-8?B?"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$subject</span><span class="keyword">).</span><span class="string">"?="</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">= </span><span class="string">"From: </span><span class="default">$from_user</span><span class="string"> &lt;</span><span class="default">$from_email</span><span class="string">&gt;\r\n"</span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"MIME-Version: 1.0" </span><span class="keyword">. </span><span class="string">"\r\n" </span><span class="keyword">. <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="string">"Content-type: text/html; CHARSET=gb2312" </span><span class="keyword">. </span><span class="string">"\r\n"</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp; &nbsp; return </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">); <br />
&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108498""></a>
  <div class="note">
   <strong class="user">rexlorenzo at gmail dot com</strong>
   <a href="#108498" class="date">02-May-2012 01:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful to not put extra spaces for the $headers variable.<br />
<br />
For example, this didn't work on our servers:<br />
<br />
$headers = "From: $from \r\n Bcc: $bcc \r\n";<br />
<br />
But this did:<br />
<br />
$headers = "From: $from\r\nBcc: $bcc\r\n";<br />
<br />
Notice the removal of the spaces around the first \r\n.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107524""></a>
  <div class="note">
   <strong class="user">Max AT</strong>
   <a href="#107524" class="date">15-Feb-2012 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To define a mail sensitivity you have to put this line in the headers:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $headers </span><span class="keyword">= </span><span class="string">"MIME-Version: 1.0\n" </span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Content-Type: text/html; charset=\"iso-8859-1\"\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$headers </span><span class="keyword">.= </span><span class="string">"Sensitivity: Personal\n"</span><span class="keyword">;<br />
<br />
&nbsp;</span><span class="default">$status&nbsp;&nbsp; </span><span class="keyword">= </span><span class="default">mail</span><span class="keyword">(</span><span class="default">$to</span><span class="keyword">, </span><span class="default">$subject</span><span class="keyword">, </span><span class="default">$message</span><span class="keyword">,</span><span class="default">$headers</span><span class="keyword">);<br />
</span><span class="default">?&gt;</span> <br />
<br />
Possible Options:<br />
Sensitivity: Normal, Personal, Private and Company-Confidential<br />
<br />
These will be recognised and handled in Outlook, Thunderbird and others.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107321""></a>
  <div class="note">
   <strong class="user">ABOMB</strong>
   <a href="#107321" class="date">30-Jan-2012 10:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I was having delivery issues from this function to Gmail, Yahoo, AOL, etc.&nbsp; I used the notes here to figure that you need to be setting your Return-Path to a valid email to catch bounces.&nbsp; There are two extra delivery gotchas on top of that:<br />
<br />
1) The domain in the email used in the -f option in the php.ini sendmail parameter or in the mail() extra parameters field, needs to have a valid SPF record for the domain (in DNS as a "TXT" record type for sure and add an additional&nbsp; "SPF" type record if possible).&nbsp; Why? That's header field being used for spam checks.<br />
<br />
2) You should also use a domain key or DKIM.&nbsp; The trick here is that the domain key/DKIM is case sensitive!&nbsp; I used Cpanel to create my domain key which automatically used all lowercase domain names in the key creation.&nbsp; I found when&nbsp; sending email and using a camel case "-f account@MyDomainHere.Com" option, my key was not accepted.&nbsp; However it was accepted when I used "-f account@mydomainhere.com".<br />
<br />
There are many other factors that can contribute to mail not getting to inboxes, including your own multiple failed testing attempts, so I suggest you consult each site's guidelines and don't ask me for help.&nbsp; These are just the couple technical issues that helped my case.<br />
<br />
I hope this saves someone some time and headaches...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="98775""></a>
  <div class="note">
   <strong class="user">Porjo</strong>
   <a href="#98775" class="date">06-Jul-2010 11:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Make sure you enclose \r\n in double quotes (not single quotes!) so that PHP can translate that into the correct linefeed code</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59773""></a>
  <div class="note">
   <strong class="user">Ben Cooke</strong>
   <a href="#59773" class="date">15-Dec-2005 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that there is a big difference between the behavior of this function on Windows systems vs. UNIX systems. On Windows it delivers directly to an SMTP server, while on a UNIX system it uses a local command to hand off to the system's own MTA.
<br />

<br />
The upshot of all this is that on a Windows system your&nbsp; message and headers must use the standard line endings \r\n as prescribed by the email specs. On a UNIX system the MTA's "sendmail" interface assumes that recieved data will use UNIX line endings and will turn any \n to \r\n, so you must supply only \n to mail() on a UNIX system to avoid the MTA hypercorrecting to \r\r\n.
<br />

<br />
If you use plain old \n on a Windows system, some MTAs will get a little upset. qmail in particular will refuse outright to accept any message that has a lonely \n without an accompanying \r.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="50544""></a>
  <div class="note">
   <strong class="user">php dot net at schrecktech dot com</strong>
   <a href="#50544" class="date">02-Mar-2005 04:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When sending MIME email make sure you follow the documentation with the "70" characters per line...you may end up with missing characters...and that is really hard to track down...</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
