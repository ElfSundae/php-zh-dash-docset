<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>初始化 cURL 会话</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.curl-getinfo.html">? curl_getinfo</a></li>
      <li style="float: right;"><a href="function.curl-multi-add-handle.html">curl_multi_add_handle ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.curl.html">cURL 函数</a></li>
    <li>初始化 cURL 会话</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.curl-init" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">curl_init</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.2, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">curl_init</span> &mdash; <span class="dc-title">初始化 cURL 会话</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.curl-init-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>curl_init</strong></span>
    ([ <span class="methodparam"><span class="type">string</span> <code class="parameter">$url</code><span class="initializer"> = <strong><code>NULL</code></strong></span></span>
  ] ) : <span class="type">resource</span></div>

  <p class="para rdfs-comment">
   初始化新的会话，返回 cURL 句柄，供<span class="function"><a href="function.curl-setopt.html" class="function">curl_setopt()</a></span>、 <span class="function"><a href="function.curl-exec.html" class="function">curl_exec()</a></span> 和 <span class="function"><a href="function.curl-close.html" class="function">curl_close()</a></span> 函数使用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.curl-init-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">url</code></dt>

     <dd>

      <p class="para">
       如果提供了该参数，<strong><code>CURLOPT_URL</code></strong> 选项将会被设置成这个值。你也可以使用<span class="function"><a href="function.curl-setopt.html" class="function">curl_setopt()</a></span>函数手动地设置这个值。
      </p>
      <blockquote class="note"><p><strong class="note">Note</strong>: 
       <p class="para">
        如果设置了 <a href="ini.core.html#ini.open-basedir" class="link">open_basedir</a>，<em>file</em> 协议会被 cURL 禁用。
       </p>
      </p></blockquote>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.curl-init-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果成功，返回 cURL 句柄，出错返回 <strong><code>FALSE</code></strong>。
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.curl-init-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5287">
    <p><strong>Example #1 
     初始化新的 cURL 会话并获取一个网页
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;创建一个新cURL资源<br /></span><span style="color: #0000BB">$ch&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">curl_init</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;设置URL和相应的选项<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_URL</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"http://www.example.com/"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">curl_setopt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">CURLOPT_HEADER</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;抓取URL并把它传递给浏览器<br /></span><span style="color: #0000BB">curl_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;关闭cURL资源，并且释放系统资源<br /></span><span style="color: #0000BB">curl_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$ch</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.curl-init-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.curl-close.html" class="function" rel="rdfs-seeAlso">curl_close()</a> - 关闭 cURL 会话</span></li>
    <li class="member"><span class="function"><a href="function.curl-multi-init.html" class="function" rel="rdfs-seeAlso">curl_multi_init()</a> - 返回一个新cURL批处理句柄</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117517""></a>
  <div class="note">
   <strong class="user">ageesen at videro dot com</strong>
   <a href="#117517" class="date">23-Jun-2015 11:59</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Curl_init as well as CURLOPT_URL don't like to have static strings as parameter.<br />
<br />
I came across this by accident and it took me very long to find out. curl_exec will throw error 3 (Malformed) and you tipple check the URL in it's variable only to find by trial and error that it's declaration is the culprit.<br />
So never do this:<br />
<br />
static $someurl = "<a href="http://www.example.com/interfacce.php" rel="nofollow" target="_blank">http://www.example.com/interfacce.php</a>";<br />
....<br />
$ch=curl_init($someurl);<br />
....<br />
$return=curl_exec($ch);<br />
<br />
Cheers</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116794""></a>
  <div class="note">
   <strong class="user">Tugrul</strong>
   <a href="#116794" class="date">01-Mar-2015 07:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php <br />
</span><span class="keyword">function </span><span class="default">curl</span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">,</span><span class="default">$posts</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">){<br />
</span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init</span><span class="keyword">();<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_URL</span><span class="keyword">, </span><span class="default">$url</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_HEADER</span><span class="keyword">, </span><span class="string">"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; .NET CLR 1.1.4322)"</span><span class="keyword">);<br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POST</span><span class="keyword">, </span><span class="default">$posts </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">:</span><span class="default">1</span><span class="keyword">;); <br />
</span><span class="default">curl_setopt</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_POSTFIELDS</span><span class="keyword">,</span><span class="default">$posts</span><span class="keyword">);<br />
</span><span class="default">$icerik </span><span class="keyword">= </span><span class="default">curl_exec</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
return </span><span class="default">$icerik</span><span class="keyword">;<br />
</span><span class="default">curl_close</span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">);<br />
} <br />
</span><span class="comment">/*Bu fonksiyonu kullanarak kolayca curl yi kullanabilirsiniz.<br />
Kullan?m?*/<br />
</span><span class="keyword">echo </span><span class="default">curl</span><span class="keyword">(</span><span class="string">"<a href="http://gencbilgin.net/" rel="nofollow" target="_blank">http://gencbilgin.net/</a>"</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Bu kodlar <a href="http://gencbilgin.net/curl-kutuphanesi-ve-kullanimi.html adresinden al?nm??t?r..." rel="nofollow" target="_blank">http://gencbilgin.net/curl-kutuphanesi-ve-kullanimi.html adresinden al?nm??t?r...</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112841""></a>
  <div class="note">
   <strong class="user">James P</strong>
   <a href="#112841" class="date">29-Jul-2013 01:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Regarding spaces in URLs;<br />
Please read<br />
<a href="http://php.net/manual/en/function.urlencode.php" rel="nofollow" target="_blank">http://php.net/manual/en/function.urlencode.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101233""></a>
  <div class="note">
   <strong class="user">jharris at et2brut dot us</strong>
   <a href="#101233" class="date">03-Dec-2010 02:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to clarify:<br />
<br />
Spaces in the URL need to be replaced with a %20.<br />
<br />
Spaces in the querystring need to be replaced with a +</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78746""></a>
  <div class="note">
   <strong class="user">rossixx at gmx dot net</strong>
   <a href="#78746" class="date">25-Oct-2007 09:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
e.g. you can check how many characters are on test_1.php<br />
<br />
or you can it use for more, i have used this function for a nagios check.<br />
<br />
<span class="default">&lt;?PHP<br />
</span><span class="keyword">echo </span><span class="string">"CURL - function test &lt;br&gt;" </span><span class="keyword">;<br />
if (</span><span class="default">$load </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">){<br />
function </span><span class="default">webcheck </span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ch </span><span class="keyword">= </span><span class="default">curl_init </span><span class="keyword">(</span><span class="default">$url</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_setopt </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">, </span><span class="default">CURLOPT_RETURNTRANSFER</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="default">curl_exec </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">curl_close </span><span class="keyword">(</span><span class="default">$ch</span><span class="keyword">) ;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$res</span><span class="keyword">) ;<br />
}<br />
echo </span><span class="string">"url = </span><span class="default">$url</span><span class="string"> &lt;br&gt;" </span><span class="keyword">;<br />
<br />
</span><span class="default">$erg </span><span class="keyword">= </span><span class="default">webcheck</span><span class="keyword">(</span><span class="string">"my_page.php/test_1.php"</span><span class="keyword">) ;<br />
</span><span class="default">$zahl </span><span class="keyword">= </span><span class="default">strlen </span><span class="keyword">(</span><span class="default">$erg</span><span class="keyword">) ;<br />
echo </span><span class="string">"length = </span><span class="default">$zahl</span><span class="string"> " </span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78700""></a>
  <div class="note">
   <strong class="user">ezyang at php dot net</strong>
   <a href="#78700" class="date">23-Oct-2007 07:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
curl_init() has undefined behavior if you pass 'false' to it and can crash when you try to copy the resulting handle using curl_copy_handle(). Keep this in mind if you create a wrapper object for CURL.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66523""></a>
  <div class="note">
   <strong class="user">darkstar_ae at hotmail dot com</strong>
   <a href="#66523" class="date">24-May-2006 08:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For some reason on some webservers it may not be able to understand what cURL is doing. If you're getting unexpected results (like getting no output when the URL is valid) while using curl_init(). Add a trailing slash '/' after the url if you haven't done so already.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
