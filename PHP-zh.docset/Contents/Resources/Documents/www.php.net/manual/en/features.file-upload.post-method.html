<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>POST 方法上传</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="features.file-upload.html">? 文件上传处理</a></li>
      <li style="float: right;"><a href="features.file-upload.errors.html">错误信息说明 ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="features.file-upload.html">文件上传处理</a></li>
    <li>POST 方法上传</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="features.file-upload.post-method" class="sect1">
  <h2 class="title">POST 方法上传</h2>
  <p class="simpara">
   本特性可以使用户上传文本和二进制文件。用 PHP
   的认证和文件操作函数，可以完全控制允许哪些人上传以及文件上传后怎样处理。
  </p>
  <p class="simpara">
   PHP 能够接受任何来自符合 RFC-1867 标准的浏览器上传的文件。
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <strong>相关的设置</strong><br />
   <p class="para">
    请参阅 <var class="filename">php.ini</var> 的 <a href="ini.core.html#ini.file-uploads" class="link">file_uploads</a>，<a href="ini.core.html#ini.upload-max-filesize" class="link">upload_max_filesize</a>，<a href="ini.core.html#ini.upload-tmp-dir" class="link">upload_tmp_dir</a><a href="ini.core.html#ini.post-max-size" class="link">post_max_size</a>
    以及 <a href="info.configuration.html#ini.max-input-time" class="link">max_input_time</a> 设置选项。
   </p>
  </p></blockquote>

  <p class="para">
   请注意 PHP 也支持 PUT 方法的文件上传，<span class="productname">Netscape Composer</span>
   和 W3C 的 <span class="productname">Amaya</span> 客户端使用这种方法。请参阅<a href="features.file-upload.put-method.html" class="link">对 PUT 方法的支持</a>以获取更多信息。
  </p>
  <p class="para">
   <div class="example" id="example-400">
    <p><strong>Example #1 文件上传表单</strong></p>
    <div class="example-contents"><p>
     可以如下建立一个特殊的表单来支持文件上传：
    </p></div>
    <div class="example-contents">
<div class="htmlcode"><pre class="htmlcode">&lt;!-- The data encoding type, enctype, MUST be specified as below --&gt;
&lt;form enctype=&quot;multipart/form-data&quot; action=&quot;__URL__&quot; method=&quot;POST&quot;&gt;
    &lt;!-- MAX_FILE_SIZE must precede the file input field --&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;30000&quot; /&gt;
    &lt;!-- Name of input element determines name in $_FILES array --&gt;
    Send this file: &lt;input name=&quot;userfile&quot; type=&quot;file&quot; /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;Send File&quot; /&gt;
&lt;/form&gt;</pre>
</div>
    </div>

    <div class="example-contents"><p>
     以上范例中的 <code class="literal">__URL__</code> 应该被换掉，指向一个真实的 PHP 文件。
    </p></div>
    <div class="example-contents"><p>
     <code class="literal">MAX_FILE_SIZE</code>
     隐藏字段（单位为字节）必须放在文件输入字段之前，其值为接收文件的最大尺寸。这是对浏览器的一个建议，PHP
     也会检查此项。在浏览器端可以简单绕过此设置，因此不要指望用此特性来阻挡大文件。实际上，PHP
     设置中的上传文件最大值是不会失效的。但是最好还是在表单中加上此项目，因为它可以避免用户在花时间等待上传大文件之后才发现文件过大上传失败的麻烦。
    </p></div>
   </div>
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    要确保文件上传表单的属性是
    <code class="literal">enctype=&quot;multipart/form-data&quot;</code>，否则文件上传不了。
   </p>
  </p></blockquote>

  <p class="para">
   全局变量 <var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES</a></var> 包含有所有上传的文件信息。
   数组的内容来自以下范例表单。我们假设文件上传字段的名称如下例所示，为
   <em class="emphasis">userfile</em>。名称可随意命名。
   <dl>

    
     <dt>
<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['name']</a></var></dt>

     <dd>

      <p class="para">
       客户端机器文件的原名称。
      </p>
     </dd>

    
    
     <dt>
<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['type']</a></var></dt>

     <dd>

      <p class="para">
       文件的 MIME 类型，如果浏览器提供此信息的话。一个例子是"<code class="literal">image/gif</code>"。不过此
       MIME 类型在 PHP 端并不检查，因此不要想当然认为有这个值。
       </p>
     </dd>

    
    
     <dt>
<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var></dt>

     <dd>

      <p class="para">
       已上传文件的大小，单位为字节。
      </p>
     </dd>

    
    
     <dt>
<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['tmp_name']</a></var></dt>

     <dd>

      <p class="para">
       文件被上传后在服务端储存的临时文件名。
      </p>
     </dd>

    
    
     <dt>
<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['error']</a></var></dt>

     <dd>

      <p class="para">
       和该文件上传相关的<a href="features.file-upload.errors.html" class="link">错误代码</a>。
      </p>
     </dd>

    
   </dl>

  </p>

  <p class="para">
   文件被上传后，默认地会被储存到服务端的默认临时目录中，除非
   <var class="filename">php.ini</var> 中的 <a href="ini.core.html#ini.upload-tmp-dir" class="link">upload_tmp_dir</a>
   设置为其它的路径。服务端的默认临时目录可以通过更改 PHP
   运行环境的环境变量 <var class="envar">TMPDIR</var> 来重新设置，但是在
   PHP 脚本内部通过运行 <span class="function"><a href="function.putenv.html" class="function">putenv()</a></span>
   函数来设置是不起作用的。该环境变量也可以用来确认其它的操作也是在上传的文件上进行的。
   <div class="example" id="example-401">
    <p><strong>Example #2 验证上传的文件</strong></p>
    <div class="example-contents"><p>
    请查阅函数 <span class="function"><a href="function.is-uploaded-file.html" class="function">is_uploaded_file()</a></span> 和
     <span class="function"><a href="function.move-uploaded-file.html" class="function">move_uploaded_file()</a></span> 以获取进一步的信息。
     以下范例处理由表单提供的文件上传。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$uploaddir&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'/var/www/uploads/'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$uploadfile&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$uploaddir&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">basename</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'userfile'</span><span style="color: #007700">][</span><span style="color: #DD0000">'name'</span><span style="color: #007700">]);<br /><br />echo&nbsp;</span><span style="color: #DD0000">'&lt;pre&gt;'</span><span style="color: #007700">;<br />if&nbsp;(</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">'userfile'</span><span style="color: #007700">][</span><span style="color: #DD0000">'tmp_name'</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$uploadfile</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"File&nbsp;is&nbsp;valid,&nbsp;and&nbsp;was&nbsp;successfully&nbsp;uploaded.\n"</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"Possible&nbsp;file&nbsp;upload&nbsp;attack!\n"</span><span style="color: #007700">;<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">'Here&nbsp;is&nbsp;some&nbsp;more&nbsp;debugging&nbsp;info:'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">);<br /><br />print&nbsp;</span><span style="color: #DD0000">"&lt;/pre&gt;"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="simpara">
   接受上传文件的 PHP
   脚本为了决定接下来要对该文件进行哪些操作，应该实现任何逻辑上必要的检查。例如可以用
   <var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var>
   变量来排除过大或过小的文件，也可以通过
   <var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['type']</a></var>
   变量来排除文件类型和某种标准不相符合的文件，但只把这个当作一系列检查中的第一步，因为此值完全由客户端控制而在
   PHP 端并不检查。同时，还可以通过
   <var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['error']</a></var> 变量来根据不同的<a href="features.file-upload.errors.html" class="link">错误代码</a>来计划下一步如何处理。不管怎样，要么将该文件从临时目录中删除，要么将其移动到其它的地方。
  </p>
  <p class="simpara">
   如果表单中没有选择上传的文件，则 PHP 变量
   <var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['size']</a></var> 的值将为
   0，<var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES['userfile']['tmp_name']</a></var> 将为空。
  </p>
  <p class="simpara">
   如果该文件没有被移动到其它地方也没有被改名，则该文件将在表单请求结束时被删除。
  </p>

  <div class="example" id="example-402">
   <p><strong>Example #3 上传一组文件</strong></p>
   <div class="example-contents"><p>
    PHP 的 <a href="faq.html.html#faq.html.arrays" class="link">HTML 数组特性</a>甚至支持文件类型。
   </p></div>
   <div class="example-contents">
<div class="htmlcode"><pre class="htmlcode">&lt;form action=&quot;&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
&lt;p&gt;Pictures:
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;file&quot; name=&quot;pictures[]&quot; /&gt;
&lt;input type=&quot;submit&quot; value=&quot;Send&quot; /&gt;
&lt;/p&gt;
&lt;/form&gt;</pre>
</div>
   </div>

   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">foreach&nbsp;(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"error"</span><span style="color: #007700">]&nbsp;as&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$error</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$error&nbsp;</span><span style="color: #007700">==&nbsp;</span><span style="color: #0000BB">UPLOAD_ERR_OK</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$tmp_name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"tmp_name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;basename()&nbsp;may&nbsp;prevent&nbsp;filesystem&nbsp;traversal&nbsp;attacks;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;further&nbsp;validation/sanitation&nbsp;of&nbsp;the&nbsp;filename&nbsp;may&nbsp;be&nbsp;appropriate<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$name&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">basename</span><span style="color: #007700">(</span><span style="color: #0000BB">$_FILES</span><span style="color: #007700">[</span><span style="color: #DD0000">"pictures"</span><span style="color: #007700">][</span><span style="color: #DD0000">"name"</span><span style="color: #007700">][</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">move_uploaded_file</span><span style="color: #007700">(</span><span style="color: #0000BB">$tmp_name</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"data/</span><span style="color: #0000BB">$name</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <p class="para">
   File upload progress bar can be implemented using <a href="session.upload-progress.html" class="link">Session Upload Progress</a>.
  </p>
 </div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="124901""></a>
  <div class="note">
   <strong class="user">fravadona at gmail dot com</strong>
   <a href="#124901" class="date">11-Apr-2020 11:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
mpyw is right, PSR-7 is awesome but a little overkill for simple projects (in my opinion).<br />
<br />
Here's an example of function that returns the file upload metadata in a (PSR-7 *like*) normalized tree. This function deals with whatever dimension of upload metadata.<br />
<br />
I kept the code extremely simple, it doesn't validate anything in $_FILES, etc... AND MOST IMPORTANTLY, it calls array_walk_recursive in an *undefined behaviour* way!!!<br />
<br />
You can test it against the examples of the PSR-7 spec ( https://www.php-fig.org/psr/psr-7/#16-uploaded-files ) and try to add your own checks that will detect the error in the last example ^^<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;*&nbsp; THIS CODE IS ABSOLUTELY NOT MEANT FOR PRODUCTION !!! MAY ITS INSIGHTS HELP YOU !!!<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">getNormalizedFiles</span><span class="keyword">()<br />
{<br />
&nbsp; </span><span class="default">$normalized </span><span class="keyword">= array();<br />
<br />
&nbsp; if ( isset(</span><span class="default">$_FILES</span><span class="keyword">) ) { <br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; foreach ( </span><span class="default">$_FILES </span><span class="keyword">as </span><span class="default">$field </span><span class="keyword">=&gt; </span><span class="default">$metadata </span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$normalized</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">] = array(); </span><span class="comment">// needs initialization for array_replace_recursive<br />
&nbsp;&nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">foreach ( </span><span class="default">$metadata </span><span class="keyword">as </span><span class="default">$meta </span><span class="keyword">=&gt; </span><span class="default">$data </span><span class="keyword">) { </span><span class="comment">// $meta is 'tmp_name', 'error', etc...<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">) ) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// insert the current meta just before each leaf !!! WRONG USE OF ARRAY_WALK_RECURSIVE !!!<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">array_walk_recursive</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">, function (&amp;</span><span class="default">$v</span><span class="keyword">,</span><span class="default">$k</span><span class="keyword">) use (</span><span class="default">$meta</span><span class="keyword">) { </span><span class="default">$v </span><span class="keyword">= array( </span><span class="default">$meta </span><span class="keyword">=&gt; </span><span class="default">$v </span><span class="keyword">); });<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// fuse the current metadata with the previous ones<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">] = </span><span class="default">array_replace_recursive</span><span class="keyword">(</span><span class="default">$normalized</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">], </span><span class="default">$data</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized</span><span class="keyword">[</span><span class="default">$field</span><span class="keyword">][</span><span class="default">$meta</span><span class="keyword">] = </span><span class="default">$data</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp;&nbsp; } <br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp; } <br />
&nbsp; return </span><span class="default">$normalized</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121833""></a>
  <div class="note">
   <strong class="user">katrinaelaine6 at gmail dot com</strong>
   <a href="#121833" class="date">06-Nov-2017 06:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a complete example of the $_FILES array with nested and non-nested names. Let's say we have this html form:<br />
<br />
&lt;form action="test.php" method="post"&gt;<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="single" id="single"&gt;<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[]"&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id="nested_one"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[root]"&nbsp; &nbsp; &nbsp; id="nested_root"&gt;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[][]"&nbsp; &nbsp; &nbsp; &nbsp; id="nested_two"&gt; <br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[][parent]"&nbsp; id="nested_parent"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[][][]"&nbsp; &nbsp; &nbsp; id="nested_three"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="nested[][][child]" id="nested_child"&gt;<br />
<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit" value="Submit"&gt;<br />
<br />
&lt;/form&gt;<br />
<br />
In the test.php file:<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; print_r</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit;<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If we upload a text file with the same name as the input id for each input and click submit, test.php will output this:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">Array<br />
(<br />
<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">single</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">name</span><span class="keyword">] =&gt; </span><span class="default">single</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">type</span><span class="keyword">] =&gt; </span><span class="default">text</span><span class="keyword">/</span><span class="default">plain<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">tmp_name</span><span class="keyword">] =&gt; /</span><span class="default">tmp</span><span class="keyword">/</span><span class="default">phpApO28i<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">error</span><span class="keyword">] =&gt; </span><span class="default">0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">size</span><span class="keyword">] =&gt; </span><span class="default">3441<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">nested</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">name</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">0</span><span class="keyword">] =&gt; </span><span class="default">nested_one</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">root</span><span class="keyword">] =&gt; </span><span class="default">nested_root</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">0</span><span class="keyword">] =&gt; </span><span class="default">nested_two</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">2</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">parent</span><span class="keyword">] =&gt; </span><span class="default">nested_parent</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">3</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">0</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">0</span><span class="keyword">] =&gt; </span><span class="default">nested_three</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">4</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">0</span><span class="keyword">] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">child</span><span class="keyword">] =&gt; </span><span class="default">nested_child</span><span class="keyword">.</span><span class="default">txt<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// type, tmp_name, size, and error will have the same structure.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">)<br />
<br />
)<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="120686""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#120686" class="date">21-Feb-2017 10:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have found it useful to re-order the multidimensional $_FILES array into a more intuitive format, as proposed by many other developers already. <br />
<br />
Unfortunately, most of the proposed functions are not able to re-order the $_FILES array when it has more than 1 additional dimension.<br />
<br />
Therefore, I would like to contribute the function below, which is capable of meeting the aforementioned requirement:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">get_fixed_files</span><span class="keyword">() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$function </span><span class="keyword">= function(</span><span class="default">$files</span><span class="keyword">, </span><span class="default">$fixed_files </span><span class="keyword">= array(), </span><span class="default">$path </span><span class="keyword">= array()) use (&amp;</span><span class="default">$function</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">$path</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp</span><span class="keyword">[] = </span><span class="default">$key</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$fixed_files </span><span class="keyword">= </span><span class="default">$function</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">, </span><span class="default">$fixed_files</span><span class="keyword">, </span><span class="default">$temp</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$next </span><span class="keyword">= </span><span class="default">array_splice</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">array_merge</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">, </span><span class="default">$next</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= &amp;</span><span class="default">$fixed_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$temp </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= &amp;</span><span class="default">$new</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$new </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$fixed_files</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; };<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$function</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
</span><span class="default">?&gt;<br />
</span><br />
Side note: the unnamed function within the function is used to avoid confusion regarding the arguments necessary for the recursion within the function, for example when viewing the function in an IDE.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119643""></a>
  <div class="note">
   <strong class="user">mpyw</strong>
   <a href="#119643" class="date">24-Jul-2016 06:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Do not use Coreywelch or Daevid's way, because their methods can handle only within two-dimensional structure. $_FILES can consist of any hierarchy, such as 3d or 4d structure.<br />
<br />
The following example form breaks their codes:<br />
<br />
&lt;form action="" method="post" enctype="multipart/form-data"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="file" name="files[x][y][z]"&gt;<br />
&nbsp;&nbsp;&nbsp; &lt;input type="submit"&gt;<br />
&lt;/form&gt;<br />
<br />
As the solution, you should use PSR-7 based zendframework/zend-diactoros.<br />
<br />
GitHub:<br />
<br />
https://github.com/zendframework/zend-diactoros<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">use </span><span class="default">Psr</span><span class="keyword">\</span><span class="default">Http</span><span class="keyword">\</span><span class="default">Message</span><span class="keyword">\</span><span class="default">UploadedFileInterface</span><span class="keyword">;<br />
use </span><span class="default">Zend</span><span class="keyword">\</span><span class="default">Diactoros</span><span class="keyword">\</span><span class="default">ServerRequestFactory</span><span class="keyword">;<br />
<br />
</span><span class="default">$request </span><span class="keyword">= </span><span class="default">ServerRequestFactory</span><span class="keyword">::</span><span class="default">fromGlobals</span><span class="keyword">();<br />
<br />
if (</span><span class="default">$request</span><span class="keyword">-&gt;</span><span class="default">getMethod</span><span class="keyword">() !== </span><span class="string">'POST'</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">405</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'Use POST method.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$uploaded_files </span><span class="keyword">= </span><span class="default">$request</span><span class="keyword">-&gt;</span><span class="default">getUploadedFiles</span><span class="keyword">();<br />
<br />
if (<br />
&nbsp;&nbsp;&nbsp; !isset(</span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">]) ||<br />
&nbsp;&nbsp;&nbsp; !</span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">] instanceof </span><span class="default">UploadedFileInterface<br />
</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'Invalid request body.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$file </span><span class="keyword">= </span><span class="default">$uploaded_files</span><span class="keyword">[</span><span class="string">'files'</span><span class="keyword">][</span><span class="string">'x'</span><span class="keyword">][</span><span class="string">'y'</span><span class="keyword">][</span><span class="string">'z'</span><span class="keyword">];<br />
<br />
if (</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">getError</span><span class="keyword">() !== </span><span class="default">UPLOAD_ERR_OK</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">http_response_code</span><span class="keyword">(</span><span class="default">400</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; exit(</span><span class="string">'File uploading failed.'</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$file</span><span class="keyword">-&gt;</span><span class="default">moveTo</span><span class="keyword">(</span><span class="string">'/path/to/new/file'</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118858""></a>
  <div class="note">
   <strong class="user">coreywelch+phpnet at gmail dot com</strong>
   <a href="#118858" class="date">17-Feb-2016 10:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The documentation doesn't have any details about how the HTML array feature formats the $_FILES array. <br />
<br />
Example $_FILES array:<br />
<br />
For single file -<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [document] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
Multi-files with HTML array feature -<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [documents] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)<br />
<br />
The problem occurs when you have a form that uses both single file and HTML array feature. The array isn't normalized and tends to make coding for it really sloppy. I have included a nice method to normalize the $_FILES array.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">function </span><span class="default">normalize_files_array</span><span class="keyword">(</span><span class="default">$files </span><span class="keyword">= []) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array </span><span class="keyword">= [];<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$files </span><span class="keyword">as </span><span class="default">$index </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (!</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">])) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">][] = </span><span class="default">$file</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; continue;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$file</span><span class="keyword">[</span><span class="string">'name'</span><span class="keyword">] as </span><span class="default">$idx </span><span class="keyword">=&gt; </span><span class="default">$name</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$normalized_array</span><span class="keyword">[</span><span class="default">$index</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">] = [<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'name' </span><span class="keyword">=&gt; </span><span class="default">$name</span><span class="keyword">,<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'type' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'type'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'tmp_name' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'tmp_name'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'error' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'error'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">],<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'size' </span><span class="keyword">=&gt; </span><span class="default">$file</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">][</span><span class="default">$idx</span><span class="keyword">]<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$normalized_array</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
The following is the output from the above method.<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [document] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [documents] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; sample-file.doc<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; application/msword<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/path/phpVGCDAJ<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117613""></a>
  <div class="note">
   <strong class="user">anon</strong>
   <a href="#117613" class="date">08-Jul-2015 10:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For clarity; the reason you would NOT want to replace the example script with<br />
$uploaddir = './';<br />
is because if you have no coded file constraints a nerd could upload a php script with the same name of one of your scripts in the scripts directory.<br />
<br />
Given the right settings and permissions php-cgi is capable of replacing even php files.<br />
<br />
Imagine if it replaced the upload post processor file itself. The next "upload" could lead to some easy exploits.<br />
<br />
Even when replacements are not possible; uploading an .htaccess file could cause some problems, especially if it is sent after the nerd throws in a devious script to use htaccess to redirect to his upload.<br />
<br />
There are probably more ways of exploiting it. Don't let the nerds get you.<br />
<br />
More sensible to use a fresh directory for uploads with some form of unique naming algorithm; maybe even a cron job for sanitizing the directory so older files do not linger for too long.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116393""></a>
  <div class="note">
   <strong class="user">bimal at sanjaal dot com</strong>
   <a href="#116393" class="date">26-Dec-2014 11:44</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Some suggestions here:<br />
<br />
1. It is always better to check for your error status. If MAX_FILE_SIZE is active and the uploaded file crossed the limit, it will set the error. So, only when error is zero (0), move the file.<br />
<br />
2. If possible, never allow your script to upload in the path where file can be downloaded. Point your upload path to outside of public_html area or prevent direct browsing (using .htaccess restrictions). Think, if someone uploads malicious code, specially php codes, they will be executed on the server.<br />
<br />
3. Do not use the file name sent by the client. Regenerate a new name for newly uploaded file. This prevents overwriting your old files.<br />
<br />
4. Regularly track the disk space consumed, if you are running out of storage.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104349""></a>
  <div class="note">
   <strong class="user">Age Bosma</strong>
   <a href="#104349" class="date">10-Jun-2011 02:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
"If no file is selected for upload in your form, PHP will return $_FILES['userfile']['size'] as 0, and $_FILES['userfile']['tmp_name'] as none."<br />
<br />
Note that the situation above is the same when a file exceeding the MAX_FILE_SIZE hidden field is being uploaded. In this case $_FILES['userfile']['size'] is also set to 0, and $_FILES['userfile']['tmp_name'] is also empty. The difference would only be the error code.<br />
Simply checking for these two conditions and assuming no file upload has been attempted is incorrect.<br />
<br />
Instead, check if $_FILES['userfile']['name'] is set or not. If it is, a file upload has at least been attempted (a failed attempt or not). If it is not set, no attempt has been made.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="100187""></a>
  <div class="note">
   <strong class="user">Mark</strong>
   <a href="#100187" class="date">29-Sep-2010 04:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
$_FILES will be empty if a user attempts to upload a file greater than post_max_size in your php.ini<br />
<br />
post_max_size should be &gt;= upload_max_filesize in your php.ini.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91479""></a>
  <div class="note">
   <strong class="user">daevid at daevid dot com</strong>
   <a href="#91479" class="date">11-Jun-2009 02:35</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I think the way an array of attachments works is kind of cumbersome. Usually the PHP guys are right on the money, but this is just counter-intuitive. It should have been more like:<br />
<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [0] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; facepalm.jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; image/jpeg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; /tmp/phpn3FmFr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; 15476<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [1] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [name] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [type] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [tmp_name] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [error] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [size] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
and not this<br />
Array<br />
(<br />
&nbsp;&nbsp;&nbsp; [name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; facepalm.jpg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [type] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; image/jpeg<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [tmp_name] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; /tmp/phpn3FmFr<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [error] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 4<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
<br />
&nbsp;&nbsp;&nbsp; [size] =&gt; Array<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; (<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [0] =&gt; 15476<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; [1] =&gt; 0<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; )<br />
)<br />
<br />
Anyways, here is a fuller example than the sparce one in the documentation above:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">foreach (</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"error"</span><span class="keyword">] as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$error</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$tmp_name </span><span class="keyword">= </span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"tmp_name"</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; if (!</span><span class="default">$tmp_name</span><span class="keyword">) continue;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$name </span><span class="keyword">= </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$_FILES</span><span class="keyword">[</span><span class="string">"attachment"</span><span class="keyword">][</span><span class="string">"name"</span><span class="keyword">][</span><span class="default">$key</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$error </span><span class="keyword">== </span><span class="default">UPLOAD_ERR_OK</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ( </span><span class="default">move_uploaded_file</span><span class="keyword">(</span><span class="default">$tmp_name</span><span class="keyword">, </span><span class="string">"/tmp/"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">) )<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$uploaded_array</span><span class="keyword">[] .= </span><span class="string">"Uploaded file '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'.&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$errormsg </span><span class="keyword">.= </span><span class="string">"Could not move uploaded file '"</span><span class="keyword">.</span><span class="default">$tmp_name</span><span class="keyword">.</span><span class="string">"' to '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'&lt;br/&gt;\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$errormsg </span><span class="keyword">.= </span><span class="string">"Upload error. ["</span><span class="keyword">.</span><span class="default">$error</span><span class="keyword">.</span><span class="string">"] on file '"</span><span class="keyword">.</span><span class="default">$name</span><span class="keyword">.</span><span class="string">"'&lt;br/&gt;\n"</span><span class="keyword">;<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89938""></a>
  <div class="note">
   <strong class="user">eslindsey at gmail dot com</strong>
   <a href="#89938" class="date">29-Mar-2009 11:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Also note that since MAX_FILE_SIZE hidden field is supplied by the browser doing the submitting, it is easily overridden from the clients' side.&nbsp; You should always perform your own examination and error checking of the file after it reaches you, instead of relying on information submitted by the client.&nbsp; This includes checks for file size (always check the length of the actual data versus the reported file size) as well as file type (the MIME type submitted by the browser can be inaccurate at best, and intentionally set to an incorrect value at worst).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89697""></a>
  <div class="note">
   <strong class="user">claude dot pache at gmail dot com</strong>
   <a href="#89697" class="date">19-Mar-2009 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the MAX_FILE_SIZE hidden field is only used by the PHP script which receives the request, as an instruction to reject files larger than the given bound. This field has no significance for the browser, it does not provide a client-side check of the file-size, and it has nothing to do with web standards or browser features.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
