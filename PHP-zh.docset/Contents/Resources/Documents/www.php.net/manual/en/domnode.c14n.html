<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>Canonicalize nodes to a string</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="domnode.appendchild.html">? DOMNode::appendChild</a></li>
      <li style="float: right;"><a href="domnode.c14nfile.html">DOMNode::C14NFile ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="class.domnode.html">DOMNode</a></li>
    <li>Canonicalize nodes to a string</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="domnode.c14n" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMNode::C14N</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">DOMNode::C14N</span> &mdash; <span class="dc-title">Canonicalize nodes to a string</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-domnode.c14n-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMNode::C14N</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span> <code class="parameter">$exclusive</code><span class="initializer"> = <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="language.types.boolean.html" class="type bool">bool</a></span> <code class="parameter">$withComments</code><span class="initializer"> = <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type"><a href="language.types.null.html" class="type null">?</a></span><span class="type"><a href="language.types.array.html" class="type array">array</a></span></span> <code class="parameter">$xpath</code><span class="initializer"> = <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type"><a href="language.types.null.html" class="type null">?</a></span><span class="type"><a href="language.types.array.html" class="type array">array</a></span></span> <code class="parameter">$nsPrefixes</code><span class="initializer"> = <strong><code><a href="reserved.constants.html#constant.null">null</a></code></strong></span></span><br>): <span class="type"><span class="type"><a href="language.types.string.html" class="type string">string</a></span>|<span class="type"><a href="language.types.value.html" class="type false">false</a></span></span></div>

  <p class="para rdfs-comment">
   Canonicalize nodes to a string
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-domnode.c14n-parameters">
  <h3 class="title">参数</h3>
  <dl>
   
    <dt><code class="parameter">exclusive</code></dt>
    <dd>
     <p class="para">
      Enable exclusive parsing of only the nodes matched by the provided
      xpath or namespace prefixes.
     </p>
    </dd>
   
   
    <dt><code class="parameter">withComments</code></dt>
    <dd>
     <p class="para">
      Retain comments in output.
     </p>
    </dd>
   
   
    <dt><code class="parameter">xpath</code></dt>
    <dd>
  <p class="para">
   An array of XPaths to filter the nodes by.
   Each entry in this array is an associative array with:
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      A required <code class="literal">query</code> key containing the XPath expression as a string.
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      An optional <code class="literal">namespaces</code> key containing an array that maps namespace prefixes (keys) to namespace URIs (values).
     </span>
    </li>
   </ul>
  </p>
 </dd>
   
   
    <dt><code class="parameter">nsPrefixes</code></dt>
    <dd>
     <p class="para">
      An array of namespace prefixes to filter the nodes by.
     </p>
    </dd>
   
  </dl>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-domnode.c14n-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   Returns canonicalized nodes as a string 或者在失败时返回 <strong><code><a href="reserved.constants.html#constant.false">false</a></code></strong>
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-domnode.c14n-examples">
  <h3 class="title">示例</h3>
  <p class="para">
   <div class="example" id="example-5569">
    <p><strong>Example #1 Example with XPath query</strong></p>
    <div class="example-contents"><p>
     This example demonstrates advanced usage canonicalizing and filtering the nodes by an XPath query.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$dom </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">loadXML</span><span style="color: #007700">(&lt;&lt;&lt;XML<br /></span><span style="color: #DD0000">&lt;root xmlns:food="urn:food"&gt;<br />    &lt;!-- redundant namespace declaration will be canonicalized --&gt;<br />    &lt;food:fruit xmlns:food="urn:food"&gt;Apple&lt;/food:fruit&gt;<br />    &lt;food:fruit&gt;Orange&lt;/food:fruit&gt;<br />    &lt;food:fruit&gt;Pear&lt;/food:fruit&gt;<br />    &lt;!-- vegetables here --&gt;<br />    &lt;food:vegetable&gt;Lettuce&lt;/food:vegetable&gt;<br />&lt;/root&gt;<br /></span><span style="color: #007700">XML);<br /><br />echo </span><span style="color: #0000BB">$dom</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">C14N</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #0000BB">false</span><span style="color: #007700">, [<br />    </span><span style="color: #DD0000">"query" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">".//f:fruit|.//f:fruit/text()"</span><span style="color: #007700">,<br />    </span><span style="color: #DD0000">"namespaces" </span><span style="color: #007700">=&gt; [</span><span style="color: #DD0000">"f" </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"urn:food"</span><span style="color: #007700">],<br />]);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    <div class="example-contents"><p>以上示例会输出：</p></div>
    <div class="example-contents screen">
<div class="examplescode"><pre class="examplescode">&lt;food:fruit&gt;Apple&lt;/food:fruit&gt;&lt;food:fruit&gt;Orange&lt;/food:fruit&gt;&lt;food:fruit&gt;Pear&lt;/food:fruit&gt;</pre>
</div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-domnode.c14n-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li><span class="methodname"><a href="domnode.c14nfile.html" class="methodname" rel="rdfs-seeAlso">DOMNode::C14NFile()</a> - Canonicalize nodes to a file</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="118732""></a>
  <div class="note">
   <strong class="user">lordbaco</strong>
   <a href="#118732" class="date">28-Jan-2016 09:57</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
[edit by nielsdos: This has been fixed starting in PHP 8.4]
<br />

<br />
Good to know:
<br />

<br />
&lt;&lt; Due to a known issue in XML canonicalization in PHP, processing large metadata files in SimpleSAMLphp takes a big amount of resources, with that amount growing approximately by the square of the number of entities in the metadata set &gt;&gt;
<br />
https://simplesamlphp.org/metaprocessing
<br />

<br />
&lt;&lt; The C14N() function appears to have a runtime that is O(N^2) (or possibly worse?) depending on input size, which means that it becomes very slow as the input grows. For example, an input with around 196000 nodes takes about 290 seconds, while an input with 486000 nodes takes 2200 seconds. &gt;&gt;
<br />
https://bugs.php.net/bug.php?id=53655
<br />

<br />
We had the same issue with a 4.1 MB XML (105k lines). The sample code of ticket&nbsp; #53655 takes 1h36 minute to canonicalize it!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="116871""></a>
  <div class="note">
   <strong class="user">jorda at edpsciences dot org</strong>
   <a href="#116871" class="date">13-Mar-2015 09:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
C14N() returns an empty string if the node is not included in the document tree:<br />
<span class="default">&lt;?php<br />
$d </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">(</span><span class="string">'1.0'</span><span class="keyword">);<br />
</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="string">'&lt;foo&gt;&lt;/foo&gt;'</span><span class="keyword">);<br />
</span><span class="default">$n </span><span class="keyword">= </span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'bar'</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">-&gt;</span><span class="default">C14N</span><span class="keyword">());<br />
</span><span class="default">$d</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">);<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$n</span><span class="keyword">-&gt;</span><span class="default">C14N</span><span class="keyword">());<br />
</span><span class="default">?&gt;<br />
</span>output:<br />
string(0) ""<br />
string(11) "&lt;bar&gt;&lt;/bar&gt;"</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111773""></a>
  <div class="note">
   <strong class="user">Rijk</strong>
   <a href="#111773" class="date">27-Mar-2013 09:26</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
When working with (malformed) HTML, you're probably better off using DOMDocument's saveHTML() method instead. C14N() will attempt to make your HTML valid XML, for example by converting &lt;br&gt; to &lt;br&gt;&lt;/br&gt;.<br />
<br />
So instead of:<br />
$html = $Node-&gt;C14N();<br />
<br />
Use:<br />
$html = $Node-&gt;ownerDocument-&gt;saveHTML( $Node );</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
