<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>将 IPV4 的字符串互联网协议转换成长整型数字</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.inet-pton.html">? inet_pton</a></li>
      <li style="float: right;"><a href="function.long2ip.html">long2ip ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.network.html">网络 函数</a></li>
    <li>将 IPV4 的字符串互联网协议转换成长整型数字</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.ip2long" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ip2long</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">ip2long</span> &mdash; <span class="dc-title">将 IPV4 的字符串互联网协议转换成长整型数字</span></p>

 </div>
 
 <div class="refsect1 description" id="refsect1-function.ip2long-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ip2long</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$ip_address</code></span>
   ) : <span class="type">int</span></div>

  <p class="para rdfs-comment">
   函数 <span class="function"><strong>ip2long()</strong></span> 返回 IPV4 网络地址的长整型格式，从标准网络地址格式(点字符串)转化得到。
  </p>
  <p class="para">
   <span class="function"><strong>ip2long()</strong></span> 还可以与非完整IP进行工作。
   阅读 <a href="http://publibn.boulder.ibm.com/doc_link/en_US/a_doc_lib/libs/commtrf2/inet_addr.htm" class="link external" title="Link : http://publibn.boulder.ibm.com/doc_link/en_US/a_doc_lib/libs/commtrf2/inet_addr.htm">&raquo;&nbsp;http://publibn.boulder.ibm.com/doc_link/en_US/a_doc_lib/libs/commtrf2/inet_addr.htm</a>
   获得更多信息。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ip2long-parameters">
  <h3 class="title">参数</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">ip_address</code></dt>

     <dd>

      <p class="para">
      一个标准格式的地址。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ip2long-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   返回IP地址转换后的数字 或 <strong><code>FALSE</code></strong> 如果 <code class="parameter">ip_address</code>
   是无效的。
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.ip2long-changelog">
  <h3 class="title">更新日志</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>版本</th>
       <th>说明</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>5.5.0</td>
       <td>
        Prior to this version, on Windows <span class="function"><strong>ip2long()</strong></span> would sometimes return
        a valid number even if passed a value which was not an (IPv4) Internet Protocol
        dotted address.
       </td>
      </tr>

      <tr>
       <td>5.2.10</td>
       <td>
        再此之前的版本, <span class="function"><strong>ip2long()</strong></span> 有时会返回即使这不是一个IPV4的标准地址的数字地址。
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ip2long-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="example-5546">
    <p><strong>Example #1 <span class="function"><strong>ip2long()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$ip&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"The&nbsp;following&nbsp;URLs&nbsp;are&nbsp;equivalent:&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$out&nbsp;</span><span style="color: #007700">.=&nbsp;</span><span style="color: #DD0000">'http://www.example.com/,&nbsp;http://'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$ip&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'/,&nbsp;and&nbsp;http://'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%u"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ip2long</span><span style="color: #007700">(</span><span style="color: #0000BB">$ip</span><span style="color: #007700">))&nbsp;.&nbsp;</span><span style="color: #DD0000">"/&lt;br&nbsp;/&gt;\n"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #0000BB">$out</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5547">
    <p><strong>Example #2 显示IP地址</strong></p>
    <div class="example-contents"><p>
     第二个例子说明打印一个转换后的地址使用
     <span class="function"><a href="function.printf.html" class="function">printf()</a></span> 在PHP4和PHP5的功能:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$ip&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">'www.example.com'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$long&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">ip2long</span><span style="color: #007700">(</span><span style="color: #0000BB">$ip</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">$long&nbsp;</span><span style="color: #007700">==&nbsp;-</span><span style="color: #0000BB">1&nbsp;</span><span style="color: #007700">||&nbsp;</span><span style="color: #0000BB">$long&nbsp;</span><span style="color: #007700">===&nbsp;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Invalid&nbsp;IP,&nbsp;please&nbsp;try&nbsp;again'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$ip&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;192.0.34.166<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$long&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;-1073732954<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"%u\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">ip2long</span><span style="color: #007700">(</span><span style="color: #0000BB">$ip</span><span style="color: #007700">));&nbsp;</span><span style="color: #FF8000">//&nbsp;3221234342<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ip2long-notes">
  <h3 class="title">注释</h3>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    因为PHP的 <span class="type"><a href="language.types.integer.html" class="type integer">integer</a></span> 类型是有符号，并且有许多的IP地址讲导致在32位系统的情况下为负数， 你需要使用 &quot;%u&quot; 进行转换通过 <span class="function"><a href="function.sprintf.html" class="function">sprintf()</a></span> 或
    <span class="function"><a href="function.printf.html" class="function">printf()</a></span> 得到的字符串来表示无符号的IP地址。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Note</strong>: 
   <p class="para">
    <span class="function"><strong>ip2long()</strong></span> 将返回 <strong><code>FALSE</code></strong> 在IP是
    <em>255.255.255.255</em> 的情况，版本为 PHP 5 &lt;= 5.0.2. 在修复后
    PHP 5.0.3 会返回 <em>-1</em> (与PHP4相同).
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ip2long-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.long2ip.html" class="function" rel="rdfs-seeAlso">long2ip()</a> - 将长整型转化为字符串形式带点的互联网标准格式地址（IPV4）</span></li>
    <li class="member"><span class="function"><a href="function.sprintf.html" class="function" rel="rdfs-seeAlso">sprintf()</a> - Return a formatted string</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="123840""></a>
  <div class="note">
   <strong class="user">schat</strong>
   <a href="#123840" class="date">10-May-2019 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
sorry i just wrote wrong, sorry. this is the right one. thanks.<br />
<br />
/**<br />
&nbsp;* convert cidr to ip range<br />
&nbsp;* From: &lt;https://github.com/www-schat-top&gt;<br />
&nbsp;* @param&nbsp; string $cidr "192.168.0.0/23"<br />
&nbsp;* @return array&nbsp; ["192.168.0.0", "192.168.1.255"]<br />
&nbsp;*/<br />
function cidr2range($cidr){<br />
&nbsp;&nbsp; list( $subnet, $mask ) = explode( '/', $cidr );<br />
&nbsp;&nbsp; return [$subnet, long2ip(ip2long( $subnet ) | (pow(2,( 32 - $mask ))-1))];<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="121755""></a>
  <div class="note">
   <strong class="user">Mike B</strong>
   <a href="#121755" class="date">14-Oct-2017 12:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
</span><span class="comment">/*<br />
&nbsp;&nbsp; &nbsp; Given an IP address and Subnet Mask, <br />
&nbsp;&nbsp; &nbsp; determine the subnet address, broadcast address, and wildcard mask<br />
&nbsp;&nbsp; &nbsp; by using bitwise operators<br />
<br />
&nbsp;&nbsp; &nbsp; ref:&nbsp; <a href="http://php.net/manual/en/language.operators.bitwise.php" rel="nofollow" target="_blank">http://php.net/manual/en/language.operators.bitwise.php</a><br />
*/<br />
<br />
</span><span class="default">$ip</span><span class="keyword">=</span><span class="string">'10.10.10.7'</span><span class="keyword">;<br />
</span><span class="default">$mask</span><span class="keyword">=</span><span class="string">'255.255.255.0'</span><span class="keyword">;<br />
</span><span class="default">$wcmask</span><span class="keyword">=</span><span class="default">long2ip</span><span class="keyword">( ~</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">) );<br />
</span><span class="default">$subnet</span><span class="keyword">=</span><span class="default">long2ip</span><span class="keyword">( </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) &amp; </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">) );<br />
</span><span class="default">$bcast</span><span class="keyword">=</span><span class="default">long2ip</span><span class="keyword">( </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) | </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$wcmask</span><span class="keyword">) );<br />
echo </span><span class="string">"Given address </span><span class="default">$ip</span><span class="string"> and mask </span><span class="default">$mask</span><span class="string">, \n" </span><span class="keyword">. <br />
</span><span class="string">"the subnet is </span><span class="default">$subnet</span><span class="string"> and broadcast is </span><span class="default">$bcast</span><span class="string"> \n" </span><span class="keyword">. <br />
</span><span class="string">"with a wildcard mask of </span><span class="default">$wcmask</span><span class="string">"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
Given address 10.10.10.7 and mask 255.255.255.0, <br />
the subnet is 10.10.10.0 and broadcast is 10.10.10.255 <br />
with a wildcard mask of 0.0.0.255<br />
*/<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="119883""></a>
  <div class="note">
   <strong class="user">alex at alex-at dot ru</strong>
   <a href="#119883" class="date">14-Sep-2016 08:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here are my versions of prefix to mask and mask to prefix conversions. You can remove first lines with if/preg of each function if you don't want sanity precheck.<br />
<br />
&nbsp;&nbsp;&nbsp; function prefix2Mask($prefix)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!preg_match('#^(?:0*[0-2]?[0-9]|3[0-2])$#', $prefix)) return false; # wrong prefix<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return long2ip(0xffffffff &lt;&lt; (32 - $prefix));<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; function mask2Prefix($mask)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!preg_match('#^(?:(?:[0-1][0-9][0-9]|2[0-4][0-9]|25[0-5]|[0-9][0-9]|[0-9])\.){3}'.<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; '(?:[0-1][0-9][0-9]|2[0-4][0-9]|25[0-5]|[0-9][0-9]|[0-9])$#', $mask))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return false; # wrong mask<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $m2p = str_pad(substr(decbin(ip2long($mask)), -32, 32), 32, '0', STR_PAD_LEFT);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (!preg_match('#^(1*)0*$#', $m2p, $m)) return false; # wrong mask<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return strlen($m[1]);<br />
&nbsp;&nbsp;&nbsp; }</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115761""></a>
  <div class="note">
   <strong class="user">Karl Rixon</strong>
   <a href="#115761" class="date">18-Sep-2014 02:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The manual states that "ip2long() will also work with non-complete IP addresses", however this is system-dependant so cannot be relied upon. For example, on my system ip2long() will return FALSE for incomplete addresses:<br />
<br />
<span class="default">&lt;?php<br />
var_dump</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">"255.255"</span><span class="keyword">)); </span><span class="comment">// bool(false)<br />
</span><span class="default">?&gt;<br />
</span><br />
This is because ip2long will use inet_pton if available, which does not support non-complete addresses. If inet_pton is not available on your system, inet_addr will be used and incomplete addresses will work as stated.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114064""></a>
  <div class="note">
   <strong class="user">oo dot para at gmail dot com</strong>
   <a href="#114064" class="date">08-Jan-2014 10:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to validate IPs using this function, please be careful:<br />
The function filter_var should be used instead for validating IPs.<br />
<br />
<span class="default">&lt;?php<br />
$ip </span><span class="keyword">= </span><span class="string">'192.168.0355.24'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// true (expected false)<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// false<br />
<br />
</span><span class="default">$ip </span><span class="keyword">= </span><span class="string">'192.168.355.24'</span><span class="keyword">;<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// false<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">); </span><span class="comment">// false<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113080""></a>
  <div class="note">
   <strong class="user">rasmus at mindplay dot dk</strong>
   <a href="#113080" class="date">27-Aug-2013 02:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As pointed out by others, this function's return value is not consistent on 32 and 64-bit platforms.<br />
<br />
Your best bet for consistent behavior across 32/64-bit platforms (and Windows) is the lowest common denominator: force the return value of ip2long() into a signed 32-bit integer, e.g.:<br />
<br />
&nbsp;&nbsp;&nbsp; var_dump(unpack('l', pack('l', ip2long('255.255.255.0'))));<br />
<br />
This looks idiotic, but it gives you a consistent signed integer value on all platforms.<br />
<br />
(the arguments to both pack() and unpack() are the lower-case letter "L", not the number "1", in case it looks that way on your screen...)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="109298""></a>
  <div class="note">
   <strong class="user">admin at wudimei dot com</strong>
   <a href="#109298" class="date">04-Jul-2012 02:42</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">/**<br />
&nbsp; *<br />
&nbsp; *get the first ip and last ip from cidr(network id and mask length)<br />
&nbsp; * i will integrate this function into "Rong Framework" :)<br />
&nbsp; * @author admin@wudimei.com<br />
&nbsp; * @param string $cidr 56.15.0.6/16 , [network id]/[mask length]<br />
&nbsp; * @return array $ipArray = array( 0 =&gt;"first ip of the network", 1=&gt;"last ip of the network" );<br />
&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Each element of $ipArray's type is long int,use long2ip( $ipArray[0] ) to convert it into ip string.<br />
&nbsp; * example:<br />
&nbsp; * list( $long_startIp , $long_endIp) = getIpRange( "56.15.0.6/16" );<br />
&nbsp; * echo "start ip:" . long2ip( $long_startIp );<br />
&nbsp; * echo "&lt;br /&gt;";<br />
&nbsp; * echo "end ip:" . long2ip( $long_endIp );<br />
&nbsp; */<br />
<br />
&nbsp; </span><span class="keyword">function </span><span class="default">getIpRang</span><span class="keyword">(&nbsp; </span><span class="default">$cidr</span><span class="keyword">) {<br />
<br />
&nbsp;&nbsp; list(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$cidr</span><span class="keyword">);<br />
&nbsp;<br />
&nbsp;&nbsp; </span><span class="default">$maskBinStr </span><span class="keyword">=</span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"1"</span><span class="keyword">, </span><span class="default">$mask </span><span class="keyword">) . </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">-</span><span class="default">$mask </span><span class="keyword">);&nbsp; &nbsp; &nbsp; </span><span class="comment">//net mask binary string<br />
&nbsp;&nbsp; </span><span class="default">$inverseMaskBinStr </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">, </span><span class="default">$mask </span><span class="keyword">) . </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"1"</span><span class="keyword">,&nbsp; </span><span class="default">32</span><span class="keyword">-</span><span class="default">$mask </span><span class="keyword">); </span><span class="comment">//inverse mask<br />
&nbsp;&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$ipLong </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">( </span><span class="default">$ip </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$ipMaskLong </span><span class="keyword">= </span><span class="default">bindec</span><span class="keyword">( </span><span class="default">$maskBinStr </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$inverseIpMaskLong </span><span class="keyword">= </span><span class="default">bindec</span><span class="keyword">( </span><span class="default">$inverseMaskBinStr </span><span class="keyword">);<br />
&nbsp;&nbsp; </span><span class="default">$netWork </span><span class="keyword">= </span><span class="default">$ipLong </span><span class="keyword">&amp; </span><span class="default">$ipMaskLong</span><span class="keyword">;&nbsp; <br />
<br />
&nbsp;&nbsp; </span><span class="default">$start </span><span class="keyword">= </span><span class="default">$netWork</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">;</span><span class="comment">//去掉网络号 ,ignore network ID(eg: 192.168.1.0)<br />
&nbsp; <br />
&nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= (</span><span class="default">$netWork </span><span class="keyword">| </span><span class="default">$inverseIpMaskLong</span><span class="keyword">) -</span><span class="default">1 </span><span class="keyword">; </span><span class="comment">//去掉广播地址 ignore brocast IP(eg: 192.168.1.255)<br />
&nbsp;&nbsp; </span><span class="keyword">return array( </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$end </span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108812""></a>
  <div class="note">
   <strong class="user">replay111 at tlen dot pl</strong>
   <a href="#108812" class="date">26-May-2012 01:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,
<br />
based on examples above I have mixed class IPFilter with netMatch function wich gives me complete class for IP4 check including CIDR IP format:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">IP4Filter </span><span class="keyword">{
<br />

<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_SINGLE </span><span class="keyword">= </span><span class="string">'single'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_WILDCARD </span><span class="keyword">= </span><span class="string">'wildcard'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_MASK </span><span class="keyword">= </span><span class="string">'mask'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_CIDR </span><span class="keyword">= </span><span class="string">'CIDR'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_SECTION </span><span class="keyword">= </span><span class="string">'section'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_allowed_ips </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$allowed_ips</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_allowed_ips </span><span class="keyword">= </span><span class="default">$allowed_ips</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">check</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$allowed_ips </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_ips </span><span class="keyword">= </span><span class="default">$allowed_ips </span><span class="keyword">? </span><span class="default">$allowed_ips </span><span class="keyword">: </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_allowed_ips</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach (</span><span class="default">$allowed_ips </span><span class="keyword">as </span><span class="default">$allowed_ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_judge_ip_type</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sub_rst </span><span class="keyword">= </span><span class="default">call_user_func</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'_sub_checker_' </span><span class="keyword">. </span><span class="default">$type</span><span class="keyword">), </span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$sub_rst</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_judge_ip_type</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'*'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_WILDCARD</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$tmp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="string">'.'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_MASK</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_CIDR</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_SECTION</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_SINGLE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_single</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">) == </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_wildcard</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$allowed_ip_arr</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$allowed_ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">'*'</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; } else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">false </span><span class="keyword">== (</span><span class="default">$allowed_ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_mask</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$allowed_ip_ip</span><span class="keyword">, </span><span class="default">$allowed_ip_mask</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_ip</span><span class="keyword">) &amp; </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_mask</span><span class="keyword">)) + </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_ip</span><span class="keyword">) | (~ </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_mask</span><span class="keyword">))) + </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$ip </span><span class="keyword">&gt;= </span><span class="default">$begin </span><span class="keyword">&amp;&amp; </span><span class="default">$ip </span><span class="keyword">&lt;= </span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_section</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$begin</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$ip </span><span class="keyword">&gt;= </span><span class="default">$begin </span><span class="keyword">&amp;&amp; </span><span class="default">$ip </span><span class="keyword">&lt;= </span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_CIDR</span><span class="keyword">(</span><span class="default">$CIDR</span><span class="keyword">, </span><span class="default">$IP</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list (</span><span class="default">$net</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$CIDR</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return ( </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">) &amp; ~((</span><span class="default">1 </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$mask</span><span class="keyword">)) - </span><span class="default">1</span><span class="keyword">) ) == </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$net</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
For me this code works great, so I wanna thank to all You guys!!!</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108567""></a>
  <div class="note">
   <strong class="user">Aleksey Kuznetsov</strong>
   <a href="#108567" class="date">07-May-2012 05:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Unfortunately sprintf('%u', ...) is low and returns string representation of integer value instead of integer.<br />
Here is a function I use to convert IP to mySQL-compatible signed integer:<br />
<br />
function ip2int($ip) {<br />
&nbsp; if (!$r = ip2long($ip)) return 0; // we want 0 instead of false, even in case of bad IP<br />
&nbsp; if ($r &gt; 2147483647)<br />
&nbsp;&nbsp; &nbsp;&nbsp; $r-= 4294967296;<br />
&nbsp; return $r; // ok<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108436""></a>
  <div class="note">
   <strong class="user">pink at pink dot art dot pl</strong>
   <a href="#108436" class="date">26-Apr-2012 01:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be aware when you're running 64bit system, ip2long will result 64 bit integer which doesn't fit in MySQL INT, you can use BIGINT or INT UNSIGNED because on 64bit systems ip2long will never return negative integer. See also https://bugs.php.net/bug.php?id=54338</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106749""></a>
  <div class="note">
   <strong class="user">PandoraBox2007 at gmail dot com</strong>
   <a href="#106749" class="date">03-Dec-2011 07:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Universal ip4/ip6
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// encoded --
<br />
</span><span class="keyword">function </span><span class="default">encode_ip </span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">) == </span><span class="default">4</span><span class="keyword">) return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%02x%02x%02x%02x'</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$d</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">$d</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$d</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
&nbsp;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$d </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(^:)|(:$)/'</span><span class="keyword">, </span><span class="string">''</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$d </span><span class="keyword">as </span><span class="default">$x</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$res </span><span class="keyword">.= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%0'</span><span class="keyword">. (</span><span class="default">$x </span><span class="keyword">== </span><span class="string">'' </span><span class="keyword">? (</span><span class="default">9 </span><span class="keyword">- </span><span class="default">count</span><span class="keyword">(</span><span class="default">$d</span><span class="keyword">)) * </span><span class="default">4 </span><span class="keyword">: </span><span class="default">4</span><span class="keyword">) .</span><span class="string">'s'</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$res</span><span class="keyword">;
<br />
}
<br />

<br />
</span><span class="comment">// decoded
<br />
</span><span class="keyword">function </span><span class="default">decode_ip</span><span class="keyword">(</span><span class="default">$int_ip</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; function </span><span class="default">hexhex</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">) { return </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">)); };
<br />
&nbsp;
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$int_ip</span><span class="keyword">) == </span><span class="default">32</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$int_ip </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">$int_ip</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">39</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$int_ip </span><span class="keyword">= </span><span class="string">':'</span><span class="keyword">. </span><span class="default">implode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">"hexhex"</span><span class="keyword">, </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">,</span><span class="default">$int_ip</span><span class="keyword">))) .</span><span class="string">':'</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">preg_match_all</span><span class="keyword">(</span><span class="string">"/(:0)+/"</span><span class="keyword">, </span><span class="default">$int_ip</span><span class="keyword">, </span><span class="default">$zeros</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$zeros</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]) &gt; </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$match </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$zeros</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">] as </span><span class="default">$zero</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$zero</span><span class="keyword">) &gt; </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$match </span><span class="keyword">= </span><span class="default">$zero</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$int_ip </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">. </span><span class="default">$match </span><span class="keyword">.</span><span class="string">'/'</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">, </span><span class="default">$int_ip</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/(^:([^:]))|(([^:]):$)/'</span><span class="keyword">, </span><span class="string">'$2$4'</span><span class="keyword">, </span><span class="default">$int_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hexipbang </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">chunk_split</span><span class="keyword">(</span><span class="default">$int_ip</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hexipbang</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]). </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hexipbang</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) . </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hexipbang</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]) . </span><span class="string">'.' </span><span class="keyword">. </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">$hexipbang</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">]);
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
DB:
<br />
`user_ip` varchar(32) DEFAULT NULL</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104163""></a>
  <div class="note">
   <strong class="user">anjo2</strong>
   <a href="#104163" class="date">28-May-2011 09:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In 32bits systems, you cannot convert ipv6 to long, but you can convert ip2bin and bin2ip
<br />

<br />
This function converts ipv4 and ipv6, returns false if ip is not valid
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ip2bin</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">, </span><span class="default">FILTER_FLAG_IPV4</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">base_convert</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">),</span><span class="default">10</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">, </span><span class="default">FILTER_FLAG_IPV6</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; if((</span><span class="default">$ip_n </span><span class="keyword">= </span><span class="default">inet_pton</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)) === </span><span class="default">false</span><span class="keyword">) return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">15</span><span class="keyword">; </span><span class="comment">// 16 x 8 bit = 128bit (ipv6)
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">while (</span><span class="default">$bits </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%08b"</span><span class="keyword">,(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$ip_n</span><span class="keyword">[</span><span class="default">$bits</span><span class="keyword">])));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ipbin </span><span class="keyword">= </span><span class="default">$bin</span><span class="keyword">.</span><span class="default">$ipbin</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">--;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ipbin</span><span class="keyword">;
<br />
}
<br />

<br />
function </span><span class="default">bin2ip</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">) &lt;= </span><span class="default">32</span><span class="keyword">) </span><span class="comment">// 32bits (ipv4)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="keyword">return </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">base_convert</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">));
<br />
&nbsp;&nbsp; if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">) != </span><span class="default">128</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$pad </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">);
<br />
&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$pad</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">.</span><span class="default">$bin</span><span class="keyword">;
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp; while (</span><span class="default">$bits </span><span class="keyword">&lt;= </span><span class="default">7</span><span class="keyword">)
<br />
&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$bin_part </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">,(</span><span class="default">$bits</span><span class="keyword">*</span><span class="default">16</span><span class="keyword">),</span><span class="default">16</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$ipv6 </span><span class="keyword">.= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">bindec</span><span class="keyword">(</span><span class="default">$bin_part</span><span class="keyword">)).</span><span class="string">":"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; </span><span class="default">$bits</span><span class="keyword">++;
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; return </span><span class="default">inet_ntop</span><span class="keyword">(</span><span class="default">inet_pton</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ipv6</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">)));
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="102898""></a>
  <div class="note">
   <strong class="user">hanguofeng at gmail dot com</strong>
   <a href="#102898" class="date">13-Mar-2011 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I've write an IPFilter class to check if a ip is in given ips.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">class </span><span class="default">IPFilter
<br />
</span><span class="keyword">{
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_SINGLE </span><span class="keyword">= </span><span class="string">'single'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_WILDCARD </span><span class="keyword">= </span><span class="string">'wildcard'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_MASK </span><span class="keyword">= </span><span class="string">'mask'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private static </span><span class="default">$_IP_TYPE_SECTION </span><span class="keyword">= </span><span class="string">'section'</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; private </span><span class="default">$_allowed_ips </span><span class="keyword">= array();
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$allowed_ips</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_allowed_ips </span><span class="keyword">= </span><span class="default">$allowed_ips</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; public function </span><span class="default">check</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$allowed_ips </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_ips </span><span class="keyword">= </span><span class="default">$allowed_ips </span><span class="keyword">? </span><span class="default">$allowed_ips </span><span class="keyword">: </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_allowed_ips</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$allowed_ips </span><span class="keyword">as </span><span class="default">$allowed_ip</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$type </span><span class="keyword">= </span><span class="default">$this </span><span class="keyword">-&gt; </span><span class="default">_judge_ip_type</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$sub_rst </span><span class="keyword">= </span><span class="default">call_user_func</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">,</span><span class="string">'_sub_checker_' </span><span class="keyword">. </span><span class="default">$type</span><span class="keyword">), </span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$sub_rst</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_judge_ip_type</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'*'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_WILDCARD</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'/'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_MASK</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'-'</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_SECTION</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">self </span><span class="keyword">:: </span><span class="default">$_IP_TYPE_SINGLE</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_single</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">) == </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_wildcard</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$allowed_ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$allowed_ip_arr</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$allowed_ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">'*'</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">false </span><span class="keyword">== (</span><span class="default">$allowed_ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_mask</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$allowed_ip_ip</span><span class="keyword">, </span><span class="default">$allowed_ip_mask</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_ip</span><span class="keyword">) &amp;</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_mask</span><span class="keyword">)) + </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_ip</span><span class="keyword">) | (~</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$allowed_ip_mask</span><span class="keyword">))) + </span><span class="default">1</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$ip </span><span class="keyword">&gt;= </span><span class="default">$begin </span><span class="keyword">&amp;&amp; </span><span class="default">$ip </span><span class="keyword">&lt;= </span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; private function </span><span class="default">_sub_checker_section</span><span class="keyword">(</span><span class="default">$allowed_ip</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$begin</span><span class="keyword">, </span><span class="default">$end</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'-'</span><span class="keyword">, </span><span class="default">$allowed_ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$begin </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$begin</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$end </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">$ip </span><span class="keyword">&gt;= </span><span class="default">$begin </span><span class="keyword">&amp;&amp; </span><span class="default">$ip </span><span class="keyword">&lt;= </span><span class="default">$end</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
useage:
<br />
<span class="default">&lt;?php
<br />
$filter </span><span class="keyword">= new </span><span class="default">IPFilter</span><span class="keyword">(
<br />
&nbsp;&nbsp;&nbsp; array(
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'127.0.0.1'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'172.0.0.*'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'173.0.*.*'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'126.1.0.0/255.255.0.0'</span><span class="keyword">,
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">'125.0.0.1-125.0.0.9'</span><span class="keyword">,
<br />
));
<br />
</span><span class="default">$filter </span><span class="keyword">-&gt; </span><span class="default">check</span><span class="keyword">(</span><span class="string">'126.1.0.2'</span><span class="keyword">);
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="97982""></a>
  <div class="note">
   <strong class="user">me at iaincollins dot com</strong>
   <a href="#97982" class="date">19-May-2010 03:37</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I would just like to try and clear up simply that if storing IPV4 addresses in an SQL database you should use an unsigned int (4 bytes).
<br />

<br />
The easiest way to do this in PHP is to use sprintf():
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;$dottedFormatAddress </span><span class="keyword">= </span><span class="string">'127.0.0.1'</span><span class="keyword">;
<br />
&nbsp;</span><span class="default">$ipv4address </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$dottedFormatAddress</span><span class="keyword">));
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Primary reasons are it's compatible with database functions like MySQL's INET_ATON &amp; INET_NTOA (which also use unsigned int's), it's efficient,&nbsp; and it's the most common format used by IP lookup databases.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94787""></a>
  <div class="note">
   <strong class="user">joe at joeceresini dot com</strong>
   <a href="#94787" class="date">24-Nov-2009 05:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A quick method to convert a netmask (ex: 255.255.255.240) to a cidr mask (ex: /28):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mask2cidr</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">){<br />
&nbsp; </span><span class="default">$long </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">);<br />
&nbsp; </span><span class="default">$base </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">'255.255.255.255'</span><span class="keyword">);<br />
&nbsp; return </span><span class="default">32</span><span class="keyword">-</span><span class="default">log</span><span class="keyword">((</span><span class="default">$long </span><span class="keyword">^ </span><span class="default">$base</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">);<br />
<br />
&nbsp; </span><span class="comment">/* xor-ing will give you the inverse mask,<br />
&nbsp;&nbsp; &nbsp;&nbsp; log base 2 of that +1 will return the number<br />
&nbsp;&nbsp; &nbsp;&nbsp; of bits that are off in the mask and subtracting<br />
&nbsp;&nbsp; &nbsp;&nbsp; from 32 gets you the cidr notation */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; <br />
</span><span class="keyword">}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94477""></a>
  <div class="note">
   <strong class="user">f dot wiessner at smart-weblications dot net</strong>
   <a href="#94477" class="date">07-Nov-2009 06:12</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here some working ip2long6 and long2ip6 functions - keep in mind that this needs php gmp-lib:
<br />

<br />
<span class="default">&lt;?php
<br />

<br />
$ipv6 </span><span class="keyword">= </span><span class="string">"2001:4860:a005::68"</span><span class="keyword">;
<br />

<br />
function </span><span class="default">ip2long6</span><span class="keyword">(</span><span class="default">$ipv6</span><span class="keyword">) {
<br />
&nbsp; </span><span class="default">$ip_n </span><span class="keyword">= </span><span class="default">inet_pton</span><span class="keyword">(</span><span class="default">$ipv6</span><span class="keyword">);
<br />
&nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">15</span><span class="keyword">; </span><span class="comment">// 16 x 8 bit = 128bit
<br />
&nbsp; </span><span class="keyword">while (</span><span class="default">$bits </span><span class="keyword">&gt;= </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%08b"</span><span class="keyword">,(</span><span class="default">ord</span><span class="keyword">(</span><span class="default">$ip_n</span><span class="keyword">[</span><span class="default">$bits</span><span class="keyword">])));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipv6long </span><span class="keyword">= </span><span class="default">$bin</span><span class="keyword">.</span><span class="default">$ipv6long</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">--;
<br />
&nbsp; }
<br />
&nbsp; return </span><span class="default">gmp_strval</span><span class="keyword">(</span><span class="default">gmp_init</span><span class="keyword">(</span><span class="default">$ipv6long</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">),</span><span class="default">10</span><span class="keyword">);
<br />
}
<br />

<br />
function </span><span class="default">long2ip6</span><span class="keyword">(</span><span class="default">$ipv6long</span><span class="keyword">) {
<br />

<br />
&nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="default">gmp_strval</span><span class="keyword">(</span><span class="default">gmp_init</span><span class="keyword">(</span><span class="default">$ipv6long</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">),</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp; if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">) &lt; </span><span class="default">128</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pad </span><span class="keyword">= </span><span class="default">128 </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$pad</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bin </span><span class="keyword">= </span><span class="string">"0"</span><span class="keyword">.</span><span class="default">$bin</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp; }
<br />
&nbsp; </span><span class="default">$bits </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp; while (</span><span class="default">$bits </span><span class="keyword">&lt;= </span><span class="default">7</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bin_part </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">,(</span><span class="default">$bits</span><span class="keyword">*</span><span class="default">16</span><span class="keyword">),</span><span class="default">16</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipv6 </span><span class="keyword">.= </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">bindec</span><span class="keyword">(</span><span class="default">$bin_part</span><span class="keyword">)).</span><span class="string">":"</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">++;
<br />
&nbsp; }
<br />
&nbsp; </span><span class="comment">// compress
<br />

<br />
&nbsp; </span><span class="keyword">return </span><span class="default">inet_ntop</span><span class="keyword">(</span><span class="default">inet_pton</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ipv6</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,-</span><span class="default">1</span><span class="keyword">)));
<br />
}
<br />

<br />
print </span><span class="default">$ipv6long </span><span class="keyword">=&nbsp; </span><span class="default">ip2long6</span><span class="keyword">(</span><span class="default">$ipv6</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br />
print </span><span class="default">$ipv6 </span><span class="keyword">= </span><span class="default">long2ip6</span><span class="keyword">(</span><span class="default">$ipv6long</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">;
<br />

<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
outputs:
<br />

<br />
42541956150894553250710573749450571880
<br />
2001:4860:a005::68</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="94290""></a>
  <div class="note">
   <strong class="user">david dot schueler at tel-billig dot de</strong>
   <a href="#94290" class="date">27-Oct-2009 06:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To get the network adress out of the broadcast adress and netmask just to an AND on it:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">// simple example<br />
</span><span class="default">$bcast </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">"192.168.178.255"</span><span class="keyword">);<br />
</span><span class="default">$smask </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">"255.255.255.0"</span><span class="keyword">);<br />
</span><span class="default">$nmask </span><span class="keyword">= </span><span class="default">$bcast </span><span class="keyword">&amp; </span><span class="default">$smask</span><span class="keyword">;<br />
echo </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$nmask</span><span class="keyword">); </span><span class="comment">// Will give 192.168.178.0<br />
</span><span class="default">?&gt;<br />
</span><br />
With this example you are able to check if a given host is in your own local net or not (on linux):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* Check if a client IP is in our Server subnet<br />
&nbsp;*<br />
&nbsp;* @param string $client_ip<br />
&nbsp;* @param string $server_ip<br />
&nbsp;* @return boolean<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">clientInSameSubnet</span><span class="keyword">(</span><span class="default">$client_ip</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">,</span><span class="default">$server_ip</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$client_ip</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$client_ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">$server_ip</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$server_ip </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'SERVER_ADDR'</span><span class="keyword">];<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Extract broadcast and netmask from ifconfig<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if (!(</span><span class="default">$p </span><span class="keyword">= </span><span class="default">popen</span><span class="keyword">(</span><span class="string">"ifconfig"</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">))) return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$out </span><span class="keyword">.= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">,</span><span class="default">1024</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// This is because the php.net comment function does not<br />
&nbsp;&nbsp;&nbsp; // allow long lines.<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$match&nbsp; </span><span class="keyword">= </span><span class="string">"/^.*"</span><span class="keyword">.</span><span class="default">$server_ip</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$match </span><span class="keyword">.= </span><span class="string">".*Bcast:(\d{1,3}\.\d{1,3}i\.\d{1,3}\.\d{1,3}).*"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$match </span><span class="keyword">.= </span><span class="string">"Mask:(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})$/im"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">,</span><span class="default">$out</span><span class="keyword">,</span><span class="default">$regs</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$bcast </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$smask </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipadr </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$client_ip</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$nmask </span><span class="keyword">= </span><span class="default">$bcast </span><span class="keyword">&amp; </span><span class="default">$smask</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return ((</span><span class="default">$ipadr </span><span class="keyword">&amp; </span><span class="default">$smask</span><span class="keyword">) == (</span><span class="default">$nmask </span><span class="keyword">&amp; </span><span class="default">$smask</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92646""></a>
  <div class="note">
   <strong class="user">joshua_r108 at hotmail dot com</strong>
   <a href="#92646" class="date">01-Aug-2009 11:30</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote something on the different ways to get an IP and convert it using ip2long(), the different ways to store an IP or an IP range in MySQL, and the different ways to query for the IP(s). Maybe something useful for others?<br />
<br />
<a href="http://strictcoder.blogspot.com/2009_08_01_archive.html" rel="nofollow" target="_blank">http://strictcoder.blogspot.com/2009_08_01_archive.html</a><br />
Title: Query For An IP In A Database<br />
<br />
Regards,<br />
Joshua K Roberson</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92544""></a>
  <div class="note">
   <strong class="user">jwadhams1 at yahoo dot com</strong>
   <a href="#92544" class="date">28-Jul-2009 03:41</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wanted to build on what kaputt and spinyn contributed in a way that I think is a little more intuitive (e.g., let sprintf do all the binary conversion and padding, and let substr_compare do the trimming and comparing):
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">ip_in_network</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$net_addr</span><span class="keyword">, </span><span class="default">$net_mask</span><span class="keyword">){
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$net_mask </span><span class="keyword">&lt;= </span><span class="default">0</span><span class="keyword">){ return </span><span class="default">false</span><span class="keyword">; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip_binary_string </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%032b"</span><span class="keyword">,</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$net_binary_string </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%032b"</span><span class="keyword">,</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$net_addr</span><span class="keyword">));
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return (</span><span class="default">substr_compare</span><span class="keyword">(</span><span class="default">$ip_binary_string</span><span class="keyword">,</span><span class="default">$net_binary_string</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">$net_mask</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">);
<br />
}
<br />

<br />
</span><span class="default">ip_in_network</span><span class="keyword">(</span><span class="string">"192.168.2.1"</span><span class="keyword">,</span><span class="string">"192.168.2.0"</span><span class="keyword">,</span><span class="default">24</span><span class="keyword">); </span><span class="comment">//true
<br />
</span><span class="default">ip_in_network</span><span class="keyword">(</span><span class="string">"192.168.6.93"</span><span class="keyword">,</span><span class="string">"192.168.0.0"</span><span class="keyword">,</span><span class="default">16</span><span class="keyword">); </span><span class="comment">//true
<br />
</span><span class="default">ip_in_network</span><span class="keyword">(</span><span class="string">"1.6.6.6"</span><span class="keyword">,</span><span class="string">"128.168.2.0"</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">); </span><span class="comment">//false
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90344""></a>
  <div class="note">
   <strong class="user">spinyn at gmail dot com</strong>
   <a href="#90344" class="date">16-Apr-2009 07:51</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just want to add a comment to kaputt's valuable contribution to the task of matching hosts to ip ranges, efficiently.&nbsp; The script works fine if the binary representation of the ip involves no leading zeros.&nbsp; Unfortunately, the way decbin() seems to work, leading zeros in the binary representation of the first ip quad get dropped.&nbsp; That is a serious matter if you're trying to match all possible candidates in the checklist.&nbsp; In those cases the leading zeros need to be added back to get accurate matches for values in the first quad between 0-127 (or the binary equivalent, 0-01111111).
<br />

<br />
The solution I came up with to address this issue was the following function:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">addLeadingZero</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;&nbsp; if ((</span><span class="default">$result </span><span class="keyword">= (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">))) &gt; </span><span class="default">0</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp;&nbsp; return </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">"0"</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">).</span><span class="default">$ip</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="89028""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#89028" class="date">18-Feb-2009 11:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To always get the signed 32bit representation of an ip, I found this workaround:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">list(, </span><span class="default">$ip</span><span class="keyword">) = </span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'l'</span><span class="keyword">,</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'l'</span><span class="keyword">,</span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">'200.200.200.200'</span><span class="keyword">)));<br />
</span><span class="default">?&gt;<br />
</span><br />
In this example, $ip will be -926365496 regardless of a 32 or 64 bit system.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="88345""></a>
  <div class="note">
   <strong class="user">randolf</strong>
   <a href="#88345" class="date">20-Jan-2009 01:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Convert IP to unsigned long
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">//$strIP&nbsp; :&nbsp;&nbsp; IP in String-format
<br />
//$lngIP&nbsp; :&nbsp;&nbsp; IP in unsigned long
<br />

<br />
</span><span class="keyword">if ((</span><span class="default">$lngIP</span><span class="keyword">=</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$strIP</span><span class="keyword">)) &lt; </span><span class="default">0</span><span class="keyword">){ </span><span class="default">$lngIP </span><span class="keyword">+= </span><span class="default">4294967296 </span><span class="keyword">;}
<br />

<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="comment">// ADD 2^32
<br />

<br />
</span><span class="default">thats all</span><span class="keyword">.
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85429""></a>
  <div class="note">
   <strong class="user">Teguh Iskanto - Kamprettos at yahoo</strong>
   <a href="#85429" class="date">29-Aug-2008 09:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
to Anonymous @ 29-Aug-2008 10:19<br />
<br />
If you're speaking about efficiency, there's no absolute right / wrong as it all depends on the user's needs, specs and requirements. <br />
<br />
But from what I'm coming from , this method served me well,&nbsp; I've used this to match 2 network ends of approx 2700++ something unique VRFs (Nortel Shasta) and yes, each VRF is a virtualized firewall that consists of at least 20 different network objects (some could have couple of hundreds). Not to mention that these , still have to be compared with another hundreds of contivity boxes and each box have a range of around 1-600 vpn peers (to add more complexity, each peer has around 1-50 network ranges). <br />
<br />
So, if you do the math, the number of permutations that need to be calculated, is indeed quite complex. I could get the whole result somewhere in around 50-65 secs tops. <br />
<br />
Had I used a php function to crunch those data the result would have been longer.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85426""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#85426" class="date">29-Aug-2008 05:19</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@Teguh Iskanto<br />
<br />
Hi,<br />
<br />
Your solution requires you to store the IP addresses and masks as strings, and also to store the subnet mask being used by your hosts.&nbsp; This is very inefficient.<br />
<br />
If you stored your network addresses as unsigned Integers, and your masks as TinyInts (i.e. a value between 0 &amp; 32), you could instead do this:<br />
<br />
select * from networks WHERE inet_aton('10.20.251.130') between `ipnumber` AND (`ipnumber` + (POW(2,(32-`mask`)))-1);<br />
<br />
Obviously this can be made quicker on very high load systems by storing the broadcast address in the table instead of calculating it on the fly:<br />
<br />
select * from networks WHERE inet_aton('10.20.251.130') between `ipnumber` AND `broadcast`;<br />
<br />
Nick</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="85425""></a>
  <div class="note">
   <strong class="user">ncritten at gmail dot youknowwhat</strong>
   <a href="#85425" class="date">29-Aug-2008 04:58</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Hi,<br />
Please find below a little function I wrote for handling IP addresses as unsigned integers.<br />
This function will take an IP address or IP number in ANY FORMAT (that I can think of) and will return it's decimal unsigned equivalent, as a string.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">myip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">is_numeric</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)){<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; } else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">, </span><span class="default">floatval</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)));<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
Here is is in action:<br />
<br />
<span class="default">&lt;?php<br />
$ip</span><span class="keyword">[</span><span class="string">'DottedQuadDec'</span><span class="keyword">] = </span><span class="string">"192.168.255.109"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'PosIntStr'</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"3232300909"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'NegIntStr'</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"-1062666387"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'PosInt'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">3232300909</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'NegInt'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = -</span><span class="default">1062666387</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'DottedQuadHex'</span><span class="keyword">] = </span><span class="string">"0xc0.0xA8.0xFF.0x6D"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'DottedQuadOct'</span><span class="keyword">] = </span><span class="string">"0300.0250.0377.0155"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'HexIntStr'</span><span class="keyword">]&nbsp; &nbsp;&nbsp; = </span><span class="string">"0xC0A8FF6D"</span><span class="keyword">;<br />
</span><span class="default">$ip</span><span class="keyword">[</span><span class="string">'HexInt'</span><span class="keyword">]&nbsp; &nbsp; &nbsp; &nbsp; = </span><span class="default">0xC0A8FF6D</span><span class="keyword">;<br />
<br />
</span><span class="default">printf</span><span class="keyword">(</span><span class="string">"\n% 16s : % 20s =&gt; % 11s =&gt; % 16s"</span><span class="keyword">,</span><span class="string">"Input Type"</span><span class="keyword">,</span><span class="string">"Input Value"</span><span class="keyword">,</span><span class="string">"Converted"</span><span class="keyword">,</span><span class="string">"Converted Back"</span><span class="keyword">);<br />
echo </span><span class="string">"\n&nbsp; &nbsp; ------------------------------------------------------------------"</span><span class="keyword">;<br />
foreach (</span><span class="default">$ip </span><span class="keyword">as </span><span class="default">$type </span><span class="keyword">=&gt; </span><span class="default">$value</span><span class="keyword">){<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ipnum </span><span class="keyword">= </span><span class="default">myip2long</span><span class="keyword">(</span><span class="default">$value</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"\n% 16s : % 20s =&gt; % 11s =&gt; % 16s"</span><span class="keyword">,</span><span class="default">$type</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">,</span><span class="default">$ipnum</span><span class="keyword">,</span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$ipnum</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83548""></a>
  <div class="note">
   <strong class="user">chrisp-phpnet at inventivedingo dot com</strong>
   <a href="#83548" class="date">30-May-2008 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I had a problem with calling this function with REMOTE_ADDR on my lighttpd web server. Turned out that IPv6 was installed on this server, so even though REMOTE_ADDR was an IPv4 address, it was being formatted using IPv6's IPv4 compatibility mode. For example, 10.0.0.1 was becoming ::ffff:10.0.0.1, which caused iplong to report the address as invalid instead of parsing it correctly.
<br />

<br />
The correct fix would of course be to update my infrastructure so that it's properly IPv6-compatible; but in the context of my particular situation, this would involve a lot of re-engineering. So in the meantime, I worked around the issue using this quick and dirty hack:
<br />

<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp;&nbsp; $ip </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'REMOTE_ADDR'</span><span class="keyword">]);
<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">'::'</span><span class="keyword">) === </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">':'</span><span class="keyword">)+</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$host </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Ugly but functional.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83320""></a>
  <div class="note">
   <strong class="user">jpmarcotte at gmail dot com</strong>
   <a href="#83320" class="date">20-May-2008 03:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In using a combination of jbothe's code below and some of the "$mask = 0xFFFFFFFF &lt;&lt; (32 - $bits)" type code, I ran into an error with some later calculations on a 64 bit machine.<br />
<br />
Keep in mind that when you're analyzing numbers meant to be treated as 32 bits wide (such as IP addresses), you may want to truncate them. Without relying on other libraries, it was simple enough to follow any calculations that may end with different results on a 64 bit machine with " &amp; 0xFFFFFFFF"<br />
<br />
Though in many cases, it seems like it might be simpler to just use "~0 &lt;&lt; ..." for initial shifting to create the network mask instead of "0xFFFFFFFF &lt;&lt; ...". I don't know that it guarantees further operations to work as expected though.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82397""></a>
  <div class="note">
   <strong class="user">lutel</strong>
   <a href="#82397" class="date">09-Apr-2008 04:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
here is netMatch function which is the fastest I could wrote, I hope developers will include native function soon...
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">netMatch </span><span class="keyword">(</span><span class="default">$CIDR</span><span class="keyword">,</span><span class="default">$IP</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; list (</span><span class="default">$net</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) = </span><span class="default">explode </span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$CIDR</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; return ( </span><span class="default">ip2long </span><span class="keyword">(</span><span class="default">$IP</span><span class="keyword">) &amp; ~((</span><span class="default">1 </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$mask</span><span class="keyword">)) - </span><span class="default">1</span><span class="keyword">) ) == </span><span class="default">ip2long </span><span class="keyword">(</span><span class="default">$net</span><span class="keyword">);
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82219""></a>
  <div class="note">
   <strong class="user">php dot net at kenman dot net</strong>
   <a href="#82219" class="date">01-Apr-2008 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To nate, who advises that there is no reason to use an unsigned version of the IP in a MySQL DB:<br />
<br />
I think it would depend on your application, but personally, I find it useful to store IP's as unsigneds since MySQL has 2 native functions, INET_ATON() and INET_NTOA(), which work the same as ip2long()/long2ip() _except_ that they generate the unsigned counterpart. So if you want, you could do:<br />
<br />
-- IANA Class-B reserved/private<br />
SELECT * FROM `servers` <br />
WHERE `ip` &gt;= INET_ATON('192.168.0.0') <br />
AND `ip` &lt;= INET_ATON('192.168.255.255');<br />
<br />
In my current application, I find it easier to use the MySQL built-ins than the PHP counter-parts. <br />
<br />
In case you're curious as to the names ATON and NTOA:<br />
<br />
ATON = address to number aka. ip2long<br />
NTOA = number to address aka. long2ip</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="82013""></a>
  <div class="note">
   <strong class="user">johniskew at yahoo dot com</strong>
   <a href="#82013" class="date">24-Mar-2008 10:14</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following function ipToHex will take an IP (v4 or v6 formatted) and if it is valid, will return a 32 byte hex string representing that address.&nbsp; Requires php &gt;= 5.2 as it uses the filter_var function.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">ipToHex</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="string">','</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$splitIp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">','</span><span class="keyword">, </span><span class="default">$ipAddress</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ipAddress </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$splitIp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$isIpV6 </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$isIpV4 </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">, </span><span class="default">FILTER_FLAG_IPV6</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isIpV6 </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else if(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">, </span><span class="default">FILTER_FLAG_IPV4</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$isIpV4 </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if(!</span><span class="default">$isIpV4 </span><span class="keyword">&amp;&amp; !</span><span class="default">$isIpV6</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// IPv4 format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">$isIpV4</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$ipAddress</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]), </span><span class="default">2</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ipAddress </span><span class="keyword">= </span><span class="string">'::'</span><span class="keyword">.</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">].</span><span class="string">':'</span><span class="keyword">.</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// IPv6 format<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">else {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$ipAddress</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">// If this is mixed IPv6/IPv4, convert end to IPv6 value<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">], </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">, </span><span class="default">FILTER_FLAG_IPV4</span><span class="keyword">) !== </span><span class="default">false</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$partsV4 </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">4</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] = </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">dechex</span><span class="keyword">(</span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]), </span><span class="default">2</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">) - </span><span class="default">1</span><span class="keyword">] = </span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].</span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$parts</span><span class="keyword">[] = </span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">].</span><span class="default">$partsV4</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$numMissing </span><span class="keyword">= </span><span class="default">8 </span><span class="keyword">- </span><span class="default">count</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expandedParts </span><span class="keyword">= array();<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expansionDone </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$parts </span><span class="keyword">as </span><span class="default">$part</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if(!</span><span class="default">$expansionDone </span><span class="keyword">&amp;&amp; </span><span class="default">$part </span><span class="keyword">== </span><span class="string">''</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$numMissing</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expandedParts</span><span class="keyword">[] = </span><span class="string">'0000'</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expansionDone </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$expandedParts</span><span class="keyword">[] = </span><span class="default">$part</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; foreach(</span><span class="default">$expandedParts </span><span class="keyword">as &amp;</span><span class="default">$part</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$part </span><span class="keyword">= </span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ipAddress </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">':'</span><span class="keyword">, </span><span class="default">$expandedParts</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$hex </span><span class="keyword">= </span><span class="default">join</span><span class="keyword">(</span><span class="string">''</span><span class="keyword">, </span><span class="default">$expandedParts</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Validate the final IP<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(!</span><span class="default">filter_var</span><span class="keyword">(</span><span class="default">$ipAddress</span><span class="keyword">, </span><span class="default">FILTER_VALIDATE_IP</span><span class="keyword">)) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">false</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">$hex</span><span class="keyword">, </span><span class="default">32</span><span class="keyword">, </span><span class="string">'0'</span><span class="keyword">, </span><span class="default">STR_PAD_LEFT</span><span class="keyword">));<br />
}<br />
</span><span class="default">$ips </span><span class="keyword">= array(<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'::192.168.0.2'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'0:0:0:0:0:0:192.168.0.2'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'192.168.0.2'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'::C0A8:2'</span><span class="keyword">,<br />
&nbsp;&nbsp;&nbsp; </span><span class="string">'0:0:0:0:0:0:C0A8:2'<br />
</span><span class="keyword">);<br />
</span><span class="default">$finals </span><span class="keyword">= array();<br />
foreach(</span><span class="default">$ips </span><span class="keyword">as </span><span class="default">$ip</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$finals</span><span class="keyword">[] = </span><span class="default">ipToHex</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);<br />
}<br />
</span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$finals</span><span class="keyword">);<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="81850""></a>
  <div class="note">
   <strong class="user">og_sam at homail dot com</strong>
   <a href="#81850" class="date">16-Mar-2008 07:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
@ samb057 at gmail dot com<br />
<br />
This function will not return a correct bigint.<br />
<br />
base_convert() is limited to the double type,<br />
which usually counts 64bits and not 128 like an IPv6 address.<br />
<br />
For example:<br />
<br />
FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF<br />
<br />
will __NOT__ be converted to 128^2 -1<br />
<br />
You should use a bigint lib's multiplication function,<br />
with decimal shifting factors defined as string constants (much faster than recalculating them every time).<br />
Grab 8 short integers (the 16bits between the ':' with base_convert($hex,16,10)) and shift the 7 higher ones with a bigint_multiplication.<br />
<br />
Of course you can also do it with less bigint ops using 32bit integers, but then you should create them this way (additionally 'sprintf' for making an uint32 string):<br />
$uint32= sprintf('%u',intval(base_convert($hex,16,10)));<br />
<br />
Finally, "bigint_add" the shifted ones to the least (unshifted) significant interger string and be happy<br />
<br />
PS: I'm working on an IPv4/6 tool class with raw (also endianness), 6/4 compatibility and validation methods,<br />
I'll post it here as soon as it's finished and tested.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="78643""></a>
  <div class="note">
   <strong class="user">ir on ir id is at gm ai ld ot co m</strong>
   <a href="#78643" class="date">20-Oct-2007 11:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Keep in mind that storing IP addresses inside of your database as integers (rather than 15 character strings in decimal format, or 8 character strings in hex format) is hundreds of times faster.<br />
<br />
Take the typical case of a MySQL database doing a search for an IP address on thousands (or millions!) of rows; you're either doing a string compare for each entry, or an integer equation. If you do your indexes correctly, your lookups should be literally 100x faster using an INT rather than a VARCHAR.<br />
<br />
Also note that an integer doesn't need to be escaped when passed to a database. :)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="76578""></a>
  <div class="note">
   <strong class="user">andrew dot minerd at sellingsource dot com</strong>
   <a href="#76578" class="date">20-Jul-2007 05:15</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A somewhat more efficient alternative to convert the signed integer return by ip2long:<br />
<br />
$float = ((ip2long($ip) &amp; 0x7FFFFFFF) + 0x80000000);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="74264""></a>
  <div class="note">
   <strong class="user">one tiger one at gee mail dot comm</strong>
   <a href="#74264" class="date">02-Apr-2007 07:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I wrote a small function to validate a netmask (We have a form where the netmask of a given server is entered in, and I wanted to make sure it was valid). Hope this is useful.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// Netmask Validator //
<br />
</span><span class="keyword">function </span><span class="default">checkNetmask</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) {
<br />
&nbsp;if (!</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)) {
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;} elseif(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">))) != </span><span class="default">32 </span><span class="keyword">&amp;&amp; </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) != </span><span class="default">0</span><span class="keyword">) {
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;} elseif(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'01'</span><span class="keyword">,</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">))) || !</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'0'</span><span class="keyword">,</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">)))) {
<br />
&nbsp; return </span><span class="default">false</span><span class="keyword">;
<br />
&nbsp;} else {
<br />
&nbsp; return </span><span class="default">true</span><span class="keyword">;
<br />
&nbsp;}
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="73288""></a>
  <div class="note">
   <strong class="user">laacz at php dot net</strong>
   <a href="#73288" class="date">16-Feb-2007 01:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just to save you some time.<br />
<br />
Beware that octets in IP address are being treated as numbers. So, '10.0.0.11' is not equal to '10.0.0.011'. '011' is octal number (base 8), so it converts to '9'. You can even go further and see that '10.0.0.0xa' also works (equals to '10.0.0.16'). <br />
<br />
This is not PHP issue, though.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71955""></a>
  <div class="note">
   <strong class="user">samb057 at gmail dot com</strong>
   <a href="#71955" class="date">26-Dec-2006 12:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a simple IP address match checking function.
<br />

<br />
It takes 3 arguments: ip address to check (after ip2long), ip address to check against (after ip2long), and mask to check against (integer 0-32).
<br />

<br />
Just make sure you perform ip2long on the ip addresses before inputting them to the function.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">match_ip</span><span class="keyword">(</span><span class="default">$check_ip</span><span class="keyword">, </span><span class="default">$match_ip</span><span class="keyword">, </span><span class="default">$match_mask </span><span class="keyword">= </span><span class="default">32</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0 </span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">$match_mask </span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$n </span><span class="keyword">= </span><span class="default">pow</span><span class="keyword">(</span><span class="default">2</span><span class="keyword">, </span><span class="default">31 </span><span class="keyword">- </span><span class="default">$i</span><span class="keyword">) ;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$n </span><span class="keyword">&amp; </span><span class="default">$check_ip</span><span class="keyword">) != (</span><span class="default">$n </span><span class="keyword">&amp; </span><span class="default">$match_ip</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">FALSE </span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">TRUE </span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
I've been looking for a function like this for a while, i hope it helps someone.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="71939""></a>
  <div class="note">
   <strong class="user">Ian B</strong>
   <a href="#71939" class="date">24-Dec-2006 04:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
NOTE: ip2long() should NOT be used for CIDR calculation. <br />
Instead, you should use something like the following:<br />
<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* get the base and the bits from the ban in the database */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$base</span><span class="keyword">, </span><span class="default">$bits</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$CIDR</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* now split it up into it's classes */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$base</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* now do some bit shfiting/switching to convert to ints */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$i </span><span class="keyword">= (</span><span class="default">$a </span><span class="keyword">&lt;&lt; </span><span class="default">24</span><span class="keyword">) + (</span><span class="default">$b </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$c </span><span class="keyword">&lt;&lt; </span><span class="default">8</span><span class="keyword">) + </span><span class="default">$d</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$mask </span><span class="keyword">= </span><span class="default">$bits </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: (~</span><span class="default">0 </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$bits</span><span class="keyword">));<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* here's our lowest int */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$low </span><span class="keyword">= </span><span class="default">$i </span><span class="keyword">&amp; </span><span class="default">$mask</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* here's our highest int */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$high </span><span class="keyword">= </span><span class="default">$i </span><span class="keyword">| (~</span><span class="default">$mask </span><span class="keyword">&amp; </span><span class="default">0xFFFFFFFF</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* now split the ip were checking against up into classes */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">list(</span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">, </span><span class="default">$c</span><span class="keyword">, </span><span class="default">$d</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$iptocheck</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* now convert the ip we're checking against to an int */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$check </span><span class="keyword">= (</span><span class="default">$a </span><span class="keyword">&lt;&lt; </span><span class="default">24</span><span class="keyword">) + (</span><span class="default">$b </span><span class="keyword">&lt;&lt; </span><span class="default">16</span><span class="keyword">) + (</span><span class="default">$c </span><span class="keyword">&lt;&lt; </span><span class="default">8</span><span class="keyword">) + </span><span class="default">$d</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">/* if the ip is within the range, including <br />
&nbsp;&nbsp; &nbsp;&nbsp; highest/lowest values, then it's witin the CIDR range */<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">if (</span><span class="default">$check </span><span class="keyword">&gt;= </span><span class="default">$low </span><span class="keyword">&amp;&amp; </span><span class="default">$check </span><span class="keyword">&lt;= </span><span class="default">$high</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">1</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; else<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0</span><span class="keyword">;<br />
</span><span class="default">?&gt;<br />
</span><br />
This means that you should check to see if the IP<br />
address is of the correct format each time.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="70734""></a>
  <div class="note">
   <strong class="user">jgwright</strong>
   <a href="#70734" class="date">25-Oct-2006 12:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a modified version of the code posted by legetz81 (AT) yahoo (dot) com. It handles the shorter, and more common, notation: "189.128/11".<br />
<br />
<span class="default">&lt;?php<br />
<br />
$ip_addr_cidr </span><span class="keyword">= </span><span class="string">"192.168.37.215/27"</span><span class="keyword">;<br />
</span><span class="default">cidr</span><span class="keyword">(</span><span class="default">$ip_addr_cidr</span><span class="keyword">);<br />
<br />
function </span><span class="default">cidr</span><span class="keyword">(</span><span class="default">$ip_addr_cidr</span><span class="keyword">) {<br />
<br />
</span><span class="default">$ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$ip_addr_cidr</span><span class="keyword">);<br />
<br />
</span><span class="default">$dotcount </span><span class="keyword">= </span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="string">"."</span><span class="keyword">);<br />
</span><span class="default">$padding </span><span class="keyword">= </span><span class="default">str_repeat</span><span class="keyword">(</span><span class="string">".0"</span><span class="keyword">, </span><span class="default">3 </span><span class="keyword">- </span><span class="default">$dotcount</span><span class="keyword">);<br />
</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">].=</span><span class="default">$padding</span><span class="keyword">;<br />
<br />
</span><span class="default">$bin </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />
for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;=</span><span class="default">32</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; </span><span class="default">$bin </span><span class="keyword">.= </span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] &gt;= </span><span class="default">$i </span><span class="keyword">? </span><span class="string">'1' </span><span class="keyword">: </span><span class="string">'0'</span><span class="keyword">;<br />
}<br />
</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] = </span><span class="default">bindec</span><span class="keyword">(</span><span class="default">$bin</span><span class="keyword">);<br />
<br />
</span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
</span><span class="default">$nm </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
</span><span class="default">$nw </span><span class="keyword">= (</span><span class="default">$ip </span><span class="keyword">&amp; </span><span class="default">$nm</span><span class="keyword">);<br />
</span><span class="default">$bc </span><span class="keyword">= </span><span class="default">$nw </span><span class="keyword">| (~</span><span class="default">$nm</span><span class="keyword">);<br />
<br />
echo </span><span class="string">"Number of Hosts:&nbsp; &nbsp; " </span><span class="keyword">. (</span><span class="default">$bc </span><span class="keyword">- </span><span class="default">$nw </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;<br />
echo </span><span class="string">"Host Range:&nbsp; &nbsp; &nbsp; &nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$nw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) . </span><span class="string">" -&gt; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$bc </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">)&nbsp; . </span><span class="string">"\n"</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
This will produce:<br />
Number of Hosts:&nbsp; &nbsp; 30<br />
Host Range:&nbsp; &nbsp; &nbsp; &nbsp; 192.168.37.193 -&gt; 192.168.37.222<br />
*/<br />
<br />
</span><span class="keyword">}<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="56373""></a>
  <div class="note">
   <strong class="user">ken at expitrans dot com</strong>
   <a href="#56373" class="date">31-Aug-2005 03:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Below is a merged form of all various notes, and a better (and correct) network matching function.<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">net_match</span><span class="keyword">(</span><span class="default">$network</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// determines if a network in the form of 192.168.17.1/16 or<br />
&nbsp;&nbsp; &nbsp;&nbsp; // 127.0.0.1/255.255.255.255 or 10.0.0.1 matches a given ip<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ip_arr </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$network</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$network_long </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$mask </span><span class="keyword">=&nbsp; </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$x</span><span class="keyword">) == </span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">] ? </span><span class="default">$x </span><span class="keyword">: </span><span class="default">0xffffffff </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$ip_arr</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="default">$ip_long </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="comment">// echo "&gt;".$ip_arr[1]."&gt; ".decbin($mask)."\n";<br />
&nbsp;&nbsp; &nbsp;&nbsp; </span><span class="keyword">return (</span><span class="default">$ip_long </span><span class="keyword">&amp; </span><span class="default">$mask</span><span class="keyword">) == (</span><span class="default">$network_long </span><span class="keyword">&amp; </span><span class="default">$mask</span><span class="keyword">);<br />
}<br />
<br />
echo </span><span class="default">net_match</span><span class="keyword">(</span><span class="string">'192.168.17.1/16'</span><span class="keyword">, </span><span class="string">'192.168.15.1'</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// returns true<br />
</span><span class="keyword">echo </span><span class="default">net_match</span><span class="keyword">(</span><span class="string">'127.0.0.1/255.255.255.255'</span><span class="keyword">, </span><span class="string">'127.0.0.2'</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// returns false<br />
</span><span class="keyword">echo </span><span class="default">net_match</span><span class="keyword">(</span><span class="string">'10.0.0.1'</span><span class="keyword">, </span><span class="string">'10.0.0.1'</span><span class="keyword">).</span><span class="string">"\n"</span><span class="keyword">; </span><span class="comment">// returns true<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="49956""></a>
  <div class="note">
   <strong class="user">mailNO at SPAMdapuzz dot com</strong>
   <a href="#49956" class="date">13-Feb-2005 11:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
a little function to make a range in this form:<br />
0.0.0.1/0.0.0.255&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ==&gt; 0.0.0.1/255<br />
0.0.0.1/255.255.255.255&nbsp; &nbsp; ==&gt; 0.0.0.1/255.255.255.255<br />
<br />
<span class="default">&lt;?php<br />
$primo </span><span class="keyword">= </span><span class="string">"62.4.32.0"</span><span class="keyword">;<br />
</span><span class="default">$ultimo </span><span class="keyword">= </span><span class="string">"62.4.63.255"</span><span class="keyword">;<br />
echo </span><span class="default">do_range</span><span class="keyword">(</span><span class="default">$primo</span><span class="keyword">,</span><span class="default">$ultimo</span><span class="keyword">); </span><span class="comment">//Example<br />
<br />
</span><span class="keyword">function </span><span class="default">do_range</span><span class="keyword">(</span><span class="default">$primo</span><span class="keyword">,</span><span class="default">$ultimo</span><span class="keyword">) {<br />
list(</span><span class="default">$a</span><span class="keyword">,</span><span class="default">$b</span><span class="keyword">,</span><span class="default">$c</span><span class="keyword">,</span><span class="default">$d</span><span class="keyword">)=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$primo</span><span class="keyword">);<br />
list(</span><span class="default">$e</span><span class="keyword">,</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$g</span><span class="keyword">,</span><span class="default">$h</span><span class="keyword">)=</span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$ultimo</span><span class="keyword">);<br />
if (</span><span class="default">$a </span><span class="keyword">!== </span><span class="default">$e</span><span class="keyword">) return </span><span class="string">"</span><span class="default">$primo</span><span class="string">/</span><span class="default">$ultimo</span><span class="string">"</span><span class="keyword">;<br />
else {<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$b </span><span class="keyword">!== </span><span class="default">$f</span><span class="keyword">) return </span><span class="string">"</span><span class="default">$primo</span><span class="string">/</span><span class="default">$f</span><span class="string">.</span><span class="default">$g</span><span class="string">.</span><span class="default">$h</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else{<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c </span><span class="keyword">!== </span><span class="default">$g</span><span class="keyword">) return </span><span class="string">"</span><span class="default">$primo</span><span class="string">/</span><span class="default">$g</span><span class="string">.</span><span class="default">$h</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; else {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$d </span><span class="keyword">!== </span><span class="default">$h</span><span class="keyword">) return </span><span class="string">"</span><span class="default">$primo</span><span class="string">/</span><span class="default">$h</span><span class="string">"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; else return -</span><span class="default">1</span><span class="keyword">; </span><span class="comment">//error<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="keyword">}<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
</span><span class="default">?&gt;<br />
</span>Please write me if you have any suggestion</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="47814""></a>
  <div class="note">
   
   <a href="#47814" class="date">01-Dec-2004 06:06</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I re-wrote the functions from jbothe at hotmail dot com as a little exercise in OO and added a couple of extra functions.<br />
<br />
<span class="default">&lt;?php<br />
<br />
&nbsp;</span><span class="comment">//--------------<br />
// IPv4 class<br />
</span><span class="keyword">class </span><span class="default">ipv4<br />
</span><span class="keyword">{<br />
&nbsp; var </span><span class="default">$address</span><span class="keyword">;<br />
&nbsp; var </span><span class="default">$netbits</span><span class="keyword">;<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Create new class<br />
&nbsp; </span><span class="keyword">function </span><span class="default">ipv4</span><span class="keyword">(</span><span class="default">$address</span><span class="keyword">,</span><span class="default">$netbits</span><span class="keyword">)<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">address </span><span class="keyword">= </span><span class="default">$address</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netbits </span><span class="keyword">= </span><span class="default">$netbits</span><span class="keyword">;<br />
&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the IP address<br />
&nbsp; </span><span class="keyword">function </span><span class="default">address</span><span class="keyword">() { return (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">address</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the netbits<br />
&nbsp; </span><span class="keyword">function </span><span class="default">netbits</span><span class="keyword">() { return (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netbits</span><span class="keyword">); }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the netmask<br />
&nbsp; </span><span class="keyword">function </span><span class="default">netmask</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">"255.255.255.255"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;&lt; (</span><span class="default">32</span><span class="keyword">-</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netbits</span><span class="keyword">)));<br />
&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the network that the address sits in<br />
&nbsp; </span><span class="keyword">function </span><span class="default">network</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">long2ip</span><span class="keyword">((</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">address</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp; (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netmask</span><span class="keyword">()))));<br />
&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the broadcast that the address sits in<br />
&nbsp; </span><span class="keyword">function </span><span class="default">broadcast</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">network</span><span class="keyword">())<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | (~(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netmask</span><span class="keyword">())))));<br />
&nbsp; }<br />
<br />
&nbsp;&nbsp; </span><span class="comment">//--------------<br />
&nbsp; // Return the inverse mask of the netmask<br />
&nbsp; </span><span class="keyword">function </span><span class="default">inverse</span><span class="keyword">()<br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">long2ip</span><span class="keyword">(~(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="string">"255.255.255.255"</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;&lt; (</span><span class="default">32</span><span class="keyword">-</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">netbits</span><span class="keyword">))));<br />
&nbsp; }<br />
<br />
}<br />
<br />
&nbsp; </span><span class="default">$ip </span><span class="keyword">= new </span><span class="default">ipv4</span><span class="keyword">(</span><span class="string">"192.168.2.1"</span><span class="keyword">,</span><span class="default">24</span><span class="keyword">);<br />
&nbsp; print </span><span class="string">"Address: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">address</span><span class="string">()\n"</span><span class="keyword">;<br />
&nbsp; print </span><span class="string">"Netbits: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">netbits</span><span class="string">()\n"</span><span class="keyword">;<br />
&nbsp; print </span><span class="string">"Netmask: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">netmask</span><span class="string">()\n"</span><span class="keyword">;<br />
&nbsp; print </span><span class="string">"Inverse: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">inverse</span><span class="string">()\n"</span><span class="keyword">;<br />
&nbsp; print </span><span class="string">"Network: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">network</span><span class="string">()\n"</span><span class="keyword">;<br />
&nbsp; print </span><span class="string">"Broadcast: </span><span class="default">$ip</span><span class="keyword">-&gt;</span><span class="default">broadcast</span><span class="string">()\n"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="42880""></a>
  <div class="note">
   <strong class="user">mediator</strong>
   <a href="#42880" class="date">02-Jun-2004 03:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Another function for matching $_SERVER['REMOTE_ADDR'] against CIDR.<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">matchCIDR</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">, </span><span class="default">$cidr</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; list(</span><span class="default">$ip</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">'/'</span><span class="keyword">, </span><span class="default">$cidr</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$mask </span><span class="keyword">= </span><span class="default">0xffffffff </span><span class="keyword">&lt;&lt; (</span><span class="default">32 </span><span class="keyword">- </span><span class="default">$mask</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return ((</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$addr</span><span class="keyword">) &amp; </span><span class="default">$mask</span><span class="keyword">) == (</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) &amp; </span><span class="default">$mask</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="37786""></a>
  <div class="note">
   <strong class="user">jbothe at hotmail dot com</strong>
   <a href="#37786" class="date">26-Nov-2003 11:01</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The following script will print out subnet statistics when you supply the IP Address and Subnet Mask. Usefull to calculate the broadcast address and network address as well as the number of hosts and the range of IP addresses in the subnet.
<br />

<br />
#!/usr/local/bin/php
<br />
<span class="default">&lt;?php
<br />
&nbsp;&nbsp; $ip_addr </span><span class="keyword">= </span><span class="string">"172.14.1.57"</span><span class="keyword">;
<br />
&nbsp;&nbsp; </span><span class="default">$subnet_mask </span><span class="keyword">= </span><span class="string">"255.255.255.0"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$ip_addr</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$nm </span><span class="keyword">= </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$subnet_mask</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$nw </span><span class="keyword">= (</span><span class="default">$ip </span><span class="keyword">&amp; </span><span class="default">$nm</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$bc </span><span class="keyword">= </span><span class="default">$nw </span><span class="keyword">| (~</span><span class="default">$nm</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp; echo </span><span class="string">"IP Address:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; echo </span><span class="string">"Subnet Mask:&nbsp; &nbsp; &nbsp; &nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$nm</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; echo </span><span class="string">"Network Address:&nbsp; &nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$nw</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; echo </span><span class="string">"Broadcast Address:&nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$bc</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; echo </span><span class="string">"Number of Hosts:&nbsp; &nbsp; " </span><span class="keyword">. (</span><span class="default">$bc </span><span class="keyword">- </span><span class="default">$nw </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">) . </span><span class="string">"\n"</span><span class="keyword">;
<br />
&nbsp;&nbsp; echo </span><span class="string">"Host Range:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$nw </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">) . </span><span class="string">" -&gt; " </span><span class="keyword">. </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$bc </span><span class="keyword">- </span><span class="default">1</span><span class="keyword">)&nbsp; . </span><span class="string">"\n"</span><span class="keyword">;
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
Produces the output:
<br />

<br />
IP Address:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 172.14.1.57
<br />
Subnet Mask:&nbsp; &nbsp; &nbsp; &nbsp; 255.255.255.0
<br />
Network Address:&nbsp; &nbsp; 172.14.1.0
<br />
Broadcast Address:&nbsp; 172.14.1.255
<br />
Number of Hosts:&nbsp; &nbsp; 254
<br />
Host Range:&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; 172.14.1.1 -&gt; 172.14.1.254</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36532""></a>
  <div class="note">
   <strong class="user">daevid at daevid dot com</strong>
   <a href="#36532" class="date">13-Oct-2003 09:23</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">CalculateIPRange</span><span class="keyword">(</span><span class="default">$iprange</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Daevid Vincent [daevid@daevid.com] 10.13.03
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; This function will return an array of either a negative error code 
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; or all possible IP addresses in the given range.
<br />
&nbsp;&nbsp;&nbsp; //&nbsp; format is NNN.NNN.NNN.NNN - NNN.NNN.NNN.NNN&nbsp; (spaces are okay)
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/-/"</span><span class="keyword">,</span><span class="default">$iprange</span><span class="keyword">, -</span><span class="default">1</span><span class="keyword">, </span><span class="default">PREG_SPLIT_NO_EMPTY</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$QRange1 </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$QRange2 </span><span class="keyword">= </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];
<br />

<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$QRange2 </span><span class="keyword">== </span><span class="string">""</span><span class="keyword">) return array(</span><span class="default">$QRange1</span><span class="keyword">); </span><span class="comment">//special case, they didn't put a second quad parameter
<br />

<br />
&nbsp;&nbsp;&nbsp; //basic error handling to see if it is generally a valid IP in the form N.N.N.N
<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/"</span><span class="keyword">,</span><span class="default">$QRange1</span><span class="keyword">) != </span><span class="default">1 </span><span class="keyword">) return array(-</span><span class="default">1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; if ( </span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}/"</span><span class="keyword">,</span><span class="default">$QRange2</span><span class="keyword">) != </span><span class="default">1 </span><span class="keyword">) return array(-</span><span class="default">1</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$quad1 </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$QRange1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$quad2 </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$QRange2</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">reset </span><span class="keyword">(</span><span class="default">$quad1</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while (list (</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each </span><span class="keyword">(</span><span class="default">$quad1</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$quad1</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$quad1</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] &lt; </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$quad1</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] &gt; </span><span class="default">255</span><span class="keyword">) return array(-</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">reset </span><span class="keyword">(</span><span class="default">$quad2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; while (list (</span><span class="default">$key</span><span class="keyword">, </span><span class="default">$val</span><span class="keyword">) = </span><span class="default">each </span><span class="keyword">(</span><span class="default">$quad2</span><span class="keyword">))
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$quad2</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] = </span><span class="default">intval</span><span class="keyword">(</span><span class="default">$val</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; if (</span><span class="default">$quad2</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] &lt; </span><span class="default">0 </span><span class="keyword">|| </span><span class="default">$quad2</span><span class="keyword">[</span><span class="default">$key</span><span class="keyword">] &gt; </span><span class="default">255</span><span class="keyword">) return array(-</span><span class="default">2</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$startIP_long </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">,</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$QRange1</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$endIP_long </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"%u"</span><span class="keyword">,</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$QRange2</span><span class="keyword">));
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$difference </span><span class="keyword">= </span><span class="default">$endIP_long </span><span class="keyword">- </span><span class="default">$startIP_long</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//echo "startIP_long = ".$startIP_long." and endIP_long = ".$endIP_long." difference = ".$difference."&lt;BR&gt;";
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$ip </span><span class="keyword">= array(); 
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$k </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">$startIP_long</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt;= </span><span class="default">$endIP_long</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">$i</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; 
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="comment">//this is a total hack. there must be a better way.
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$thisQuad </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"."</span><span class="keyword">,</span><span class="default">$temp</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$thisQuad</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] &gt; </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$thisQuad</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">] &lt; </span><span class="default">255</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$ip</span><span class="keyword">[</span><span class="default">$k</span><span class="keyword">++] = </span><span class="default">$temp</span><span class="keyword">;
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$ip</span><span class="keyword">;
<br />
} </span><span class="comment">//CalculateIPRange()
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="34796""></a>
  <div class="note">
   <strong class="user">anderson at piq dot com dot br</strong>
   <a href="#34796" class="date">06-Aug-2003 10:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to get the interface of an IP, based on the local route table, use this.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">GetIfaceforIP</span><span class="keyword">(</span><span class="default">$user_ip</span><span class="keyword">)
<br />
{
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$route </span><span class="keyword">= </span><span class="string">"/bin/netstat -rn"</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">exec</span><span class="keyword">(</span><span class="default">$route</span><span class="keyword">, </span><span class="default">$aoutput</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; foreach(</span><span class="default">$aoutput </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$line</span><span class="keyword">)
<br />
&nbsp;&nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$key </span><span class="keyword">&gt; </span><span class="default">1</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$line </span><span class="keyword">= </span><span class="default">ereg_replace</span><span class="keyword">(</span><span class="string">"[[:space:]]+"</span><span class="keyword">,</span><span class="string">","</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">);
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; list(</span><span class="default">$network</span><span class="keyword">, </span><span class="default">$gateway</span><span class="keyword">, </span><span class="default">$mask</span><span class="keyword">, </span><span class="default">$flags</span><span class="keyword">, </span><span class="default">$mss</span><span class="keyword">, </span><span class="default">$window</span><span class="keyword">, </span><span class="default">$irtt</span><span class="keyword">, </span><span class="default">$iface</span><span class="keyword">) = </span><span class="default">explode</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="default">$line</span><span class="keyword">)
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if((</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$user_ip</span><span class="keyword">) &amp; </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">)) == </span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$network</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$iface</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp;&nbsp; }
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="16260""></a>
  <div class="note">
   <strong class="user">phl AT cyways.com</strong>
   <a href="#16260" class="date">22-Oct-2001 04:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here's a function I whipped up today to deduce some important network information given a hostname (or its IP address) and its subnet mask:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">find_net</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">,</span><span class="default">$mask</span><span class="keyword">) {
<br />
&nbsp;&nbsp; </span><span class="comment">### Function to determine network characteristics
<br />
&nbsp;&nbsp; ### $host = IP address or hostname of target host (string)
<br />
&nbsp;&nbsp; ### $mask = Subnet mask of host in dotted decimal (string)
<br />
&nbsp;&nbsp; ### returns array with
<br />
&nbsp;&nbsp; ###&nbsp;&nbsp; "cidr"&nbsp; &nbsp; &nbsp; =&gt; host and mask in CIDR notation
<br />
&nbsp;&nbsp; ###&nbsp;&nbsp; "network"&nbsp;&nbsp; =&gt; network address
<br />
&nbsp;&nbsp; ###&nbsp;&nbsp; "broadcast" =&gt; broadcast address
<br />
&nbsp;&nbsp; ###
<br />
&nbsp;&nbsp; ### Example: find_net("192.168.37.215","255.255.255.224")
<br />
&nbsp;&nbsp; ### returns:
<br />
&nbsp;&nbsp; ###&nbsp; &nbsp; "cidr"&nbsp; &nbsp; &nbsp; =&gt; 192.168.37.215/27
<br />
&nbsp;&nbsp; ###&nbsp; &nbsp; "network"&nbsp;&nbsp; =&gt; 192.168.37.192
<br />
&nbsp;&nbsp; ###&nbsp; &nbsp; "broadcast" =&gt; 192.168.37.223
<br />
&nbsp;&nbsp; ###
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$bits</span><span class="keyword">=</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">)),</span><span class="string">"0"</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$net</span><span class="keyword">[</span><span class="string">"cidr"</span><span class="keyword">]=</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">).</span><span class="string">"/"</span><span class="keyword">.</span><span class="default">$bits</span><span class="keyword">;
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$net</span><span class="keyword">[</span><span class="string">"network"</span><span class="keyword">]=</span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">bindec</span><span class="keyword">(</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">))) &amp; </span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">))));
<br />

<br />
&nbsp;&nbsp; </span><span class="default">$binhost</span><span class="keyword">=</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">gethostbyname</span><span class="keyword">(</span><span class="default">$host</span><span class="keyword">))),</span><span class="default">32</span><span class="keyword">,</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">STR_PAD_LEFT</span><span class="keyword">);
<br />
&nbsp;&nbsp; </span><span class="default">$binmask</span><span class="keyword">=</span><span class="default">str_pad</span><span class="keyword">(</span><span class="default">decbin</span><span class="keyword">(</span><span class="default">ip2long</span><span class="keyword">(</span><span class="default">$mask</span><span class="keyword">)),</span><span class="default">32</span><span class="keyword">,</span><span class="string">"0"</span><span class="keyword">,</span><span class="default">STR_PAD_LEFT</span><span class="keyword">);
<br />
&nbsp;&nbsp; for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">32</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {
<br />
&nbsp;&nbsp; &nbsp;&nbsp; if (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$binhost</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)==</span><span class="string">"1" </span><span class="keyword">|| </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$binmask</span><span class="keyword">,</span><span class="default">$i</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">)==</span><span class="string">"0"</span><span class="keyword">) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$broadcast</span><span class="keyword">.=</span><span class="string">"1"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }&nbsp; else {
<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="default">$broadcast</span><span class="keyword">.=</span><span class="string">"0"</span><span class="keyword">;
<br />
&nbsp;&nbsp; &nbsp;&nbsp; }
<br />
&nbsp;&nbsp; }
<br />
&nbsp;&nbsp; </span><span class="default">$net</span><span class="keyword">[</span><span class="string">"broadcast"</span><span class="keyword">]=</span><span class="default">long2ip</span><span class="keyword">(</span><span class="default">bindec</span><span class="keyword">(</span><span class="default">$broadcast</span><span class="keyword">));
<br />

<br />
&nbsp;&nbsp; return </span><span class="default">$net</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
