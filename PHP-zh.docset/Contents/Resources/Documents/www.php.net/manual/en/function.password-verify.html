<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=gb2312">
  <title>验证密码是否和散列值匹配</title>
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-base.css" />
<link media="all" rel="stylesheet" type="text/css" href="styles/03e73060321a0a848018724a6c83de7f-theme-medium.css" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs" class="docs"><div class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <ul class="nav" style="width: 100%">
      <li style="float: left;"><a href="function.password-needs-rehash.html">? password_needs_rehash</a></li>
      <li style="float: right;"><a href="book.sodium.html">Sodium ?</a></li>
    </ul>
  </div>
</div>
<div id="breadcrumbs" class="clearfix">
  <ul class="breadcrumbs-container">
    <li><a href="index.html">PHP Manual</a></li>
    <li><a href="ref.password.html">密码散列算法函数</a></li>
    <li>验证密码是否和散列值匹配</li>
  </ul>
</div>
<div id="layout">
  <div id="layout-content"><div id="function.password-verify" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">password_verify</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.5.0, PHP 7)</p><p class="refpurpose"><span class="refname">password_verify</span> &mdash; <span class="dc-title">验证密码是否和散列值匹配</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.password-verify-description">
  <h3 class="title">说明</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>password_verify</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$hash</code></span>
   ) : <span class="type">bool</span></div>

  <p class="para rdfs-comment">
   验证密码是否和指定的散列值匹配。
  </p>
  <p class="para">
   注意 <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> 返回的散列包含了算法、 cost 和盐值。
   因此，所有需要的信息都包含内。使得验证函数不需要储存额外盐值等信息即可验证哈希。
  </p>
  <p class="para">
   时序攻击（timing attacks）对此函数不起作用。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.password-verify-parameters">
  <h3 class="title">参数</h3>
  <dl>

   
    <dt>
<code class="parameter">password</code></dt>

    <dd>

     <p class="para">
      用户的密码。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">hash</code></dt>

    <dd>

     <p class="para">
      一个由 <span class="function"><a href="function.password-hash.html" class="function">password_hash()</a></span> 创建的散列值。
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.password-verify-returnvalues">
  <h3 class="title">返回值</h3>
  <p class="para">
   如果密码和散列值匹配则返回 <strong><code>TRUE</code></strong>，否则返回 <strong><code>FALSE</code></strong> 。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.password-verify-examples">
  <h3 class="title">范例</h3>
  <p class="para">
   <div class="example" id="openssl_spki_export.example.keygen">
    <p><strong>Example #1 <span class="function"><strong>password_verify()</strong></span> 例子</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;想知道以下字符从哪里来，可参见&nbsp;password_hash()&nbsp;的例子<br /></span><span style="color: #0000BB">$hash&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'$2y$07$BCryptRequires22Chrcte/VlQH0piJtjXl.0t1XkA8pw9dMXTpOq'</span><span style="color: #007700">;<br /><br />if&nbsp;(</span><span style="color: #0000BB">password_verify</span><span style="color: #007700">(</span><span style="color: #DD0000">'rasmuslerdorf'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$hash</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Password&nbsp;is&nbsp;valid!'</span><span style="color: #007700">;<br />}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Invalid&nbsp;password.'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>以上例程会输出：</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Password is valid!
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.password-verify-seealso">
  <h3 class="title">参见</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.password-hash.html" class="function" rel="rdfs-seeAlso">password_hash()</a> - 创建密码的散列（hash）</span></li>
    <li class="member"><a href="https://github.com/ircmaxell/password_compat" class="link external" title="Link : https://github.com/ircmaxell/password_compat">&raquo;&nbsp;用户使用</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121974""></a>
  <div class="note">
   <strong class="user">omidbahrami1990 at gmail dot com</strong>
   <a href="#121974" class="date">04-Dec-2017 10:03</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This Is The Most Secure Way To Keep Your Password Safe With PHP 7 , <br />
Even When Your DataBase Has Been Hacked ,<br />
It Will Be Almost Impossible To Retrieve Your Password .<br />
--------------------------------------------------------<br />
--- When A User Wants To Sign Up ---<br />
1 ---&gt; Get Input From User Which Is The User`s Password<br />
1 ---&gt; Hash The Password<br />
2 ---&gt; Store The Hashed Password In Your DataBase<br />
--------------------------------------------------------<br />
<span class="default">&lt;?php<br />
$hashed_password </span><span class="keyword">= </span><span class="default">password_hash</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">],</span><span class="default">PASSWORD_DEFAULT</span><span class="keyword">);<br />
<br />
</span><span class="comment">// $_POST["password"] ---&gt; Is The User`s Input<br />
// $hashed_password ---&gt; Is The Hashed Password You Can Store In Your DataBase<br />
</span><span class="default">?&gt;<br />
</span>--------------------------------------------------------<br />
--- When A User Wants To Sign In ---<br />
1 ---&gt; Get Input From User Which Is The User`s Password<br />
2 ---&gt; Fetch The Hashed Password From Your Database<br />
3 ---&gt; Compare The User`s Input And The Hashed Password <br />
--------------------------------------------------------<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if(</span><span class="default">password_verify</span><span class="keyword">(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">"password"</span><span class="keyword">],</span><span class="default">$hashed_password</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Welcome"</span><span class="keyword">; <br />
<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">"Wrong Password"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// $_POST["password"] ---&gt; Is The User`s Input<br />
// $hashed_password ---&gt; Is The Hashed Password You Have Fetched From DataBase<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118640""></a>
  <div class="note">
   <strong class="user">chris at weeone dot de</strong>
   <a href="#118640" class="date">14-Jan-2016 12:09</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
The function password_verify() uses constant time. This makes it safe against timing attacks. Don't use crypt($password_database) === crypt($password_given_by_login), since there is no protection against timing attacks!<br />
<br />
If you don't want to use password_verify(), then have a look at hash_equals(), which also runs a timing attack safe string comparison.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115120""></a>
  <div class="note">
   <strong class="user">Anonymous</strong>
   <a href="#115120" class="date">29-May-2014 01:40</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you get incorrect false responses from password_verify when manually including the hash variable (eg. for testing) and you know it should be correct, make sure you are enclosing the hash variable in single quotes (') and not double quotes (").
<br />

<br />
PHP parses anything that starts with a $ inside double quotes as a variable:
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="comment">// this will result in 'Invalid Password' as the hash is parsed into 3 variables of
<br />
// $2y, $07 and $BCryptRequires22Chrcte/VlQH0piJtjXl.0t1XkA8pw9dMXTpOq
<br />
// due to it being enclosed inside double quotes
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="string">"$2y$07</span><span class="default">$BCryptRequires22Chrcte</span><span class="string">/VlQH0piJtjXl.0t1XkA8pw9dMXTpOq"</span><span class="keyword">;
<br />

<br />
</span><span class="comment">// this will result in 'Password is valid' as variables are not parsed inside single quotes
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="string">'$2y$07$BCryptRequires22Chrcte/VlQH0piJtjXl.0t1XkA8pw9dMXTpOq'</span><span class="keyword">;
<br />

<br />
if (</span><span class="default">password_verify</span><span class="keyword">(</span><span class="string">'rasmuslerdorf'</span><span class="keyword">, </span><span class="default">$hash</span><span class="keyword">)) {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Password is valid!'</span><span class="keyword">;
<br />
} else {
<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Invalid password.'</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113493""></a>
  <div class="note">
   <strong class="user">suit at rebell dot at</strong>
   <a href="#113493" class="date">18-Oct-2013 07:18</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
As Vasil Toshkov stated, password_verify() can be used to verify a password created by crypt() or password_hash()<br />
<br />
That is because passwords created by password_hash() also use the C crypt sheme<br />
<br />
If you want to verify older plain MD5-Hashes you just need to prefix them with $1$<br />
<br />
See https://en.wikipedia.org/wiki/Crypt_(C) for more information.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113455""></a>
  <div class="note">
   <strong class="user">Vasil Toshkov</strong>
   <a href="#113455" class="date">12-Oct-2013 09:16</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This function can be used to verify hashes created with other functions like crypt(). For example:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$hash </span><span class="keyword">= </span><span class="string">'$1$toHVx1uW$KIvW9yGZZSU/1YOidHeqJ/'</span><span class="keyword">;<br />
<br />
if (</span><span class="default">password_verify</span><span class="keyword">(</span><span class="string">'rasmuslerdorf'</span><span class="keyword">, </span><span class="default">$hash</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Password is valid!'</span><span class="keyword">;<br />
} else {<br />
&nbsp;&nbsp;&nbsp; echo </span><span class="string">'Invalid password.'</span><span class="keyword">;<br />
}<br />
<br />
</span><span class="comment">// Output: Password is valid!<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
</div></div></body></html>
